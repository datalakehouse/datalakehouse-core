

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER_ADDRESS"
),
rename AS 
(   
SELECT 
    MD5(ID) AS K_CUSTOMER_ADDRESS_DLHK
    ,ID AS K_CUSTOMER_ADDRESS_BK
    ,MD5(CONCAT(
        COALESCE(ADDRESS1,'00'),
        COALESCE(ADDRESS2,'00'),
        COALESCE(CITY,'00'),
        COALESCE(COUNTRY,'00'),
        COALESCE(COUNTRY_CODE,'00'),
        COALESCE(FIRST_NAME,'00'),
        COALESCE(LAST_NAME,'00'),
        COALESCE(PROVINCE,'00'),
        COALESCE(PROVINCE_CODE,'00'),
        COALESCE(ZIP,'00')
    )) AS K_ADDRESS_DLHK
    ,CUSTOMER_ID AS K_CUSTOMER_BK
    ,ADDRESS1 AS A_ADDRESS1
    ,ADDRESS2 AS A_ADDRESS2
    ,CITY AS A_CITY
    ,COMPANY AS A_COMPANY
    ,COUNTRY AS A_COUNTRY
    ,COUNTRY_CODE AS A_COUNTRY_CODE
    ,COUNTRY_NAME AS A_COUNTRY_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,PHONE AS A_PHONE
    ,PROVINCE AS A_PROVINCE
    ,PROVINCE_CODE AS A_PROVINCE_CODE
    ,ZIP AS A_ZIP
    ,IS_DEFAULT AS B_IS_DEFAULT  
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename