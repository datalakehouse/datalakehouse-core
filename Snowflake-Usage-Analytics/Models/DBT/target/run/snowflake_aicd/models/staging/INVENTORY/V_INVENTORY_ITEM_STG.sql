
  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_ITEM"
),
inventory_level AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_LEVEL"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
products AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename AS 
(   
  SELECT   
  MD5(S.ID) AS K_INVENTORY_ITEM_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
  ,L.K_LOCATION_DLHK
  ,L.K_LOCATION_BK  
  ,S.ID AS K_INVENTORY_ITEM_BK
  ,S.COUNTRY_CODE_OF_ORIGIN AS A_COUNTRY_CODE_OF_ORIGIN
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.PROVINCE_CODE_OF_ORIGIN AS A_PROVINCE_CODE_OF_ORIGIN
  ,S.SKU AS A_SKU
  ,S.UPDATED_AT AS A_UPDATED_AT
  ,S.HARMONIZED_SYSTEM_CODE AS A_HARMONIZED_SYSTEM_CODE  
  --BOOLEAN
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TRACKED AS B_TRACKED
  --METRICS
  ,S.COST::decimal(15,2) AS M_COST 
  ,IL.AVAILABLE AS M_AVAIABLE  
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
  FROM
      source S
      left join inventory_level IL ON IL.INVENTORY_ITEM_ID = S.ID      
      left join locations L ON L.K_LOCATION_BK = IL.LOCATION_ID
      left join products P ON P.K_VARIANT_INVENTORY_ITEM_BK = S.ID 
)


SELECT * FROM rename
  );
