
  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT_LINE_ITEM"
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_ABANDONED_CHECKOUT_ITEM_DLHK
  ,MD5(S.CHECKOUT_ID) AS K_ABANDONED_CHECKOUT_DLHK
  
  ,MD5(CONCAT(S.PRODUCT_ID,'-',COALESCE(S.VARIANT_ID,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_ABANDONED_CHECKOUT_ITEM_BK
  ,S.CHECKOUT_ID AS K_ABANDONED_CHECKOUT_BK
  ,S.DESTINATION_LOCATION_ID AS K_DESTINATION_LOCATION_BK    
  ,S.ORIGIN_LOCATION_ID AS K_ORIGIN_LOCATION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  ,S.VARIANT_ID AS K_VARIANT_BK
  --ATTRIBUTES
  ,S.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,S.KEY AS A_KEY
  ,S.PRESENTMENT_TITLE AS A_PRESENTMENT_TITLE
  ,S.PRESENTMENT_VARIANT_TITLE AS A_PRESENTMENT_VARIANT_TITLE
  ,S.SKU AS A_SKU
  ,S.TITLE AS A_TITLE
  ,S.VARIANT_TITLE AS A_VARIANT_TITLE
  ,S.VENDOR AS A_VENDOR
  --BOOLEAN
  ,S.GIFT_CARD AS B_GIFT_CARD
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TAXABLE AS B_TAXABLE
  --METRICS
  ,S.COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,S.GRAMS AS M_GRAMS
  ,S.LINE_PRICE AS M_LINE_PRICE
  ,S.PRICE AS M_PRICE
  ,S.QUANTITY AS M_QUANTITY
  ,S.VARIANT_PRICE AS M_VARIANT_PRICE
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'9a6254a5-a7b6-4785-afcf-f956626fae6f' AS MD_INTGR_ID
  FROM
      source S
)


SELECT * FROM rename
  );
