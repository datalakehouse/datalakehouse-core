
  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_USERS_STG  as (
    
 

WITH source AS (
  SELECT * FROM  SNOWFLAKE.ACCOUNT_USAGE."USERS"
),

rename as (
SELECT
--DLHK
  MD5(S.NAME) AS K_USER_DLHK  
  ,S.NAME AS A_USERNAME
  ,S.BYPASS_MFA_UNTIL AS A_BYPASS_MFA_UNTIL
  ,S.COMMENT AS A_COMMENT  
  ,S.DEFAULT_NAMESPACE AS A_DEFAULT_NAMESPACE
  ,S.DEFAULT_ROLE AS A_DEFAULT_ROLE
  ,S.DEFAULT_WAREHOUSE AS A_DEFAULT_WAREHOUSE  
  ,S.DISABLED AS A_DISABLED
  ,S.DISPLAY_NAME AS A_DISPLAY_NAME
  ,S.EMAIL AS A_EMAIL  
  ,S.EXT_AUTHN_DUO AS A_EXT_AUTHN_DUO
  ,S.FIRST_NAME AS A_FIRST_NAME
  ,S.LAST_NAME AS A_LAST_NAME
  ,S.LAST_SUCCESS_LOGIN AS A_LAST_SUCCESS_LOGIN
  ,S.LOCKED_UNTIL_TIME AS A_LOCKED_UNTIL_TIME
  ,S.LOGIN_NAME AS A_LOGIN_NAME  
  ,S.PASSWORD_LAST_SET_TIME AS A_PASSWORD_LAST_SET_TIME
  ,S.EXT_AUTHN_UID AS A_EXT_AUTHN_UID
  ,S.EXPIRES_AT AS A_EXPIRES_AT_DTS
  --BOOLEAN
  ,S.HAS_PASSWORD AS B_HAS_PASSWORD
  ,S.HAS_RSA_PUBLIC_KEY AS B_HAS_RSA_PUBLIC_KEY
  ,S.MUST_CHANGE_PASSWORD AS B_MUST_CHANGE_PASSWORD
  ,S.SNOWFLAKE_LOCK<>'FALSE' OR S.SNOWFLAKE_LOCK IS NULL AS B_SNOWFLAKE_LOCK
  ,S.DISABLED<>'FALSE' OR S.DISABLED IS NULL AS B_DISABLED
    --metadata (MD)
  ,S.CREATED_ON AS MD_VALID_FROM_DTS
  ,S.DELETED_ON AS MD_VALID_TO_DTS
  ,S.DELETED_ON IS NOT NULL  AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '5d46a0f0-b3d3-4524-9663-160a0476382b' AS MD_INTGR_ID
FROM
    source S
)

SELECT * FROM rename
  );
