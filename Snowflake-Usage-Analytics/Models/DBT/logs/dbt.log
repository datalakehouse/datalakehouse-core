2022-03-03 13:01:58.905704 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '01bec423-ae76-4dfe-ac08-1aba9b21f12f' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:01:58.906154 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:00.576631 (Thread-1): SQL status: SUCCESS 1 in 1.67 seconds
2022-03-03 13:02:00.586753 (Thread-1): finished collecting timing info
2022-03-03 13:02:00.587416 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-03 13:02:01.058885 (Thread-1): 10:02:01 | 4 of 24 OK created view model DBT_SHOPIFY.V_LOCATION_STG............. [SUCCESS 1 in 2.16s]
2022-03-03 13:02:01.059695 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:02:01.060235 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:02:01.066127 (Thread-1): 10:02:01 | 5 of 24 START view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG......... [RUN]
2022-03-03 13:02:01.067075 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:02:01.067599 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:02:01.078981 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-03 13:02:01.079796 (Thread-1): finished collecting timing info
2022-03-03 13:02:01.081480 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-03 13:02:01.083822 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:02:01.083998 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_ADJUSTMENT" AS A
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_ADJUSTMENT_DLHK
  --BK
  ,ID AS K_ORDER_ADJUSTMENT_BK
  ,ORDER_ID AS K_ORDER_BK
  ,REFUND_ID AS K_REFUND_BK
  --ATTRIBUTE
  ,KIND AS A_KIND
  ,REASON AS A_REASON
  --METRIC
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_AMOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT_PRIMARY
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_AMOUNT_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'01bec423-ae76-4dfe-ac08-1aba9b21f12f' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-03 13:02:01.084144 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:02.991684 (Thread-1): SQL status: SUCCESS 1 in 1.91 seconds
2022-03-03 13:02:02.996160 (Thread-1): finished collecting timing info
2022-03-03 13:02:02.996661 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: Close
2022-03-03 13:02:03.457267 (Thread-1): 10:02:03 | 5 of 24 OK created view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG.... [SUCCESS 1 in 2.39s]
2022-03-03 13:02:03.457807 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:02:03.465387 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:02:03.466313 (Thread-1): 10:02:03 | 6 of 24 START view model DBT_SHOPIFY.V_ORDERS_HEADER_STG............. [RUN]
2022-03-03 13:02:03.467210 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:02:03.467676 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:02:03.474402 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-03 13:02:03.475130 (Thread-1): finished collecting timing info
2022-03-03 13:02:03.476558 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-03 13:02:03.485572 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:02:03.486035 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDERS" AS A
),
rename AS 
(
SELECT
    MD5(O.ID) AS K_ORDER_DLHK    
    ,MD5(O.CUSTOMER_ID) AS K_CUSTOMER_DLHK
    ,MD5(O.LOCATION_ID) AS K_LOCATION_DLHK    
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
    --BUSINESS_KEYS
    ,O.APP_ID AS K_APP_BK
    ,O.ID AS K_ORDER_BK
    ,O.CUSTOMER_ID AS K_CUSTOMER_BK
    ,O.DEVICE_ID AS K_DEVICE_BK  
    ,O.LOCATION_ID AS K_LOCATION_BK
    ,O.SOURCE_IDENTIFIER AS K_SOURCE_ENTIFIER_BK
    --ATTRIBUTES
    ,O.BROWSER_IP AS A_BROWSER_IP
    ,O.CANCELLED_AT AS A_CANCELLED_AT_DTS
    ,O.CANCEL_REASON AS A_CANCEL_REASON
    ,O.CART_TOKEN AS A_CART_TOKEN
    ,O.CHECKOUT_TOKEN AS A_CHECKOUT_TOKEN
    ,O.CLIENT_DETAILS AS A_CLIENT_DETAILS
    ,O.CLOSED_AT AS A_CLOSED_AT_DTS
    ,O.CREATED_AT AS A_CREATED_AT_DTS
    ,O.CURRENCY AS A_CURRENCY
    ,O.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
    ,O.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
    ,O.EMAIL AS A_EMAIL
    ,O.FINANCIAL_STATUS AS A_FINANCIAL_STATUS
    ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
    ,O.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
    ,O.LANDING_SITE_REF AS A_LANDING_SITE_REF
    ,O.NAME AS A_NAME
    ,O.NOTE AS A_NOTE
    ,O.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES    
    ,O.PAYMENT_GATEWAY_NAMES AS A_PAYMENT_GATEWAY_NAMES    
    ,O.PROCESSED_AT AS A_PROCESSED_AT_DTS
    ,O.PROCESSING_METHOD AS A_PROCESSING_METHOD
    ,O.REFERENCE AS A_REFERENCE
    ,O.REFERRING_SITE AS A_REFERRING_SITE    
    ,O.SOURCE_NAME AS A_SOURCE_NAME
    ,O.SOURCE_URL AS A_SOURCE_URL    
    ,O.ORDER_NUMBER AS A_ORDER_NUMBER
    ,O.POSION_NUMBER AS A_POSION_NUMBER  
    ,O.UPDATED_AT AS A_UPDATED_AT_DTS
    --BOOLEAN
    ,O.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
    ,O.CONFIRMED AS B_CONFIRMED
    ,O.TAXES_INCLUDED AS B_TAXES_INCLUDED
    --METRICS
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE_PRIMARY 
    ,O.TOTAL_TIP_RECEIVED::DECIMAL(15,2) AS M_TOTAL_TIP_RECEIVED   
    ,O.TOTAL_WEIGHT::DECIMAL(15,2) AS M_TOTAL_WEIGHT
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'01bec423-ae76-4dfe-ac08-1aba9b21f12f' AS MD_INTGR_ID
FROM source O
)

SELECT * FROM rename
  );
2022-03-03 13:02:03.486242 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:07.035669 (Thread-1): SQL status: SUCCESS 1 in 3.55 seconds
2022-03-03 13:02:07.041406 (Thread-1): finished collecting timing info
2022-03-03 13:02:07.042180 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: Close
2022-03-03 13:02:07.557200 (Thread-1): 10:02:07 | 6 of 24 OK created view model DBT_SHOPIFY.V_ORDERS_HEADER_STG........ [SUCCESS 1 in 4.09s]
2022-03-03 13:02:07.557975 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:02:07.558442 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:02:07.560418 (Thread-1): 10:02:07 | 7 of 24 START view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG.. [RUN]
2022-03-03 13:02:07.562497 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:02:07.563041 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:02:07.572049 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-03 13:02:07.573385 (Thread-1): finished collecting timing info
2022-03-03 13:02:07.575187 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-03 13:02:07.577029 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:02:07.577166 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM_TAX_LINE" AS A
),
rename AS 
(
SELECT
  CONCAT(COALESCE(ORDER_ID,'0000000000'),'-',COALESCE(ORDER_LINE_ID,'0000000000')) AS K_ORDER_LINE_ITEM_TAX_DLHK
  ,ORDER_ID AS K_ORDER_BK
  ,ORDER_LINE_ID AS K_ORDER_LINE_ITEM_BK
  ,TITLE AS A_TITLE
  ,CHANNEL_LIABLE AS B_CHANNEL_LIABLE
  ,RATE AS M_RATE
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TAX
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TAX_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'01bec423-ae76-4dfe-ac08-1aba9b21f12f' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-03 13:02:07.577289 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:09.479770 (Thread-1): SQL status: SUCCESS 1 in 1.90 seconds
2022-03-03 13:02:09.483785 (Thread-1): finished collecting timing info
2022-03-03 13:02:09.484399 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: Close
2022-03-03 13:02:09.948242 (Thread-1): 10:02:09 | 7 of 24 OK created view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG [SUCCESS 1 in 2.39s]
2022-03-03 13:02:09.949408 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:02:09.953194 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:02:09.954196 (Thread-1): 10:02:09 | 8 of 24 START view model DBT_SHOPIFY.V_PRODUCT_STG................... [RUN]
2022-03-03 13:02:09.955710 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:02:09.956850 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:02:09.964663 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-03 13:02:09.965138 (Thread-1): finished collecting timing info
2022-03-03 13:02:09.966719 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-03 13:02:09.968135 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:02:09.968268 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_DLHK
  ,ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE
  ,HANDLE AS A_HANDLE
  ,PRODUCT_TYPE AS A_PRODUCT_TYPE
  ,VENDOR AS A_VENDOR
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE
  ,STATUS AS A_STATUS
  ,TEMPLATE_SUFFIX AS A_TEMPLATE_SUFFIX   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '01bec423-ae76-4dfe-ac08-1aba9b21f12f' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:02:09.968380 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:12.559427 (Thread-1): SQL status: SUCCESS 1 in 2.59 seconds
2022-03-03 13:02:12.562464 (Thread-1): finished collecting timing info
2022-03-03 13:02:12.563260 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: Close
2022-03-03 13:02:13.030662 (Thread-1): 10:02:13 | 8 of 24 OK created view model DBT_SHOPIFY.V_PRODUCT_STG.............. [SUCCESS 1 in 3.08s]
2022-03-03 13:02:13.031229 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:02:13.031802 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:02:13.032630 (Thread-1): 10:02:13 | 9 of 24 START view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG........... [RUN]
2022-03-03 13:02:13.033423 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:02:13.033998 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:02:13.049222 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-03 13:02:13.051524 (Thread-1): finished collecting timing info
2022-03-03 13:02:13.053290 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-03 13:02:13.055387 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:02:13.055498 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT_VARIANT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_VARIANT_DLHK
  ,MD5(PRODUCT_ID) AS K_PRODUCT_DLHK  
  --BUSINESS KEYS  
  ,ID AS K_PRODUCT_VARIANT_BK
  ,PRODUCT_ID AS K_PRODUCT_BK  
  ,INVENTORY_ITEM_ID AS K_INVENTORY_ITEM_BK
  ,IMAGE_ID AS K_IMAGE_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE  
  ,SKU AS A_SKU    
  ,FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,INVENTORY_MANAGEMENT AS A_INVENTORY_MANAGEMENT
  ,INVENTORY_POLICY AS A_INVENTORY_POLICY
  ,BARCODE AS A_BARCODE
  ,GRAMS AS A_GRAMS
  ,WEIGHT_UNIT AS A_WEIGHT_UNIT
  ,OPTION_1 AS A_OPTION_1
  ,OPTION_2 AS A_OPTION_2
  ,OPTION_3 AS A_OPTION_3
  ,TAX_CODE AS A_TAX_CODE  
  ,PRESENTMENT_PRICES AS A_PRESENTMENT_PRICES  
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  --BOOLEAN
  ,REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,TAXABLE AS B_TAXABLE
  --METRICS
  ,PRICE AS M_PRICE
  ,POSITION AS M_POSITION
  ,COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,INVENTORY_QUANTITY AS M_INVENTORY_QUANTITY
  ,INVENTORY_QUANTITY_ADJUSTMENT AS M_INVENTORY_QUANTITY_ADJUSTMENT
  ,WEIGHT AS M_WEIGHT
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '01bec423-ae76-4dfe-ac08-1aba9b21f12f' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:02:13.055612 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:15.033444 (Thread-1): SQL status: SUCCESS 1 in 1.98 seconds
2022-03-03 13:02:15.037197 (Thread-1): finished collecting timing info
2022-03-03 13:02:15.038098 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: Close
2022-03-03 13:02:15.498402 (Thread-1): 10:02:15 | 9 of 24 OK created view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG...... [SUCCESS 1 in 2.46s]
2022-03-03 13:02:15.499066 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:02:15.499479 (Thread-1): Began running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:02:15.500996 (Thread-1): 10:02:15 | 10 of 24 START view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG......... [RUN]
2022-03-03 13:02:15.503479 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:02:15.504391 (Thread-1): Compiling model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:02:15.520790 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-03 13:02:15.521392 (Thread-1): finished collecting timing info
2022-03-03 13:02:15.522811 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-03 13:02:15.525631 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:02:15.525804 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG  as (
    


WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND" AS A
),
refund_line as (
    SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND_LINE_ITEM" AS A
),
rename AS 
(
SELECT
  MD5(RL.ID) AS K_REFUND_LINE_DLHK
  ,MD5(R.ID) AS K_REFUND_DLHK
  ,R.ID AS K_REFUND_BK
  ,RL.ID AS K_REFUND_LINE_BK
  ,R.ORDER_ID AS K_ORDER_BK
  ,R.USER_ID AS K_USER_BK
  ,RL.LOCATION_ID AS K_LOCATION_BK
  ,RL.LINE_ITEM_ID AS K_ORDER_LINE_ITEM_BK
  ,R.NOTE AS A_NOTE
  ,R.RESTOCK AS B_RESTOCK
  ,RL.QUANTITY AS M_QUANTITY
  ,RL.RESTOCK_TYPE AS A_RESTOCK_TYPE
   
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_SUBTOTAL


  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'01bec423-ae76-4dfe-ac08-1aba9b21f12f' AS MD_INTGR_ID
FROM source R
LEFT JOIN refund_line RL ON RL.REFUND_ID = R.ID
)

SELECT * FROM rename
  );
2022-03-03 13:02:15.525931 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:17.798877 (Thread-1): SQL status: SUCCESS 1 in 2.27 seconds
2022-03-03 13:02:17.801934 (Thread-1): finished collecting timing info
2022-03-03 13:02:17.802421 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: Close
2022-03-03 13:02:18.441655 (Thread-1): 10:02:18 | 10 of 24 OK created view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG.... [SUCCESS 1 in 2.94s]
2022-03-03 13:02:18.442277 (Thread-1): Finished running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:02:18.442735 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:02:18.443289 (Thread-1): 10:02:18 | 11 of 24 START table model DBT_SHOPIFY.W_CUSTOMERS_D................. [RUN]
2022-03-03 13:02:18.443972 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:02:18.444355 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:02:18.455648 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-03 13:02:18.456973 (Thread-1): finished collecting timing info
2022-03-03 13:02:18.478676 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-03 13:02:18.479745 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:02:18.479995 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG AS C
      );
2022-03-03 13:02:18.480124 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:21.182815 (Thread-1): SQL status: SUCCESS 1 in 2.70 seconds
2022-03-03 13:02:21.202749 (Thread-1): finished collecting timing info
2022-03-03 13:02:21.203292 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-03 13:02:22.007086 (Thread-1): 10:02:22 | 11 of 24 OK created table model DBT_SHOPIFY.W_CUSTOMERS_D............ [SUCCESS 1 in 3.56s]
2022-03-03 13:02:22.007650 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:02:22.008049 (Thread-1): Began running node model.snowflake_aicd.W_DATE_D
2022-03-03 13:02:22.008810 (Thread-1): 10:02:22 | 12 of 24 START table model DBT_SHOPIFY.W_DATE_D...................... [RUN]
2022-03-03 13:02:22.009924 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:02:22.010530 (Thread-1): Compiling model.snowflake_aicd.W_DATE_D
2022-03-03 13:02:22.020886 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-03 13:02:22.021600 (Thread-1): finished collecting timing info
2022-03-03 13:02:22.023079 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-03 13:02:22.026013 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:02:22.026168 (Thread-1): On model.snowflake_aicd.W_DATE_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_DATE_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_DATE_D  as
      (

SELECT 
	CAST(DATE_KEY AS NUMBER(9)) AS K_DATE_INTEGER_BK
	,CAST(DATE_COLUMN AS DATE) AS K_DATE_BK
	,CAST(FULL_DATE_DESC AS VARCHAR(64)) AS A_FULL_DATE_DESC
	,CAST(DAY_NUM_IN_WEEK AS NUMBER(1)) AS A_DAY_NUM_IN_WEEK
	,CAST(DAY_NUM_IN_MONTH AS NUMBER(2)) AS A_DAY_NUM_IN_MONTH
	,CAST(DAY_NUM_IN_YEAR AS NUMBER(3)) AS A_DAY_NUM_IN_YEAR
	,CAST(DAY_NAME AS VARCHAR(10)) AS A_DAY_NAME
	,CAST(DAY_ABBREV AS VARCHAR(3)) AS A_DAY_ABBREV
	,CAST(WEEKDAY_IND AS VARCHAR(64)) AS A_WEEKDAY_IND
	,CAST(US_HOLIDAY_IND AS VARCHAR(64)) AS A_US_HOLIDAY_IND
	,CAST(COMPANY_HOLIDAY_IND AS VARCHAR(64)) AS A_COMPANY_HOLIDAY_IND
	,CAST(MONTH_END_IND AS VARCHAR(64)) AS A_MONTH_END_IND
	,CAST(WEEK_BEGIN_DATE_NKEY AS NUMBER(9)) AS A_WEEK_BEGIN_DATE_NKEY
	,CAST(WEEK_BEGIN_DATE AS DATE) AS A_WEEK_BEGIN_DATE
	,CAST(WEEK_END_DATE_NKEY AS NUMBER(9)) AS A_WEEK_END_DATE_NKEY
	,CAST(WEEK_END_DATE AS DATE) AS A_WEEK_END_DATE
	,CAST(WEEK_NUM_IN_YEAR AS NUMBER(9)) AS A_WEEK_NUM_IN_YEAR
	,CAST(MONTH_NAME AS VARCHAR(10)) AS A_MONTH_NAME
	,CAST(MONTH_ABBREV AS VARCHAR(3)) AS A_MONTH_ABBREV
	,CAST(MONTH_NUM_IN_YEAR AS NUMBER(2)) AS A_MONTH_NUM_IN_YEAR
	,CAST(YEARMONTH AS VARCHAR(10)) AS A_YEARMONTH
	,CAST(CURRENT_QUARTER AS NUMBER(1)) AS A_QUARTER
	,CAST(YEARQUARTER AS VARCHAR(10)) AS A_YEARQUARTER
	,CAST(CURRENT_YEAR AS NUMBER(5)) AS A_YEAR
	,CAST(FISCAL_WEEK_NUM AS NUMBER(2)) AS A_FISCAL_WEEK_NUM
	,CAST(FISCAL_MONTH_NUM AS NUMBER(2)) AS A_FISCAL_MONTH_NUM
	,CAST(FISCAL_YEARMONTH AS VARCHAR(10)) AS A_FISCAL_YEARMONTH
	,CAST(FISCAL_QUARTER AS NUMBER(1)) AS A_FISCAL_QUARTER
	,CAST(FISCAL_YEARQUARTER AS VARCHAR(10)) AS A_FISCAL_YEARQUARTER
	,CAST(FISCAL_HALFYEAR AS NUMBER(1)) AS A_FISCAL_HALFYEAR
	,CAST(FISCAL_YEAR AS NUMBER(5)) AS A_FISCAL_YEAR
	,CAST(SQL_TIMESTAMP AS TIMESTAMP_NTZ) AS A_SQL_TIMESTAMP_DTS
	,CAST(CURRENT_ROW_IND AS CHAR(1)) AS A_CURRENT_ROW_IND
	,CAST(EFFECTIVE_DATE AS DATE) AS A_EFFECTIVE_DATE
	,CAST(EXPIRA_DATE AS DATE) AS A_EXPIRATION_DATE
FROM
DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG
      );
2022-03-03 13:02:22.026283 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:25.952702 (Thread-1): SQL status: SUCCESS 1 in 3.93 seconds
2022-03-03 13:02:25.957385 (Thread-1): finished collecting timing info
2022-03-03 13:02:25.958021 (Thread-1): On model.snowflake_aicd.W_DATE_D: Close
2022-03-03 13:02:26.594091 (Thread-1): 10:02:26 | 12 of 24 OK created table model DBT_SHOPIFY.W_DATE_D................. [SUCCESS 1 in 4.58s]
2022-03-03 13:02:26.594675 (Thread-1): Finished running node model.snowflake_aicd.W_DATE_D
2022-03-03 13:02:26.595506 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:02:26.596181 (Thread-1): 10:02:26 | 13 of 24 START table model DBT_SHOPIFY.W_LOCATION_D.................. [RUN]
2022-03-03 13:02:26.596987 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:02:26.597458 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:02:26.614733 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-03 13:02:26.615415 (Thread-1): finished collecting timing info
2022-03-03 13:02:26.617019 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-03 13:02:26.617713 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:02:26.617819 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-03 13:02:26.617926 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:29.519685 (Thread-1): SQL status: SUCCESS 1 in 2.90 seconds
2022-03-03 13:02:29.526153 (Thread-1): finished collecting timing info
2022-03-03 13:02:29.527443 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-03 13:02:29.973442 (Thread-1): 10:02:29 | 13 of 24 OK created table model DBT_SHOPIFY.W_LOCATION_D............. [SUCCESS 1 in 3.38s]
2022-03-03 13:02:29.974297 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:02:29.979250 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:02:29.989275 (Thread-1): 10:02:29 | 14 of 24 START view model DBT_SHOPIFY.V_PRODUCTS_D_STG............... [RUN]
2022-03-03 13:02:29.990544 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:02:29.991054 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:02:29.996957 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-03 13:02:29.997500 (Thread-1): finished collecting timing info
2022-03-03 13:02:29.998916 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-03 13:02:30.002155 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:02:30.002297 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCTS_D_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG  as (
    
 

WITH product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG
),
product_variant AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG
),

rename as (


SELECT
    CONCAT(P.K_PRODUCT_BK,'-',COALESCE(V.K_PRODUCT_VARIANT_BK,'0000000000')) AS K_PRODUCT_VARIATION_DLHK
    ,P.K_PRODUCT_DLHK
    ,V.K_PRODUCT_VARIANT_DLHK AS K_PRODUCT_VARIANT_DLHK
    ,V.K_PRODUCT_VARIANT_BK AS K_PRODUCT_VARIANT_BK
    ,P.K_PRODUCT_BK AS K_PRODUCT_BK
    ,V.K_INVENTORY_ITEM_BK AS K_VARIANT_INVENTORY_ITEM_BK
    ,V.K_IMAGE_BK AS K_VARIANT_IMAGE_BK
    --ATTRIBUTES
    ,P.A_TITLE
    ,P.A_HANDLE
    ,P.A_PRODUCT_TYPE
    ,P.A_VENDOR
    ,P.A_CREATED_AT_DTS
    ,P.A_UPDATED_AT_DTS
    ,P.A_PUBLISHED_AT_DTS
    ,P.A_PUBLISHED_SCOPE
    ,P.A_STATUS
    ,P.A_TEMPLATE_SUFFIX       
    ,V.A_TITLE AS A_VARIANT_TITLE
    ,V.A_SKU AS A_VARIANT_SKU
    ,V.A_FULFILLMENT_SERVICE AS A_VARIANT_FULFILLMENT_SERVICE
    ,V.A_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
    ,V.A_BARCODE AS A_VARIANT_BARCODE
    ,V.A_INVENTORY_POLICY AS A_VARIANT_INVENTORY_POLICY
    ,V.A_GRAMS AS A_VARIANT_GRAMS
    ,V.A_WEIGHT_UNIT AS A_VARIANT_WEIGHT_UNIT
    ,V.A_OPTION_1 AS A_VARIANT_OPTION_1
    ,V.A_OPTION_2 AS A_VARIANT_OPTION_2
    ,V.A_OPTION_3 AS A_VARIANT_OPTION_3
    ,V.A_TAX_CODE AS A_VARIANT_TAX_CODE
    ,V.A_PRESENTMENT_PRICES AS A_VARIANT_PRESENTMENT_PRICES
    ,V.A_CREATED_AT_DTS AS A_VARIANT_CREATED_AT_DTS
    ,V.A_UPDATED_AT_DTS AS A_VARIANT_UPDATED_AT_DTS
    --BOOLEAN
    ,V.B_REQUIRES_SHIPPING AS B_VARIANT_REQUIRES_SHIPPING
    ,V.B_TAXABLE AS B_VARIANT_TAXABLE
    --METRICS
    ,V.M_PRICE AS M_VARIANT_PRICE
    ,V.M_POSITION AS M_VARIANT_POSITION
    ,V.M_COMPARE_AT_PRICE AS M_VARIANT_COMPARE_AT_PRICE
    ,V.M_INVENTORY_QUANTITY AS M_VARIANT_INVENTORY_QUANTITY
    ,V.M_INVENTORY_QUANTITY_ADJUSTMENT AS M_VARIANT_INVENTORY_QUANTITY_ADJUSTMENT
    ,V.M_WEIGHT AS M_VARIANT_WEIGHT
    --metadata (MD)
    ,P.MD_IS_DELETED AS MD_IS_DELETED_PRODUCT
    ,V.MD_IS_DELETED AS MD_IS_DELETED_VARIANT
    , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
    , '01bec423-ae76-4dfe-ac08-1aba9b21f12f' AS MD_INTGR_ID
FROM
    product P
    LEFT JOIN product_variant V ON V.K_PRODUCT_BK = P.K_PRODUCT_BK
)

SELECT * FROM rename
  );
2022-03-03 13:02:30.002421 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:32.271015 (Thread-1): SQL status: SUCCESS 1 in 2.27 seconds
2022-03-03 13:02:32.274052 (Thread-1): finished collecting timing info
2022-03-03 13:02:32.274530 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: Close
2022-03-03 13:02:32.724212 (Thread-1): 10:02:32 | 14 of 24 OK created view model DBT_SHOPIFY.V_PRODUCTS_D_STG.......... [SUCCESS 1 in 2.73s]
2022-03-03 13:02:32.729604 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:02:32.730076 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:02:32.730646 (Thread-1): 10:02:32 | 15 of 24 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG....... [RUN]
2022-03-03 13:02:32.731425 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:02:32.731911 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:02:32.747345 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-03 13:02:32.749109 (Thread-1): finished collecting timing info
2022-03-03 13:02:32.750905 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-03 13:02:32.756235 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:02:32.756381 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT"
),
customer AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 

  MD5(S.ID) AS K_ABANDONED_CHECKOUT_DLHK
  ,C.K_CUSTOMER_DLHK
  ,L.K_LOCATION_DLHK
  ,MD5(S.USER_ID) AS K_USER_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK  
  ,S.ID AS K_ABANDONED_CHECKOUT_BK
  ,S.CUSTOMER_ID AS K_CUSTOMER_BK
  ,S.DEVICE_ID AS K_DEVICE_BK
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.SOURCE_IDENTIFIER AS K_SOURCE_BKENTIFIER
  ,S.USER_ID AS K_USER_BK
  ,S.ABANDONED_CHECKOUT_URL AS A_ABANDONED_CHECKOUT_URL  
  ,S.CART_TOKEN AS A_CART_TOKEN
  ,S.CLOSED_AT AS A_CLOSED_AT
  ,S.COMPLETED_AT AS A_COMPLETED_AT
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
  ,S.EMAIL AS A_EMAIL
  ,S.GATEWAY AS A_GATEWAY
  ,S.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
  ,S.NAME AS A_NAME
  ,S.NOTE AS A_NOTE
  ,S.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES
  ,S.PHONE AS A_PHONE
  ,S.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
  ,S.REFERRING_SITE AS A_REFERRING_SITE    
  ,S.SOURCE AS A_SOURCE
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.SOURCE_URL AS A_SOURCE_URL
  ,S.TOKEN AS A_TOKEN
  ,S.UPDATED_AT AS A_UPDATED_AT  
  --BOOLEAN
  ,S.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
  ,S.TAXES_INCLUDED AS B_TAXES_INCLUDED
  --METRIC
  ,S.SUBTOTAL_PRICE::decimal(15,2) AS M_SUBTOTAL_PRICE
  ,S.TOTAL_DISCOUNTS::decimal(15,2) AS M_TOTAL_DISCOUNTS
  ,S.TOTAL_DUTIES::decimal(15,2) AS M_TOTAL_DUTIES
  ,S.TOTAL_LINE_ITEMS_PRICE::decimal(15,2) AS M_TOTAL_LINE_ITEMS_PRICE
  ,S.TOTAL_PRICE::decimal(15,2) AS M_TOTAL_PRICE
  ,S.TOTAL_TAX::decimal(15,2) AS M_TOTAL_TAX
  ,S.TOTAL_WEIGHT::decimal(15,2) AS M_TOTAL_WEIGHT
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'01bec423-ae76-4dfe-ac08-1aba9b21f12f' AS MD_INTGR_ID
  FROM
      source S
      left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
      left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-03 13:02:32.756512 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:34.962958 (Thread-1): SQL status: SUCCESS 1 in 2.21 seconds
2022-03-03 13:02:34.966345 (Thread-1): finished collecting timing info
2022-03-03 13:02:34.966897 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: Close
2022-03-03 13:02:35.771339 (Thread-1): 10:02:35 | 15 of 24 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.. [SUCCESS 1 in 3.04s]
2022-03-03 13:02:35.773097 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:02:35.773790 (Thread-1): Began running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:02:35.776893 (Thread-1): 10:02:35 | 16 of 24 START view model DBT_SHOPIFY.V_TRANSACTIONS_STG............. [RUN]
2022-03-03 13:02:35.778216 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:02:35.779511 (Thread-1): Compiling model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:02:35.791631 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-03 13:02:35.792311 (Thread-1): finished collecting timing info
2022-03-03 13:02:35.793966 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-03 13:02:35.796121 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:02:35.796232 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_TRANSACTIONS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."TRANSACTION"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_TRANSACTION_DLHK
  ,L.K_LOCATION_DLHK  
  ,MD5(S.USER_ID) AS K_USER_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_TRANSACTION_BK
  ,S.DEVICE_ID AS K_DEVICE_BK  
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.ORDER_ID AS K_ORDER_BK
  ,S.PARENT_ID AS K_PARENT_BK
  ,S.REFUND_ID AS K_REFUND_BK
  ,S.USER_ID AS K_USER_BK  
  --ATTRIBUTES
  ,S.AUTHORIZATION AS A_AUTHORIZATION
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CURRENCY_EXCHANGE_ADJUSTMENT AS A_CURRENCY_EXCHANGE_ADJUSTMENT
  ,S.ERROR_CODE AS A_ERROR_CODE
  ,S.GATEWAY AS A_GATEWAY
  ,S.KIND AS A_KIND
  ,S.MESSAGE AS A_MESSAGE
  ,S.PAYMENT_DETAILS AS A_PAYMENT_DETAILS
  ,S.PROCESSED_AT AS A_PROCESSED_AT
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.STATUS AS A_STATUS
  --boolean
  ,S.TEST AS B_TEST
  --METRICS
  ,S.AMOUNT::decimal(15,2) AS M_AMOUNT   
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'01bec423-ae76-4dfe-ac08-1aba9b21f12f' AS MD_INTGR_ID
  FROM
    source S
  left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
  left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-03 13:02:35.796335 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:37.854247 (Thread-1): Snowflake query id: 01a2adce-0601-3d9c-000b-358300f23b96
2022-03-03 13:02:37.854672 (Thread-1): Snowflake error: 002003 (42S02): SQL compilation error:
Object 'DEVELOPER_SANDBOX.DBT_SHOPIFY.CUSTOMER' does not exist or not authorized.
2022-03-03 13:02:37.854979 (Thread-1): finished collecting timing info
2022-03-03 13:02:37.855153 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: Close
2022-03-03 13:02:38.858372 (Thread-1): Database Error in model V_TRANSACTIONS_STG (models/staging/TRANSACTION/V_TRANSACTIONS_STG.sql)
  002003 (42S02): SQL compilation error:
  Object 'DEVELOPER_SANDBOX.DBT_SHOPIFY.CUSTOMER' does not exist or not authorized.
  compiled SQL at target/run/snowflake_aicd/models/staging/TRANSACTION/V_TRANSACTIONS_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002003 (42S02): SQL compilation error:
Object 'DEVELOPER_SANDBOX.DBT_SHOPIFY.CUSTOMER' does not exist or not authorized.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_TRANSACTIONS_STG (models/staging/TRANSACTION/V_TRANSACTIONS_STG.sql)
  002003 (42S02): SQL compilation error:
  Object 'DEVELOPER_SANDBOX.DBT_SHOPIFY.CUSTOMER' does not exist or not authorized.
  compiled SQL at target/run/snowflake_aicd/models/staging/TRANSACTION/V_TRANSACTIONS_STG.sql
2022-03-03 13:02:38.886185 (Thread-1): 10:02:38 | 16 of 24 ERROR creating view model DBT_SHOPIFY.V_TRANSACTIONS_STG.... [ERROR in 3.11s]
2022-03-03 13:02:38.886361 (Thread-1): Finished running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:02:38.886544 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:02:38.886766 (Thread-1): 10:02:38 | 17 of 24 START table model DBT_SHOPIFY.W_PRODUCTS_D.................. [RUN]
2022-03-03 13:02:38.887336 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:02:38.887484 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:02:38.892661 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-03 13:02:38.893141 (Thread-1): finished collecting timing info
2022-03-03 13:02:38.895861 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-03 13:02:38.896762 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:02:38.896933 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCTS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG AS C
      );
2022-03-03 13:02:38.897047 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:42.239551 (Thread-1): SQL status: SUCCESS 1 in 3.34 seconds
2022-03-03 13:02:42.243113 (Thread-1): finished collecting timing info
2022-03-03 13:02:42.243655 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: Close
2022-03-03 13:02:42.770798 (Thread-1): 10:02:42 | 17 of 24 OK created table model DBT_SHOPIFY.W_PRODUCTS_D............. [SUCCESS 1 in 3.88s]
2022-03-03 13:02:42.771512 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:02:42.772160 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:02:42.773712 (Thread-1): 10:02:42 | 18 of 24 START table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F........ [RUN]
2022-03-03 13:02:42.775967 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:02:42.776690 (Thread-1): Compiling model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:02:42.787358 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-03 13:02:42.788653 (Thread-1): finished collecting timing info
2022-03-03 13:02:42.790111 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-03 13:02:42.790740 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:02:42.790839 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG AS C
      );
2022-03-03 13:02:42.790941 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:46.103177 (Thread-1): SQL status: SUCCESS 1 in 3.31 seconds
2022-03-03 13:02:46.109195 (Thread-1): finished collecting timing info
2022-03-03 13:02:46.109798 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: Close
2022-03-03 13:02:46.572172 (Thread-1): 10:02:46 | 18 of 24 OK created table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F... [SUCCESS 1 in 3.80s]
2022-03-03 13:02:46.572817 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:02:46.573234 (Thread-1): Began running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:02:46.573732 (Thread-1): 10:02:46 | 19 of 24 SKIP relation DBT_SHOPIFY.W_TRANSACTIONS_F.................. [SKIP]
2022-03-03 13:02:46.574437 (Thread-1): Finished running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:02:46.575516 (Thread-1): Began running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:02:46.576882 (Thread-1): 10:02:46 | 20 of 24 START view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG........... [RUN]
2022-03-03 13:02:46.577821 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:02:46.578280 (Thread-1): Compiling model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:02:46.589514 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-03 13:02:46.590726 (Thread-1): finished collecting timing info
2022-03-03 13:02:46.592895 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-03 13:02:46.595060 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:02:46.595191 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_INVENTORY_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_ITEM"
),
inventory_level AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_LEVEL"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
products AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename AS 
(   
  SELECT   
  ,MD5(S.ID) AS K_INVENTORY_ITEM_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
  ,L.K_LOCATION_DLHK
  ,L.K_LOCATION_BK  
  ,S.ID AS K_INVENTORY_ITEM_BK
  ,S.COUNTRY_CODE_OF_ORIGIN AS A_COUNTRY_CODE_OF_ORIGIN
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.PROVINCE_CODE_OF_ORIGIN AS A_PROVINCE_CODE_OF_ORIGIN
  ,S.SKU AS A_SKU
  ,S.UPDATED_AT AS A_UPDATED_AT
  ,S.HARMONIZED_SYSTEM_CODE AS A_HARMONIZED_SYSTEM_CODE  
  --BOOLEAN
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TRACKED AS B_TRACKED
  --METRICS
  ,S.COST::decimal(15,2) AS M_COST 
  ,IL.AVAILABLE AS M_AVAIABLE  
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'01bec423-ae76-4dfe-ac08-1aba9b21f12f' AS MD_INTGR_ID
  FROM
      source S
      left join inventory_level IL ON IL.INVENTORY_ITEM_ID = S.ID      
      left join locations L ON L.K_LOCATION_BK = IL.LOCATION_ID
      left join products P ON P.K_VARIANT_INVENTORY_ITEM_BK = S.ID 
)


SELECT * FROM rename
  );
2022-03-03 13:02:46.595304 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:48.414001 (Thread-1): Snowflake query id: 01a2adce-0601-3da5-000b-358300f22c5e
2022-03-03 13:02:48.414208 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 31 at position 2 unexpected ','.
2022-03-03 13:02:48.414366 (Thread-1): finished collecting timing info
2022-03-03 13:02:48.414504 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: Close
2022-03-03 13:02:48.916787 (Thread-1): Database Error in model V_INVENTORY_ITEM_STG (models/staging/INVENTORY/V_INVENTORY_ITEM_STG.sql)
  001003 (42000): SQL compilation error:
  syntax error line 31 at position 2 unexpected ','.
  compiled SQL at target/run/snowflake_aicd/models/staging/INVENTORY/V_INVENTORY_ITEM_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 31 at position 2 unexpected ','.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_INVENTORY_ITEM_STG (models/staging/INVENTORY/V_INVENTORY_ITEM_STG.sql)
  001003 (42000): SQL compilation error:
  syntax error line 31 at position 2 unexpected ','.
  compiled SQL at target/run/snowflake_aicd/models/staging/INVENTORY/V_INVENTORY_ITEM_STG.sql
2022-03-03 13:02:48.950246 (Thread-1): 10:02:48 | 20 of 24 ERROR creating view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG.. [ERROR in 2.37s]
2022-03-03 13:02:48.950443 (Thread-1): Finished running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:02:48.950592 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:02:48.950762 (Thread-1): 10:02:48 | 21 of 24 START view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG......... [RUN]
2022-03-03 13:02:48.951143 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:02:48.951263 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:02:48.955156 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-03 13:02:48.955609 (Thread-1): finished collecting timing info
2022-03-03 13:02:48.957348 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-03 13:02:48.961609 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:02:48.961747 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM" AS A
),
products AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D AS A
),
taxes AS (
  SELECT 
      K_ORDER_LINE_ITEM_BK,
      AVG(M_RATE) AS M_RATE,
      SUM(M_TAX) AS M_TAX,
      SUM(M_TAX_PRIMARY) AS M_TAX_PRIMARY
    FROM 
      DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG AS A
    GROUP BY K_ORDER_LINE_ITEM_BK
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_LINE_ITEM_DLHK  
  ,MD5(ORDER_ID) AS K_ORDER_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
 --business keys
  ,O.PRODUCT_ID AS K_PRODUCT_BK
  ,O.VARIANT_ID AS K_VARIANT_BK
  
  ,O.ORDER_ID AS K_ORDER_BK
  ,O.ID AS K_ORDER_LINE_ITEM_BK
  --attribubtes
  ,O.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
  ,O.NAME AS A_NAME  
  ,O.PROPERTIES AS A_PROPERTIES
  ,O.SKU AS A_SKU
  ,O.TITLE AS A_TITLE  
  ,O.VARIANT_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
  ,O.VARIANT_TITLE AS A_VARIANT_TITLE
  ,O.VENDOR AS A_VENDOR
  --boolean
  ,O.GIFT_CARD AS B_GIFT_CARD
  ,O.PRODUCT_EXISTS AS B_PRODUCT_EXISTS
  ,O.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,O.TAXABLE AS B_TAXABLE
  --metrics
  ,O.FULFILLABLE_QUANTITY AS M_FULFILLABLE_QUANTITY
  ,O.GRAMS::DECIMAL(15,2) AS M_GRAMS
  ,O.QUANTITY::DECIMAL(15,2) AS M_QUANTITY
  ,M_RATE AS M_TAX_RATE
  ,T.M_TAX_PRIMARY::DECIMAL(15,2) AS M_TAX_AMOUNT
  ,T.M_TAX::DECIMAL(15,2) AS M_TAX_AMOUNT_PRIMARY

  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE_PRIMARY 
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT_PRIMARY 
  ,(O.QUANTITY * M_UNIT_PRICE)::DECIMAL(15,2) AS M_TOTAL_PRICE  
  ,(O.QUANTITY * M_UNIT_PRICE_PRIMARY)::DECIMAL(15,2) AS M_TOTAL_PRICE_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'01bec423-ae76-4dfe-ac08-1aba9b21f12f' AS MD_INTGR_ID
FROM source O
  left join products P ON P.K_PRODUCT_BK = O.PRODUCT_ID AND CASE WHEN O.VARIANT_ID IS NOT NULL THEN O.VARIANT_ID = P.K_PRODUCT_VARIANT_BK ELSE 1=1 END
  left join taxes T ON T.K_ORDER_LINE_ITEM_BK = O.ID
)

SELECT * FROM rename
  );
2022-03-03 13:02:48.961876 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:50.758147 (Thread-1): SQL status: SUCCESS 1 in 1.80 seconds
2022-03-03 13:02:50.761699 (Thread-1): finished collecting timing info
2022-03-03 13:02:50.762228 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: Close
2022-03-03 13:02:51.253611 (Thread-1): 10:02:51 | 21 of 24 OK created view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG.... [SUCCESS 1 in 2.30s]
2022-03-03 13:02:51.254521 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:02:51.256315 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:02:51.257843 (Thread-1): 10:02:51 | 22 of 24 START view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG....... [RUN]
2022-03-03 13:02:51.259057 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:02:51.259682 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:02:51.269204 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-03 13:02:51.269994 (Thread-1): finished collecting timing info
2022-03-03 13:02:51.271669 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-03 13:02:51.273618 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:02:51.273727 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECT"
),
source_collection AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECTION"
),
product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename as (

SELECT
  MD5(S.ID) AS K_PRODUCT_COLLECT_DLHK
  ,MD5(CC.ID) AS K_COLLECTION_DLHK
  ,P.K_PRODUCT_DLHK  
  ,S.ID AS K_PRODUCT_COLLECT_BK
  ,CC.ID AS K_COLLECTION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,S.POSITION AS A_POSITION
  ,S.SORT_ORDER AS A_SORT_ORDER  
  ,S.CREATED_AT AS A_CREATED_AT_DTS
  ,S.UPDATED_AT AS A_UPDATED_AT_DTS
  ,CC.PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,CC.BODY_HTML AS A_BODY_HTML
  ,CC.TITLE AS A_TITLE
  ,CC.HANDLE AS A_HANDLE
  ,CC.PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE  
  ,CC.COLLECTION_TYPE AS A_COLLECTION_TYPE  
  --metrics
  ,CC.PRODUCTS_COUNT AS M_PRODUCTS_COUNT
  --metadata (MD)
  ,S.__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '01bec423-ae76-4dfe-ac08-1aba9b21f12f' AS MD_INTGR_ID
FROM
    source S
    LEFT JOIN source_collection CC ON CC.ID = S.COLLECTION_ID
    LEFT JOIN product P ON P.K_PRODUCT_BK = S.PRODUCT_ID
)

SELECT * FROM rename
  );
2022-03-03 13:02:51.273830 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:53.226288 (Thread-1): SQL status: SUCCESS 1 in 1.95 seconds
2022-03-03 13:02:53.233251 (Thread-1): finished collecting timing info
2022-03-03 13:02:53.233731 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: Close
2022-03-03 13:02:53.712518 (Thread-1): 10:02:53 | 22 of 24 OK created view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG.. [SUCCESS 1 in 2.45s]
2022-03-03 13:02:53.713149 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:02:53.713560 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:02:53.714223 (Thread-1): 10:02:53 | 23 of 24 START table model DBT_SHOPIFY.W_ORDERS_F.................... [RUN]
2022-03-03 13:02:53.715680 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:02:53.716210 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:02:53.728980 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-03 13:02:53.730220 (Thread-1): finished collecting timing info
2022-03-03 13:02:53.735688 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-03 13:02:53.745215 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:02:53.745410 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ORDERS_F  as
      (

SELECT
  O.K_ORDER_DLHK AS K_ORDER_DLHK
  ,OLI.K_ORDER_LINE_ITEM_DLHK AS K_ORDER_LINE_ITEM_DLHK
  ,O.K_CUSTOMER_DLHK AS K_CUSTOMER_DLHK
  ,O.K_LOCATION_DLHK AS K_LOCATION_DLHK
  ,O.K_BILLING_ADDRESS_DLHK AS K_BILLING_ADDRESS_DLHK
  ,O.K_SHIPPING_ADDRESS_DLHK AS K_SHIPPING_ADDRESS_DLHK
  ,OLI.K_PRODUCT_VARIATION_DLHK AS K_ITEM_PRODUCT_VARIATION_DLHK
  ,OLI.K_PRODUCT_BK AS K_ITEM_PRODUCT_BK
  ,OLI.K_VARIANT_BK AS K_ITEM_VARIANT_BK
  ,OLI.K_ORDER_BK AS K_ITEM_ORDER_BK
  ,O.K_ORDER_BK AS K_ORDER_BK
  ,OLI.K_ORDER_LINE_ITEM_BK AS K_ITEM_ORDER_LINE_ITEM_BK
  ,O.K_APP_BK AS K_HEADER_APP_BK
  
  ,O.K_CUSTOMER_BK AS K_CUSTOMER_BK
  ,O.K_DEVICE_BK AS K_DEVICE_BK
  ,O.K_LOCATION_BK AS K_LOCATION_BK
  ,O.K_SOURCE_ENTIFIER_BK AS K_SOURCE_ENTIFIER_BK
  ,O.A_BROWSER_IP AS A_HEADER_BROWSER_IP
  ,O.A_CANCELLED_AT_DTS AS A_HEADER_CANCELLED_AT_DTS
  ,O.A_CANCEL_REASON AS A_HEADER_CANCEL_REASON
  ,O.A_CART_TOKEN AS A_HEADER_CART_TOKEN
  ,O.A_CHECKOUT_TOKEN AS A_HEADER_CHECKOUT_TOKEN
  ,O.A_CLIENT_DETAILS AS A_HEADER_CLIENT_DETAILS
  ,O.A_CLOSED_AT_DTS AS A_HEADER_CLOSED_AT_DTS
  ,O.A_CREATED_AT_DTS AS A_HEADER_CREATED_AT_DTS
  ,O.A_CURRENCY AS A_HEADER_CURRENCY
  ,O.A_PRESENTMENT_CURRENCY AS A_HEADER_PRESENTMENT_CURRENCY
  ,O.A_CUSTOMER_LOCALE AS A_HEADER_CUSTOMER_LOCALE
  ,O.A_EMAIL AS A_HEADER_EMAIL
  ,O.A_FINANCIAL_STATUS AS A_HEADER_FINANCIAL_STATUS
  ,O.A_FULFILLMENT_STATUS AS A_HEADER_FULFILLMENT_STATUS
  ,O.A_LANDING_SITE_BASE_URL AS A_HEADER_LANDING_SITE_BASE_URL
  ,O.A_LANDING_SITE_REF AS A_HEADER_LANDING_SITE_REF
  ,O.A_NAME AS A_HEADER_NAME
  ,O.A_NOTE AS A_HEADER_NOTE
  ,O.A_NOTE_ATTRIBUTES AS A_HEADER_NOTE_ATTRIBUTES
  ,O.A_PAYMENT_GATEWAY_NAMES AS A_HEADER_PAYMENT_GATEWAY_NAMES
  ,O.A_PROCESSED_AT_DTS AS A_HEADER_PROCESSED_AT_DTS
  ,O.A_PROCESSING_METHOD AS A_HEADER_PROCESSING_METHOD
  ,O.A_REFERENCE AS A_HEADER_REFERENCE
  ,O.A_REFERRING_SITE AS A_HEADER_REFERRING_SITE
  ,O.A_SOURCE_NAME AS A_HEADER_SOURCE_NAME
  ,O.A_SOURCE_URL AS A_HEADER_SOURCE_URL
  ,O.A_ORDER_NUMBER AS A_HEADER_ORDER_NUMBER
  ,O.A_POSION_NUMBER AS A_HEADER_POSION_NUMBER
  ,O.A_UPDATED_AT_DTS AS A_HEADER_UPDATED_AT_DTS
  ,O.B_BUYER_ACCEPTS_MARKETING AS B_HEADER_BUYER_ACCEPTS_MARKETING
  ,O.B_CONFIRMED AS B_HEADER_CONFIRMED
  ,O.B_TAXES_INCLUDED  AS B_HEADER_TAXES_INCLUDED   
  ,OLI.A_FULFILLMENT_SERVICE AS A_ITEM_FULFILLMENT_SERVICE
  ,OLI.A_FULFILLMENT_STATUS AS A_ITEM_FULFILLMENT_STATUS
  ,OLI.A_NAME AS A_ITEM_NAME
  ,OLI.A_PROPERTIES AS A_ITEM_PROPERTIES
  ,OLI.A_SKU AS A_ITEM_SKU
  ,OLI.A_TITLE AS A_ITEM_TITLE  
  ,OLI.A_VARIANT_INVENTORY_MANAGEMENT AS A_ITEM_VARIANT_INVENTORY_MANAGEMENT
  ,OLI.A_VARIANT_TITLE AS A_ITEM_VARIANT_TITLE
  ,OLI.A_VENDOR AS A_ITEM_VENDOR
  ,OLI.B_GIFT_CARD AS B_ITEM_GIFT_CARD
  ,OLI.B_PRODUCT_EXISTS AS B_ITEM_PRODUCT_EXISTS
  ,OLI.B_REQUIRES_SHIPPING AS B_ITEM_REQUIRES_SHIPPING
  ,OLI.B_TAXABLE AS B_ITEM_TAXABLE
  ,OLI.M_FULFILLABLE_QUANTITY AS M_ITEM_FULFILLABLE_QUANTITY
  ,OLI.M_GRAMS AS M_ITEM_GRAMS
  ,OLI.M_QUANTITY AS M_ITEM_QUANTITY
  ,OLI.M_UNIT_PRICE AS M_ITEM_UNIT_PRICE
  ,OLI.M_UNIT_PRICE_PRIMARY AS M_ITEM_UNIT_PRICE_PRIMARY
  ,OLI.M_TOTAL_PRICE AS M_ITEM_TOTAL_PRICE
  ,OLI.M_TOTAL_PRICE_PRIMARY AS M_ITEM_TOTAL_PRICE_PRIMARY
  ,OLI.M_TOTAL_DISCOUNT AS M_ITEM_TOTAL_DISCOUNT
  ,OLI.M_TOTAL_DISCOUNT_PRIMARY AS M_ITEM_TOTAL_DISCOUNT_PRIMARY
  ,OLI.M_TAX_AMOUNT AS M_TAX_AMOUNT
  ,OLI.M_TAX_AMOUNT_PRIMARY AS M_TAX_AMOUNT_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_TIP_RECEIVED * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_TIP_AMOUNT_PRIMARY  
  --,ROUND(DIV0((O.M_TOTAL_DISCOUNTS_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_HEADER_DISCOUNT
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE * OLI.M_TOTAL_PRICE),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE



   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'01bec423-ae76-4dfe-ac08-1aba9b21f12f' AS MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG OLI ON OLI.K_ORDER_DLHK = O.K_ORDER_DLHK
      );
2022-03-03 13:02:53.745536 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:56.536815 (Thread-1): SQL status: SUCCESS 1 in 2.79 seconds
2022-03-03 13:02:56.541208 (Thread-1): finished collecting timing info
2022-03-03 13:02:56.541847 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-03 13:02:57.039580 (Thread-1): 10:02:57 | 23 of 24 OK created table model DBT_SHOPIFY.W_ORDERS_F............... [SUCCESS 1 in 3.32s]
2022-03-03 13:02:57.040125 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:02:57.040547 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:02:57.041539 (Thread-1): 10:02:57 | 24 of 24 START table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F........ [RUN]
2022-03-03 13:02:57.042580 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:02:57.043075 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:02:57.051572 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-03 13:02:57.052854 (Thread-1): finished collecting timing info
2022-03-03 13:02:57.057827 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-03 13:02:57.060019 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:02:57.060556 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCT_COLLECTION_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG AS C
      );
2022-03-03 13:02:57.060940 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:02:59.565664 (Thread-1): SQL status: SUCCESS 1 in 2.50 seconds
2022-03-03 13:02:59.571929 (Thread-1): finished collecting timing info
2022-03-03 13:02:59.572559 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: Close
2022-03-03 13:03:00.078362 (Thread-1): 10:03:00 | 24 of 24 OK created table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F... [SUCCESS 1 in 3.03s]
2022-03-03 13:03:00.079139 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:03:00.083352 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 13:03:00.085453 (MainThread): 10:03:00 | 
2022-03-03 13:03:00.087553 (MainThread): 10:03:00 | Finished running 16 view models, 8 table models in 76.73s.
2022-03-03 13:03:00.088204 (MainThread): Connection 'master' was properly closed.
2022-03-03 13:03:00.088550 (MainThread): Connection 'model.snowflake_aicd.W_PRODUCT_COLLECTION_F' was properly closed.
2022-03-03 13:03:00.103901 (MainThread): 
2022-03-03 13:03:00.104113 (MainThread): Completed with 2 errors and 0 warnings:
2022-03-03 13:03:00.104229 (MainThread): 
2022-03-03 13:03:00.104336 (MainThread): Database Error in model V_TRANSACTIONS_STG (models/staging/TRANSACTION/V_TRANSACTIONS_STG.sql)
2022-03-03 13:03:00.104436 (MainThread):   002003 (42S02): SQL compilation error:
2022-03-03 13:03:00.104530 (MainThread):   Object 'DEVELOPER_SANDBOX.DBT_SHOPIFY.CUSTOMER' does not exist or not authorized.
2022-03-03 13:03:00.104621 (MainThread):   compiled SQL at target/run/snowflake_aicd/models/staging/TRANSACTION/V_TRANSACTIONS_STG.sql
2022-03-03 13:03:00.104716 (MainThread): 
2022-03-03 13:03:00.104814 (MainThread): Database Error in model V_INVENTORY_ITEM_STG (models/staging/INVENTORY/V_INVENTORY_ITEM_STG.sql)
2022-03-03 13:03:00.104909 (MainThread):   001003 (42000): SQL compilation error:
2022-03-03 13:03:00.104999 (MainThread):   syntax error line 31 at position 2 unexpected ','.
2022-03-03 13:03:00.105090 (MainThread):   compiled SQL at target/run/snowflake_aicd/models/staging/INVENTORY/V_INVENTORY_ITEM_STG.sql
2022-03-03 13:03:00.105219 (MainThread): 
Done. PASS=21 WARN=0 ERROR=2 SKIP=1 TOTAL=24
2022-03-03 13:03:00.105427 (MainThread): Flushing usage events
2022-03-03 13:04:18.925017 (MainThread): Running with dbt=0.21.1
2022-03-03 13:04:19.543607 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-03 13:04:19.550569 (MainThread): Tracking: do not track
2022-03-03 13:04:19.562300 (MainThread): Partial parsing not enabled
2022-03-03 13:04:19.591703 (MainThread): Parsing macros/common.sql
2022-03-03 13:04:19.595006 (MainThread): Parsing macros/catalog.sql
2022-03-03 13:04:19.597188 (MainThread): Parsing macros/adapters.sql
2022-03-03 13:04:19.630605 (MainThread): Parsing macros/materializations/merge.sql
2022-03-03 13:04:19.633764 (MainThread): Parsing macros/materializations/seed.sql
2022-03-03 13:04:19.637683 (MainThread): Parsing macros/materializations/view.sql
2022-03-03 13:04:19.638841 (MainThread): Parsing macros/materializations/table.sql
2022-03-03 13:04:19.641542 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-03 13:04:19.648994 (MainThread): Parsing macros/core.sql
2022-03-03 13:04:19.652061 (MainThread): Parsing macros/materializations/test.sql
2022-03-03 13:04:19.657757 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-03 13:04:19.665802 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-03 13:04:19.667109 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-03 13:04:19.681920 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-03 13:04:19.714311 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-03 13:04:19.739627 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-03 13:04:19.741434 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-03 13:04:19.750535 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-03 13:04:19.768645 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-03 13:04:19.780558 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-03 13:04:19.787690 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-03 13:04:19.794256 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-03 13:04:19.797457 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-03 13:04:19.798733 (MainThread): Parsing macros/etc/query.sql
2022-03-03 13:04:19.799493 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-03 13:04:19.800740 (MainThread): Parsing macros/etc/datetime.sql
2022-03-03 13:04:19.808117 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-03 13:04:19.809623 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-03 13:04:19.811547 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-03 13:04:19.812801 (MainThread): Parsing macros/adapters/common.sql
2022-03-03 13:04:19.861057 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-03 13:04:19.862602 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-03 13:04:19.863669 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-03 13:04:19.864704 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-03 13:04:20.024101 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:04:20.032795 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.036028 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:04:20.039125 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.039965 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:04:20.042782 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.043594 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:04:20.048958 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.049847 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:04:20.053089 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.053900 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:04:20.057208 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.058018 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:04:20.061105 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.061966 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:04:20.064903 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.065773 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:04:20.068814 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.069657 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:04:20.073994 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.074880 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:04:20.078106 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.078902 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:04:20.084208 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.085046 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:04:20.090983 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.091851 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:04:20.094818 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.095589 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:04:20.099295 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.101616 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:04:20.105559 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.106344 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:04:20.109416 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.110178 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:04:20.113519 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.114294 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:04:20.155955 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.157010 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:04:20.159862 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.160635 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:04:20.162968 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.163734 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:04:20.166585 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.167452 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:04:20.169959 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.170741 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:04:20.173170 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.195576 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.196966 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.198567 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.200012 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.201444 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.203031 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.204381 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.205609 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:04:20.243318 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-03 13:04:20.244156 (MainThread): Found 24 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 23 sources, 0 exposures
2022-03-03 13:04:20.246285 (MainThread): 
2022-03-03 13:04:20.246531 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 13:04:20.247983 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 13:04:20.258744 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 13:04:20.258913 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-03 13:04:20.259010 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-03 13:04:22.657555 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 2.40 seconds
2022-03-03 13:04:22.668839 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-03 13:04:23.129182 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 13:04:23.142748 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 13:04:23.142962 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-03 13:04:23.143063 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-03 13:04:25.112723 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 23 in 1.97 seconds
2022-03-03 13:04:25.119754 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-03 13:04:25.573410 (MainThread): 10:04:25 | Concurrency: 1 threads (target='dev')
2022-03-03 13:04:25.573877 (MainThread): 10:04:25 | 
2022-03-03 13:04:25.578291 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:04:25.580067 (Thread-1): 10:04:25 | 1 of 24 START view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG.......... [RUN]
2022-03-03 13:04:25.587068 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:04:25.587303 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:04:25.589833 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-03 13:04:25.590242 (Thread-1): finished collecting timing info
2022-03-03 13:04:25.607493 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-03 13:04:25.609344 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:04:25.609449 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER_ADDRESS"
),
rename AS 
(   
SELECT 
    MD5(ID) AS K_CUSTOMER_ADDRESS_DLHK
    ,ID AS K_CUSTOMER_ADDRESS_BK
    ,MD5(CONCAT(
        COALESCE(ADDRESS1,'00'),
        COALESCE(ADDRESS2,'00'),
        COALESCE(CITY,'00'),
        COALESCE(COUNTRY,'00'),
        COALESCE(COUNTRY_CODE,'00'),
        COALESCE(FIRST_NAME,'00'),
        COALESCE(LAST_NAME,'00'),
        COALESCE(PROVINCE,'00'),
        COALESCE(PROVINCE_CODE,'00'),
        COALESCE(ZIP,'00')
    )) AS K_ADDRESS_DLHK
    ,CUSTOMER_ID AS K_CUSTOMER_BK
    ,ADDRESS1 AS A_ADDRESS1
    ,ADDRESS2 AS A_ADDRESS2
    ,CITY AS A_CITY
    ,COMPANY AS A_COMPANY
    ,COUNTRY AS A_COUNTRY
    ,COUNTRY_CODE AS A_COUNTRY_CODE
    ,COUNTRY_NAME AS A_COUNTRY_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,PHONE AS A_PHONE
    ,PROVINCE AS A_PROVINCE
    ,PROVINCE_CODE AS A_PROVINCE_CODE
    ,ZIP AS A_ZIP
    ,IS_DEFAULT AS B_IS_DEFAULT  
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-03 13:04:25.609550 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:04:27.285399 (Thread-1): SQL status: SUCCESS 1 in 1.68 seconds
2022-03-03 13:04:27.309614 (Thread-1): finished collecting timing info
2022-03-03 13:04:27.310250 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: Close
2022-03-03 13:04:27.763537 (Thread-1): 10:04:27 | 1 of 24 OK created view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG..... [SUCCESS 1 in 2.18s]
2022-03-03 13:04:27.763725 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:04:27.763873 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:04:27.764033 (Thread-1): 10:04:27 | 2 of 24 START view model DBT_SHOPIFY.V_CUSTOMER_STG.................. [RUN]
2022-03-03 13:04:27.764243 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:04:27.764355 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:04:27.767808 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-03 13:04:27.768189 (Thread-1): finished collecting timing info
2022-03-03 13:04:27.769618 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-03 13:04:27.771763 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:04:27.771882 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER"
),
rename AS 
(   
SELECT 
    --KEYS
    MD5(ID) AS K_CUSTOMER_DLHK    
    --BUSINESS KEYS
    ,ID AS K_CUSTOMER_BK
    ,LAST_ORDER_ID AS K_LAST_ORDER_BK
    ,MULTIPASS_IDENTIFIER AS K_MULTIPASS_BKENTIFIER
    --ATTRIBUTES
    ,ACCEPTS_MARKETING_UPDATED_AT AS A_ACCEPTS_MARKETING_UPDATED_AT_DTS
    ,CREATED_AT AS A_CREATED_AT_DTS
    ,CURRENCY AS A_CURRENCY
    ,EMAIL AS A_EMAIL
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,LAST_ORDER_NAME AS A_LAST_ORDER_NAME
    ,MARKETING_OPT_IN_LEVEL AS A_MARKETING_OPT_IN_LEVEL
    ,NOTE AS A_NOTE
    ,PHONE AS A_PHONE
    ,SMS_MARKETING_CONSENT AS A_SMS_MARKETING_CONSENT
    ,STATE AS A_STATE
    ,TAGS AS A_TAGS
    ,TAX_EXEMPTIONS AS A_TAX_EXEMPTIONS
    ,TOTAL_SPENT AS A_TOTAL_SPENT
    ,UPDATED_AT AS A_UPDATED_AT
    --BOOLEAN
    ,ACCEPTS_MARKETING AS B_ACCEPTS_MARKETING
    ,TAX_EXEMPT AS B_TAX_EXEMPT
    ,VERIFIED_EMAIL AS B_VERIFIED_EMAIL
    --METRICS
    ,ORDERS_COUNT AS M_ORDERS_COUNT
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-03 13:04:27.772076 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:04:29.577115 (Thread-1): SQL status: SUCCESS 1 in 1.80 seconds
2022-03-03 13:04:29.582376 (Thread-1): finished collecting timing info
2022-03-03 13:04:29.583097 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-03 13:04:30.069023 (Thread-1): 10:04:30 | 2 of 24 OK created view model DBT_SHOPIFY.V_CUSTOMER_STG............. [SUCCESS 1 in 2.30s]
2022-03-03 13:04:30.069603 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:04:30.070398 (Thread-1): Began running node model.snowflake_aicd.V_DATE_STG
2022-03-03 13:04:30.071221 (Thread-1): 10:04:30 | 3 of 24 START view model DBT_SHOPIFY.V_DATE_STG...................... [RUN]
2022-03-03 13:04:30.072740 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:04:30.073505 (Thread-1): Compiling model.snowflake_aicd.V_DATE_STG
2022-03-03 13:04:30.085569 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-03 13:04:30.086197 (Thread-1): finished collecting timing info
2022-03-03 13:04:30.087824 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-03 13:04:30.108750 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:04:30.108937 (Thread-1): On model.snowflake_aicd.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-03 13:04:30.109304 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:04:32.266001 (Thread-1): SQL status: SUCCESS 1 in 2.16 seconds
2022-03-03 13:04:32.273735 (Thread-1): finished collecting timing info
2022-03-03 13:04:32.274492 (Thread-1): On model.snowflake_aicd.V_DATE_STG: Close
2022-03-03 13:04:32.762112 (Thread-1): 10:04:32 | 3 of 24 OK created view model DBT_SHOPIFY.V_DATE_STG................. [SUCCESS 1 in 2.69s]
2022-03-03 13:04:32.763036 (Thread-1): Finished running node model.snowflake_aicd.V_DATE_STG
2022-03-03 13:04:32.764000 (Thread-1): Began running node model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:04:32.765918 (Thread-1): 10:04:32 | 4 of 24 START view model DBT_SHOPIFY.V_LOCATION_STG.................. [RUN]
2022-03-03 13:04:32.767587 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:04:32.769156 (Thread-1): Compiling model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:04:32.780961 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-03 13:04:32.781611 (Thread-1): finished collecting timing info
2022-03-03 13:04:32.783325 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-03 13:04:32.785026 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:04:32.785176 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:04:32.785285 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:04:34.658074 (Thread-1): SQL status: SUCCESS 1 in 1.87 seconds
2022-03-03 13:04:34.663368 (Thread-1): finished collecting timing info
2022-03-03 13:04:34.664090 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-03 13:04:35.107656 (Thread-1): 10:04:35 | 4 of 24 OK created view model DBT_SHOPIFY.V_LOCATION_STG............. [SUCCESS 1 in 2.34s]
2022-03-03 13:04:35.108543 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:04:35.109266 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:04:35.110280 (Thread-1): 10:04:35 | 5 of 24 START view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG......... [RUN]
2022-03-03 13:04:35.111931 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:04:35.112710 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:04:35.128228 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-03 13:04:35.128909 (Thread-1): finished collecting timing info
2022-03-03 13:04:35.130325 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-03 13:04:35.132502 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:04:35.132596 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_ADJUSTMENT" AS A
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_ADJUSTMENT_DLHK
  --BK
  ,ID AS K_ORDER_ADJUSTMENT_BK
  ,ORDER_ID AS K_ORDER_BK
  ,REFUND_ID AS K_REFUND_BK
  --ATTRIBUTE
  ,KIND AS A_KIND
  ,REASON AS A_REASON
  --METRIC
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_AMOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT_PRIMARY
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_AMOUNT_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-03 13:04:35.132694 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:04:37.134451 (Thread-1): SQL status: SUCCESS 1 in 2.00 seconds
2022-03-03 13:04:37.140391 (Thread-1): finished collecting timing info
2022-03-03 13:04:37.140965 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: Close
2022-03-03 13:04:37.593671 (Thread-1): 10:04:37 | 5 of 24 OK created view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG.... [SUCCESS 1 in 2.48s]
2022-03-03 13:04:37.594587 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:04:37.595118 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:04:37.596154 (Thread-1): 10:04:37 | 6 of 24 START view model DBT_SHOPIFY.V_ORDERS_HEADER_STG............. [RUN]
2022-03-03 13:04:37.596956 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:04:37.597395 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:04:37.615169 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-03 13:04:37.615632 (Thread-1): finished collecting timing info
2022-03-03 13:04:37.617045 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-03 13:04:37.626112 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:04:37.626287 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDERS" AS A
),
rename AS 
(
SELECT
    MD5(O.ID) AS K_ORDER_DLHK    
    ,MD5(O.CUSTOMER_ID) AS K_CUSTOMER_DLHK
    ,MD5(O.LOCATION_ID) AS K_LOCATION_DLHK    
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
    --BUSINESS_KEYS
    ,O.APP_ID AS K_APP_BK
    ,O.ID AS K_ORDER_BK
    ,O.CUSTOMER_ID AS K_CUSTOMER_BK
    ,O.DEVICE_ID AS K_DEVICE_BK  
    ,O.LOCATION_ID AS K_LOCATION_BK
    ,O.SOURCE_IDENTIFIER AS K_SOURCE_ENTIFIER_BK
    --ATTRIBUTES
    ,O.BROWSER_IP AS A_BROWSER_IP
    ,O.CANCELLED_AT AS A_CANCELLED_AT_DTS
    ,O.CANCEL_REASON AS A_CANCEL_REASON
    ,O.CART_TOKEN AS A_CART_TOKEN
    ,O.CHECKOUT_TOKEN AS A_CHECKOUT_TOKEN
    ,O.CLIENT_DETAILS AS A_CLIENT_DETAILS
    ,O.CLOSED_AT AS A_CLOSED_AT_DTS
    ,O.CREATED_AT AS A_CREATED_AT_DTS
    ,O.CURRENCY AS A_CURRENCY
    ,O.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
    ,O.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
    ,O.EMAIL AS A_EMAIL
    ,O.FINANCIAL_STATUS AS A_FINANCIAL_STATUS
    ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
    ,O.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
    ,O.LANDING_SITE_REF AS A_LANDING_SITE_REF
    ,O.NAME AS A_NAME
    ,O.NOTE AS A_NOTE
    ,O.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES    
    ,O.PAYMENT_GATEWAY_NAMES AS A_PAYMENT_GATEWAY_NAMES    
    ,O.PROCESSED_AT AS A_PROCESSED_AT_DTS
    ,O.PROCESSING_METHOD AS A_PROCESSING_METHOD
    ,O.REFERENCE AS A_REFERENCE
    ,O.REFERRING_SITE AS A_REFERRING_SITE    
    ,O.SOURCE_NAME AS A_SOURCE_NAME
    ,O.SOURCE_URL AS A_SOURCE_URL    
    ,O.ORDER_NUMBER AS A_ORDER_NUMBER
    ,O.POSION_NUMBER AS A_POSION_NUMBER  
    ,O.UPDATED_AT AS A_UPDATED_AT_DTS
    --BOOLEAN
    ,O.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
    ,O.CONFIRMED AS B_CONFIRMED
    ,O.TAXES_INCLUDED AS B_TAXES_INCLUDED
    --METRICS
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE_PRIMARY 
    ,O.TOTAL_TIP_RECEIVED::DECIMAL(15,2) AS M_TOTAL_TIP_RECEIVED   
    ,O.TOTAL_WEIGHT::DECIMAL(15,2) AS M_TOTAL_WEIGHT
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
FROM source O
)

SELECT * FROM rename
  );
2022-03-03 13:04:37.626429 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:04:39.392877 (Thread-1): SQL status: SUCCESS 1 in 1.77 seconds
2022-03-03 13:04:39.397486 (Thread-1): finished collecting timing info
2022-03-03 13:04:39.398189 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: Close
2022-03-03 13:04:39.874734 (Thread-1): 10:04:39 | 6 of 24 OK created view model DBT_SHOPIFY.V_ORDERS_HEADER_STG........ [SUCCESS 1 in 2.28s]
2022-03-03 13:04:39.875563 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:04:39.876271 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:04:39.877446 (Thread-1): 10:04:39 | 7 of 24 START view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG.. [RUN]
2022-03-03 13:04:39.878466 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:04:39.879031 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:04:39.892889 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-03 13:04:39.893487 (Thread-1): finished collecting timing info
2022-03-03 13:04:39.894928 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-03 13:04:39.896519 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:04:39.896642 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM_TAX_LINE" AS A
),
rename AS 
(
SELECT
  CONCAT(COALESCE(ORDER_ID,'0000000000'),'-',COALESCE(ORDER_LINE_ID,'0000000000')) AS K_ORDER_LINE_ITEM_TAX_DLHK
  ,ORDER_ID AS K_ORDER_BK
  ,ORDER_LINE_ID AS K_ORDER_LINE_ITEM_BK
  ,TITLE AS A_TITLE
  ,CHANNEL_LIABLE AS B_CHANNEL_LIABLE
  ,RATE AS M_RATE
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TAX
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TAX_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-03 13:04:39.896809 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:04:41.900847 (Thread-1): SQL status: SUCCESS 1 in 2.00 seconds
2022-03-03 13:04:41.904542 (Thread-1): finished collecting timing info
2022-03-03 13:04:41.905058 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: Close
2022-03-03 13:04:42.385329 (Thread-1): 10:04:42 | 7 of 24 OK created view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG [SUCCESS 1 in 2.51s]
2022-03-03 13:04:42.385940 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:04:42.386444 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:04:42.387036 (Thread-1): 10:04:42 | 8 of 24 START view model DBT_SHOPIFY.V_PRODUCT_STG................... [RUN]
2022-03-03 13:04:42.387856 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:04:42.388261 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:04:42.397205 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-03 13:04:42.398400 (Thread-1): finished collecting timing info
2022-03-03 13:04:42.399913 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-03 13:04:42.401180 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:04:42.401278 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_DLHK
  ,ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE
  ,HANDLE AS A_HANDLE
  ,PRODUCT_TYPE AS A_PRODUCT_TYPE
  ,VENDOR AS A_VENDOR
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE
  ,STATUS AS A_STATUS
  ,TEMPLATE_SUFFIX AS A_TEMPLATE_SUFFIX   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:04:42.401373 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:04:44.156977 (Thread-1): SQL status: SUCCESS 1 in 1.76 seconds
2022-03-03 13:04:44.162753 (Thread-1): finished collecting timing info
2022-03-03 13:04:44.163535 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: Close
2022-03-03 13:04:44.636265 (Thread-1): 10:04:44 | 8 of 24 OK created view model DBT_SHOPIFY.V_PRODUCT_STG.............. [SUCCESS 1 in 2.25s]
2022-03-03 13:04:44.636877 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:04:44.637452 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:04:44.638057 (Thread-1): 10:04:44 | 9 of 24 START view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG........... [RUN]
2022-03-03 13:04:44.638768 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:04:44.639180 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:04:44.653947 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-03 13:04:44.654620 (Thread-1): finished collecting timing info
2022-03-03 13:04:44.656306 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-03 13:04:44.658416 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:04:44.658528 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT_VARIANT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_VARIANT_DLHK
  ,MD5(PRODUCT_ID) AS K_PRODUCT_DLHK  
  --BUSINESS KEYS  
  ,ID AS K_PRODUCT_VARIANT_BK
  ,PRODUCT_ID AS K_PRODUCT_BK  
  ,INVENTORY_ITEM_ID AS K_INVENTORY_ITEM_BK
  ,IMAGE_ID AS K_IMAGE_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE  
  ,SKU AS A_SKU    
  ,FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,INVENTORY_MANAGEMENT AS A_INVENTORY_MANAGEMENT
  ,INVENTORY_POLICY AS A_INVENTORY_POLICY
  ,BARCODE AS A_BARCODE
  ,GRAMS AS A_GRAMS
  ,WEIGHT_UNIT AS A_WEIGHT_UNIT
  ,OPTION_1 AS A_OPTION_1
  ,OPTION_2 AS A_OPTION_2
  ,OPTION_3 AS A_OPTION_3
  ,TAX_CODE AS A_TAX_CODE  
  ,PRESENTMENT_PRICES AS A_PRESENTMENT_PRICES  
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  --BOOLEAN
  ,REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,TAXABLE AS B_TAXABLE
  --METRICS
  ,PRICE AS M_PRICE
  ,POSITION AS M_POSITION
  ,COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,INVENTORY_QUANTITY AS M_INVENTORY_QUANTITY
  ,INVENTORY_QUANTITY_ADJUSTMENT AS M_INVENTORY_QUANTITY_ADJUSTMENT
  ,WEIGHT AS M_WEIGHT
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:04:44.658636 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:04:46.605540 (Thread-1): SQL status: SUCCESS 1 in 1.95 seconds
2022-03-03 13:04:46.621787 (Thread-1): finished collecting timing info
2022-03-03 13:04:46.622227 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: Close
2022-03-03 13:04:47.061760 (Thread-1): 10:04:47 | 9 of 24 OK created view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG...... [SUCCESS 1 in 2.42s]
2022-03-03 13:04:47.062305 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:04:47.062858 (Thread-1): Began running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:04:47.063528 (Thread-1): 10:04:47 | 10 of 24 START view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG......... [RUN]
2022-03-03 13:04:47.064412 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:04:47.064928 (Thread-1): Compiling model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:04:47.078845 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-03 13:04:47.079504 (Thread-1): finished collecting timing info
2022-03-03 13:04:47.081146 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-03 13:04:47.083792 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:04:47.083894 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG  as (
    


WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND" AS A
),
refund_line as (
    SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND_LINE_ITEM" AS A
),
rename AS 
(
SELECT
  MD5(RL.ID) AS K_REFUND_LINE_DLHK
  ,MD5(R.ID) AS K_REFUND_DLHK
  ,R.ID AS K_REFUND_BK
  ,RL.ID AS K_REFUND_LINE_BK
  ,R.ORDER_ID AS K_ORDER_BK
  ,R.USER_ID AS K_USER_BK
  ,RL.LOCATION_ID AS K_LOCATION_BK
  ,RL.LINE_ITEM_ID AS K_ORDER_LINE_ITEM_BK
  ,R.NOTE AS A_NOTE
  ,R.RESTOCK AS B_RESTOCK
  ,RL.QUANTITY AS M_QUANTITY
  ,RL.RESTOCK_TYPE AS A_RESTOCK_TYPE
   
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_SUBTOTAL


  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
FROM source R
LEFT JOIN refund_line RL ON RL.REFUND_ID = R.ID
)

SELECT * FROM rename
  );
2022-03-03 13:04:47.083995 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:04:48.704138 (Thread-1): SQL status: SUCCESS 1 in 1.62 seconds
2022-03-03 13:04:48.707693 (Thread-1): finished collecting timing info
2022-03-03 13:04:48.708221 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: Close
2022-03-03 13:04:49.181863 (Thread-1): 10:04:49 | 10 of 24 OK created view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG.... [SUCCESS 1 in 2.12s]
2022-03-03 13:04:49.188430 (Thread-1): Finished running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:04:49.188590 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:04:49.191400 (Thread-1): 10:04:49 | 11 of 24 START table model DBT_SHOPIFY.W_CUSTOMERS_D................. [RUN]
2022-03-03 13:04:49.191707 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:04:49.191828 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:04:49.194591 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-03 13:04:49.194986 (Thread-1): finished collecting timing info
2022-03-03 13:04:49.208654 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-03 13:04:49.209470 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:04:49.209572 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG AS C
      );
2022-03-03 13:04:49.209669 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:04:52.089609 (Thread-1): SQL status: SUCCESS 1 in 2.88 seconds
2022-03-03 13:04:52.095490 (Thread-1): finished collecting timing info
2022-03-03 13:04:52.095695 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-03 13:04:52.558777 (Thread-1): 10:04:52 | 11 of 24 OK created table model DBT_SHOPIFY.W_CUSTOMERS_D............ [SUCCESS 1 in 3.37s]
2022-03-03 13:04:52.559266 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:04:52.559860 (Thread-1): Began running node model.snowflake_aicd.W_DATE_D
2022-03-03 13:04:52.560700 (Thread-1): 10:04:52 | 12 of 24 START table model DBT_SHOPIFY.W_DATE_D...................... [RUN]
2022-03-03 13:04:52.562145 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:04:52.562938 (Thread-1): Compiling model.snowflake_aicd.W_DATE_D
2022-03-03 13:04:52.576979 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-03 13:04:52.577530 (Thread-1): finished collecting timing info
2022-03-03 13:04:52.579025 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-03 13:04:52.581778 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:04:52.581875 (Thread-1): On model.snowflake_aicd.W_DATE_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_DATE_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_DATE_D  as
      (

SELECT 
	CAST(DATE_KEY AS NUMBER(9)) AS K_DATE_INTEGER_BK
	,CAST(DATE_COLUMN AS DATE) AS K_DATE_BK
	,CAST(FULL_DATE_DESC AS VARCHAR(64)) AS A_FULL_DATE_DESC
	,CAST(DAY_NUM_IN_WEEK AS NUMBER(1)) AS A_DAY_NUM_IN_WEEK
	,CAST(DAY_NUM_IN_MONTH AS NUMBER(2)) AS A_DAY_NUM_IN_MONTH
	,CAST(DAY_NUM_IN_YEAR AS NUMBER(3)) AS A_DAY_NUM_IN_YEAR
	,CAST(DAY_NAME AS VARCHAR(10)) AS A_DAY_NAME
	,CAST(DAY_ABBREV AS VARCHAR(3)) AS A_DAY_ABBREV
	,CAST(WEEKDAY_IND AS VARCHAR(64)) AS A_WEEKDAY_IND
	,CAST(US_HOLIDAY_IND AS VARCHAR(64)) AS A_US_HOLIDAY_IND
	,CAST(COMPANY_HOLIDAY_IND AS VARCHAR(64)) AS A_COMPANY_HOLIDAY_IND
	,CAST(MONTH_END_IND AS VARCHAR(64)) AS A_MONTH_END_IND
	,CAST(WEEK_BEGIN_DATE_NKEY AS NUMBER(9)) AS A_WEEK_BEGIN_DATE_NKEY
	,CAST(WEEK_BEGIN_DATE AS DATE) AS A_WEEK_BEGIN_DATE
	,CAST(WEEK_END_DATE_NKEY AS NUMBER(9)) AS A_WEEK_END_DATE_NKEY
	,CAST(WEEK_END_DATE AS DATE) AS A_WEEK_END_DATE
	,CAST(WEEK_NUM_IN_YEAR AS NUMBER(9)) AS A_WEEK_NUM_IN_YEAR
	,CAST(MONTH_NAME AS VARCHAR(10)) AS A_MONTH_NAME
	,CAST(MONTH_ABBREV AS VARCHAR(3)) AS A_MONTH_ABBREV
	,CAST(MONTH_NUM_IN_YEAR AS NUMBER(2)) AS A_MONTH_NUM_IN_YEAR
	,CAST(YEARMONTH AS VARCHAR(10)) AS A_YEARMONTH
	,CAST(CURRENT_QUARTER AS NUMBER(1)) AS A_QUARTER
	,CAST(YEARQUARTER AS VARCHAR(10)) AS A_YEARQUARTER
	,CAST(CURRENT_YEAR AS NUMBER(5)) AS A_YEAR
	,CAST(FISCAL_WEEK_NUM AS NUMBER(2)) AS A_FISCAL_WEEK_NUM
	,CAST(FISCAL_MONTH_NUM AS NUMBER(2)) AS A_FISCAL_MONTH_NUM
	,CAST(FISCAL_YEARMONTH AS VARCHAR(10)) AS A_FISCAL_YEARMONTH
	,CAST(FISCAL_QUARTER AS NUMBER(1)) AS A_FISCAL_QUARTER
	,CAST(FISCAL_YEARQUARTER AS VARCHAR(10)) AS A_FISCAL_YEARQUARTER
	,CAST(FISCAL_HALFYEAR AS NUMBER(1)) AS A_FISCAL_HALFYEAR
	,CAST(FISCAL_YEAR AS NUMBER(5)) AS A_FISCAL_YEAR
	,CAST(SQL_TIMESTAMP AS TIMESTAMP_NTZ) AS A_SQL_TIMESTAMP_DTS
	,CAST(CURRENT_ROW_IND AS CHAR(1)) AS A_CURRENT_ROW_IND
	,CAST(EFFECTIVE_DATE AS DATE) AS A_EFFECTIVE_DATE
	,CAST(EXPIRA_DATE AS DATE) AS A_EXPIRATION_DATE
FROM
DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG
      );
2022-03-03 13:04:52.581971 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:04:57.272269 (Thread-1): SQL status: SUCCESS 1 in 4.69 seconds
2022-03-03 13:04:57.276281 (Thread-1): finished collecting timing info
2022-03-03 13:04:57.276688 (Thread-1): On model.snowflake_aicd.W_DATE_D: Close
2022-03-03 13:04:57.750172 (Thread-1): 10:04:57 | 12 of 24 OK created table model DBT_SHOPIFY.W_DATE_D................. [SUCCESS 1 in 5.19s]
2022-03-03 13:04:57.750849 (Thread-1): Finished running node model.snowflake_aicd.W_DATE_D
2022-03-03 13:04:57.751406 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:04:57.752282 (Thread-1): 10:04:57 | 13 of 24 START table model DBT_SHOPIFY.W_LOCATION_D.................. [RUN]
2022-03-03 13:04:57.753363 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:04:57.753871 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:04:57.762454 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-03 13:04:57.762956 (Thread-1): finished collecting timing info
2022-03-03 13:04:57.764723 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-03 13:04:57.765427 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:04:57.765527 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-03 13:04:57.765621 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:05:00.286934 (Thread-1): SQL status: SUCCESS 1 in 2.52 seconds
2022-03-03 13:05:00.291474 (Thread-1): finished collecting timing info
2022-03-03 13:05:00.292066 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-03 13:05:00.757672 (Thread-1): 10:05:00 | 13 of 24 OK created table model DBT_SHOPIFY.W_LOCATION_D............. [SUCCESS 1 in 3.00s]
2022-03-03 13:05:00.758190 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:05:00.761957 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:05:00.762713 (Thread-1): 10:05:00 | 14 of 24 START view model DBT_SHOPIFY.V_PRODUCTS_D_STG............... [RUN]
2022-03-03 13:05:00.763443 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:05:00.763852 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:05:00.771918 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-03 13:05:00.773116 (Thread-1): finished collecting timing info
2022-03-03 13:05:00.779381 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-03 13:05:00.783259 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:05:00.783368 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCTS_D_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG  as (
    
 

WITH product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG
),
product_variant AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG
),

rename as (


SELECT
    CONCAT(P.K_PRODUCT_BK,'-',COALESCE(V.K_PRODUCT_VARIANT_BK,'0000000000')) AS K_PRODUCT_VARIATION_DLHK
    ,P.K_PRODUCT_DLHK
    ,V.K_PRODUCT_VARIANT_DLHK AS K_PRODUCT_VARIANT_DLHK
    ,V.K_PRODUCT_VARIANT_BK AS K_PRODUCT_VARIANT_BK
    ,P.K_PRODUCT_BK AS K_PRODUCT_BK
    ,V.K_INVENTORY_ITEM_BK AS K_VARIANT_INVENTORY_ITEM_BK
    ,V.K_IMAGE_BK AS K_VARIANT_IMAGE_BK
    --ATTRIBUTES
    ,P.A_TITLE
    ,P.A_HANDLE
    ,P.A_PRODUCT_TYPE
    ,P.A_VENDOR
    ,P.A_CREATED_AT_DTS
    ,P.A_UPDATED_AT_DTS
    ,P.A_PUBLISHED_AT_DTS
    ,P.A_PUBLISHED_SCOPE
    ,P.A_STATUS
    ,P.A_TEMPLATE_SUFFIX       
    ,V.A_TITLE AS A_VARIANT_TITLE
    ,V.A_SKU AS A_VARIANT_SKU
    ,V.A_FULFILLMENT_SERVICE AS A_VARIANT_FULFILLMENT_SERVICE
    ,V.A_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
    ,V.A_BARCODE AS A_VARIANT_BARCODE
    ,V.A_INVENTORY_POLICY AS A_VARIANT_INVENTORY_POLICY
    ,V.A_GRAMS AS A_VARIANT_GRAMS
    ,V.A_WEIGHT_UNIT AS A_VARIANT_WEIGHT_UNIT
    ,V.A_OPTION_1 AS A_VARIANT_OPTION_1
    ,V.A_OPTION_2 AS A_VARIANT_OPTION_2
    ,V.A_OPTION_3 AS A_VARIANT_OPTION_3
    ,V.A_TAX_CODE AS A_VARIANT_TAX_CODE
    ,V.A_PRESENTMENT_PRICES AS A_VARIANT_PRESENTMENT_PRICES
    ,V.A_CREATED_AT_DTS AS A_VARIANT_CREATED_AT_DTS
    ,V.A_UPDATED_AT_DTS AS A_VARIANT_UPDATED_AT_DTS
    --BOOLEAN
    ,V.B_REQUIRES_SHIPPING AS B_VARIANT_REQUIRES_SHIPPING
    ,V.B_TAXABLE AS B_VARIANT_TAXABLE
    --METRICS
    ,V.M_PRICE AS M_VARIANT_PRICE
    ,V.M_POSITION AS M_VARIANT_POSITION
    ,V.M_COMPARE_AT_PRICE AS M_VARIANT_COMPARE_AT_PRICE
    ,V.M_INVENTORY_QUANTITY AS M_VARIANT_INVENTORY_QUANTITY
    ,V.M_INVENTORY_QUANTITY_ADJUSTMENT AS M_VARIANT_INVENTORY_QUANTITY_ADJUSTMENT
    ,V.M_WEIGHT AS M_VARIANT_WEIGHT
    --metadata (MD)
    ,P.MD_IS_DELETED AS MD_IS_DELETED_PRODUCT
    ,V.MD_IS_DELETED AS MD_IS_DELETED_VARIANT
    , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
    , 'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
FROM
    product P
    LEFT JOIN product_variant V ON V.K_PRODUCT_BK = P.K_PRODUCT_BK
)

SELECT * FROM rename
  );
2022-03-03 13:05:00.783472 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:05:02.592454 (Thread-1): SQL status: SUCCESS 1 in 1.81 seconds
2022-03-03 13:05:02.596763 (Thread-1): finished collecting timing info
2022-03-03 13:05:02.597488 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: Close
2022-03-03 13:05:03.133043 (Thread-1): 10:05:03 | 14 of 24 OK created view model DBT_SHOPIFY.V_PRODUCTS_D_STG.......... [SUCCESS 1 in 2.37s]
2022-03-03 13:05:03.133537 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:05:03.133896 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:05:03.134585 (Thread-1): 10:05:03 | 15 of 24 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG....... [RUN]
2022-03-03 13:05:03.135284 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:05:03.135753 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:05:03.149174 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-03 13:05:03.149808 (Thread-1): finished collecting timing info
2022-03-03 13:05:03.151211 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-03 13:05:03.156097 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:05:03.156193 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT"
),
customer AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 

  MD5(S.ID) AS K_ABANDONED_CHECKOUT_DLHK
  ,C.K_CUSTOMER_DLHK
  ,L.K_LOCATION_DLHK
  ,MD5(S.USER_ID) AS K_USER_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK  
  ,S.ID AS K_ABANDONED_CHECKOUT_BK
  ,S.CUSTOMER_ID AS K_CUSTOMER_BK
  ,S.DEVICE_ID AS K_DEVICE_BK
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.SOURCE_IDENTIFIER AS K_SOURCE_BKENTIFIER
  ,S.USER_ID AS K_USER_BK
  ,S.ABANDONED_CHECKOUT_URL AS A_ABANDONED_CHECKOUT_URL  
  ,S.CART_TOKEN AS A_CART_TOKEN
  ,S.CLOSED_AT AS A_CLOSED_AT
  ,S.COMPLETED_AT AS A_COMPLETED_AT
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
  ,S.EMAIL AS A_EMAIL
  ,S.GATEWAY AS A_GATEWAY
  ,S.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
  ,S.NAME AS A_NAME
  ,S.NOTE AS A_NOTE
  ,S.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES
  ,S.PHONE AS A_PHONE
  ,S.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
  ,S.REFERRING_SITE AS A_REFERRING_SITE    
  ,S.SOURCE AS A_SOURCE
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.SOURCE_URL AS A_SOURCE_URL
  ,S.TOKEN AS A_TOKEN
  ,S.UPDATED_AT AS A_UPDATED_AT  
  --BOOLEAN
  ,S.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
  ,S.TAXES_INCLUDED AS B_TAXES_INCLUDED
  --METRIC
  ,S.SUBTOTAL_PRICE::decimal(15,2) AS M_SUBTOTAL_PRICE
  ,S.TOTAL_DISCOUNTS::decimal(15,2) AS M_TOTAL_DISCOUNTS
  ,S.TOTAL_DUTIES::decimal(15,2) AS M_TOTAL_DUTIES
  ,S.TOTAL_LINE_ITEMS_PRICE::decimal(15,2) AS M_TOTAL_LINE_ITEMS_PRICE
  ,S.TOTAL_PRICE::decimal(15,2) AS M_TOTAL_PRICE
  ,S.TOTAL_TAX::decimal(15,2) AS M_TOTAL_TAX
  ,S.TOTAL_WEIGHT::decimal(15,2) AS M_TOTAL_WEIGHT
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
  FROM
      source S
      left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
      left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-03 13:05:03.156294 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:05:05.219736 (Thread-1): SQL status: SUCCESS 1 in 2.06 seconds
2022-03-03 13:05:05.224317 (Thread-1): finished collecting timing info
2022-03-03 13:05:05.224737 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: Close
2022-03-03 13:05:05.691461 (Thread-1): 10:05:05 | 15 of 24 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.. [SUCCESS 1 in 2.56s]
2022-03-03 13:05:05.691658 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:05:05.691959 (Thread-1): Began running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:05:05.692170 (Thread-1): 10:05:05 | 16 of 24 START view model DBT_SHOPIFY.V_TRANSACTIONS_STG............. [RUN]
2022-03-03 13:05:05.692409 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:05:05.692514 (Thread-1): Compiling model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:05:05.695212 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-03 13:05:05.695787 (Thread-1): finished collecting timing info
2022-03-03 13:05:05.697296 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-03 13:05:05.699406 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:05:05.699534 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_TRANSACTIONS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."TRANSACTION"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_TRANSACTION_DLHK
  ,L.K_LOCATION_DLHK  
  ,MD5(S.USER_ID) AS K_USER_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_TRANSACTION_BK
  ,S.DEVICE_ID AS K_DEVICE_BK  
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.ORDER_ID AS K_ORDER_BK
  ,S.PARENT_ID AS K_PARENT_BK
  ,S.REFUND_ID AS K_REFUND_BK
  ,S.USER_ID AS K_USER_BK  
  --ATTRIBUTES
  ,S.AUTHORIZATION AS A_AUTHORIZATION
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CURRENCY_EXCHANGE_ADJUSTMENT AS A_CURRENCY_EXCHANGE_ADJUSTMENT
  ,S.ERROR_CODE AS A_ERROR_CODE
  ,S.GATEWAY AS A_GATEWAY
  ,S.KIND AS A_KIND
  ,S.MESSAGE AS A_MESSAGE
  ,S.PAYMENT_DETAILS AS A_PAYMENT_DETAILS
  ,S.PROCESSED_AT AS A_PROCESSED_AT
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.STATUS AS A_STATUS
  --boolean
  ,S.TEST AS B_TEST
  --METRICS
  ,S.AMOUNT::decimal(15,2) AS M_AMOUNT   
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
  FROM
    source S  
  left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-03 13:05:05.699636 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:05:07.655061 (Thread-1): SQL status: SUCCESS 1 in 1.96 seconds
2022-03-03 13:05:07.659046 (Thread-1): finished collecting timing info
2022-03-03 13:05:07.659543 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: Close
2022-03-03 13:05:08.103960 (Thread-1): 10:05:08 | 16 of 24 OK created view model DBT_SHOPIFY.V_TRANSACTIONS_STG........ [SUCCESS 1 in 2.41s]
2022-03-03 13:05:08.104449 (Thread-1): Finished running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:05:08.104848 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:05:08.105082 (Thread-1): 10:05:08 | 17 of 24 START table model DBT_SHOPIFY.W_PRODUCTS_D.................. [RUN]
2022-03-03 13:05:08.105447 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:05:08.105583 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:05:08.108191 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-03 13:05:08.108565 (Thread-1): finished collecting timing info
2022-03-03 13:05:08.109855 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-03 13:05:08.110406 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:05:08.110502 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCTS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG AS C
      );
2022-03-03 13:05:08.110595 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:05:11.104691 (Thread-1): SQL status: SUCCESS 1 in 2.99 seconds
2022-03-03 13:05:11.110449 (Thread-1): finished collecting timing info
2022-03-03 13:05:11.110641 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: Close
2022-03-03 13:05:11.592135 (Thread-1): 10:05:11 | 17 of 24 OK created table model DBT_SHOPIFY.W_PRODUCTS_D............. [SUCCESS 1 in 3.49s]
2022-03-03 13:05:11.592985 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:05:11.593695 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:05:11.594975 (Thread-1): 10:05:11 | 18 of 24 START table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F........ [RUN]
2022-03-03 13:05:11.596688 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:05:11.597386 (Thread-1): Compiling model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:05:11.608462 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-03 13:05:11.609527 (Thread-1): finished collecting timing info
2022-03-03 13:05:11.611234 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-03 13:05:11.611850 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:05:11.611981 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG AS C
      );
2022-03-03 13:05:11.612100 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:05:15.095315 (Thread-1): SQL status: SUCCESS 1 in 3.48 seconds
2022-03-03 13:05:15.100750 (Thread-1): finished collecting timing info
2022-03-03 13:05:15.101519 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: Close
2022-03-03 13:05:15.560790 (Thread-1): 10:05:15 | 18 of 24 OK created table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F... [SUCCESS 1 in 3.96s]
2022-03-03 13:05:15.561636 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:05:15.562171 (Thread-1): Began running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:05:15.566407 (Thread-1): 10:05:15 | 19 of 24 START table model DBT_SHOPIFY.W_TRANSACTIONS_F.............. [RUN]
2022-03-03 13:05:15.567271 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:05:15.567737 (Thread-1): Compiling model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:05:15.577097 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-03 13:05:15.577533 (Thread-1): finished collecting timing info
2022-03-03 13:05:15.579012 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-03 13:05:15.579602 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:05:15.579697 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_TRANSACTIONS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_TRANSACTIONS_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG AS C
      );
2022-03-03 13:05:15.579788 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:05:18.150766 (Thread-1): SQL status: SUCCESS 1 in 2.57 seconds
2022-03-03 13:05:18.156997 (Thread-1): finished collecting timing info
2022-03-03 13:05:18.157623 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: Close
2022-03-03 13:05:18.645387 (Thread-1): 10:05:18 | 19 of 24 OK created table model DBT_SHOPIFY.W_TRANSACTIONS_F......... [SUCCESS 1 in 3.08s]
2022-03-03 13:05:18.646023 (Thread-1): Finished running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:05:18.646542 (Thread-1): Began running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:05:18.647888 (Thread-1): 10:05:18 | 20 of 24 START view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG........... [RUN]
2022-03-03 13:05:18.653805 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:05:18.654329 (Thread-1): Compiling model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:05:18.665129 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-03 13:05:18.665626 (Thread-1): finished collecting timing info
2022-03-03 13:05:18.667001 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-03 13:05:18.668966 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:05:18.669064 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_INVENTORY_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_ITEM"
),
inventory_level AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_LEVEL"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
products AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename AS 
(   
  SELECT   
  MD5(S.ID) AS K_INVENTORY_ITEM_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
  ,L.K_LOCATION_DLHK
  ,L.K_LOCATION_BK  
  ,S.ID AS K_INVENTORY_ITEM_BK
  ,S.COUNTRY_CODE_OF_ORIGIN AS A_COUNTRY_CODE_OF_ORIGIN
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.PROVINCE_CODE_OF_ORIGIN AS A_PROVINCE_CODE_OF_ORIGIN
  ,S.SKU AS A_SKU
  ,S.UPDATED_AT AS A_UPDATED_AT
  ,S.HARMONIZED_SYSTEM_CODE AS A_HARMONIZED_SYSTEM_CODE  
  --BOOLEAN
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TRACKED AS B_TRACKED
  --METRICS
  ,S.COST::decimal(15,2) AS M_COST 
  ,IL.AVAILABLE AS M_AVAIABLE  
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
  FROM
      source S
      left join inventory_level IL ON IL.INVENTORY_ITEM_ID = S.ID      
      left join locations L ON L.K_LOCATION_BK = IL.LOCATION_ID
      left join products P ON P.K_VARIANT_INVENTORY_ITEM_BK = S.ID 
)


SELECT * FROM rename
  );
2022-03-03 13:05:18.669161 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:05:20.540523 (Thread-1): SQL status: SUCCESS 1 in 1.87 seconds
2022-03-03 13:05:20.543294 (Thread-1): finished collecting timing info
2022-03-03 13:05:20.543647 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: Close
2022-03-03 13:05:21.006198 (Thread-1): 10:05:21 | 20 of 24 OK created view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG...... [SUCCESS 1 in 2.36s]
2022-03-03 13:05:21.006764 (Thread-1): Finished running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:05:21.007267 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:05:21.008065 (Thread-1): 10:05:21 | 21 of 24 START view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG......... [RUN]
2022-03-03 13:05:21.009013 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:05:21.009760 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:05:21.023551 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-03 13:05:21.024985 (Thread-1): finished collecting timing info
2022-03-03 13:05:21.026536 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-03 13:05:21.030525 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:05:21.030623 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM" AS A
),
products AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D AS A
),
taxes AS (
  SELECT 
      K_ORDER_LINE_ITEM_BK,
      AVG(M_RATE) AS M_RATE,
      SUM(M_TAX) AS M_TAX,
      SUM(M_TAX_PRIMARY) AS M_TAX_PRIMARY
    FROM 
      DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG AS A
    GROUP BY K_ORDER_LINE_ITEM_BK
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_LINE_ITEM_DLHK  
  ,MD5(ORDER_ID) AS K_ORDER_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
 --business keys
  ,O.PRODUCT_ID AS K_PRODUCT_BK
  ,O.VARIANT_ID AS K_VARIANT_BK
  
  ,O.ORDER_ID AS K_ORDER_BK
  ,O.ID AS K_ORDER_LINE_ITEM_BK
  --attribubtes
  ,O.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
  ,O.NAME AS A_NAME  
  ,O.PROPERTIES AS A_PROPERTIES
  ,O.SKU AS A_SKU
  ,O.TITLE AS A_TITLE  
  ,O.VARIANT_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
  ,O.VARIANT_TITLE AS A_VARIANT_TITLE
  ,O.VENDOR AS A_VENDOR
  --boolean
  ,O.GIFT_CARD AS B_GIFT_CARD
  ,O.PRODUCT_EXISTS AS B_PRODUCT_EXISTS
  ,O.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,O.TAXABLE AS B_TAXABLE
  --metrics
  ,O.FULFILLABLE_QUANTITY AS M_FULFILLABLE_QUANTITY
  ,O.GRAMS::DECIMAL(15,2) AS M_GRAMS
  ,O.QUANTITY::DECIMAL(15,2) AS M_QUANTITY
  ,M_RATE AS M_TAX_RATE
  ,T.M_TAX_PRIMARY::DECIMAL(15,2) AS M_TAX_AMOUNT
  ,T.M_TAX::DECIMAL(15,2) AS M_TAX_AMOUNT_PRIMARY

  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE_PRIMARY 
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT_PRIMARY 
  ,(O.QUANTITY * M_UNIT_PRICE)::DECIMAL(15,2) AS M_TOTAL_PRICE  
  ,(O.QUANTITY * M_UNIT_PRICE_PRIMARY)::DECIMAL(15,2) AS M_TOTAL_PRICE_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
FROM source O
  left join products P ON P.K_PRODUCT_BK = O.PRODUCT_ID AND CASE WHEN O.VARIANT_ID IS NOT NULL THEN O.VARIANT_ID = P.K_PRODUCT_VARIANT_BK ELSE 1=1 END
  left join taxes T ON T.K_ORDER_LINE_ITEM_BK = O.ID
)

SELECT * FROM rename
  );
2022-03-03 13:05:21.030725 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:05:23.049612 (Thread-1): SQL status: SUCCESS 1 in 2.02 seconds
2022-03-03 13:05:23.054569 (Thread-1): finished collecting timing info
2022-03-03 13:05:23.055187 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: Close
2022-03-03 13:05:23.517675 (Thread-1): 10:05:23 | 21 of 24 OK created view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG.... [SUCCESS 1 in 2.51s]
2022-03-03 13:05:23.518135 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:05:23.518280 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:05:23.518437 (Thread-1): 10:05:23 | 22 of 24 START view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG....... [RUN]
2022-03-03 13:05:23.518636 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:05:23.518754 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:05:23.522172 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-03 13:05:23.522750 (Thread-1): finished collecting timing info
2022-03-03 13:05:23.524067 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-03 13:05:23.525974 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:05:23.526072 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECT"
),
source_collection AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECTION"
),
product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename as (

SELECT
  MD5(S.ID) AS K_PRODUCT_COLLECT_DLHK
  ,MD5(CC.ID) AS K_COLLECTION_DLHK
  ,P.K_PRODUCT_DLHK  
  ,S.ID AS K_PRODUCT_COLLECT_BK
  ,CC.ID AS K_COLLECTION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,S.POSITION AS A_POSITION
  ,S.SORT_ORDER AS A_SORT_ORDER  
  ,S.CREATED_AT AS A_CREATED_AT_DTS
  ,S.UPDATED_AT AS A_UPDATED_AT_DTS
  ,CC.PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,CC.BODY_HTML AS A_BODY_HTML
  ,CC.TITLE AS A_TITLE
  ,CC.HANDLE AS A_HANDLE
  ,CC.PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE  
  ,CC.COLLECTION_TYPE AS A_COLLECTION_TYPE  
  --metrics
  ,CC.PRODUCTS_COUNT AS M_PRODUCTS_COUNT
  --metadata (MD)
  ,S.__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
FROM
    source S
    LEFT JOIN source_collection CC ON CC.ID = S.COLLECTION_ID
    LEFT JOIN product P ON P.K_PRODUCT_BK = S.PRODUCT_ID
)

SELECT * FROM rename
  );
2022-03-03 13:05:23.526167 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:05:25.329358 (Thread-1): SQL status: SUCCESS 1 in 1.80 seconds
2022-03-03 13:05:25.331748 (Thread-1): finished collecting timing info
2022-03-03 13:05:25.331942 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: Close
2022-03-03 13:05:25.821091 (Thread-1): 10:05:25 | 22 of 24 OK created view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG.. [SUCCESS 1 in 2.30s]
2022-03-03 13:05:25.821336 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:05:25.821480 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:05:25.822097 (Thread-1): 10:05:25 | 23 of 24 START table model DBT_SHOPIFY.W_ORDERS_F.................... [RUN]
2022-03-03 13:05:25.822914 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:05:25.823229 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:05:25.829011 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-03 13:05:25.830385 (Thread-1): finished collecting timing info
2022-03-03 13:05:25.832090 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-03 13:05:25.838213 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:05:25.838328 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ORDERS_F  as
      (

SELECT
  O.K_ORDER_DLHK AS K_ORDER_DLHK
  ,OLI.K_ORDER_LINE_ITEM_DLHK AS K_ORDER_LINE_ITEM_DLHK
  ,O.K_CUSTOMER_DLHK AS K_CUSTOMER_DLHK
  ,O.K_LOCATION_DLHK AS K_LOCATION_DLHK
  ,O.K_BILLING_ADDRESS_DLHK AS K_BILLING_ADDRESS_DLHK
  ,O.K_SHIPPING_ADDRESS_DLHK AS K_SHIPPING_ADDRESS_DLHK
  ,OLI.K_PRODUCT_VARIATION_DLHK AS K_ITEM_PRODUCT_VARIATION_DLHK
  ,OLI.K_PRODUCT_BK AS K_ITEM_PRODUCT_BK
  ,OLI.K_VARIANT_BK AS K_ITEM_VARIANT_BK
  ,OLI.K_ORDER_BK AS K_ITEM_ORDER_BK
  ,O.K_ORDER_BK AS K_ORDER_BK
  ,OLI.K_ORDER_LINE_ITEM_BK AS K_ITEM_ORDER_LINE_ITEM_BK
  ,O.K_APP_BK AS K_HEADER_APP_BK
  
  ,O.K_CUSTOMER_BK AS K_CUSTOMER_BK
  ,O.K_DEVICE_BK AS K_DEVICE_BK
  ,O.K_LOCATION_BK AS K_LOCATION_BK
  ,O.K_SOURCE_ENTIFIER_BK AS K_SOURCE_ENTIFIER_BK
  ,O.A_BROWSER_IP AS A_HEADER_BROWSER_IP
  ,O.A_CANCELLED_AT_DTS AS A_HEADER_CANCELLED_AT_DTS
  ,O.A_CANCEL_REASON AS A_HEADER_CANCEL_REASON
  ,O.A_CART_TOKEN AS A_HEADER_CART_TOKEN
  ,O.A_CHECKOUT_TOKEN AS A_HEADER_CHECKOUT_TOKEN
  ,O.A_CLIENT_DETAILS AS A_HEADER_CLIENT_DETAILS
  ,O.A_CLOSED_AT_DTS AS A_HEADER_CLOSED_AT_DTS
  ,O.A_CREATED_AT_DTS AS A_HEADER_CREATED_AT_DTS
  ,O.A_CURRENCY AS A_HEADER_CURRENCY
  ,O.A_PRESENTMENT_CURRENCY AS A_HEADER_PRESENTMENT_CURRENCY
  ,O.A_CUSTOMER_LOCALE AS A_HEADER_CUSTOMER_LOCALE
  ,O.A_EMAIL AS A_HEADER_EMAIL
  ,O.A_FINANCIAL_STATUS AS A_HEADER_FINANCIAL_STATUS
  ,O.A_FULFILLMENT_STATUS AS A_HEADER_FULFILLMENT_STATUS
  ,O.A_LANDING_SITE_BASE_URL AS A_HEADER_LANDING_SITE_BASE_URL
  ,O.A_LANDING_SITE_REF AS A_HEADER_LANDING_SITE_REF
  ,O.A_NAME AS A_HEADER_NAME
  ,O.A_NOTE AS A_HEADER_NOTE
  ,O.A_NOTE_ATTRIBUTES AS A_HEADER_NOTE_ATTRIBUTES
  ,O.A_PAYMENT_GATEWAY_NAMES AS A_HEADER_PAYMENT_GATEWAY_NAMES
  ,O.A_PROCESSED_AT_DTS AS A_HEADER_PROCESSED_AT_DTS
  ,O.A_PROCESSING_METHOD AS A_HEADER_PROCESSING_METHOD
  ,O.A_REFERENCE AS A_HEADER_REFERENCE
  ,O.A_REFERRING_SITE AS A_HEADER_REFERRING_SITE
  ,O.A_SOURCE_NAME AS A_HEADER_SOURCE_NAME
  ,O.A_SOURCE_URL AS A_HEADER_SOURCE_URL
  ,O.A_ORDER_NUMBER AS A_HEADER_ORDER_NUMBER
  ,O.A_POSION_NUMBER AS A_HEADER_POSION_NUMBER
  ,O.A_UPDATED_AT_DTS AS A_HEADER_UPDATED_AT_DTS
  ,O.B_BUYER_ACCEPTS_MARKETING AS B_HEADER_BUYER_ACCEPTS_MARKETING
  ,O.B_CONFIRMED AS B_HEADER_CONFIRMED
  ,O.B_TAXES_INCLUDED  AS B_HEADER_TAXES_INCLUDED   
  ,OLI.A_FULFILLMENT_SERVICE AS A_ITEM_FULFILLMENT_SERVICE
  ,OLI.A_FULFILLMENT_STATUS AS A_ITEM_FULFILLMENT_STATUS
  ,OLI.A_NAME AS A_ITEM_NAME
  ,OLI.A_PROPERTIES AS A_ITEM_PROPERTIES
  ,OLI.A_SKU AS A_ITEM_SKU
  ,OLI.A_TITLE AS A_ITEM_TITLE  
  ,OLI.A_VARIANT_INVENTORY_MANAGEMENT AS A_ITEM_VARIANT_INVENTORY_MANAGEMENT
  ,OLI.A_VARIANT_TITLE AS A_ITEM_VARIANT_TITLE
  ,OLI.A_VENDOR AS A_ITEM_VENDOR
  ,OLI.B_GIFT_CARD AS B_ITEM_GIFT_CARD
  ,OLI.B_PRODUCT_EXISTS AS B_ITEM_PRODUCT_EXISTS
  ,OLI.B_REQUIRES_SHIPPING AS B_ITEM_REQUIRES_SHIPPING
  ,OLI.B_TAXABLE AS B_ITEM_TAXABLE
  ,OLI.M_FULFILLABLE_QUANTITY AS M_ITEM_FULFILLABLE_QUANTITY
  ,OLI.M_GRAMS AS M_ITEM_GRAMS
  ,OLI.M_QUANTITY AS M_ITEM_QUANTITY
  ,OLI.M_UNIT_PRICE AS M_ITEM_UNIT_PRICE
  ,OLI.M_UNIT_PRICE_PRIMARY AS M_ITEM_UNIT_PRICE_PRIMARY
  ,OLI.M_TOTAL_PRICE AS M_ITEM_TOTAL_PRICE
  ,OLI.M_TOTAL_PRICE_PRIMARY AS M_ITEM_TOTAL_PRICE_PRIMARY
  ,OLI.M_TOTAL_DISCOUNT AS M_ITEM_TOTAL_DISCOUNT
  ,OLI.M_TOTAL_DISCOUNT_PRIMARY AS M_ITEM_TOTAL_DISCOUNT_PRIMARY
  ,OLI.M_TAX_AMOUNT AS M_TAX_AMOUNT
  ,OLI.M_TAX_AMOUNT_PRIMARY AS M_TAX_AMOUNT_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_TIP_RECEIVED * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_TIP_AMOUNT_PRIMARY  
  --,ROUND(DIV0((O.M_TOTAL_DISCOUNTS_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_HEADER_DISCOUNT
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE * OLI.M_TOTAL_PRICE),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE



   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'a26ceb0b-6ca8-4395-b363-f74d8cbd97c2' AS MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG OLI ON OLI.K_ORDER_DLHK = O.K_ORDER_DLHK
      );
2022-03-03 13:05:25.838434 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:05:29.488405 (Thread-1): SQL status: SUCCESS 1 in 3.65 seconds
2022-03-03 13:05:29.495821 (Thread-1): finished collecting timing info
2022-03-03 13:05:29.496467 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-03 13:05:29.956581 (Thread-1): 10:05:29 | 23 of 24 OK created table model DBT_SHOPIFY.W_ORDERS_F............... [SUCCESS 1 in 4.13s]
2022-03-03 13:05:29.957432 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:05:29.958526 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:05:29.959792 (Thread-1): 10:05:29 | 24 of 24 START table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F........ [RUN]
2022-03-03 13:05:29.960773 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:05:29.961359 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:05:29.971807 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-03 13:05:29.972482 (Thread-1): finished collecting timing info
2022-03-03 13:05:29.974060 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-03 13:05:29.974682 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:05:29.974780 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCT_COLLECTION_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG AS C
      );
2022-03-03 13:05:29.974883 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:05:33.315535 (Thread-1): SQL status: SUCCESS 1 in 3.34 seconds
2022-03-03 13:05:33.320376 (Thread-1): finished collecting timing info
2022-03-03 13:05:33.320920 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: Close
2022-03-03 13:05:33.791377 (Thread-1): 10:05:33 | 24 of 24 OK created table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F... [SUCCESS 1 in 3.83s]
2022-03-03 13:05:33.792067 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:05:33.799908 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 13:05:33.802823 (MainThread): 10:05:33 | 
2022-03-03 13:05:33.803304 (MainThread): 10:05:33 | Finished running 16 view models, 8 table models in 73.55s.
2022-03-03 13:05:33.803608 (MainThread): Connection 'master' was properly closed.
2022-03-03 13:05:33.803700 (MainThread): Connection 'model.snowflake_aicd.W_PRODUCT_COLLECTION_F' was properly closed.
2022-03-03 13:05:33.811180 (MainThread): 
2022-03-03 13:05:33.811408 (MainThread): Completed successfully
2022-03-03 13:05:33.811592 (MainThread): 
Done. PASS=24 WARN=0 ERROR=0 SKIP=0 TOTAL=24
2022-03-03 13:05:33.811866 (MainThread): Flushing usage events
2022-03-03 13:12:38.987773 (MainThread): Running with dbt=0.21.1
2022-03-03 13:12:39.556509 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-03 13:12:39.558920 (MainThread): Tracking: do not track
2022-03-03 13:12:39.576146 (MainThread): Partial parsing not enabled
2022-03-03 13:12:39.599363 (MainThread): Parsing macros/common.sql
2022-03-03 13:12:39.602514 (MainThread): Parsing macros/catalog.sql
2022-03-03 13:12:39.604472 (MainThread): Parsing macros/adapters.sql
2022-03-03 13:12:39.639931 (MainThread): Parsing macros/materializations/merge.sql
2022-03-03 13:12:39.643592 (MainThread): Parsing macros/materializations/seed.sql
2022-03-03 13:12:39.647330 (MainThread): Parsing macros/materializations/view.sql
2022-03-03 13:12:39.648337 (MainThread): Parsing macros/materializations/table.sql
2022-03-03 13:12:39.651052 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-03 13:12:39.658027 (MainThread): Parsing macros/core.sql
2022-03-03 13:12:39.661160 (MainThread): Parsing macros/materializations/test.sql
2022-03-03 13:12:39.667009 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-03 13:12:39.675574 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-03 13:12:39.677055 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-03 13:12:39.691492 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-03 13:12:39.725377 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-03 13:12:39.746528 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-03 13:12:39.748040 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-03 13:12:39.757171 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-03 13:12:39.776315 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-03 13:12:39.789520 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-03 13:12:39.796997 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-03 13:12:39.804272 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-03 13:12:39.807543 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-03 13:12:39.808752 (MainThread): Parsing macros/etc/query.sql
2022-03-03 13:12:39.809489 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-03 13:12:39.810711 (MainThread): Parsing macros/etc/datetime.sql
2022-03-03 13:12:39.817999 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-03 13:12:39.819357 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-03 13:12:39.821185 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-03 13:12:39.822347 (MainThread): Parsing macros/adapters/common.sql
2022-03-03 13:12:39.874321 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-03 13:12:39.875908 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-03 13:12:39.876943 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-03 13:12:39.877939 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-03 13:12:40.025687 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:12:40.033596 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.036895 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:12:40.039803 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.040590 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:12:40.043225 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.043944 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:12:40.048811 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.049670 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:12:40.052891 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.053697 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:12:40.056942 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.057738 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:12:40.060654 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.061395 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:12:40.063842 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.064561 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:12:40.066902 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.067604 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:12:40.071872 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.072666 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:12:40.075656 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.080558 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:12:40.085924 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.086837 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:12:40.092687 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.093590 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:12:40.096756 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.097688 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:12:40.101207 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.102132 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:12:40.105588 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.106303 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:12:40.109079 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.109779 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:12:40.113273 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.114038 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:12:40.152475 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.153401 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:12:40.156143 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.156934 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:12:40.159612 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.160423 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:12:40.162726 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.163710 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:12:40.166595 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.167540 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:12:40.169935 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.170683 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:12:40.173179 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.195625 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.197636 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.199061 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.200558 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.202086 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.203748 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.205034 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.206173 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:12:40.249864 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-03 13:12:40.250547 (MainThread): Found 25 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 23 sources, 0 exposures
2022-03-03 13:12:40.252798 (MainThread): 
2022-03-03 13:12:40.253080 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 13:12:40.254610 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 13:12:40.265127 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 13:12:40.265328 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-03 13:12:40.265429 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-03 13:12:42.108063 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 1.84 seconds
2022-03-03 13:12:42.113788 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-03 13:12:42.584675 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 13:12:42.589719 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 13:12:42.589858 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-03 13:12:42.589963 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-03 13:12:44.062763 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 25 in 1.47 seconds
2022-03-03 13:12:44.069005 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-03 13:12:44.517402 (MainThread): 10:12:44 | Concurrency: 1 threads (target='dev')
2022-03-03 13:12:44.517893 (MainThread): 10:12:44 | 
2022-03-03 13:12:44.532875 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:12:44.534005 (Thread-1): 10:12:44 | 1 of 25 START view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG.......... [RUN]
2022-03-03 13:12:44.534288 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:12:44.534406 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:12:44.537200 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-03 13:12:44.541272 (Thread-1): finished collecting timing info
2022-03-03 13:12:44.560428 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-03 13:12:44.562405 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:12:44.562533 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER_ADDRESS"
),
rename AS 
(   
SELECT 
    MD5(ID) AS K_CUSTOMER_ADDRESS_DLHK
    ,ID AS K_CUSTOMER_ADDRESS_BK
    ,MD5(CONCAT(
        COALESCE(ADDRESS1,'00'),
        COALESCE(ADDRESS2,'00'),
        COALESCE(CITY,'00'),
        COALESCE(COUNTRY,'00'),
        COALESCE(COUNTRY_CODE,'00'),
        COALESCE(FIRST_NAME,'00'),
        COALESCE(LAST_NAME,'00'),
        COALESCE(PROVINCE,'00'),
        COALESCE(PROVINCE_CODE,'00'),
        COALESCE(ZIP,'00')
    )) AS K_ADDRESS_DLHK
    ,CUSTOMER_ID AS K_CUSTOMER_BK
    ,ADDRESS1 AS A_ADDRESS1
    ,ADDRESS2 AS A_ADDRESS2
    ,CITY AS A_CITY
    ,COMPANY AS A_COMPANY
    ,COUNTRY AS A_COUNTRY
    ,COUNTRY_CODE AS A_COUNTRY_CODE
    ,COUNTRY_NAME AS A_COUNTRY_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,PHONE AS A_PHONE
    ,PROVINCE AS A_PROVINCE
    ,PROVINCE_CODE AS A_PROVINCE_CODE
    ,ZIP AS A_ZIP
    ,IS_DEFAULT AS B_IS_DEFAULT  
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-03 13:12:44.562640 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:12:46.514477 (Thread-1): SQL status: SUCCESS 1 in 1.95 seconds
2022-03-03 13:12:46.535271 (Thread-1): finished collecting timing info
2022-03-03 13:12:46.535480 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: Close
2022-03-03 13:12:46.978942 (Thread-1): 10:12:46 | 1 of 25 OK created view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG..... [SUCCESS 1 in 2.44s]
2022-03-03 13:12:46.979543 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:12:46.981722 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:12:46.983070 (Thread-1): 10:12:46 | 2 of 25 START view model DBT_SHOPIFY.V_CUSTOMER_STG.................. [RUN]
2022-03-03 13:12:46.999067 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:12:46.999403 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:12:47.003079 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-03 13:12:47.003785 (Thread-1): finished collecting timing info
2022-03-03 13:12:47.005447 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-03 13:12:47.007488 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:12:47.007649 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER"
),
rename AS 
(   
SELECT 
    --KEYS
    MD5(ID) AS K_CUSTOMER_DLHK    
    --BUSINESS KEYS
    ,ID AS K_CUSTOMER_BK
    ,LAST_ORDER_ID AS K_LAST_ORDER_BK
    ,MULTIPASS_IDENTIFIER AS K_MULTIPASS_BKENTIFIER
    --ATTRIBUTES
    ,ACCEPTS_MARKETING_UPDATED_AT AS A_ACCEPTS_MARKETING_UPDATED_AT_DTS
    ,CREATED_AT AS A_CREATED_AT_DTS
    ,CURRENCY AS A_CURRENCY
    ,EMAIL AS A_EMAIL
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,LAST_ORDER_NAME AS A_LAST_ORDER_NAME
    ,MARKETING_OPT_IN_LEVEL AS A_MARKETING_OPT_IN_LEVEL
    ,NOTE AS A_NOTE
    ,PHONE AS A_PHONE
    ,SMS_MARKETING_CONSENT AS A_SMS_MARKETING_CONSENT
    ,STATE AS A_STATE
    ,TAGS AS A_TAGS
    ,TAX_EXEMPTIONS AS A_TAX_EXEMPTIONS
    ,TOTAL_SPENT AS A_TOTAL_SPENT
    ,UPDATED_AT AS A_UPDATED_AT
    --BOOLEAN
    ,ACCEPTS_MARKETING AS B_ACCEPTS_MARKETING
    ,TAX_EXEMPT AS B_TAX_EXEMPT
    ,VERIFIED_EMAIL AS B_VERIFIED_EMAIL
    --METRICS
    ,ORDERS_COUNT AS M_ORDERS_COUNT
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-03 13:12:47.007753 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:12:48.976620 (Thread-1): SQL status: SUCCESS 1 in 1.96 seconds
2022-03-03 13:12:48.980974 (Thread-1): finished collecting timing info
2022-03-03 13:12:48.981227 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-03 13:12:49.447707 (Thread-1): 10:12:49 | 2 of 25 OK created view model DBT_SHOPIFY.V_CUSTOMER_STG............. [SUCCESS 1 in 2.45s]
2022-03-03 13:12:49.448749 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:12:49.449904 (Thread-1): Began running node model.snowflake_aicd.V_DATE_STG
2022-03-03 13:12:49.450985 (Thread-1): 10:12:49 | 3 of 25 START view model DBT_SHOPIFY.V_DATE_STG...................... [RUN]
2022-03-03 13:12:49.452735 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:12:49.453591 (Thread-1): Compiling model.snowflake_aicd.V_DATE_STG
2022-03-03 13:12:49.470052 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-03 13:12:49.475808 (Thread-1): finished collecting timing info
2022-03-03 13:12:49.477416 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-03 13:12:49.498379 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:12:49.498563 (Thread-1): On model.snowflake_aicd.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-03 13:12:49.498741 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:12:51.624436 (Thread-1): SQL status: SUCCESS 1 in 2.13 seconds
2022-03-03 13:12:51.630968 (Thread-1): finished collecting timing info
2022-03-03 13:12:51.632731 (Thread-1): On model.snowflake_aicd.V_DATE_STG: Close
2022-03-03 13:12:52.101462 (Thread-1): 10:12:52 | 3 of 25 OK created view model DBT_SHOPIFY.V_DATE_STG................. [SUCCESS 1 in 2.65s]
2022-03-03 13:12:52.103284 (Thread-1): Finished running node model.snowflake_aicd.V_DATE_STG
2022-03-03 13:12:52.104536 (Thread-1): Began running node model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:12:52.105502 (Thread-1): 10:12:52 | 4 of 25 START view model DBT_SHOPIFY.V_LOCATION_STG.................. [RUN]
2022-03-03 13:12:52.106854 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:12:52.107456 (Thread-1): Compiling model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:12:52.122013 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-03 13:12:52.122862 (Thread-1): finished collecting timing info
2022-03-03 13:12:52.124569 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-03 13:12:52.126311 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:12:52.126464 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:12:52.126572 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:12:54.020360 (Thread-1): SQL status: SUCCESS 1 in 1.89 seconds
2022-03-03 13:12:54.023506 (Thread-1): finished collecting timing info
2022-03-03 13:12:54.023977 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-03 13:12:54.477261 (Thread-1): 10:12:54 | 4 of 25 OK created view model DBT_SHOPIFY.V_LOCATION_STG............. [SUCCESS 1 in 2.37s]
2022-03-03 13:12:54.479023 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:12:54.479639 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:12:54.485151 (Thread-1): 10:12:54 | 5 of 25 START view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG......... [RUN]
2022-03-03 13:12:54.486092 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:12:54.486596 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:12:54.500677 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-03 13:12:54.502328 (Thread-1): finished collecting timing info
2022-03-03 13:12:54.504037 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-03 13:12:54.506384 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:12:54.506498 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_ADJUSTMENT" AS A
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_ADJUSTMENT_DLHK
  --BK
  ,ID AS K_ORDER_ADJUSTMENT_BK
  ,ORDER_ID AS K_ORDER_BK
  ,REFUND_ID AS K_REFUND_BK
  --ATTRIBUTE
  ,KIND AS A_KIND
  ,REASON AS A_REASON
  --METRIC
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_AMOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT_PRIMARY
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_AMOUNT_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-03 13:12:54.506605 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:12:56.184368 (Thread-1): SQL status: SUCCESS 1 in 1.68 seconds
2022-03-03 13:12:56.187304 (Thread-1): finished collecting timing info
2022-03-03 13:12:56.187487 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: Close
2022-03-03 13:12:56.629690 (Thread-1): 10:12:56 | 5 of 25 OK created view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG.... [SUCCESS 1 in 2.14s]
2022-03-03 13:12:56.629910 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:12:56.630354 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:12:56.630883 (Thread-1): 10:12:56 | 6 of 25 START view model DBT_SHOPIFY.V_ORDERS_HEADER_STG............. [RUN]
2022-03-03 13:12:56.631187 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:12:56.631308 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:12:56.639712 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-03 13:12:56.640614 (Thread-1): finished collecting timing info
2022-03-03 13:12:56.642182 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-03 13:12:56.651440 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:12:56.651614 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDERS" AS A
),
rename AS 
(
SELECT
    MD5(O.ID) AS K_ORDER_DLHK    
    ,MD5(O.CUSTOMER_ID) AS K_CUSTOMER_DLHK
    ,MD5(O.LOCATION_ID) AS K_LOCATION_DLHK    
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
    --BUSINESS_KEYS
    ,O.APP_ID AS K_APP_BK
    ,O.ID AS K_ORDER_BK
    ,O.CUSTOMER_ID AS K_CUSTOMER_BK
    ,O.DEVICE_ID AS K_DEVICE_BK  
    ,O.LOCATION_ID AS K_LOCATION_BK
    ,O.SOURCE_IDENTIFIER AS K_SOURCE_ENTIFIER_BK
    --ATTRIBUTES
    ,O.BROWSER_IP AS A_BROWSER_IP
    ,O.CANCELLED_AT AS A_CANCELLED_AT_DTS
    ,O.CANCEL_REASON AS A_CANCEL_REASON
    ,O.CART_TOKEN AS A_CART_TOKEN
    ,O.CHECKOUT_TOKEN AS A_CHECKOUT_TOKEN
    ,O.CLIENT_DETAILS AS A_CLIENT_DETAILS
    ,O.CLOSED_AT AS A_CLOSED_AT_DTS
    ,O.CREATED_AT AS A_CREATED_AT_DTS
    ,O.CURRENCY AS A_CURRENCY
    ,O.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
    ,O.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
    ,O.EMAIL AS A_EMAIL
    ,O.FINANCIAL_STATUS AS A_FINANCIAL_STATUS
    ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
    ,O.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
    ,O.LANDING_SITE_REF AS A_LANDING_SITE_REF
    ,O.NAME AS A_NAME
    ,O.NOTE AS A_NOTE
    ,O.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES    
    ,O.PAYMENT_GATEWAY_NAMES AS A_PAYMENT_GATEWAY_NAMES    
    ,O.PROCESSED_AT AS A_PROCESSED_AT_DTS
    ,O.PROCESSING_METHOD AS A_PROCESSING_METHOD
    ,O.REFERENCE AS A_REFERENCE
    ,O.REFERRING_SITE AS A_REFERRING_SITE    
    ,O.SOURCE_NAME AS A_SOURCE_NAME
    ,O.SOURCE_URL AS A_SOURCE_URL    
    ,O.ORDER_NUMBER AS A_ORDER_NUMBER
    ,O.POSION_NUMBER AS A_POSION_NUMBER  
    ,O.UPDATED_AT AS A_UPDATED_AT_DTS
    --BOOLEAN
    ,O.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
    ,O.CONFIRMED AS B_CONFIRMED
    ,O.TAXES_INCLUDED AS B_TAXES_INCLUDED
    --METRICS
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE_PRIMARY 
    ,O.TOTAL_TIP_RECEIVED::DECIMAL(15,2) AS M_TOTAL_TIP_RECEIVED   
    ,O.TOTAL_WEIGHT::DECIMAL(15,2) AS M_TOTAL_WEIGHT
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
FROM source O
)

SELECT * FROM rename
  );
2022-03-03 13:12:56.651752 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:12:58.369203 (Thread-1): SQL status: SUCCESS 1 in 1.72 seconds
2022-03-03 13:12:58.374830 (Thread-1): finished collecting timing info
2022-03-03 13:12:58.375112 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: Close
2022-03-03 13:12:58.848341 (Thread-1): 10:12:58 | 6 of 25 OK created view model DBT_SHOPIFY.V_ORDERS_HEADER_STG........ [SUCCESS 1 in 2.22s]
2022-03-03 13:12:58.848642 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:12:58.848913 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:12:58.849421 (Thread-1): 10:12:58 | 7 of 25 START view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG.. [RUN]
2022-03-03 13:12:58.849757 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:12:58.849895 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:12:58.853770 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-03 13:12:58.854121 (Thread-1): finished collecting timing info
2022-03-03 13:12:58.856338 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-03 13:12:58.858337 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:12:58.858461 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM_TAX_LINE" AS A
),
rename AS 
(
SELECT
  CONCAT(COALESCE(ORDER_ID,'0000000000'),'-',COALESCE(ORDER_LINE_ID,'0000000000')) AS K_ORDER_LINE_ITEM_TAX_DLHK
  ,ORDER_ID AS K_ORDER_BK
  ,ORDER_LINE_ID AS K_ORDER_LINE_ITEM_BK
  ,TITLE AS A_TITLE
  ,CHANNEL_LIABLE AS B_CHANNEL_LIABLE
  ,RATE AS M_RATE
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TAX
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TAX_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-03 13:12:58.858570 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:00.689230 (Thread-1): SQL status: SUCCESS 1 in 1.83 seconds
2022-03-03 13:13:00.690597 (Thread-1): finished collecting timing info
2022-03-03 13:13:00.690768 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: Close
2022-03-03 13:13:01.155041 (Thread-1): 10:13:01 | 7 of 25 OK created view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG [SUCCESS 1 in 2.30s]
2022-03-03 13:13:01.155638 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:13:01.163406 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:13:01.164274 (Thread-1): 10:13:01 | 8 of 25 START view model DBT_SHOPIFY.V_PRODUCT_STG................... [RUN]
2022-03-03 13:13:01.165105 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:13:01.167898 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:13:01.176855 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-03 13:13:01.178257 (Thread-1): finished collecting timing info
2022-03-03 13:13:01.179984 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-03 13:13:01.181641 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:13:01.182759 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_DLHK
  ,ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE
  ,HANDLE AS A_HANDLE
  ,PRODUCT_TYPE AS A_PRODUCT_TYPE
  ,VENDOR AS A_VENDOR
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE
  ,STATUS AS A_STATUS
  ,TEMPLATE_SUFFIX AS A_TEMPLATE_SUFFIX   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:13:01.182878 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:03.047072 (Thread-1): SQL status: SUCCESS 1 in 1.86 seconds
2022-03-03 13:13:03.050469 (Thread-1): finished collecting timing info
2022-03-03 13:13:03.050977 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: Close
2022-03-03 13:13:03.501786 (Thread-1): 10:13:03 | 8 of 25 OK created view model DBT_SHOPIFY.V_PRODUCT_STG.............. [SUCCESS 1 in 2.34s]
2022-03-03 13:13:03.502341 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:13:03.502866 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:13:03.503469 (Thread-1): 10:13:03 | 9 of 25 START view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG........... [RUN]
2022-03-03 13:13:03.504188 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:13:03.504702 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:13:03.516821 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-03 13:13:03.520796 (Thread-1): finished collecting timing info
2022-03-03 13:13:03.522373 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-03 13:13:03.524965 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:13:03.525082 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT_VARIANT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_VARIANT_DLHK
  ,MD5(PRODUCT_ID) AS K_PRODUCT_DLHK  
  --BUSINESS KEYS  
  ,ID AS K_PRODUCT_VARIANT_BK
  ,PRODUCT_ID AS K_PRODUCT_BK  
  ,INVENTORY_ITEM_ID AS K_INVENTORY_ITEM_BK
  ,IMAGE_ID AS K_IMAGE_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE  
  ,SKU AS A_SKU    
  ,FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,INVENTORY_MANAGEMENT AS A_INVENTORY_MANAGEMENT
  ,INVENTORY_POLICY AS A_INVENTORY_POLICY
  ,BARCODE AS A_BARCODE
  ,GRAMS AS A_GRAMS
  ,WEIGHT_UNIT AS A_WEIGHT_UNIT
  ,OPTION_1 AS A_OPTION_1
  ,OPTION_2 AS A_OPTION_2
  ,OPTION_3 AS A_OPTION_3
  ,TAX_CODE AS A_TAX_CODE  
  ,PRESENTMENT_PRICES AS A_PRESENTMENT_PRICES  
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  --BOOLEAN
  ,REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,TAXABLE AS B_TAXABLE
  --METRICS
  ,PRICE AS M_PRICE
  ,POSITION AS M_POSITION
  ,COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,INVENTORY_QUANTITY AS M_INVENTORY_QUANTITY
  ,INVENTORY_QUANTITY_ADJUSTMENT AS M_INVENTORY_QUANTITY_ADJUSTMENT
  ,WEIGHT AS M_WEIGHT
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:13:03.525192 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:05.785464 (Thread-1): SQL status: SUCCESS 1 in 2.26 seconds
2022-03-03 13:13:05.788077 (Thread-1): finished collecting timing info
2022-03-03 13:13:05.788293 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: Close
2022-03-03 13:13:06.225654 (Thread-1): 10:13:06 | 9 of 25 OK created view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG...... [SUCCESS 1 in 2.72s]
2022-03-03 13:13:06.225860 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:13:06.225993 (Thread-1): Began running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:13:06.226146 (Thread-1): 10:13:06 | 10 of 25 START view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG......... [RUN]
2022-03-03 13:13:06.226348 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:13:06.226459 (Thread-1): Compiling model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:13:06.230215 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-03 13:13:06.231894 (Thread-1): finished collecting timing info
2022-03-03 13:13:06.249642 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-03 13:13:06.252600 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:13:06.252740 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG  as (
    


WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND" AS A
),
refund_line as (
    SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND_LINE_ITEM" AS A
),
rename AS 
(
SELECT
  MD5(RL.ID) AS K_REFUND_LINE_DLHK
  ,MD5(R.ID) AS K_REFUND_DLHK
  ,R.ID AS K_REFUND_BK
  ,RL.ID AS K_REFUND_LINE_BK
  ,R.ORDER_ID AS K_ORDER_BK
  ,R.USER_ID AS K_USER_BK
  ,RL.LOCATION_ID AS K_LOCATION_BK
  ,RL.LINE_ITEM_ID AS K_ORDER_LINE_ITEM_BK
  ,R.NOTE AS A_NOTE
  ,R.RESTOCK AS B_RESTOCK
  ,RL.QUANTITY AS M_QUANTITY
  ,RL.RESTOCK_TYPE AS A_RESTOCK_TYPE
   
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_SUBTOTAL


  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
FROM source R
LEFT JOIN refund_line RL ON RL.REFUND_ID = R.ID
)

SELECT * FROM rename
  );
2022-03-03 13:13:06.252857 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:08.062503 (Thread-1): SQL status: SUCCESS 1 in 1.81 seconds
2022-03-03 13:13:08.069322 (Thread-1): finished collecting timing info
2022-03-03 13:13:08.070088 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: Close
2022-03-03 13:13:08.530375 (Thread-1): 10:13:08 | 10 of 25 OK created view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG.... [SUCCESS 1 in 2.30s]
2022-03-03 13:13:08.533413 (Thread-1): Finished running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:13:08.534225 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:13:08.535469 (Thread-1): 10:13:08 | 11 of 25 START table model DBT_SHOPIFY.W_CUSTOMERS_D................. [RUN]
2022-03-03 13:13:08.537888 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:13:08.538631 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:13:08.565035 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-03 13:13:08.565551 (Thread-1): finished collecting timing info
2022-03-03 13:13:08.580053 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-03 13:13:08.580825 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:13:08.580926 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG AS C
      );
2022-03-03 13:13:08.581024 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:11.703536 (Thread-1): SQL status: SUCCESS 1 in 3.12 seconds
2022-03-03 13:13:11.722341 (Thread-1): finished collecting timing info
2022-03-03 13:13:11.722553 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-03 13:13:12.186763 (Thread-1): 10:13:12 | 11 of 25 OK created table model DBT_SHOPIFY.W_CUSTOMERS_D............ [SUCCESS 1 in 3.65s]
2022-03-03 13:13:12.187372 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:13:12.188084 (Thread-1): Began running node model.snowflake_aicd.W_DATE_D
2022-03-03 13:13:12.188961 (Thread-1): 10:13:12 | 12 of 25 START table model DBT_SHOPIFY.W_DATE_D...................... [RUN]
2022-03-03 13:13:12.190503 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:13:12.191204 (Thread-1): Compiling model.snowflake_aicd.W_DATE_D
2022-03-03 13:13:12.209790 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-03 13:13:12.210484 (Thread-1): finished collecting timing info
2022-03-03 13:13:12.212138 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-03 13:13:12.215139 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:13:12.215255 (Thread-1): On model.snowflake_aicd.W_DATE_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_DATE_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_DATE_D  as
      (

SELECT 
	CAST(DATE_KEY AS NUMBER(9)) AS K_DATE_INTEGER_BK
	,CAST(DATE_COLUMN AS DATE) AS K_DATE_BK
	,CAST(FULL_DATE_DESC AS VARCHAR(64)) AS A_FULL_DATE_DESC
	,CAST(DAY_NUM_IN_WEEK AS NUMBER(1)) AS A_DAY_NUM_IN_WEEK
	,CAST(DAY_NUM_IN_MONTH AS NUMBER(2)) AS A_DAY_NUM_IN_MONTH
	,CAST(DAY_NUM_IN_YEAR AS NUMBER(3)) AS A_DAY_NUM_IN_YEAR
	,CAST(DAY_NAME AS VARCHAR(10)) AS A_DAY_NAME
	,CAST(DAY_ABBREV AS VARCHAR(3)) AS A_DAY_ABBREV
	,CAST(WEEKDAY_IND AS VARCHAR(64)) AS A_WEEKDAY_IND
	,CAST(US_HOLIDAY_IND AS VARCHAR(64)) AS A_US_HOLIDAY_IND
	,CAST(COMPANY_HOLIDAY_IND AS VARCHAR(64)) AS A_COMPANY_HOLIDAY_IND
	,CAST(MONTH_END_IND AS VARCHAR(64)) AS A_MONTH_END_IND
	,CAST(WEEK_BEGIN_DATE_NKEY AS NUMBER(9)) AS A_WEEK_BEGIN_DATE_NKEY
	,CAST(WEEK_BEGIN_DATE AS DATE) AS A_WEEK_BEGIN_DATE
	,CAST(WEEK_END_DATE_NKEY AS NUMBER(9)) AS A_WEEK_END_DATE_NKEY
	,CAST(WEEK_END_DATE AS DATE) AS A_WEEK_END_DATE
	,CAST(WEEK_NUM_IN_YEAR AS NUMBER(9)) AS A_WEEK_NUM_IN_YEAR
	,CAST(MONTH_NAME AS VARCHAR(10)) AS A_MONTH_NAME
	,CAST(MONTH_ABBREV AS VARCHAR(3)) AS A_MONTH_ABBREV
	,CAST(MONTH_NUM_IN_YEAR AS NUMBER(2)) AS A_MONTH_NUM_IN_YEAR
	,CAST(YEARMONTH AS VARCHAR(10)) AS A_YEARMONTH
	,CAST(CURRENT_QUARTER AS NUMBER(1)) AS A_QUARTER
	,CAST(YEARQUARTER AS VARCHAR(10)) AS A_YEARQUARTER
	,CAST(CURRENT_YEAR AS NUMBER(5)) AS A_YEAR
	,CAST(FISCAL_WEEK_NUM AS NUMBER(2)) AS A_FISCAL_WEEK_NUM
	,CAST(FISCAL_MONTH_NUM AS NUMBER(2)) AS A_FISCAL_MONTH_NUM
	,CAST(FISCAL_YEARMONTH AS VARCHAR(10)) AS A_FISCAL_YEARMONTH
	,CAST(FISCAL_QUARTER AS NUMBER(1)) AS A_FISCAL_QUARTER
	,CAST(FISCAL_YEARQUARTER AS VARCHAR(10)) AS A_FISCAL_YEARQUARTER
	,CAST(FISCAL_HALFYEAR AS NUMBER(1)) AS A_FISCAL_HALFYEAR
	,CAST(FISCAL_YEAR AS NUMBER(5)) AS A_FISCAL_YEAR
	,CAST(SQL_TIMESTAMP AS TIMESTAMP_NTZ) AS A_SQL_TIMESTAMP_DTS
	,CAST(CURRENT_ROW_IND AS CHAR(1)) AS A_CURRENT_ROW_IND
	,CAST(EFFECTIVE_DATE AS DATE) AS A_EFFECTIVE_DATE
	,CAST(EXPIRA_DATE AS DATE) AS A_EXPIRATION_DATE
FROM
DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG
      );
2022-03-03 13:13:12.215356 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:16.552651 (Thread-1): SQL status: SUCCESS 1 in 4.34 seconds
2022-03-03 13:13:16.559745 (Thread-1): finished collecting timing info
2022-03-03 13:13:16.560259 (Thread-1): On model.snowflake_aicd.W_DATE_D: Close
2022-03-03 13:13:17.023154 (Thread-1): 10:13:17 | 12 of 25 OK created table model DBT_SHOPIFY.W_DATE_D................. [SUCCESS 1 in 4.83s]
2022-03-03 13:13:17.024034 (Thread-1): Finished running node model.snowflake_aicd.W_DATE_D
2022-03-03 13:13:17.024779 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:13:17.025861 (Thread-1): 10:13:17 | 13 of 25 START table model DBT_SHOPIFY.W_LOCATION_D.................. [RUN]
2022-03-03 13:13:17.027675 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:13:17.028579 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:13:17.039810 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-03 13:13:17.040374 (Thread-1): finished collecting timing info
2022-03-03 13:13:17.042119 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-03 13:13:17.042888 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:13:17.043030 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-03 13:13:17.043137 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:19.814612 (Thread-1): SQL status: SUCCESS 1 in 2.77 seconds
2022-03-03 13:13:19.818876 (Thread-1): finished collecting timing info
2022-03-03 13:13:19.819635 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-03 13:13:20.302769 (Thread-1): 10:13:20 | 13 of 25 OK created table model DBT_SHOPIFY.W_LOCATION_D............. [SUCCESS 1 in 3.28s]
2022-03-03 13:13:20.303521 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:13:20.304138 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:13:20.305175 (Thread-1): 10:13:20 | 14 of 25 START view model DBT_SHOPIFY.V_PRODUCTS_D_STG............... [RUN]
2022-03-03 13:13:20.306556 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:13:20.307267 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:13:20.319894 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-03 13:13:20.321010 (Thread-1): finished collecting timing info
2022-03-03 13:13:20.324192 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-03 13:13:20.327892 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:13:20.327998 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCTS_D_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG  as (
    
 

WITH product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG
),
product_variant AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG
),

rename as (


SELECT
    CONCAT(P.K_PRODUCT_BK,'-',COALESCE(V.K_PRODUCT_VARIANT_BK,'0000000000')) AS K_PRODUCT_VARIATION_DLHK
    ,P.K_PRODUCT_DLHK
    ,V.K_PRODUCT_VARIANT_DLHK AS K_PRODUCT_VARIANT_DLHK
    ,V.K_PRODUCT_VARIANT_BK AS K_PRODUCT_VARIANT_BK
    ,P.K_PRODUCT_BK AS K_PRODUCT_BK
    ,V.K_INVENTORY_ITEM_BK AS K_VARIANT_INVENTORY_ITEM_BK
    ,V.K_IMAGE_BK AS K_VARIANT_IMAGE_BK
    --ATTRIBUTES
    ,P.A_TITLE
    ,P.A_HANDLE
    ,P.A_PRODUCT_TYPE
    ,P.A_VENDOR
    ,P.A_CREATED_AT_DTS
    ,P.A_UPDATED_AT_DTS
    ,P.A_PUBLISHED_AT_DTS
    ,P.A_PUBLISHED_SCOPE
    ,P.A_STATUS
    ,P.A_TEMPLATE_SUFFIX       
    ,V.A_TITLE AS A_VARIANT_TITLE
    ,V.A_SKU AS A_VARIANT_SKU
    ,V.A_FULFILLMENT_SERVICE AS A_VARIANT_FULFILLMENT_SERVICE
    ,V.A_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
    ,V.A_BARCODE AS A_VARIANT_BARCODE
    ,V.A_INVENTORY_POLICY AS A_VARIANT_INVENTORY_POLICY
    ,V.A_GRAMS AS A_VARIANT_GRAMS
    ,V.A_WEIGHT_UNIT AS A_VARIANT_WEIGHT_UNIT
    ,V.A_OPTION_1 AS A_VARIANT_OPTION_1
    ,V.A_OPTION_2 AS A_VARIANT_OPTION_2
    ,V.A_OPTION_3 AS A_VARIANT_OPTION_3
    ,V.A_TAX_CODE AS A_VARIANT_TAX_CODE
    ,V.A_PRESENTMENT_PRICES AS A_VARIANT_PRESENTMENT_PRICES
    ,V.A_CREATED_AT_DTS AS A_VARIANT_CREATED_AT_DTS
    ,V.A_UPDATED_AT_DTS AS A_VARIANT_UPDATED_AT_DTS
    --BOOLEAN
    ,V.B_REQUIRES_SHIPPING AS B_VARIANT_REQUIRES_SHIPPING
    ,V.B_TAXABLE AS B_VARIANT_TAXABLE
    --METRICS
    ,V.M_PRICE AS M_VARIANT_PRICE
    ,V.M_POSITION AS M_VARIANT_POSITION
    ,V.M_COMPARE_AT_PRICE AS M_VARIANT_COMPARE_AT_PRICE
    ,V.M_INVENTORY_QUANTITY AS M_VARIANT_INVENTORY_QUANTITY
    ,V.M_INVENTORY_QUANTITY_ADJUSTMENT AS M_VARIANT_INVENTORY_QUANTITY_ADJUSTMENT
    ,V.M_WEIGHT AS M_VARIANT_WEIGHT
    --metadata (MD)
    ,P.MD_IS_DELETED AS MD_IS_DELETED_PRODUCT
    ,V.MD_IS_DELETED AS MD_IS_DELETED_VARIANT
    , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
    , '18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
FROM
    product P
    LEFT JOIN product_variant V ON V.K_PRODUCT_BK = P.K_PRODUCT_BK
)

SELECT * FROM rename
  );
2022-03-03 13:13:20.328103 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:22.394043 (Thread-1): SQL status: SUCCESS 1 in 2.07 seconds
2022-03-03 13:13:22.399889 (Thread-1): finished collecting timing info
2022-03-03 13:13:22.400694 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: Close
2022-03-03 13:13:22.847135 (Thread-1): 10:13:22 | 14 of 25 OK created view model DBT_SHOPIFY.V_PRODUCTS_D_STG.......... [SUCCESS 1 in 2.54s]
2022-03-03 13:13:22.847788 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:13:22.852264 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:13:22.853011 (Thread-1): 10:13:22 | 15 of 25 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG....... [RUN]
2022-03-03 13:13:22.859089 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:13:22.859598 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:13:22.867033 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-03 13:13:22.867473 (Thread-1): finished collecting timing info
2022-03-03 13:13:22.868877 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-03 13:13:22.874104 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:13:22.874250 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT"
),
customer AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 

  MD5(S.ID) AS K_ABANDONED_CHECKOUT_DLHK
  ,C.K_CUSTOMER_DLHK
  ,L.K_LOCATION_DLHK
  ,MD5(S.USER_ID) AS K_USER_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK  
  ,S.ID AS K_ABANDONED_CHECKOUT_BK
  ,S.CUSTOMER_ID AS K_CUSTOMER_BK
  ,S.DEVICE_ID AS K_DEVICE_BK
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.SOURCE_IDENTIFIER AS K_SOURCE_BKENTIFIER
  ,S.USER_ID AS K_USER_BK
  ,S.ABANDONED_CHECKOUT_URL AS A_ABANDONED_CHECKOUT_URL  
  ,S.CART_TOKEN AS A_CART_TOKEN
  ,S.CLOSED_AT AS A_CLOSED_AT
  ,S.COMPLETED_AT AS A_COMPLETED_AT
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
  ,S.EMAIL AS A_EMAIL
  ,S.GATEWAY AS A_GATEWAY
  ,S.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
  ,S.NAME AS A_NAME
  ,S.NOTE AS A_NOTE
  ,S.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES
  ,S.PHONE AS A_PHONE
  ,S.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
  ,S.REFERRING_SITE AS A_REFERRING_SITE    
  ,S.SOURCE AS A_SOURCE
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.SOURCE_URL AS A_SOURCE_URL
  ,S.TOKEN AS A_TOKEN
  ,S.UPDATED_AT AS A_UPDATED_AT  
  --BOOLEAN
  ,S.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
  ,S.TAXES_INCLUDED AS B_TAXES_INCLUDED
  --METRIC
  ,S.SUBTOTAL_PRICE::decimal(15,2) AS M_SUBTOTAL_PRICE
  ,S.TOTAL_DISCOUNTS::decimal(15,2) AS M_TOTAL_DISCOUNTS
  ,S.TOTAL_DUTIES::decimal(15,2) AS M_TOTAL_DUTIES
  ,S.TOTAL_LINE_ITEMS_PRICE::decimal(15,2) AS M_TOTAL_LINE_ITEMS_PRICE
  ,S.TOTAL_PRICE::decimal(15,2) AS M_TOTAL_PRICE
  ,S.TOTAL_TAX::decimal(15,2) AS M_TOTAL_TAX
  ,S.TOTAL_WEIGHT::decimal(15,2) AS M_TOTAL_WEIGHT
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
  FROM
      source S
      left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
      left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-03 13:13:22.874363 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:24.597923 (Thread-1): SQL status: SUCCESS 1 in 1.72 seconds
2022-03-03 13:13:24.599539 (Thread-1): finished collecting timing info
2022-03-03 13:13:24.599710 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: Close
2022-03-03 13:13:25.047160 (Thread-1): 10:13:25 | 15 of 25 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.. [SUCCESS 1 in 2.19s]
2022-03-03 13:13:25.054536 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:13:25.055273 (Thread-1): Began running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:13:25.056037 (Thread-1): 10:13:25 | 16 of 25 START view model DBT_SHOPIFY.V_TRANSACTIONS_STG............. [RUN]
2022-03-03 13:13:25.057425 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:13:25.060170 (Thread-1): Compiling model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:13:25.065665 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-03 13:13:25.066172 (Thread-1): finished collecting timing info
2022-03-03 13:13:25.067645 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-03 13:13:25.069610 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:13:25.069712 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_TRANSACTIONS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."TRANSACTION"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_TRANSACTION_DLHK
  ,L.K_LOCATION_DLHK  
  ,MD5(S.USER_ID) AS K_USER_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_TRANSACTION_BK
  ,S.DEVICE_ID AS K_DEVICE_BK  
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.ORDER_ID AS K_ORDER_BK
  ,S.PARENT_ID AS K_PARENT_BK
  ,S.REFUND_ID AS K_REFUND_BK
  ,S.USER_ID AS K_USER_BK  
  --ATTRIBUTES
  ,S.AUTHORIZATION AS A_AUTHORIZATION
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CURRENCY_EXCHANGE_ADJUSTMENT AS A_CURRENCY_EXCHANGE_ADJUSTMENT
  ,S.ERROR_CODE AS A_ERROR_CODE
  ,S.GATEWAY AS A_GATEWAY
  ,S.KIND AS A_KIND
  ,S.MESSAGE AS A_MESSAGE
  ,S.PAYMENT_DETAILS AS A_PAYMENT_DETAILS
  ,S.PROCESSED_AT AS A_PROCESSED_AT
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.STATUS AS A_STATUS
  --boolean
  ,S.TEST AS B_TEST
  --METRICS
  ,S.AMOUNT::decimal(15,2) AS M_AMOUNT   
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
  FROM
    source S  
  left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-03 13:13:25.069808 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:27.018470 (Thread-1): SQL status: SUCCESS 1 in 1.95 seconds
2022-03-03 13:13:27.024038 (Thread-1): finished collecting timing info
2022-03-03 13:13:27.024811 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: Close
2022-03-03 13:13:27.478265 (Thread-1): 10:13:27 | 16 of 25 OK created view model DBT_SHOPIFY.V_TRANSACTIONS_STG........ [SUCCESS 1 in 2.42s]
2022-03-03 13:13:27.478810 (Thread-1): Finished running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:13:27.479338 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:13:27.480109 (Thread-1): 10:13:27 | 17 of 25 START table model DBT_SHOPIFY.W_PRODUCTS_D.................. [RUN]
2022-03-03 13:13:27.481265 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:13:27.486885 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:13:27.490050 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-03 13:13:27.490568 (Thread-1): finished collecting timing info
2022-03-03 13:13:27.492423 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-03 13:13:27.493327 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:13:27.493456 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCTS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG AS C
      );
2022-03-03 13:13:27.493560 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:30.418184 (Thread-1): SQL status: SUCCESS 1 in 2.92 seconds
2022-03-03 13:13:30.424219 (Thread-1): finished collecting timing info
2022-03-03 13:13:30.424828 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: Close
2022-03-03 13:13:30.876277 (Thread-1): 10:13:30 | 17 of 25 OK created table model DBT_SHOPIFY.W_PRODUCTS_D............. [SUCCESS 1 in 3.40s]
2022-03-03 13:13:30.876780 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:13:30.877234 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:13:30.877849 (Thread-1): 10:13:30 | 18 of 25 START table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F........ [RUN]
2022-03-03 13:13:30.878568 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:13:30.879046 (Thread-1): Compiling model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:13:30.890261 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-03 13:13:30.891670 (Thread-1): finished collecting timing info
2022-03-03 13:13:30.894523 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-03 13:13:30.895605 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:13:30.895745 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG AS C
      );
2022-03-03 13:13:30.895859 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:33.948360 (Thread-1): SQL status: SUCCESS 1 in 3.05 seconds
2022-03-03 13:13:33.951213 (Thread-1): finished collecting timing info
2022-03-03 13:13:33.951747 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: Close
2022-03-03 13:13:34.421563 (Thread-1): 10:13:34 | 18 of 25 OK created table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F... [SUCCESS 1 in 3.54s]
2022-03-03 13:13:34.422072 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:13:34.422566 (Thread-1): Began running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:13:34.423414 (Thread-1): 10:13:34 | 19 of 25 START table model DBT_SHOPIFY.W_TRANSACTIONS_F.............. [RUN]
2022-03-03 13:13:34.424277 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:13:34.427289 (Thread-1): Compiling model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:13:34.435738 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-03 13:13:34.438104 (Thread-1): finished collecting timing info
2022-03-03 13:13:34.439604 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-03 13:13:34.440299 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:13:34.440403 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_TRANSACTIONS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_TRANSACTIONS_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG AS C
      );
2022-03-03 13:13:34.440502 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:37.256795 (Thread-1): SQL status: SUCCESS 1 in 2.82 seconds
2022-03-03 13:13:37.270580 (Thread-1): finished collecting timing info
2022-03-03 13:13:37.271549 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: Close
2022-03-03 13:13:37.726312 (Thread-1): 10:13:37 | 19 of 25 OK created table model DBT_SHOPIFY.W_TRANSACTIONS_F......... [SUCCESS 1 in 3.30s]
2022-03-03 13:13:37.726949 (Thread-1): Finished running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:13:37.727538 (Thread-1): Began running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:13:37.728313 (Thread-1): 10:13:37 | 20 of 25 START view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG........... [RUN]
2022-03-03 13:13:37.729211 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:13:37.729806 (Thread-1): Compiling model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:13:37.738108 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-03 13:13:37.738567 (Thread-1): finished collecting timing info
2022-03-03 13:13:37.740181 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-03 13:13:37.742184 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:13:37.742283 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_INVENTORY_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_ITEM"
),
inventory_level AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_LEVEL"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
products AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename AS 
(   
  SELECT   
  MD5(S.ID) AS K_INVENTORY_ITEM_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
  ,L.K_LOCATION_DLHK
  ,L.K_LOCATION_BK  
  ,S.ID AS K_INVENTORY_ITEM_BK
  ,S.COUNTRY_CODE_OF_ORIGIN AS A_COUNTRY_CODE_OF_ORIGIN
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.PROVINCE_CODE_OF_ORIGIN AS A_PROVINCE_CODE_OF_ORIGIN
  ,S.SKU AS A_SKU
  ,S.UPDATED_AT AS A_UPDATED_AT
  ,S.HARMONIZED_SYSTEM_CODE AS A_HARMONIZED_SYSTEM_CODE  
  --BOOLEAN
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TRACKED AS B_TRACKED
  --METRICS
  ,S.COST::decimal(15,2) AS M_COST 
  ,IL.AVAILABLE AS M_AVAIABLE  
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
  FROM
      source S
      left join inventory_level IL ON IL.INVENTORY_ITEM_ID = S.ID      
      left join locations L ON L.K_LOCATION_BK = IL.LOCATION_ID
      left join products P ON P.K_VARIANT_INVENTORY_ITEM_BK = S.ID 
)


SELECT * FROM rename
  );
2022-03-03 13:13:37.742387 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:40.314592 (Thread-1): SQL status: SUCCESS 1 in 2.57 seconds
2022-03-03 13:13:40.319928 (Thread-1): finished collecting timing info
2022-03-03 13:13:40.320486 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: Close
2022-03-03 13:13:40.852417 (Thread-1): 10:13:40 | 20 of 25 OK created view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG...... [SUCCESS 1 in 3.12s]
2022-03-03 13:13:40.852998 (Thread-1): Finished running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:13:40.853610 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:13:40.854375 (Thread-1): 10:13:40 | 21 of 25 START view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG......... [RUN]
2022-03-03 13:13:40.855450 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:13:40.856013 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:13:40.869739 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-03 13:13:40.871799 (Thread-1): finished collecting timing info
2022-03-03 13:13:40.873621 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-03 13:13:40.879194 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:13:40.879400 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM" AS A
),
products AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D AS A
),
taxes AS (
  SELECT 
      K_ORDER_LINE_ITEM_BK,
      AVG(M_RATE) AS M_RATE,
      SUM(M_TAX) AS M_TAX,
      SUM(M_TAX_PRIMARY) AS M_TAX_PRIMARY
    FROM 
      DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG AS A
    GROUP BY K_ORDER_LINE_ITEM_BK
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_LINE_ITEM_DLHK  
  ,MD5(ORDER_ID) AS K_ORDER_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
 --business keys
  ,O.PRODUCT_ID AS K_PRODUCT_BK
  ,O.VARIANT_ID AS K_VARIANT_BK
  
  ,O.ORDER_ID AS K_ORDER_BK
  ,O.ID AS K_ORDER_LINE_ITEM_BK
  --attribubtes
  ,O.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
  ,O.NAME AS A_NAME  
  ,O.PROPERTIES AS A_PROPERTIES
  ,O.SKU AS A_SKU
  ,O.TITLE AS A_TITLE  
  ,O.VARIANT_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
  ,O.VARIANT_TITLE AS A_VARIANT_TITLE
  ,O.VENDOR AS A_VENDOR
  --boolean
  ,O.GIFT_CARD AS B_GIFT_CARD
  ,O.PRODUCT_EXISTS AS B_PRODUCT_EXISTS
  ,O.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,O.TAXABLE AS B_TAXABLE
  --metrics
  ,O.FULFILLABLE_QUANTITY AS M_FULFILLABLE_QUANTITY
  ,O.GRAMS::DECIMAL(15,2) AS M_GRAMS
  ,O.QUANTITY::DECIMAL(15,2) AS M_QUANTITY
  ,M_RATE AS M_TAX_RATE
  ,T.M_TAX_PRIMARY::DECIMAL(15,2) AS M_TAX_AMOUNT
  ,T.M_TAX::DECIMAL(15,2) AS M_TAX_AMOUNT_PRIMARY

  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.PRICE_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE_PRIMARY 
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount')),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(to_numeric(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount')),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT_PRIMARY 
  ,(O.QUANTITY * M_UNIT_PRICE)::DECIMAL(15,2) AS M_TOTAL_PRICE  
  ,(O.QUANTITY * M_UNIT_PRICE_PRIMARY)::DECIMAL(15,2) AS M_TOTAL_PRICE_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
FROM source O
  left join products P ON P.K_PRODUCT_BK = O.PRODUCT_ID AND CASE WHEN O.VARIANT_ID IS NOT NULL THEN O.VARIANT_ID = P.K_PRODUCT_VARIANT_BK ELSE 1=1 END
  left join taxes T ON T.K_ORDER_LINE_ITEM_BK = O.ID
)

SELECT * FROM rename
  );
2022-03-03 13:13:40.879526 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:42.935565 (Thread-1): SQL status: SUCCESS 1 in 2.06 seconds
2022-03-03 13:13:42.942197 (Thread-1): finished collecting timing info
2022-03-03 13:13:42.942993 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: Close
2022-03-03 13:13:43.390647 (Thread-1): 10:13:43 | 21 of 25 OK created view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG.... [SUCCESS 1 in 2.53s]
2022-03-03 13:13:43.391623 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:13:43.392437 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:13:43.393617 (Thread-1): 10:13:43 | 22 of 25 START view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG....... [RUN]
2022-03-03 13:13:43.394666 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:13:43.396506 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:13:43.406402 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-03 13:13:43.407845 (Thread-1): finished collecting timing info
2022-03-03 13:13:43.409342 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-03 13:13:43.411180 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:13:43.411277 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECT"
),
source_collection AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECTION"
),
product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename as (

SELECT
  MD5(S.ID) AS K_PRODUCT_COLLECT_DLHK
  ,MD5(CC.ID) AS K_COLLECTION_DLHK
  ,P.K_PRODUCT_DLHK  
  ,S.ID AS K_PRODUCT_COLLECT_BK
  ,CC.ID AS K_COLLECTION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,S.POSITION AS A_POSITION
  ,S.SORT_ORDER AS A_SORT_ORDER  
  ,S.CREATED_AT AS A_CREATED_AT_DTS
  ,S.UPDATED_AT AS A_UPDATED_AT_DTS
  ,CC.PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,CC.BODY_HTML AS A_BODY_HTML
  ,CC.TITLE AS A_TITLE
  ,CC.HANDLE AS A_HANDLE
  ,CC.PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE  
  ,CC.COLLECTION_TYPE AS A_COLLECTION_TYPE  
  --metrics
  ,CC.PRODUCTS_COUNT AS M_PRODUCTS_COUNT
  --metadata (MD)
  ,S.__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
FROM
    source S
    LEFT JOIN source_collection CC ON CC.ID = S.COLLECTION_ID
    LEFT JOIN product P ON P.K_PRODUCT_BK = S.PRODUCT_ID
)

SELECT * FROM rename
  );
2022-03-03 13:13:43.411379 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:45.396266 (Thread-1): SQL status: SUCCESS 1 in 1.98 seconds
2022-03-03 13:13:45.401535 (Thread-1): finished collecting timing info
2022-03-03 13:13:45.402238 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: Close
2022-03-03 13:13:45.892493 (Thread-1): 10:13:45 | 22 of 25 OK created view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG.. [SUCCESS 1 in 2.50s]
2022-03-03 13:13:45.893169 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:13:45.893748 (Thread-1): Began running node model.snowflake_aicd.W_INVENTORY_F
2022-03-03 13:13:45.894556 (Thread-1): 10:13:45 | 23 of 25 START table model DBT_SHOPIFY.W_INVENTORY_F................. [RUN]
2022-03-03 13:13:45.895612 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:13:45.896089 (Thread-1): Compiling model.snowflake_aicd.W_INVENTORY_F
2022-03-03 13:13:45.905838 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-03 13:13:45.906595 (Thread-1): finished collecting timing info
2022-03-03 13:13:45.908234 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-03 13:13:45.908833 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:13:45.908933 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_INVENTORY_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_INVENTORY_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG AS C
      );
2022-03-03 13:13:45.909033 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:48.973670 (Thread-1): SQL status: SUCCESS 1 in 3.06 seconds
2022-03-03 13:13:48.979123 (Thread-1): finished collecting timing info
2022-03-03 13:13:48.979882 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: Close
2022-03-03 13:13:49.421465 (Thread-1): 10:13:49 | 23 of 25 OK created table model DBT_SHOPIFY.W_INVENTORY_F............ [SUCCESS 1 in 3.53s]
2022-03-03 13:13:49.422194 (Thread-1): Finished running node model.snowflake_aicd.W_INVENTORY_F
2022-03-03 13:13:49.422966 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:13:49.423796 (Thread-1): 10:13:49 | 24 of 25 START table model DBT_SHOPIFY.W_ORDERS_F.................... [RUN]
2022-03-03 13:13:49.425020 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:13:49.432949 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:13:49.488460 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-03 13:13:49.489882 (Thread-1): finished collecting timing info
2022-03-03 13:13:49.491503 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-03 13:13:49.496995 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:13:49.497138 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ORDERS_F  as
      (

SELECT
  O.K_ORDER_DLHK AS K_ORDER_DLHK
  ,OLI.K_ORDER_LINE_ITEM_DLHK AS K_ORDER_LINE_ITEM_DLHK
  ,O.K_CUSTOMER_DLHK AS K_CUSTOMER_DLHK
  ,O.K_LOCATION_DLHK AS K_LOCATION_DLHK
  ,O.K_BILLING_ADDRESS_DLHK AS K_BILLING_ADDRESS_DLHK
  ,O.K_SHIPPING_ADDRESS_DLHK AS K_SHIPPING_ADDRESS_DLHK
  ,OLI.K_PRODUCT_VARIATION_DLHK AS K_ITEM_PRODUCT_VARIATION_DLHK
  ,OLI.K_PRODUCT_BK AS K_ITEM_PRODUCT_BK
  ,OLI.K_VARIANT_BK AS K_ITEM_VARIANT_BK
  ,OLI.K_ORDER_BK AS K_ITEM_ORDER_BK
  ,O.K_ORDER_BK AS K_ORDER_BK
  ,OLI.K_ORDER_LINE_ITEM_BK AS K_ITEM_ORDER_LINE_ITEM_BK
  ,O.K_APP_BK AS K_HEADER_APP_BK
  
  ,O.K_CUSTOMER_BK AS K_CUSTOMER_BK
  ,O.K_DEVICE_BK AS K_DEVICE_BK
  ,O.K_LOCATION_BK AS K_LOCATION_BK
  ,O.K_SOURCE_ENTIFIER_BK AS K_SOURCE_ENTIFIER_BK
  ,O.A_BROWSER_IP AS A_HEADER_BROWSER_IP
  ,O.A_CANCELLED_AT_DTS AS A_HEADER_CANCELLED_AT_DTS
  ,O.A_CANCEL_REASON AS A_HEADER_CANCEL_REASON
  ,O.A_CART_TOKEN AS A_HEADER_CART_TOKEN
  ,O.A_CHECKOUT_TOKEN AS A_HEADER_CHECKOUT_TOKEN
  ,O.A_CLIENT_DETAILS AS A_HEADER_CLIENT_DETAILS
  ,O.A_CLOSED_AT_DTS AS A_HEADER_CLOSED_AT_DTS
  ,O.A_CREATED_AT_DTS AS A_HEADER_CREATED_AT_DTS
  ,O.A_CURRENCY AS A_HEADER_CURRENCY
  ,O.A_PRESENTMENT_CURRENCY AS A_HEADER_PRESENTMENT_CURRENCY
  ,O.A_CUSTOMER_LOCALE AS A_HEADER_CUSTOMER_LOCALE
  ,O.A_EMAIL AS A_HEADER_EMAIL
  ,O.A_FINANCIAL_STATUS AS A_HEADER_FINANCIAL_STATUS
  ,O.A_FULFILLMENT_STATUS AS A_HEADER_FULFILLMENT_STATUS
  ,O.A_LANDING_SITE_BASE_URL AS A_HEADER_LANDING_SITE_BASE_URL
  ,O.A_LANDING_SITE_REF AS A_HEADER_LANDING_SITE_REF
  ,O.A_NAME AS A_HEADER_NAME
  ,O.A_NOTE AS A_HEADER_NOTE
  ,O.A_NOTE_ATTRIBUTES AS A_HEADER_NOTE_ATTRIBUTES
  ,O.A_PAYMENT_GATEWAY_NAMES AS A_HEADER_PAYMENT_GATEWAY_NAMES
  ,O.A_PROCESSED_AT_DTS AS A_HEADER_PROCESSED_AT_DTS
  ,O.A_PROCESSING_METHOD AS A_HEADER_PROCESSING_METHOD
  ,O.A_REFERENCE AS A_HEADER_REFERENCE
  ,O.A_REFERRING_SITE AS A_HEADER_REFERRING_SITE
  ,O.A_SOURCE_NAME AS A_HEADER_SOURCE_NAME
  ,O.A_SOURCE_URL AS A_HEADER_SOURCE_URL
  ,O.A_ORDER_NUMBER AS A_HEADER_ORDER_NUMBER
  ,O.A_POSION_NUMBER AS A_HEADER_POSION_NUMBER
  ,O.A_UPDATED_AT_DTS AS A_HEADER_UPDATED_AT_DTS
  ,O.B_BUYER_ACCEPTS_MARKETING AS B_HEADER_BUYER_ACCEPTS_MARKETING
  ,O.B_CONFIRMED AS B_HEADER_CONFIRMED
  ,O.B_TAXES_INCLUDED  AS B_HEADER_TAXES_INCLUDED   
  ,OLI.A_FULFILLMENT_SERVICE AS A_ITEM_FULFILLMENT_SERVICE
  ,OLI.A_FULFILLMENT_STATUS AS A_ITEM_FULFILLMENT_STATUS
  ,OLI.A_NAME AS A_ITEM_NAME
  ,OLI.A_PROPERTIES AS A_ITEM_PROPERTIES
  ,OLI.A_SKU AS A_ITEM_SKU
  ,OLI.A_TITLE AS A_ITEM_TITLE  
  ,OLI.A_VARIANT_INVENTORY_MANAGEMENT AS A_ITEM_VARIANT_INVENTORY_MANAGEMENT
  ,OLI.A_VARIANT_TITLE AS A_ITEM_VARIANT_TITLE
  ,OLI.A_VENDOR AS A_ITEM_VENDOR
  ,OLI.B_GIFT_CARD AS B_ITEM_GIFT_CARD
  ,OLI.B_PRODUCT_EXISTS AS B_ITEM_PRODUCT_EXISTS
  ,OLI.B_REQUIRES_SHIPPING AS B_ITEM_REQUIRES_SHIPPING
  ,OLI.B_TAXABLE AS B_ITEM_TAXABLE
  ,OLI.M_FULFILLABLE_QUANTITY AS M_ITEM_FULFILLABLE_QUANTITY
  ,OLI.M_GRAMS AS M_ITEM_GRAMS
  ,OLI.M_QUANTITY AS M_ITEM_QUANTITY
  ,OLI.M_UNIT_PRICE AS M_ITEM_UNIT_PRICE
  ,OLI.M_UNIT_PRICE_PRIMARY AS M_ITEM_UNIT_PRICE_PRIMARY
  ,OLI.M_TOTAL_PRICE AS M_ITEM_TOTAL_PRICE
  ,OLI.M_TOTAL_PRICE_PRIMARY AS M_ITEM_TOTAL_PRICE_PRIMARY
  ,OLI.M_TOTAL_DISCOUNT AS M_ITEM_TOTAL_DISCOUNT
  ,OLI.M_TOTAL_DISCOUNT_PRIMARY AS M_ITEM_TOTAL_DISCOUNT_PRIMARY
  ,OLI.M_TAX_AMOUNT AS M_TAX_AMOUNT
  ,OLI.M_TAX_AMOUNT_PRIMARY AS M_TAX_AMOUNT_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_TIP_RECEIVED * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_TIP_AMOUNT_PRIMARY  
  --,ROUND(DIV0((O.M_TOTAL_DISCOUNTS_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_HEADER_DISCOUNT
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE * OLI.M_TOTAL_PRICE),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE



   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'18e4a879-da73-4189-9a13-f7ad09c8b181' AS MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG OLI ON OLI.K_ORDER_DLHK = O.K_ORDER_DLHK
      );
2022-03-03 13:13:49.497253 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:52.315643 (Thread-1): SQL status: SUCCESS 1 in 2.82 seconds
2022-03-03 13:13:52.319588 (Thread-1): finished collecting timing info
2022-03-03 13:13:52.320001 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-03 13:13:52.779993 (Thread-1): 10:13:52 | 24 of 25 OK created table model DBT_SHOPIFY.W_ORDERS_F............... [SUCCESS 1 in 3.36s]
2022-03-03 13:13:52.780223 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:13:52.780380 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:13:52.780532 (Thread-1): 10:13:52 | 25 of 25 START table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F........ [RUN]
2022-03-03 13:13:52.780727 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:13:52.780827 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:13:52.783063 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-03 13:13:52.783569 (Thread-1): finished collecting timing info
2022-03-03 13:13:52.784866 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-03 13:13:52.785465 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:13:52.785558 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCT_COLLECTION_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG AS C
      );
2022-03-03 13:13:52.785651 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:13:55.415268 (Thread-1): SQL status: SUCCESS 1 in 2.63 seconds
2022-03-03 13:13:55.430163 (Thread-1): finished collecting timing info
2022-03-03 13:13:55.430932 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: Close
2022-03-03 13:13:55.894498 (Thread-1): 10:13:55 | 25 of 25 OK created table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F... [SUCCESS 1 in 3.11s]
2022-03-03 13:13:55.895019 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:13:55.898389 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 13:13:55.899812 (MainThread): 10:13:55 | 
2022-03-03 13:13:55.900323 (MainThread): 10:13:55 | Finished running 16 view models, 9 table models in 75.65s.
2022-03-03 13:13:55.900671 (MainThread): Connection 'master' was properly closed.
2022-03-03 13:13:55.909556 (MainThread): Connection 'model.snowflake_aicd.W_PRODUCT_COLLECTION_F' was properly closed.
2022-03-03 13:13:55.917601 (MainThread): 
2022-03-03 13:13:55.917797 (MainThread): Completed successfully
2022-03-03 13:13:55.917943 (MainThread): 
Done. PASS=25 WARN=0 ERROR=0 SKIP=0 TOTAL=25
2022-03-03 13:13:55.918113 (MainThread): Flushing usage events
2022-03-03 13:27:37.875098 (MainThread): Running with dbt=0.21.1
2022-03-03 13:27:38.534529 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-03 13:27:38.536307 (MainThread): Tracking: do not track
2022-03-03 13:27:38.546944 (MainThread): Partial parsing not enabled
2022-03-03 13:27:38.572137 (MainThread): Parsing macros/common.sql
2022-03-03 13:27:38.575116 (MainThread): Parsing macros/catalog.sql
2022-03-03 13:27:38.577122 (MainThread): Parsing macros/adapters.sql
2022-03-03 13:27:38.609410 (MainThread): Parsing macros/materializations/merge.sql
2022-03-03 13:27:38.612824 (MainThread): Parsing macros/materializations/seed.sql
2022-03-03 13:27:38.616586 (MainThread): Parsing macros/materializations/view.sql
2022-03-03 13:27:38.617641 (MainThread): Parsing macros/materializations/table.sql
2022-03-03 13:27:38.620088 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-03 13:27:38.627443 (MainThread): Parsing macros/core.sql
2022-03-03 13:27:38.630815 (MainThread): Parsing macros/materializations/test.sql
2022-03-03 13:27:38.637106 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-03 13:27:38.645421 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-03 13:27:38.656063 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-03 13:27:38.672176 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-03 13:27:38.703057 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-03 13:27:38.724442 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-03 13:27:38.725918 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-03 13:27:38.734780 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-03 13:27:38.755040 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-03 13:27:38.767018 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-03 13:27:38.773977 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-03 13:27:38.780538 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-03 13:27:38.783788 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-03 13:27:38.784934 (MainThread): Parsing macros/etc/query.sql
2022-03-03 13:27:38.785642 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-03 13:27:38.786796 (MainThread): Parsing macros/etc/datetime.sql
2022-03-03 13:27:38.793742 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-03 13:27:38.795134 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-03 13:27:38.797013 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-03 13:27:38.798181 (MainThread): Parsing macros/adapters/common.sql
2022-03-03 13:27:38.845332 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-03 13:27:38.846727 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-03 13:27:38.847602 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-03 13:27:38.848575 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-03 13:27:39.004589 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:27:39.012614 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.015646 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:27:39.018223 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.019000 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:27:39.022008 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.022827 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:27:39.027237 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.027957 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:27:39.031037 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.034647 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:27:39.038048 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.038833 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:27:39.041673 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.042459 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:27:39.045556 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.046375 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:27:39.048964 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.049715 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:27:39.053762 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.054536 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:27:39.057741 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.058524 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:27:39.063531 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.064322 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:27:39.069686 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.070643 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:27:39.073432 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.074137 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:27:39.077229 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.077973 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:27:39.081922 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.082833 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:27:39.086180 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.087407 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:27:39.090781 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.091687 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:27:39.130913 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.131839 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:27:39.134709 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.135497 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:27:39.137801 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.138506 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:27:39.140839 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.141747 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:27:39.144088 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.144884 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:27:39.147139 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.147839 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:27:39.149985 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.171743 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.173245 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.174526 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.175782 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.177205 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.178683 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.180003 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.181546 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:27:39.218841 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-03 13:27:39.219425 (MainThread): Found 25 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 23 sources, 0 exposures
2022-03-03 13:27:39.221574 (MainThread): 
2022-03-03 13:27:39.221864 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 13:27:39.223447 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 13:27:39.233529 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 13:27:39.233686 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-03 13:27:39.233785 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-03 13:27:41.227249 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 1.99 seconds
2022-03-03 13:27:41.234605 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-03 13:27:41.688054 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 13:27:41.705587 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 13:27:41.705989 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-03 13:27:41.706256 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-03 13:27:43.614554 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 26 in 1.91 seconds
2022-03-03 13:27:43.619863 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-03 13:27:44.089556 (MainThread): 10:27:44 | Concurrency: 1 threads (target='dev')
2022-03-03 13:27:44.090672 (MainThread): 10:27:44 | 
2022-03-03 13:27:44.106746 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:27:44.107117 (Thread-1): 10:27:44 | 1 of 25 START view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG.......... [RUN]
2022-03-03 13:27:44.107403 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:27:44.107523 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:27:44.110007 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-03 13:27:44.110719 (Thread-1): finished collecting timing info
2022-03-03 13:27:44.128987 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-03 13:27:44.131013 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:27:44.131166 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER_ADDRESS"
),
rename AS 
(   
SELECT 
    MD5(ID) AS K_CUSTOMER_ADDRESS_DLHK
    ,ID AS K_CUSTOMER_ADDRESS_BK
    ,MD5(CONCAT(
        COALESCE(ADDRESS1,'00'),
        COALESCE(ADDRESS2,'00'),
        COALESCE(CITY,'00'),
        COALESCE(COUNTRY,'00'),
        COALESCE(COUNTRY_CODE,'00'),
        COALESCE(FIRST_NAME,'00'),
        COALESCE(LAST_NAME,'00'),
        COALESCE(PROVINCE,'00'),
        COALESCE(PROVINCE_CODE,'00'),
        COALESCE(ZIP,'00')
    )) AS K_ADDRESS_DLHK
    ,CUSTOMER_ID AS K_CUSTOMER_BK
    ,ADDRESS1 AS A_ADDRESS1
    ,ADDRESS2 AS A_ADDRESS2
    ,CITY AS A_CITY
    ,COMPANY AS A_COMPANY
    ,COUNTRY AS A_COUNTRY
    ,COUNTRY_CODE AS A_COUNTRY_CODE
    ,COUNTRY_NAME AS A_COUNTRY_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,PHONE AS A_PHONE
    ,PROVINCE AS A_PROVINCE
    ,PROVINCE_CODE AS A_PROVINCE_CODE
    ,ZIP AS A_ZIP
    ,IS_DEFAULT AS B_IS_DEFAULT  
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-03 13:27:44.131273 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:27:45.877438 (Thread-1): SQL status: SUCCESS 1 in 1.75 seconds
2022-03-03 13:27:45.897469 (Thread-1): finished collecting timing info
2022-03-03 13:27:45.897700 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: Close
2022-03-03 13:27:46.406474 (Thread-1): 10:27:46 | 1 of 25 OK created view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG..... [SUCCESS 1 in 2.30s]
2022-03-03 13:27:46.407318 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:27:46.408079 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:27:46.409234 (Thread-1): 10:27:46 | 2 of 25 START view model DBT_SHOPIFY.V_CUSTOMER_STG.................. [RUN]
2022-03-03 13:27:46.410333 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:27:46.411042 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:27:46.422581 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-03 13:27:46.423110 (Thread-1): finished collecting timing info
2022-03-03 13:27:46.424542 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-03 13:27:46.426374 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:27:46.426479 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER"
),
rename AS 
(   
SELECT 
    --KEYS
    MD5(ID) AS K_CUSTOMER_DLHK    
    --BUSINESS KEYS
    ,ID AS K_CUSTOMER_BK
    ,LAST_ORDER_ID AS K_LAST_ORDER_BK
    ,MULTIPASS_IDENTIFIER AS K_MULTIPASS_BKENTIFIER
    --ATTRIBUTES
    ,ACCEPTS_MARKETING_UPDATED_AT AS A_ACCEPTS_MARKETING_UPDATED_AT_DTS
    ,CREATED_AT AS A_CREATED_AT_DTS
    ,CURRENCY AS A_CURRENCY
    ,EMAIL AS A_EMAIL
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,LAST_ORDER_NAME AS A_LAST_ORDER_NAME
    ,MARKETING_OPT_IN_LEVEL AS A_MARKETING_OPT_IN_LEVEL
    ,NOTE AS A_NOTE
    ,PHONE AS A_PHONE
    ,SMS_MARKETING_CONSENT AS A_SMS_MARKETING_CONSENT
    ,STATE AS A_STATE
    ,TAGS AS A_TAGS
    ,TAX_EXEMPTIONS AS A_TAX_EXEMPTIONS
    ,TOTAL_SPENT AS A_TOTAL_SPENT
    ,UPDATED_AT AS A_UPDATED_AT
    --BOOLEAN
    ,ACCEPTS_MARKETING AS B_ACCEPTS_MARKETING
    ,TAX_EXEMPT AS B_TAX_EXEMPT
    ,VERIFIED_EMAIL AS B_VERIFIED_EMAIL
    --METRICS
    ,ORDERS_COUNT AS M_ORDERS_COUNT
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-03 13:27:46.426575 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:27:48.097314 (Thread-1): SQL status: SUCCESS 1 in 1.67 seconds
2022-03-03 13:27:48.100569 (Thread-1): finished collecting timing info
2022-03-03 13:27:48.100999 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-03 13:27:48.554545 (Thread-1): 10:27:48 | 2 of 25 OK created view model DBT_SHOPIFY.V_CUSTOMER_STG............. [SUCCESS 1 in 2.14s]
2022-03-03 13:27:48.555064 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:27:48.555457 (Thread-1): Began running node model.snowflake_aicd.V_DATE_STG
2022-03-03 13:27:48.556111 (Thread-1): 10:27:48 | 3 of 25 START view model DBT_SHOPIFY.V_DATE_STG...................... [RUN]
2022-03-03 13:27:48.557479 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:27:48.557937 (Thread-1): Compiling model.snowflake_aicd.V_DATE_STG
2022-03-03 13:27:48.570653 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-03 13:27:48.571243 (Thread-1): finished collecting timing info
2022-03-03 13:27:48.572861 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-03 13:27:48.593849 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:27:48.594045 (Thread-1): On model.snowflake_aicd.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-03 13:27:48.594226 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:27:51.167321 (Thread-1): SQL status: SUCCESS 1 in 2.57 seconds
2022-03-03 13:27:51.170501 (Thread-1): finished collecting timing info
2022-03-03 13:27:51.170909 (Thread-1): On model.snowflake_aicd.V_DATE_STG: Close
2022-03-03 13:27:51.678446 (Thread-1): 10:27:51 | 3 of 25 OK created view model DBT_SHOPIFY.V_DATE_STG................. [SUCCESS 1 in 3.12s]
2022-03-03 13:27:51.679165 (Thread-1): Finished running node model.snowflake_aicd.V_DATE_STG
2022-03-03 13:27:51.679610 (Thread-1): Began running node model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:27:51.680266 (Thread-1): 10:27:51 | 4 of 25 START view model DBT_SHOPIFY.V_LOCATION_STG.................. [RUN]
2022-03-03 13:27:51.681389 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:27:51.681938 (Thread-1): Compiling model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:27:51.689392 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-03 13:27:51.689868 (Thread-1): finished collecting timing info
2022-03-03 13:27:51.691662 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-03 13:27:51.693270 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:27:51.693372 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:27:51.693472 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:27:54.651112 (Thread-1): SQL status: SUCCESS 1 in 2.96 seconds
2022-03-03 13:27:54.656220 (Thread-1): finished collecting timing info
2022-03-03 13:27:54.657051 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-03 13:27:55.117032 (Thread-1): 10:27:55 | 4 of 25 OK created view model DBT_SHOPIFY.V_LOCATION_STG............. [SUCCESS 1 in 3.44s]
2022-03-03 13:27:55.121099 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:27:55.121936 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:27:55.122701 (Thread-1): 10:27:55 | 5 of 25 START view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG......... [RUN]
2022-03-03 13:27:55.123676 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:27:55.124355 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:27:55.137380 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-03 13:27:55.138383 (Thread-1): finished collecting timing info
2022-03-03 13:27:55.139884 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-03 13:27:55.141994 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:27:55.142102 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_ADJUSTMENT" AS A
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_ADJUSTMENT_DLHK
  --BK
  ,ID AS K_ORDER_ADJUSTMENT_BK
  ,ORDER_ID AS K_ORDER_BK
  ,REFUND_ID AS K_REFUND_BK
  --ATTRIBUTE
  ,KIND AS A_KIND
  ,REASON AS A_REASON
  --METRIC
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT_PRIMARY
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-03 13:27:55.142205 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:27:57.082027 (Thread-1): SQL status: SUCCESS 1 in 1.94 seconds
2022-03-03 13:27:57.092431 (Thread-1): finished collecting timing info
2022-03-03 13:27:57.092952 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: Close
2022-03-03 13:27:57.580385 (Thread-1): 10:27:57 | 5 of 25 OK created view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG.... [SUCCESS 1 in 2.46s]
2022-03-03 13:27:57.580916 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:27:57.581638 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:27:57.591562 (Thread-1): 10:27:57 | 6 of 25 START view model DBT_SHOPIFY.V_ORDERS_HEADER_STG............. [RUN]
2022-03-03 13:27:57.592264 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:27:57.592548 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:27:57.600729 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-03 13:27:57.601696 (Thread-1): finished collecting timing info
2022-03-03 13:27:57.603463 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-03 13:27:57.614164 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:27:57.614392 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDERS" AS A
),
rename AS 
(
SELECT
    MD5(O.ID) AS K_ORDER_DLHK    
    ,MD5(O.CUSTOMER_ID) AS K_CUSTOMER_DLHK
    ,MD5(O.LOCATION_ID) AS K_LOCATION_DLHK    
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
    --BUSINESS_KEYS
    ,O.APP_ID AS K_APP_BK
    ,O.ID AS K_ORDER_BK
    ,O.CUSTOMER_ID AS K_CUSTOMER_BK
    ,O.DEVICE_ID AS K_DEVICE_BK  
    ,O.LOCATION_ID AS K_LOCATION_BK
    ,O.SOURCE_IDENTIFIER AS K_SOURCE_ENTIFIER_BK
    --ATTRIBUTES
    ,O.BROWSER_IP AS A_BROWSER_IP
    ,O.CANCELLED_AT AS A_CANCELLED_AT_DTS
    ,O.CANCEL_REASON AS A_CANCEL_REASON
    ,O.CART_TOKEN AS A_CART_TOKEN
    ,O.CHECKOUT_TOKEN AS A_CHECKOUT_TOKEN
    ,O.CLIENT_DETAILS AS A_CLIENT_DETAILS
    ,O.CLOSED_AT AS A_CLOSED_AT_DTS
    ,O.CREATED_AT AS A_CREATED_AT_DTS
    ,O.CURRENCY AS A_CURRENCY
    ,O.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
    ,O.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
    ,O.EMAIL AS A_EMAIL
    ,O.FINANCIAL_STATUS AS A_FINANCIAL_STATUS
    ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
    ,O.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
    ,O.LANDING_SITE_REF AS A_LANDING_SITE_REF
    ,O.NAME AS A_NAME
    ,O.NOTE AS A_NOTE
    ,O.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES    
    ,O.PAYMENT_GATEWAY_NAMES AS A_PAYMENT_GATEWAY_NAMES    
    ,O.PROCESSED_AT AS A_PROCESSED_AT_DTS
    ,O.PROCESSING_METHOD AS A_PROCESSING_METHOD
    ,O.REFERENCE AS A_REFERENCE
    ,O.REFERRING_SITE AS A_REFERRING_SITE    
    ,O.SOURCE_NAME AS A_SOURCE_NAME
    ,O.SOURCE_URL AS A_SOURCE_URL    
    ,O.ORDER_NUMBER AS A_ORDER_NUMBER
    ,O.POSION_NUMBER AS A_POSION_NUMBER  
    ,O.UPDATED_AT AS A_UPDATED_AT_DTS
    --BOOLEAN
    ,O.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
    ,O.CONFIRMED AS B_CONFIRMED
    ,O.TAXES_INCLUDED AS B_TAXES_INCLUDED
    --METRICS
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE_PRIMARY 
    ,O.TOTAL_TIP_RECEIVED::DECIMAL(15,2) AS M_TOTAL_TIP_RECEIVED   
    ,O.TOTAL_WEIGHT::DECIMAL(15,2) AS M_TOTAL_WEIGHT
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
FROM source O
)

SELECT * FROM rename
  );
2022-03-03 13:27:57.614552 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:27:59.414091 (Thread-1): SQL status: SUCCESS 1 in 1.80 seconds
2022-03-03 13:27:59.419661 (Thread-1): finished collecting timing info
2022-03-03 13:27:59.420228 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: Close
2022-03-03 13:27:59.870259 (Thread-1): 10:27:59 | 6 of 25 OK created view model DBT_SHOPIFY.V_ORDERS_HEADER_STG........ [SUCCESS 1 in 2.28s]
2022-03-03 13:27:59.870764 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:27:59.871277 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:27:59.872099 (Thread-1): 10:27:59 | 7 of 25 START view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG.. [RUN]
2022-03-03 13:27:59.873476 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:27:59.874475 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:27:59.889625 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-03 13:27:59.890143 (Thread-1): finished collecting timing info
2022-03-03 13:27:59.891723 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-03 13:27:59.893386 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:27:59.893491 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM_TAX_LINE" AS A
),
rename AS 
(
SELECT
  CONCAT(COALESCE(ORDER_ID,'0000000000'),'-',COALESCE(ORDER_LINE_ID,'0000000000')) AS K_ORDER_LINE_ITEM_TAX_DLHK
  ,ORDER_ID AS K_ORDER_BK
  ,ORDER_LINE_ID AS K_ORDER_LINE_ITEM_BK
  ,TITLE AS A_TITLE
  ,CHANNEL_LIABLE AS B_CHANNEL_LIABLE
  ,RATE AS M_RATE
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-03 13:27:59.893596 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:01.700901 (Thread-1): SQL status: SUCCESS 1 in 1.81 seconds
2022-03-03 13:28:01.713828 (Thread-1): finished collecting timing info
2022-03-03 13:28:01.714604 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: Close
2022-03-03 13:28:02.207470 (Thread-1): 10:28:02 | 7 of 25 OK created view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG [SUCCESS 1 in 2.33s]
2022-03-03 13:28:02.208856 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:28:02.209643 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:28:02.210512 (Thread-1): 10:28:02 | 8 of 25 START view model DBT_SHOPIFY.V_PRODUCT_STG................... [RUN]
2022-03-03 13:28:02.211785 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:28:02.212251 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:28:02.221271 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-03 13:28:02.222698 (Thread-1): finished collecting timing info
2022-03-03 13:28:02.224536 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-03 13:28:02.226034 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:28:02.226158 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_DLHK
  ,ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE
  ,HANDLE AS A_HANDLE
  ,PRODUCT_TYPE AS A_PRODUCT_TYPE
  ,VENDOR AS A_VENDOR
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE
  ,STATUS AS A_STATUS
  ,TEMPLATE_SUFFIX AS A_TEMPLATE_SUFFIX   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:28:02.226264 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:04.076240 (Thread-1): SQL status: SUCCESS 1 in 1.85 seconds
2022-03-03 13:28:04.080190 (Thread-1): finished collecting timing info
2022-03-03 13:28:04.080920 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: Close
2022-03-03 13:28:04.535600 (Thread-1): 10:28:04 | 8 of 25 OK created view model DBT_SHOPIFY.V_PRODUCT_STG.............. [SUCCESS 1 in 2.32s]
2022-03-03 13:28:04.535814 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:28:04.535951 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:28:04.536110 (Thread-1): 10:28:04 | 9 of 25 START view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG........... [RUN]
2022-03-03 13:28:04.536464 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:28:04.536587 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:28:04.540152 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-03 13:28:04.540555 (Thread-1): finished collecting timing info
2022-03-03 13:28:04.542566 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-03 13:28:04.544841 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:28:04.545004 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT_VARIANT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_VARIANT_DLHK
  ,MD5(PRODUCT_ID) AS K_PRODUCT_DLHK  
  --BUSINESS KEYS  
  ,ID AS K_PRODUCT_VARIANT_BK
  ,PRODUCT_ID AS K_PRODUCT_BK  
  ,INVENTORY_ITEM_ID AS K_INVENTORY_ITEM_BK
  ,IMAGE_ID AS K_IMAGE_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE  
  ,SKU AS A_SKU    
  ,FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,INVENTORY_MANAGEMENT AS A_INVENTORY_MANAGEMENT
  ,INVENTORY_POLICY AS A_INVENTORY_POLICY
  ,BARCODE AS A_BARCODE
  ,GRAMS AS A_GRAMS
  ,WEIGHT_UNIT AS A_WEIGHT_UNIT
  ,OPTION_1 AS A_OPTION_1
  ,OPTION_2 AS A_OPTION_2
  ,OPTION_3 AS A_OPTION_3
  ,TAX_CODE AS A_TAX_CODE  
  ,PRESENTMENT_PRICES AS A_PRESENTMENT_PRICES  
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  --BOOLEAN
  ,REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,TAXABLE AS B_TAXABLE
  --METRICS
  ,PRICE AS M_PRICE
  ,POSITION AS M_POSITION
  ,COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,INVENTORY_QUANTITY AS M_INVENTORY_QUANTITY
  ,INVENTORY_QUANTITY_ADJUSTMENT AS M_INVENTORY_QUANTITY_ADJUSTMENT
  ,WEIGHT AS M_WEIGHT
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:28:04.545112 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:06.277036 (Thread-1): SQL status: SUCCESS 1 in 1.73 seconds
2022-03-03 13:28:06.284350 (Thread-1): finished collecting timing info
2022-03-03 13:28:06.285023 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: Close
2022-03-03 13:28:06.727807 (Thread-1): 10:28:06 | 9 of 25 OK created view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG...... [SUCCESS 1 in 2.19s]
2022-03-03 13:28:06.728443 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:28:06.728835 (Thread-1): Began running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:28:06.729413 (Thread-1): 10:28:06 | 10 of 25 START view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG......... [RUN]
2022-03-03 13:28:06.730514 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:28:06.731059 (Thread-1): Compiling model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:28:06.741493 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-03 13:28:06.743748 (Thread-1): finished collecting timing info
2022-03-03 13:28:06.745277 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-03 13:28:06.748647 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:28:06.748812 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG  as (
    


WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND" AS A
),
refund_line as (
    SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND_LINE_ITEM" AS A
),
rename AS 
(
SELECT
  MD5(RL.ID) AS K_REFUND_LINE_DLHK
  ,MD5(R.ID) AS K_REFUND_DLHK
  ,R.ID AS K_REFUND_BK
  ,RL.ID AS K_REFUND_LINE_BK
  ,R.ORDER_ID AS K_ORDER_BK
  ,R.USER_ID AS K_USER_BK
  ,RL.LOCATION_ID AS K_LOCATION_BK
  ,RL.LINE_ITEM_ID AS K_ORDER_LINE_ITEM_BK
  ,R.NOTE AS A_NOTE
  ,R.RESTOCK AS B_RESTOCK
  ,RL.QUANTITY AS M_QUANTITY
  ,RL.RESTOCK_TYPE AS A_RESTOCK_TYPE
   
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL


  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
FROM source R
LEFT JOIN refund_line RL ON RL.REFUND_ID = R.ID
)

SELECT * FROM rename
  );
2022-03-03 13:28:06.748921 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:08.593908 (Thread-1): SQL status: SUCCESS 1 in 1.84 seconds
2022-03-03 13:28:08.598199 (Thread-1): finished collecting timing info
2022-03-03 13:28:08.598700 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: Close
2022-03-03 13:28:09.040224 (Thread-1): 10:28:09 | 10 of 25 OK created view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG.... [SUCCESS 1 in 2.31s]
2022-03-03 13:28:09.040715 (Thread-1): Finished running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:28:09.041088 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:28:09.041823 (Thread-1): 10:28:09 | 11 of 25 START table model DBT_SHOPIFY.W_CUSTOMERS_D................. [RUN]
2022-03-03 13:28:09.042805 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:28:09.043505 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:28:09.051859 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-03 13:28:09.053053 (Thread-1): finished collecting timing info
2022-03-03 13:28:09.072192 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-03 13:28:09.072991 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:28:09.073091 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG AS C
      );
2022-03-03 13:28:09.073187 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:11.983523 (Thread-1): SQL status: SUCCESS 1 in 2.91 seconds
2022-03-03 13:28:11.989626 (Thread-1): finished collecting timing info
2022-03-03 13:28:11.989838 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-03 13:28:12.499701 (Thread-1): 10:28:12 | 11 of 25 OK created table model DBT_SHOPIFY.W_CUSTOMERS_D............ [SUCCESS 1 in 3.46s]
2022-03-03 13:28:12.499931 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:28:12.500072 (Thread-1): Began running node model.snowflake_aicd.W_DATE_D
2022-03-03 13:28:12.500234 (Thread-1): 10:28:12 | 12 of 25 START table model DBT_SHOPIFY.W_DATE_D...................... [RUN]
2022-03-03 13:28:12.500457 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:28:12.500578 (Thread-1): Compiling model.snowflake_aicd.W_DATE_D
2022-03-03 13:28:12.503266 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-03 13:28:12.503833 (Thread-1): finished collecting timing info
2022-03-03 13:28:12.505274 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-03 13:28:12.508171 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:28:12.508274 (Thread-1): On model.snowflake_aicd.W_DATE_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_DATE_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_DATE_D  as
      (

SELECT 
	CAST(DATE_KEY AS NUMBER(9)) AS K_DATE_INTEGER_BK
	,CAST(DATE_COLUMN AS DATE) AS K_DATE_BK
	,CAST(FULL_DATE_DESC AS VARCHAR(64)) AS A_FULL_DATE_DESC
	,CAST(DAY_NUM_IN_WEEK AS NUMBER(1)) AS A_DAY_NUM_IN_WEEK
	,CAST(DAY_NUM_IN_MONTH AS NUMBER(2)) AS A_DAY_NUM_IN_MONTH
	,CAST(DAY_NUM_IN_YEAR AS NUMBER(3)) AS A_DAY_NUM_IN_YEAR
	,CAST(DAY_NAME AS VARCHAR(10)) AS A_DAY_NAME
	,CAST(DAY_ABBREV AS VARCHAR(3)) AS A_DAY_ABBREV
	,CAST(WEEKDAY_IND AS VARCHAR(64)) AS A_WEEKDAY_IND
	,CAST(US_HOLIDAY_IND AS VARCHAR(64)) AS A_US_HOLIDAY_IND
	,CAST(COMPANY_HOLIDAY_IND AS VARCHAR(64)) AS A_COMPANY_HOLIDAY_IND
	,CAST(MONTH_END_IND AS VARCHAR(64)) AS A_MONTH_END_IND
	,CAST(WEEK_BEGIN_DATE_NKEY AS NUMBER(9)) AS A_WEEK_BEGIN_DATE_NKEY
	,CAST(WEEK_BEGIN_DATE AS DATE) AS A_WEEK_BEGIN_DATE
	,CAST(WEEK_END_DATE_NKEY AS NUMBER(9)) AS A_WEEK_END_DATE_NKEY
	,CAST(WEEK_END_DATE AS DATE) AS A_WEEK_END_DATE
	,CAST(WEEK_NUM_IN_YEAR AS NUMBER(9)) AS A_WEEK_NUM_IN_YEAR
	,CAST(MONTH_NAME AS VARCHAR(10)) AS A_MONTH_NAME
	,CAST(MONTH_ABBREV AS VARCHAR(3)) AS A_MONTH_ABBREV
	,CAST(MONTH_NUM_IN_YEAR AS NUMBER(2)) AS A_MONTH_NUM_IN_YEAR
	,CAST(YEARMONTH AS VARCHAR(10)) AS A_YEARMONTH
	,CAST(CURRENT_QUARTER AS NUMBER(1)) AS A_QUARTER
	,CAST(YEARQUARTER AS VARCHAR(10)) AS A_YEARQUARTER
	,CAST(CURRENT_YEAR AS NUMBER(5)) AS A_YEAR
	,CAST(FISCAL_WEEK_NUM AS NUMBER(2)) AS A_FISCAL_WEEK_NUM
	,CAST(FISCAL_MONTH_NUM AS NUMBER(2)) AS A_FISCAL_MONTH_NUM
	,CAST(FISCAL_YEARMONTH AS VARCHAR(10)) AS A_FISCAL_YEARMONTH
	,CAST(FISCAL_QUARTER AS NUMBER(1)) AS A_FISCAL_QUARTER
	,CAST(FISCAL_YEARQUARTER AS VARCHAR(10)) AS A_FISCAL_YEARQUARTER
	,CAST(FISCAL_HALFYEAR AS NUMBER(1)) AS A_FISCAL_HALFYEAR
	,CAST(FISCAL_YEAR AS NUMBER(5)) AS A_FISCAL_YEAR
	,CAST(SQL_TIMESTAMP AS TIMESTAMP_NTZ) AS A_SQL_TIMESTAMP_DTS
	,CAST(CURRENT_ROW_IND AS CHAR(1)) AS A_CURRENT_ROW_IND
	,CAST(EFFECTIVE_DATE AS DATE) AS A_EFFECTIVE_DATE
	,CAST(EXPIRA_DATE AS DATE) AS A_EXPIRATION_DATE
FROM
DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG
      );
2022-03-03 13:28:12.508375 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:15.950820 (Thread-1): SQL status: SUCCESS 1 in 3.44 seconds
2022-03-03 13:28:15.957316 (Thread-1): finished collecting timing info
2022-03-03 13:28:15.957891 (Thread-1): On model.snowflake_aicd.W_DATE_D: Close
2022-03-03 13:28:16.558350 (Thread-1): 10:28:16 | 12 of 25 OK created table model DBT_SHOPIFY.W_DATE_D................. [SUCCESS 1 in 4.06s]
2022-03-03 13:28:16.558885 (Thread-1): Finished running node model.snowflake_aicd.W_DATE_D
2022-03-03 13:28:16.560176 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:28:16.560780 (Thread-1): 10:28:16 | 13 of 25 START table model DBT_SHOPIFY.W_LOCATION_D.................. [RUN]
2022-03-03 13:28:16.561607 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:28:16.562060 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:28:16.573437 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-03 13:28:16.573911 (Thread-1): finished collecting timing info
2022-03-03 13:28:16.575450 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-03 13:28:16.576082 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:28:16.576182 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-03 13:28:16.576279 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:19.258250 (Thread-1): SQL status: SUCCESS 1 in 2.68 seconds
2022-03-03 13:28:19.265052 (Thread-1): finished collecting timing info
2022-03-03 13:28:19.265884 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-03 13:28:19.725773 (Thread-1): 10:28:19 | 13 of 25 OK created table model DBT_SHOPIFY.W_LOCATION_D............. [SUCCESS 1 in 3.16s]
2022-03-03 13:28:19.725958 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:28:19.726100 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:28:19.726256 (Thread-1): 10:28:19 | 14 of 25 START view model DBT_SHOPIFY.V_PRODUCTS_D_STG............... [RUN]
2022-03-03 13:28:19.726453 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:28:19.726567 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:28:19.729549 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-03 13:28:19.729918 (Thread-1): finished collecting timing info
2022-03-03 13:28:19.731248 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-03 13:28:19.741072 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:28:19.741246 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCTS_D_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG  as (
    
 

WITH product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG
),
product_variant AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG
),

rename as (


SELECT
    MD5(CONCAT(P.K_PRODUCT_BK,'-',COALESCE(V.K_PRODUCT_VARIANT_BK,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
    ,P.K_PRODUCT_DLHK
    ,V.K_PRODUCT_VARIANT_DLHK AS K_PRODUCT_VARIANT_DLHK
    ,V.K_PRODUCT_VARIANT_BK AS K_PRODUCT_VARIANT_BK
    ,P.K_PRODUCT_BK AS K_PRODUCT_BK
    ,V.K_INVENTORY_ITEM_BK AS K_VARIANT_INVENTORY_ITEM_BK
    ,V.K_IMAGE_BK AS K_VARIANT_IMAGE_BK
    --ATTRIBUTES
    ,P.A_TITLE
    ,P.A_HANDLE
    ,P.A_PRODUCT_TYPE
    ,P.A_VENDOR
    ,P.A_CREATED_AT_DTS
    ,P.A_UPDATED_AT_DTS
    ,P.A_PUBLISHED_AT_DTS
    ,P.A_PUBLISHED_SCOPE
    ,P.A_STATUS
    ,P.A_TEMPLATE_SUFFIX       
    ,V.A_TITLE AS A_VARIANT_TITLE
    ,V.A_SKU AS A_VARIANT_SKU
    ,V.A_FULFILLMENT_SERVICE AS A_VARIANT_FULFILLMENT_SERVICE
    ,V.A_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
    ,V.A_BARCODE AS A_VARIANT_BARCODE
    ,V.A_INVENTORY_POLICY AS A_VARIANT_INVENTORY_POLICY
    ,V.A_GRAMS AS A_VARIANT_GRAMS
    ,V.A_WEIGHT_UNIT AS A_VARIANT_WEIGHT_UNIT
    ,V.A_OPTION_1 AS A_VARIANT_OPTION_1
    ,V.A_OPTION_2 AS A_VARIANT_OPTION_2
    ,V.A_OPTION_3 AS A_VARIANT_OPTION_3
    ,V.A_TAX_CODE AS A_VARIANT_TAX_CODE
    ,V.A_PRESENTMENT_PRICES AS A_VARIANT_PRESENTMENT_PRICES
    ,V.A_CREATED_AT_DTS AS A_VARIANT_CREATED_AT_DTS
    ,V.A_UPDATED_AT_DTS AS A_VARIANT_UPDATED_AT_DTS
    --BOOLEAN
    ,V.B_REQUIRES_SHIPPING AS B_VARIANT_REQUIRES_SHIPPING
    ,V.B_TAXABLE AS B_VARIANT_TAXABLE
    --METRICS
    ,V.M_PRICE AS M_VARIANT_PRICE
    ,V.M_POSITION AS M_VARIANT_POSITION
    ,V.M_COMPARE_AT_PRICE AS M_VARIANT_COMPARE_AT_PRICE
    ,V.M_INVENTORY_QUANTITY AS M_VARIANT_INVENTORY_QUANTITY
    ,V.M_INVENTORY_QUANTITY_ADJUSTMENT AS M_VARIANT_INVENTORY_QUANTITY_ADJUSTMENT
    ,V.M_WEIGHT AS M_VARIANT_WEIGHT
    --metadata (MD)
    ,P.MD_IS_DELETED AS MD_IS_DELETED_PRODUCT
    ,V.MD_IS_DELETED AS MD_IS_DELETED_VARIANT
    , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
    , 'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
FROM
    product P
    LEFT JOIN product_variant V ON V.K_PRODUCT_BK = P.K_PRODUCT_BK
)

SELECT * FROM rename
  );
2022-03-03 13:28:19.741365 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:21.760781 (Thread-1): SQL status: SUCCESS 1 in 2.02 seconds
2022-03-03 13:28:21.767217 (Thread-1): finished collecting timing info
2022-03-03 13:28:21.767753 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: Close
2022-03-03 13:28:22.241082 (Thread-1): 10:28:22 | 14 of 25 OK created view model DBT_SHOPIFY.V_PRODUCTS_D_STG.......... [SUCCESS 1 in 2.51s]
2022-03-03 13:28:22.241659 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:28:22.242514 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:28:22.243344 (Thread-1): 10:28:22 | 15 of 25 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG....... [RUN]
2022-03-03 13:28:22.244558 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:28:22.251258 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:28:22.259182 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-03 13:28:22.259676 (Thread-1): finished collecting timing info
2022-03-03 13:28:22.261274 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-03 13:28:22.266589 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:28:22.266737 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT"
),
customer AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 

  MD5(S.ID) AS K_ABANDONED_CHECKOUT_DLHK
  ,C.K_CUSTOMER_DLHK
  ,L.K_LOCATION_DLHK
  ,MD5(S.USER_ID) AS K_USER_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK  
  ,S.ID AS K_ABANDONED_CHECKOUT_BK
  ,S.CUSTOMER_ID AS K_CUSTOMER_BK
  ,S.DEVICE_ID AS K_DEVICE_BK
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.SOURCE_IDENTIFIER AS K_SOURCE_BKENTIFIER
  ,S.USER_ID AS K_USER_BK
  ,S.ABANDONED_CHECKOUT_URL AS A_ABANDONED_CHECKOUT_URL  
  ,S.CART_TOKEN AS A_CART_TOKEN
  ,S.CLOSED_AT AS A_CLOSED_AT
  ,S.COMPLETED_AT AS A_COMPLETED_AT
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
  ,S.EMAIL AS A_EMAIL
  ,S.GATEWAY AS A_GATEWAY
  ,S.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
  ,S.NAME AS A_NAME
  ,S.NOTE AS A_NOTE
  ,S.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES
  ,S.PHONE AS A_PHONE
  ,S.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
  ,S.REFERRING_SITE AS A_REFERRING_SITE    
  ,S.SOURCE AS A_SOURCE
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.SOURCE_URL AS A_SOURCE_URL
  ,S.TOKEN AS A_TOKEN
  ,S.UPDATED_AT AS A_UPDATED_AT  
  --BOOLEAN
  ,S.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
  ,S.TAXES_INCLUDED AS B_TAXES_INCLUDED
  --METRIC
  ,S.SUBTOTAL_PRICE::decimal(15,2) AS M_SUBTOTAL_PRICE
  ,S.TOTAL_DISCOUNTS::decimal(15,2) AS M_TOTAL_DISCOUNTS
  ,S.TOTAL_DUTIES::decimal(15,2) AS M_TOTAL_DUTIES
  ,S.TOTAL_LINE_ITEMS_PRICE::decimal(15,2) AS M_TOTAL_LINE_ITEMS_PRICE
  ,S.TOTAL_PRICE::decimal(15,2) AS M_TOTAL_PRICE
  ,S.TOTAL_TAX::decimal(15,2) AS M_TOTAL_TAX
  ,S.TOTAL_WEIGHT::decimal(15,2) AS M_TOTAL_WEIGHT
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
  FROM
      source S
      left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
      left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-03 13:28:22.266857 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:24.378753 (Thread-1): SQL status: SUCCESS 1 in 2.11 seconds
2022-03-03 13:28:24.380540 (Thread-1): finished collecting timing info
2022-03-03 13:28:24.380716 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: Close
2022-03-03 13:28:24.863763 (Thread-1): 10:28:24 | 15 of 25 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.. [SUCCESS 1 in 2.62s]
2022-03-03 13:28:24.867030 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:28:24.868053 (Thread-1): Began running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:28:24.875107 (Thread-1): 10:28:24 | 16 of 25 START view model DBT_SHOPIFY.V_TRANSACTIONS_STG............. [RUN]
2022-03-03 13:28:24.877110 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:28:24.880668 (Thread-1): Compiling model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:28:24.896140 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-03 13:28:24.896750 (Thread-1): finished collecting timing info
2022-03-03 13:28:24.898497 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-03 13:28:24.900777 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:28:24.900927 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_TRANSACTIONS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."TRANSACTION"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_TRANSACTION_DLHK
  ,L.K_LOCATION_DLHK  
  ,MD5(S.USER_ID) AS K_USER_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_TRANSACTION_BK
  ,S.DEVICE_ID AS K_DEVICE_BK  
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.ORDER_ID AS K_ORDER_BK
  ,S.PARENT_ID AS K_PARENT_BK
  ,S.REFUND_ID AS K_REFUND_BK
  ,S.USER_ID AS K_USER_BK  
  --ATTRIBUTES
  ,S.AUTHORIZATION AS A_AUTHORIZATION
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CURRENCY_EXCHANGE_ADJUSTMENT AS A_CURRENCY_EXCHANGE_ADJUSTMENT
  ,S.ERROR_CODE AS A_ERROR_CODE
  ,S.GATEWAY AS A_GATEWAY
  ,S.KIND AS A_KIND
  ,S.MESSAGE AS A_MESSAGE
  ,S.PAYMENT_DETAILS AS A_PAYMENT_DETAILS
  ,S.PROCESSED_AT AS A_PROCESSED_AT
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.STATUS AS A_STATUS
  --boolean
  ,S.TEST AS B_TEST
  --METRICS
  ,S.AMOUNT::decimal(15,2) AS M_AMOUNT   
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
  FROM
    source S  
  left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-03 13:28:24.901034 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:26.754560 (Thread-1): SQL status: SUCCESS 1 in 1.85 seconds
2022-03-03 13:28:26.757406 (Thread-1): finished collecting timing info
2022-03-03 13:28:26.757657 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: Close
2022-03-03 13:28:27.202459 (Thread-1): 10:28:27 | 16 of 25 OK created view model DBT_SHOPIFY.V_TRANSACTIONS_STG........ [SUCCESS 1 in 2.33s]
2022-03-03 13:28:27.202659 (Thread-1): Finished running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:28:27.202784 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:28:27.202927 (Thread-1): 10:28:27 | 17 of 25 START table model DBT_SHOPIFY.W_PRODUCTS_D.................. [RUN]
2022-03-03 13:28:27.203112 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:28:27.203212 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:28:27.205523 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-03 13:28:27.206030 (Thread-1): finished collecting timing info
2022-03-03 13:28:27.207343 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-03 13:28:27.208583 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:28:27.208799 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCTS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG AS C
      );
2022-03-03 13:28:27.209012 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:30.120907 (Thread-1): SQL status: SUCCESS 1 in 2.91 seconds
2022-03-03 13:28:30.126229 (Thread-1): finished collecting timing info
2022-03-03 13:28:30.126809 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: Close
2022-03-03 13:28:30.588566 (Thread-1): 10:28:30 | 17 of 25 OK created table model DBT_SHOPIFY.W_PRODUCTS_D............. [SUCCESS 1 in 3.39s]
2022-03-03 13:28:30.588789 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:28:30.588928 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:28:30.589100 (Thread-1): 10:28:30 | 18 of 25 START table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F........ [RUN]
2022-03-03 13:28:30.589301 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:28:30.589524 (Thread-1): Compiling model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:28:30.595344 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-03 13:28:30.596463 (Thread-1): finished collecting timing info
2022-03-03 13:28:30.600521 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-03 13:28:30.602152 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:28:30.602557 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG AS C
      );
2022-03-03 13:28:30.602760 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:33.802513 (Thread-1): SQL status: SUCCESS 1 in 3.20 seconds
2022-03-03 13:28:33.814085 (Thread-1): finished collecting timing info
2022-03-03 13:28:33.815250 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: Close
2022-03-03 13:28:34.283659 (Thread-1): 10:28:34 | 18 of 25 OK created table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F... [SUCCESS 1 in 3.68s]
2022-03-03 13:28:34.283999 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:28:34.284233 (Thread-1): Began running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:28:34.285531 (Thread-1): 10:28:34 | 19 of 25 START table model DBT_SHOPIFY.W_TRANSACTIONS_F.............. [RUN]
2022-03-03 13:28:34.286115 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:28:34.286331 (Thread-1): Compiling model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:28:34.290799 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-03 13:28:34.291909 (Thread-1): finished collecting timing info
2022-03-03 13:28:34.297009 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-03 13:28:34.299000 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:28:34.299182 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_TRANSACTIONS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_TRANSACTIONS_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG AS C
      );
2022-03-03 13:28:34.299301 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:37.044033 (Thread-1): SQL status: SUCCESS 1 in 2.74 seconds
2022-03-03 13:28:37.056884 (Thread-1): finished collecting timing info
2022-03-03 13:28:37.057697 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: Close
2022-03-03 13:28:37.526920 (Thread-1): 10:28:37 | 19 of 25 OK created table model DBT_SHOPIFY.W_TRANSACTIONS_F......... [SUCCESS 1 in 3.24s]
2022-03-03 13:28:37.527530 (Thread-1): Finished running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:28:37.529065 (Thread-1): Began running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:28:37.536203 (Thread-1): 10:28:37 | 20 of 25 START view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG........... [RUN]
2022-03-03 13:28:37.539006 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:28:37.539547 (Thread-1): Compiling model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:28:37.545102 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-03 13:28:37.545548 (Thread-1): finished collecting timing info
2022-03-03 13:28:37.547010 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-03 13:28:37.549076 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:28:37.549174 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_INVENTORY_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_ITEM"
),
inventory_level AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_LEVEL"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
products AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename AS 
(   
  SELECT   
  MD5(S.ID) AS K_INVENTORY_ITEM_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
  ,L.K_LOCATION_DLHK
  ,L.K_LOCATION_BK  
  ,S.ID AS K_INVENTORY_ITEM_BK
  ,S.COUNTRY_CODE_OF_ORIGIN AS A_COUNTRY_CODE_OF_ORIGIN
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.PROVINCE_CODE_OF_ORIGIN AS A_PROVINCE_CODE_OF_ORIGIN
  ,S.SKU AS A_SKU
  ,S.UPDATED_AT AS A_UPDATED_AT
  ,S.HARMONIZED_SYSTEM_CODE AS A_HARMONIZED_SYSTEM_CODE  
  --BOOLEAN
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TRACKED AS B_TRACKED
  --METRICS
  ,S.COST::decimal(15,2) AS M_COST 
  ,IL.AVAILABLE AS M_AVAIABLE  
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
  FROM
      source S
      left join inventory_level IL ON IL.INVENTORY_ITEM_ID = S.ID      
      left join locations L ON L.K_LOCATION_BK = IL.LOCATION_ID
      left join products P ON P.K_VARIANT_INVENTORY_ITEM_BK = S.ID 
)


SELECT * FROM rename
  );
2022-03-03 13:28:37.549277 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:39.385316 (Thread-1): SQL status: SUCCESS 1 in 1.84 seconds
2022-03-03 13:28:39.389042 (Thread-1): finished collecting timing info
2022-03-03 13:28:39.389477 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: Close
2022-03-03 13:28:39.840648 (Thread-1): 10:28:39 | 20 of 25 OK created view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG...... [SUCCESS 1 in 2.30s]
2022-03-03 13:28:39.841176 (Thread-1): Finished running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:28:39.841659 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:28:39.842385 (Thread-1): 10:28:39 | 21 of 25 START view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG......... [RUN]
2022-03-03 13:28:39.843139 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:28:39.843555 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:28:39.855245 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-03 13:28:39.855926 (Thread-1): finished collecting timing info
2022-03-03 13:28:39.857431 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-03 13:28:39.861377 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:28:39.861474 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM" AS A
),
products AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D AS A
),
taxes AS (
  SELECT 
      K_ORDER_LINE_ITEM_BK,
      AVG(M_RATE) AS M_RATE,
      SUM(M_TAX) AS M_TAX,
      SUM(M_TAX_PRIMARY) AS M_TAX_PRIMARY
    FROM 
      DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG AS A
    GROUP BY K_ORDER_LINE_ITEM_BK
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_LINE_ITEM_DLHK  
  ,MD5(ORDER_ID) AS K_ORDER_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
 --business keys
  ,O.PRODUCT_ID AS K_PRODUCT_BK
  ,O.VARIANT_ID AS K_VARIANT_BK
  
  ,O.ORDER_ID AS K_ORDER_BK
  ,O.ID AS K_ORDER_LINE_ITEM_BK
  --attribubtes
  ,O.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
  ,O.NAME AS A_NAME  
  ,O.PROPERTIES AS A_PROPERTIES
  ,O.SKU AS A_SKU
  ,O.TITLE AS A_TITLE  
  ,O.VARIANT_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
  ,O.VARIANT_TITLE AS A_VARIANT_TITLE
  ,O.VENDOR AS A_VENDOR
  --boolean
  ,O.GIFT_CARD AS B_GIFT_CARD
  ,O.PRODUCT_EXISTS AS B_PRODUCT_EXISTS
  ,O.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,O.TAXABLE AS B_TAXABLE
  --metrics
  ,O.FULFILLABLE_QUANTITY AS M_FULFILLABLE_QUANTITY
  ,O.GRAMS::DECIMAL(15,2) AS M_GRAMS
  ,O.QUANTITY::DECIMAL(15,2) AS M_QUANTITY
  ,M_RATE AS M_TAX_RATE
  ,COALESCE(T.M_TAX_PRIMARY,0)::DECIMAL(15,2) AS M_TAX_AMOUNT
  ,COALESCE(T.M_TAX,0)::DECIMAL(15,2) AS M_TAX_AMOUNT_PRIMARY

  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE_PRIMARY 
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT_PRIMARY 
  ,(O.QUANTITY * M_UNIT_PRICE)::DECIMAL(15,2) AS M_TOTAL_PRICE  
  ,(O.QUANTITY * M_UNIT_PRICE_PRIMARY)::DECIMAL(15,2) AS M_TOTAL_PRICE_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
FROM source O
  left join products P ON P.K_PRODUCT_BK = O.PRODUCT_ID AND CASE WHEN O.VARIANT_ID IS NOT NULL THEN O.VARIANT_ID = P.K_PRODUCT_VARIANT_BK ELSE 1=1 END
  left join taxes T ON T.K_ORDER_LINE_ITEM_BK = O.ID
)

SELECT * FROM rename
  );
2022-03-03 13:28:39.861576 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:41.564971 (Thread-1): SQL status: SUCCESS 1 in 1.70 seconds
2022-03-03 13:28:41.569637 (Thread-1): finished collecting timing info
2022-03-03 13:28:41.570151 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: Close
2022-03-03 13:28:42.011242 (Thread-1): 10:28:42 | 21 of 25 OK created view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG.... [SUCCESS 1 in 2.17s]
2022-03-03 13:28:42.011728 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:28:42.012220 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:28:42.016333 (Thread-1): 10:28:42 | 22 of 25 START view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG....... [RUN]
2022-03-03 13:28:42.017609 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:28:42.018075 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:28:42.028849 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-03 13:28:42.030303 (Thread-1): finished collecting timing info
2022-03-03 13:28:42.032254 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-03 13:28:42.034340 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:28:42.034472 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECT"
),
source_collection AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECTION"
),
product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename as (

SELECT
  MD5(S.ID) AS K_PRODUCT_COLLECT_DLHK
  ,MD5(CC.ID) AS K_COLLECTION_DLHK
  ,P.K_PRODUCT_DLHK  
  ,S.ID AS K_PRODUCT_COLLECT_BK
  ,CC.ID AS K_COLLECTION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,S.POSITION AS A_POSITION
  ,S.SORT_ORDER AS A_SORT_ORDER  
  ,S.CREATED_AT AS A_CREATED_AT_DTS
  ,S.UPDATED_AT AS A_UPDATED_AT_DTS
  ,CC.PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,CC.BODY_HTML AS A_BODY_HTML
  ,CC.TITLE AS A_TITLE
  ,CC.HANDLE AS A_HANDLE
  ,CC.PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE  
  ,CC.COLLECTION_TYPE AS A_COLLECTION_TYPE  
  --metrics
  ,CC.PRODUCTS_COUNT AS M_PRODUCTS_COUNT
  --metadata (MD)
  ,S.__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
FROM
    source S
    LEFT JOIN source_collection CC ON CC.ID = S.COLLECTION_ID
    LEFT JOIN product P ON P.K_PRODUCT_BK = S.PRODUCT_ID
)

SELECT * FROM rename
  );
2022-03-03 13:28:42.034581 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:43.857711 (Thread-1): SQL status: SUCCESS 1 in 1.82 seconds
2022-03-03 13:28:43.861677 (Thread-1): finished collecting timing info
2022-03-03 13:28:43.862185 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: Close
2022-03-03 13:28:44.319863 (Thread-1): 10:28:44 | 22 of 25 OK created view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG.. [SUCCESS 1 in 2.30s]
2022-03-03 13:28:44.320635 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:28:44.321664 (Thread-1): Began running node model.snowflake_aicd.W_INVENTORY_F
2022-03-03 13:28:44.323496 (Thread-1): 10:28:44 | 23 of 25 START table model DBT_SHOPIFY.W_INVENTORY_F................. [RUN]
2022-03-03 13:28:44.325977 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:28:44.328227 (Thread-1): Compiling model.snowflake_aicd.W_INVENTORY_F
2022-03-03 13:28:44.337473 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-03 13:28:44.338251 (Thread-1): finished collecting timing info
2022-03-03 13:28:44.339931 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-03 13:28:44.340612 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:28:44.340717 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_INVENTORY_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_INVENTORY_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG AS C
      );
2022-03-03 13:28:44.340817 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:47.004280 (Thread-1): SQL status: SUCCESS 1 in 2.66 seconds
2022-03-03 13:28:47.007687 (Thread-1): finished collecting timing info
2022-03-03 13:28:47.008169 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: Close
2022-03-03 13:28:47.460457 (Thread-1): 10:28:47 | 23 of 25 OK created table model DBT_SHOPIFY.W_INVENTORY_F............ [SUCCESS 1 in 3.14s]
2022-03-03 13:28:47.464016 (Thread-1): Finished running node model.snowflake_aicd.W_INVENTORY_F
2022-03-03 13:28:47.464707 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:28:47.466108 (Thread-1): 10:28:47 | 24 of 25 START table model DBT_SHOPIFY.W_ORDERS_F.................... [RUN]
2022-03-03 13:28:47.484601 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:28:47.485174 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:28:47.491015 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-03 13:28:47.505876 (Thread-1): finished collecting timing info
2022-03-03 13:28:47.507547 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-03 13:28:47.513226 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:28:47.513394 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ORDERS_F  as
      (

SELECT
  O.K_ORDER_DLHK AS K_ORDER_DLHK
  ,OLI.K_ORDER_LINE_ITEM_DLHK AS K_ORDER_LINE_ITEM_DLHK
  ,O.K_CUSTOMER_DLHK AS K_CUSTOMER_DLHK
  ,O.K_LOCATION_DLHK AS K_LOCATION_DLHK
  ,O.K_BILLING_ADDRESS_DLHK AS K_BILLING_ADDRESS_DLHK
  ,O.K_SHIPPING_ADDRESS_DLHK AS K_SHIPPING_ADDRESS_DLHK
  ,OLI.K_PRODUCT_VARIATION_DLHK AS K_ITEM_PRODUCT_VARIATION_DLHK
  ,OLI.K_PRODUCT_BK AS K_ITEM_PRODUCT_BK
  ,OLI.K_VARIANT_BK AS K_ITEM_VARIANT_BK
  ,OLI.K_ORDER_BK AS K_ITEM_ORDER_BK
  ,O.K_ORDER_BK AS K_ORDER_BK
  ,OLI.K_ORDER_LINE_ITEM_BK AS K_ITEM_ORDER_LINE_ITEM_BK
  ,O.K_APP_BK AS K_HEADER_APP_BK
  
  ,O.K_CUSTOMER_BK AS K_CUSTOMER_BK
  ,O.K_DEVICE_BK AS K_DEVICE_BK
  ,O.K_LOCATION_BK AS K_LOCATION_BK
  ,O.K_SOURCE_ENTIFIER_BK AS K_SOURCE_ENTIFIER_BK
  ,O.A_BROWSER_IP AS A_HEADER_BROWSER_IP
  ,O.A_CANCELLED_AT_DTS AS A_HEADER_CANCELLED_AT_DTS
  ,O.A_CANCEL_REASON AS A_HEADER_CANCEL_REASON
  ,O.A_CART_TOKEN AS A_HEADER_CART_TOKEN
  ,O.A_CHECKOUT_TOKEN AS A_HEADER_CHECKOUT_TOKEN
  ,O.A_CLIENT_DETAILS AS A_HEADER_CLIENT_DETAILS
  ,O.A_CLOSED_AT_DTS AS A_HEADER_CLOSED_AT_DTS
  ,O.A_CREATED_AT_DTS AS A_HEADER_CREATED_AT_DTS
  ,O.A_CURRENCY AS A_HEADER_CURRENCY
  ,O.A_PRESENTMENT_CURRENCY AS A_HEADER_PRESENTMENT_CURRENCY
  ,O.A_CUSTOMER_LOCALE AS A_HEADER_CUSTOMER_LOCALE
  ,O.A_EMAIL AS A_HEADER_EMAIL
  ,O.A_FINANCIAL_STATUS AS A_HEADER_FINANCIAL_STATUS
  ,O.A_FULFILLMENT_STATUS AS A_HEADER_FULFILLMENT_STATUS
  ,O.A_LANDING_SITE_BASE_URL AS A_HEADER_LANDING_SITE_BASE_URL
  ,O.A_LANDING_SITE_REF AS A_HEADER_LANDING_SITE_REF
  ,O.A_NAME AS A_HEADER_NAME
  ,O.A_NOTE AS A_HEADER_NOTE
  ,O.A_NOTE_ATTRIBUTES AS A_HEADER_NOTE_ATTRIBUTES
  ,O.A_PAYMENT_GATEWAY_NAMES AS A_HEADER_PAYMENT_GATEWAY_NAMES
  ,O.A_PROCESSED_AT_DTS AS A_HEADER_PROCESSED_AT_DTS
  ,O.A_PROCESSING_METHOD AS A_HEADER_PROCESSING_METHOD
  ,O.A_REFERENCE AS A_HEADER_REFERENCE
  ,O.A_REFERRING_SITE AS A_HEADER_REFERRING_SITE
  ,O.A_SOURCE_NAME AS A_HEADER_SOURCE_NAME
  ,O.A_SOURCE_URL AS A_HEADER_SOURCE_URL
  ,O.A_ORDER_NUMBER AS A_HEADER_ORDER_NUMBER
  ,O.A_POSION_NUMBER AS A_HEADER_POSION_NUMBER
  ,O.A_UPDATED_AT_DTS AS A_HEADER_UPDATED_AT_DTS
  ,O.B_BUYER_ACCEPTS_MARKETING AS B_HEADER_BUYER_ACCEPTS_MARKETING
  ,O.B_CONFIRMED AS B_HEADER_CONFIRMED
  ,O.B_TAXES_INCLUDED  AS B_HEADER_TAXES_INCLUDED   
  ,OLI.A_FULFILLMENT_SERVICE AS A_ITEM_FULFILLMENT_SERVICE
  ,OLI.A_FULFILLMENT_STATUS AS A_ITEM_FULFILLMENT_STATUS
  ,OLI.A_NAME AS A_ITEM_NAME
  ,OLI.A_PROPERTIES AS A_ITEM_PROPERTIES
  ,OLI.A_SKU AS A_ITEM_SKU
  ,OLI.A_TITLE AS A_ITEM_TITLE  
  ,OLI.A_VARIANT_INVENTORY_MANAGEMENT AS A_ITEM_VARIANT_INVENTORY_MANAGEMENT
  ,OLI.A_VARIANT_TITLE AS A_ITEM_VARIANT_TITLE
  ,OLI.A_VENDOR AS A_ITEM_VENDOR
  ,OLI.B_GIFT_CARD AS B_ITEM_GIFT_CARD
  ,OLI.B_PRODUCT_EXISTS AS B_ITEM_PRODUCT_EXISTS
  ,OLI.B_REQUIRES_SHIPPING AS B_ITEM_REQUIRES_SHIPPING
  ,OLI.B_TAXABLE AS B_ITEM_TAXABLE
  ,OLI.M_FULFILLABLE_QUANTITY AS M_ITEM_FULFILLABLE_QUANTITY
  ,OLI.M_GRAMS AS M_ITEM_GRAMS
  ,OLI.M_QUANTITY AS M_ITEM_QUANTITY
  ,OLI.M_UNIT_PRICE AS M_ITEM_UNIT_PRICE
  ,OLI.M_UNIT_PRICE_PRIMARY AS M_ITEM_UNIT_PRICE_PRIMARY
  ,OLI.M_TOTAL_PRICE AS M_ITEM_TOTAL_PRICE
  ,OLI.M_TOTAL_PRICE_PRIMARY AS M_ITEM_TOTAL_PRICE_PRIMARY
  ,OLI.M_TOTAL_DISCOUNT AS M_ITEM_TOTAL_DISCOUNT
  ,OLI.M_TOTAL_DISCOUNT_PRIMARY AS M_ITEM_TOTAL_DISCOUNT_PRIMARY
  ,OLI.M_TAX_AMOUNT AS M_TAX_AMOUNT
  ,OLI.M_TAX_AMOUNT_PRIMARY AS M_TAX_AMOUNT_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_TIP_RECEIVED * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_TIP_AMOUNT_PRIMARY  
  --,ROUND(DIV0((O.M_TOTAL_DISCOUNTS_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_HEADER_DISCOUNT
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE * OLI.M_TOTAL_PRICE),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE



   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fcf3f955-4661-4d93-991b-b7f776a54bef' AS MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG OLI ON OLI.K_ORDER_DLHK = O.K_ORDER_DLHK
      );
2022-03-03 13:28:47.513512 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:50.430909 (Thread-1): SQL status: SUCCESS 1 in 2.92 seconds
2022-03-03 13:28:50.436649 (Thread-1): finished collecting timing info
2022-03-03 13:28:50.437205 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-03 13:28:50.907292 (Thread-1): 10:28:50 | 24 of 25 OK created table model DBT_SHOPIFY.W_ORDERS_F............... [SUCCESS 1 in 3.42s]
2022-03-03 13:28:50.907884 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:28:50.908394 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:28:50.908983 (Thread-1): 10:28:50 | 25 of 25 START table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F........ [RUN]
2022-03-03 13:28:50.909834 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:28:50.919884 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:28:50.923444 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-03 13:28:50.924178 (Thread-1): finished collecting timing info
2022-03-03 13:28:50.925685 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-03 13:28:50.926370 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:28:50.926472 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCT_COLLECTION_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG AS C
      );
2022-03-03 13:28:50.926568 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:28:53.780520 (Thread-1): SQL status: SUCCESS 1 in 2.85 seconds
2022-03-03 13:28:53.801128 (Thread-1): finished collecting timing info
2022-03-03 13:28:53.801958 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: Close
2022-03-03 13:28:54.276827 (Thread-1): 10:28:54 | 25 of 25 OK created table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F... [SUCCESS 1 in 3.37s]
2022-03-03 13:28:54.277733 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:28:54.296557 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 13:28:54.297433 (MainThread): 10:28:54 | 
2022-03-03 13:28:54.297580 (MainThread): 10:28:54 | Finished running 16 view models, 9 table models in 75.08s.
2022-03-03 13:28:54.297688 (MainThread): Connection 'master' was properly closed.
2022-03-03 13:28:54.297774 (MainThread): Connection 'model.snowflake_aicd.W_PRODUCT_COLLECTION_F' was properly closed.
2022-03-03 13:28:54.305708 (MainThread): 
2022-03-03 13:28:54.305942 (MainThread): Completed successfully
2022-03-03 13:28:54.306091 (MainThread): 
Done. PASS=25 WARN=0 ERROR=0 SKIP=0 TOTAL=25
2022-03-03 13:28:54.308457 (MainThread): Flushing usage events
2022-03-03 13:31:33.422684 (MainThread): Running with dbt=0.21.1
2022-03-03 13:31:34.016521 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-03 13:31:34.017875 (MainThread): Tracking: do not track
2022-03-03 13:31:34.027997 (MainThread): Partial parsing not enabled
2022-03-03 13:31:34.049558 (MainThread): Parsing macros/common.sql
2022-03-03 13:31:34.052851 (MainThread): Parsing macros/catalog.sql
2022-03-03 13:31:34.054822 (MainThread): Parsing macros/adapters.sql
2022-03-03 13:31:34.089055 (MainThread): Parsing macros/materializations/merge.sql
2022-03-03 13:31:34.092400 (MainThread): Parsing macros/materializations/seed.sql
2022-03-03 13:31:34.096264 (MainThread): Parsing macros/materializations/view.sql
2022-03-03 13:31:34.097348 (MainThread): Parsing macros/materializations/table.sql
2022-03-03 13:31:34.100105 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-03 13:31:34.107082 (MainThread): Parsing macros/core.sql
2022-03-03 13:31:34.110319 (MainThread): Parsing macros/materializations/test.sql
2022-03-03 13:31:34.115785 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-03 13:31:34.124515 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-03 13:31:34.125924 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-03 13:31:34.140239 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-03 13:31:34.171554 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-03 13:31:34.191797 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-03 13:31:34.193250 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-03 13:31:34.202097 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-03 13:31:34.220521 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-03 13:31:34.233113 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-03 13:31:34.240166 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-03 13:31:34.246652 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-03 13:31:34.249794 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-03 13:31:34.250965 (MainThread): Parsing macros/etc/query.sql
2022-03-03 13:31:34.251685 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-03 13:31:34.252883 (MainThread): Parsing macros/etc/datetime.sql
2022-03-03 13:31:34.260075 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-03 13:31:34.261488 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-03 13:31:34.263560 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-03 13:31:34.264946 (MainThread): Parsing macros/adapters/common.sql
2022-03-03 13:31:34.315475 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-03 13:31:34.316940 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-03 13:31:34.317818 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-03 13:31:34.318821 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-03 13:31:34.467374 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:31:34.476262 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.479295 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:31:34.481829 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.482609 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:31:34.485412 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.486180 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:31:34.490833 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.491611 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:31:34.494668 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.495426 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:31:34.498836 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.499629 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:31:34.502391 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.503110 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:31:34.505574 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.506548 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:31:34.509623 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.510399 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:31:34.514635 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.515429 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:31:34.518646 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.519432 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:31:34.524263 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.525040 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:31:34.530700 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.531491 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:31:34.534596 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.535404 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:31:34.538975 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.539762 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:31:34.543396 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.544134 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:31:34.547217 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.547990 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:31:34.551205 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.551980 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:31:34.589277 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.590106 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:31:34.592643 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.593412 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:31:34.595899 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.596766 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:31:34.599165 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.599887 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:31:34.602084 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.602787 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:31:34.604963 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.605736 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:31:34.608717 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.629850 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.631338 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.632534 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.633691 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.635001 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.636182 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.637314 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.638443 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:31:34.676052 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-03 13:31:34.676709 (MainThread): Found 25 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 23 sources, 0 exposures
2022-03-03 13:31:34.678812 (MainThread): 
2022-03-03 13:31:34.679069 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 13:31:34.680461 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 13:31:34.690156 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 13:31:34.690306 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-03 13:31:34.690403 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-03 13:31:36.592948 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 1.90 seconds
2022-03-03 13:31:36.597994 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-03 13:31:37.378284 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 13:31:37.383340 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 13:31:37.383481 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-03 13:31:37.383587 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-03 13:31:38.861361 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 26 in 1.48 seconds
2022-03-03 13:31:38.865126 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-03 13:31:39.292611 (MainThread): 10:31:39 | Concurrency: 1 threads (target='dev')
2022-03-03 13:31:39.293018 (MainThread): 10:31:39 | 
2022-03-03 13:31:39.294427 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:31:39.294685 (Thread-1): 10:31:39 | 1 of 25 START view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG.......... [RUN]
2022-03-03 13:31:39.294912 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:31:39.295024 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:31:39.297351 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-03 13:31:39.298073 (Thread-1): finished collecting timing info
2022-03-03 13:31:39.316271 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-03 13:31:39.318363 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:31:39.318502 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER_ADDRESS"
),
rename AS 
(   
SELECT 
    MD5(ID) AS K_CUSTOMER_ADDRESS_DLHK
    ,ID AS K_CUSTOMER_ADDRESS_BK
    ,MD5(CONCAT(
        COALESCE(ADDRESS1,'00'),
        COALESCE(ADDRESS2,'00'),
        COALESCE(CITY,'00'),
        COALESCE(COUNTRY,'00'),
        COALESCE(COUNTRY_CODE,'00'),
        COALESCE(FIRST_NAME,'00'),
        COALESCE(LAST_NAME,'00'),
        COALESCE(PROVINCE,'00'),
        COALESCE(PROVINCE_CODE,'00'),
        COALESCE(ZIP,'00')
    )) AS K_ADDRESS_DLHK
    ,CUSTOMER_ID AS K_CUSTOMER_BK
    ,ADDRESS1 AS A_ADDRESS1
    ,ADDRESS2 AS A_ADDRESS2
    ,CITY AS A_CITY
    ,COMPANY AS A_COMPANY
    ,COUNTRY AS A_COUNTRY
    ,COUNTRY_CODE AS A_COUNTRY_CODE
    ,COUNTRY_NAME AS A_COUNTRY_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,PHONE AS A_PHONE
    ,PROVINCE AS A_PROVINCE
    ,PROVINCE_CODE AS A_PROVINCE_CODE
    ,ZIP AS A_ZIP
    ,IS_DEFAULT AS B_IS_DEFAULT  
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'36e04cbb-d882-41af-a65d-fd2ae2567729' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-03 13:31:39.318609 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:31:42.757043 (Thread-1): SQL status: SUCCESS 1 in 3.44 seconds
2022-03-03 13:31:42.763487 (Thread-1): finished collecting timing info
2022-03-03 13:31:42.763708 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: Close
2022-03-03 13:31:43.270850 (Thread-1): 10:31:43 | 1 of 25 OK created view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG..... [SUCCESS 1 in 3.98s]
2022-03-03 13:31:43.271107 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:31:43.271354 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:31:43.272560 (Thread-1): 10:31:43 | 2 of 25 START view model DBT_SHOPIFY.V_CUSTOMER_STG.................. [RUN]
2022-03-03 13:31:43.273225 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:31:43.273536 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:31:43.279048 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-03 13:31:43.279470 (Thread-1): finished collecting timing info
2022-03-03 13:31:43.280898 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-03 13:31:43.283071 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:31:43.283236 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER"
),
rename AS 
(   
SELECT 
    --KEYS
    MD5(ID) AS K_CUSTOMER_DLHK    
    --BUSINESS KEYS
    ,ID AS K_CUSTOMER_BK
    ,LAST_ORDER_ID AS K_LAST_ORDER_BK
    ,MULTIPASS_IDENTIFIER AS K_MULTIPASS_BKENTIFIER
    --ATTRIBUTES
    ,ACCEPTS_MARKETING_UPDATED_AT AS A_ACCEPTS_MARKETING_UPDATED_AT_DTS
    ,CREATED_AT AS A_CREATED_AT_DTS
    ,CURRENCY AS A_CURRENCY
    ,EMAIL AS A_EMAIL
    ,,
    (COALESCE(FIRST_NAME,'') || ' ' || COALESCE(LAST_NAME,''))
 AS A_FULL_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,LAST_ORDER_NAME AS A_LAST_ORDER_NAME
    ,MARKETING_OPT_IN_LEVEL AS A_MARKETING_OPT_IN_LEVEL
    ,NOTE AS A_NOTE
    ,PHONE AS A_PHONE
    ,SMS_MARKETING_CONSENT AS A_SMS_MARKETING_CONSENT
    ,STATE AS A_STATE
    ,TAGS AS A_TAGS
    ,TAX_EXEMPTIONS AS A_TAX_EXEMPTIONS
    ,TOTAL_SPENT AS A_TOTAL_SPENT
    ,UPDATED_AT AS A_UPDATED_AT
    --BOOLEAN
    ,ACCEPTS_MARKETING AS B_ACCEPTS_MARKETING
    ,TAX_EXEMPT AS B_TAX_EXEMPT
    ,VERIFIED_EMAIL AS B_VERIFIED_EMAIL
    --METRICS
    ,ORDERS_COUNT AS M_ORDERS_COUNT
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'36e04cbb-d882-41af-a65d-fd2ae2567729' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-03 13:31:43.283346 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:31:46.255100 (Thread-1): Snowflake query id: 01a2adeb-0601-3da5-000b-358300f22e0a
2022-03-03 13:31:46.255928 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 24 at position 5 unexpected ','.
2022-03-03 13:31:46.256113 (Thread-1): finished collecting timing info
2022-03-03 13:31:46.256256 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-03 13:31:46.718149 (Thread-1): Database Error in model V_CUSTOMER_STG (models/staging/CUSTOMERS/V_CUSTOMER_STG.sql)
  001003 (42000): SQL compilation error:
  syntax error line 24 at position 5 unexpected ','.
  compiled SQL at target/run/snowflake_aicd/models/staging/CUSTOMERS/V_CUSTOMER_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 24 at position 5 unexpected ','.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_CUSTOMER_STG (models/staging/CUSTOMERS/V_CUSTOMER_STG.sql)
  001003 (42000): SQL compilation error:
  syntax error line 24 at position 5 unexpected ','.
  compiled SQL at target/run/snowflake_aicd/models/staging/CUSTOMERS/V_CUSTOMER_STG.sql
2022-03-03 13:31:46.730581 (Thread-1): 10:31:46 | 2 of 25 ERROR creating view model DBT_SHOPIFY.V_CUSTOMER_STG......... [ERROR in 3.46s]
2022-03-03 13:31:46.730779 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:31:46.730918 (Thread-1): Began running node model.snowflake_aicd.V_DATE_STG
2022-03-03 13:31:46.731099 (Thread-1): 10:31:46 | 3 of 25 START view model DBT_SHOPIFY.V_DATE_STG...................... [RUN]
2022-03-03 13:31:46.731344 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:31:46.731646 (Thread-1): Compiling model.snowflake_aicd.V_DATE_STG
2022-03-03 13:31:46.735705 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-03 13:31:46.736304 (Thread-1): finished collecting timing info
2022-03-03 13:31:46.738874 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-03 13:31:46.761657 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:31:46.761905 (Thread-1): On model.snowflake_aicd.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-03 13:31:46.762102 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:31:49.280522 (Thread-1): SQL status: SUCCESS 1 in 2.52 seconds
2022-03-03 13:31:49.283146 (Thread-1): finished collecting timing info
2022-03-03 13:31:49.283388 (Thread-1): On model.snowflake_aicd.V_DATE_STG: Close
2022-03-03 13:31:49.732623 (Thread-1): 10:31:49 | 3 of 25 OK created view model DBT_SHOPIFY.V_DATE_STG................. [SUCCESS 1 in 3.00s]
2022-03-03 13:31:49.732918 (Thread-1): Finished running node model.snowflake_aicd.V_DATE_STG
2022-03-03 13:31:49.733159 (Thread-1): Began running node model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:31:49.733348 (Thread-1): 10:31:49 | 4 of 25 START view model DBT_SHOPIFY.V_LOCATION_STG.................. [RUN]
2022-03-03 13:31:49.733596 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:31:49.733724 (Thread-1): Compiling model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:31:49.736824 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-03 13:31:49.737483 (Thread-1): finished collecting timing info
2022-03-03 13:31:49.738891 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-03 13:31:49.740637 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:31:49.740773 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '36e04cbb-d882-41af-a65d-fd2ae2567729' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:31:49.740878 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:31:51.642384 (Thread-1): SQL status: SUCCESS 1 in 1.90 seconds
2022-03-03 13:31:51.645724 (Thread-1): finished collecting timing info
2022-03-03 13:31:51.645958 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-03 13:31:52.089136 (Thread-1): 10:31:52 | 4 of 25 OK created view model DBT_SHOPIFY.V_LOCATION_STG............. [SUCCESS 1 in 2.36s]
2022-03-03 13:31:52.089384 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:31:52.089890 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:31:52.090478 (Thread-1): 10:31:52 | 5 of 25 START view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG......... [RUN]
2022-03-03 13:31:52.091190 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:31:52.091540 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:31:52.097652 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-03 13:31:52.098041 (Thread-1): finished collecting timing info
2022-03-03 13:31:52.099339 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-03 13:31:52.103937 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:31:52.104151 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_ADJUSTMENT" AS A
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_ADJUSTMENT_DLHK
  --BK
  ,ID AS K_ORDER_ADJUSTMENT_BK
  ,ORDER_ID AS K_ORDER_BK
  ,REFUND_ID AS K_REFUND_BK
  --ATTRIBUTE
  ,KIND AS A_KIND
  ,REASON AS A_REASON
  --METRIC
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT_PRIMARY
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'36e04cbb-d882-41af-a65d-fd2ae2567729' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-03 13:31:52.104357 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:31:53.770177 (Thread-1): SQL status: SUCCESS 1 in 1.67 seconds
2022-03-03 13:31:53.773337 (Thread-1): finished collecting timing info
2022-03-03 13:31:53.773760 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: Close
2022-03-03 13:31:54.216146 (Thread-1): 10:31:54 | 5 of 25 OK created view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG.... [SUCCESS 1 in 2.13s]
2022-03-03 13:31:54.216368 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:31:54.216582 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:31:54.216766 (Thread-1): 10:31:54 | 6 of 25 START view model DBT_SHOPIFY.V_ORDERS_HEADER_STG............. [RUN]
2022-03-03 13:31:54.216989 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:31:54.217102 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:31:54.223410 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-03 13:31:54.225283 (Thread-1): finished collecting timing info
2022-03-03 13:31:54.226964 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-03 13:31:54.236697 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:31:54.236815 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDERS" AS A
),
rename AS 
(
SELECT
    MD5(O.ID) AS K_ORDER_DLHK    
    ,MD5(O.CUSTOMER_ID) AS K_CUSTOMER_DLHK
    ,MD5(O.LOCATION_ID) AS K_LOCATION_DLHK    
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
    --BUSINESS_KEYS
    ,O.APP_ID AS K_APP_BK
    ,O.ID AS K_ORDER_BK
    ,O.CUSTOMER_ID AS K_CUSTOMER_BK
    ,O.DEVICE_ID AS K_DEVICE_BK  
    ,O.LOCATION_ID AS K_LOCATION_BK
    ,O.SOURCE_IDENTIFIER AS K_SOURCE_ENTIFIER_BK
    --ATTRIBUTES
    ,O.BROWSER_IP AS A_BROWSER_IP
    ,O.CANCELLED_AT AS A_CANCELLED_AT_DTS
    ,O.CANCEL_REASON AS A_CANCEL_REASON
    ,O.CART_TOKEN AS A_CART_TOKEN
    ,O.CHECKOUT_TOKEN AS A_CHECKOUT_TOKEN
    ,O.CLIENT_DETAILS AS A_CLIENT_DETAILS
    ,O.CLOSED_AT AS A_CLOSED_AT_DTS
    ,O.CREATED_AT AS A_CREATED_AT_DTS
    ,O.CURRENCY AS A_CURRENCY
    ,O.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
    ,O.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
    ,O.EMAIL AS A_EMAIL
    ,O.FINANCIAL_STATUS AS A_FINANCIAL_STATUS
    ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
    ,O.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
    ,O.LANDING_SITE_REF AS A_LANDING_SITE_REF
    ,O.NAME AS A_NAME
    ,O.NOTE AS A_NOTE
    ,O.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES    
    ,O.PAYMENT_GATEWAY_NAMES AS A_PAYMENT_GATEWAY_NAMES    
    ,O.PROCESSED_AT AS A_PROCESSED_AT_DTS
    ,O.PROCESSING_METHOD AS A_PROCESSING_METHOD
    ,O.REFERENCE AS A_REFERENCE
    ,O.REFERRING_SITE AS A_REFERRING_SITE    
    ,O.SOURCE_NAME AS A_SOURCE_NAME
    ,O.SOURCE_URL AS A_SOURCE_URL    
    ,O.ORDER_NUMBER AS A_ORDER_NUMBER
    ,O.POSION_NUMBER AS A_POSION_NUMBER  
    ,O.UPDATED_AT AS A_UPDATED_AT_DTS
    --BOOLEAN
    ,O.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
    ,O.CONFIRMED AS B_CONFIRMED
    ,O.TAXES_INCLUDED AS B_TAXES_INCLUDED
    --METRICS
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE_PRIMARY 
    ,O.TOTAL_TIP_RECEIVED::DECIMAL(15,2) AS M_TOTAL_TIP_RECEIVED   
    ,O.TOTAL_WEIGHT::DECIMAL(15,2) AS M_TOTAL_WEIGHT
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'36e04cbb-d882-41af-a65d-fd2ae2567729' AS MD_INTGR_ID
FROM source O
)

SELECT * FROM rename
  );
2022-03-03 13:31:54.236939 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:31:55.933718 (Thread-1): SQL status: SUCCESS 1 in 1.70 seconds
2022-03-03 13:31:55.936478 (Thread-1): finished collecting timing info
2022-03-03 13:31:55.936715 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: Close
2022-03-03 13:31:56.392468 (Thread-1): 10:31:56 | 6 of 25 OK created view model DBT_SHOPIFY.V_ORDERS_HEADER_STG........ [SUCCESS 1 in 2.18s]
2022-03-03 13:31:56.392662 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:31:56.392948 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:31:56.393156 (Thread-1): 10:31:56 | 7 of 25 START view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG.. [RUN]
2022-03-03 13:31:56.393396 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:31:56.393503 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:31:56.396597 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-03 13:31:56.397309 (Thread-1): finished collecting timing info
2022-03-03 13:31:56.398941 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-03 13:31:56.400766 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:31:56.400910 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM_TAX_LINE" AS A
),
rename AS 
(
SELECT
  CONCAT(COALESCE(ORDER_ID,'0000000000'),'-',COALESCE(ORDER_LINE_ID,'0000000000')) AS K_ORDER_LINE_ITEM_TAX_DLHK
  ,ORDER_ID AS K_ORDER_BK
  ,ORDER_LINE_ID AS K_ORDER_LINE_ITEM_BK
  ,TITLE AS A_TITLE
  ,CHANNEL_LIABLE AS B_CHANNEL_LIABLE
  ,RATE AS M_RATE
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'36e04cbb-d882-41af-a65d-fd2ae2567729' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-03 13:31:56.401015 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:31:57.989900 (Thread-1): SQL status: SUCCESS 1 in 1.59 seconds
2022-03-03 13:31:57.992883 (Thread-1): finished collecting timing info
2022-03-03 13:31:57.993060 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: Close
2022-03-03 13:31:58.432944 (Thread-1): 10:31:58 | 7 of 25 OK created view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG [SUCCESS 1 in 2.04s]
2022-03-03 13:31:58.433168 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:31:58.433318 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:31:58.433483 (Thread-1): 10:31:58 | 8 of 25 START view model DBT_SHOPIFY.V_PRODUCT_STG................... [RUN]
2022-03-03 13:31:58.433712 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:31:58.433826 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:31:58.436602 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-03 13:31:58.437133 (Thread-1): finished collecting timing info
2022-03-03 13:31:58.438515 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-03 13:31:58.439787 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:31:58.440081 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_DLHK
  ,ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE
  ,HANDLE AS A_HANDLE
  ,PRODUCT_TYPE AS A_PRODUCT_TYPE
  ,VENDOR AS A_VENDOR
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE
  ,STATUS AS A_STATUS
  ,TEMPLATE_SUFFIX AS A_TEMPLATE_SUFFIX   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '36e04cbb-d882-41af-a65d-fd2ae2567729' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:31:58.440223 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:32:00.261930 (Thread-1): SQL status: SUCCESS 1 in 1.82 seconds
2022-03-03 13:32:00.264724 (Thread-1): finished collecting timing info
2022-03-03 13:32:00.264972 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: Close
2022-03-03 13:32:00.715177 (Thread-1): 10:32:00 | 8 of 25 OK created view model DBT_SHOPIFY.V_PRODUCT_STG.............. [SUCCESS 1 in 2.28s]
2022-03-03 13:32:00.715411 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:32:00.715549 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:32:00.715775 (Thread-1): 10:32:00 | 9 of 25 START view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG........... [RUN]
2022-03-03 13:32:00.716036 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:32:00.716338 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:32:00.718777 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-03 13:32:00.719177 (Thread-1): finished collecting timing info
2022-03-03 13:32:00.720744 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-03 13:32:00.723447 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:32:00.723595 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT_VARIANT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_VARIANT_DLHK
  ,MD5(PRODUCT_ID) AS K_PRODUCT_DLHK  
  --BUSINESS KEYS  
  ,ID AS K_PRODUCT_VARIANT_BK
  ,PRODUCT_ID AS K_PRODUCT_BK  
  ,INVENTORY_ITEM_ID AS K_INVENTORY_ITEM_BK
  ,IMAGE_ID AS K_IMAGE_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE  
  ,SKU AS A_SKU    
  ,FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,INVENTORY_MANAGEMENT AS A_INVENTORY_MANAGEMENT
  ,INVENTORY_POLICY AS A_INVENTORY_POLICY
  ,BARCODE AS A_BARCODE
  ,GRAMS AS A_GRAMS
  ,WEIGHT_UNIT AS A_WEIGHT_UNIT
  ,OPTION_1 AS A_OPTION_1
  ,OPTION_2 AS A_OPTION_2
  ,OPTION_3 AS A_OPTION_3
  ,TAX_CODE AS A_TAX_CODE  
  ,PRESENTMENT_PRICES AS A_PRESENTMENT_PRICES  
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  --BOOLEAN
  ,REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,TAXABLE AS B_TAXABLE
  --METRICS
  ,PRICE AS M_PRICE
  ,POSITION AS M_POSITION
  ,COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,INVENTORY_QUANTITY AS M_INVENTORY_QUANTITY
  ,INVENTORY_QUANTITY_ADJUSTMENT AS M_INVENTORY_QUANTITY_ADJUSTMENT
  ,WEIGHT AS M_WEIGHT
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '36e04cbb-d882-41af-a65d-fd2ae2567729' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:32:00.723698 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:32:02.496428 (Thread-1): SQL status: SUCCESS 1 in 1.77 seconds
2022-03-03 13:32:02.499752 (Thread-1): finished collecting timing info
2022-03-03 13:32:02.500168 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: Close
2022-03-03 13:32:02.957947 (Thread-1): 10:32:02 | 9 of 25 OK created view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG...... [SUCCESS 1 in 2.24s]
2022-03-03 13:32:02.958182 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:32:02.958317 (Thread-1): Began running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:32:02.958473 (Thread-1): 10:32:02 | 10 of 25 START view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG......... [RUN]
2022-03-03 13:32:02.958680 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:32:02.959412 (Thread-1): Compiling model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:32:02.963754 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-03 13:32:02.964153 (Thread-1): finished collecting timing info
2022-03-03 13:32:02.965744 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-03 13:32:02.968336 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:32:02.968492 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG  as (
    


WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND" AS A
),
refund_line as (
    SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND_LINE_ITEM" AS A
),
rename AS 
(
SELECT
  MD5(RL.ID) AS K_REFUND_LINE_DLHK
  ,MD5(R.ID) AS K_REFUND_DLHK
  ,R.ID AS K_REFUND_BK
  ,RL.ID AS K_REFUND_LINE_BK
  ,R.ORDER_ID AS K_ORDER_BK
  ,R.USER_ID AS K_USER_BK
  ,RL.LOCATION_ID AS K_LOCATION_BK
  ,RL.LINE_ITEM_ID AS K_ORDER_LINE_ITEM_BK
  ,R.NOTE AS A_NOTE
  ,R.RESTOCK AS B_RESTOCK
  ,RL.QUANTITY AS M_QUANTITY
  ,RL.RESTOCK_TYPE AS A_RESTOCK_TYPE
   
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL


  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'36e04cbb-d882-41af-a65d-fd2ae2567729' AS MD_INTGR_ID
FROM source R
LEFT JOIN refund_line RL ON RL.REFUND_ID = R.ID
)

SELECT * FROM rename
  );
2022-03-03 13:32:02.968597 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:32:04.844460 (Thread-1): SQL status: SUCCESS 1 in 1.88 seconds
2022-03-03 13:32:04.847942 (Thread-1): finished collecting timing info
2022-03-03 13:32:04.848146 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: Close
2022-03-03 13:32:05.284702 (Thread-1): 10:32:05 | 10 of 25 OK created view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG.... [SUCCESS 1 in 2.33s]
2022-03-03 13:32:05.284946 (Thread-1): Finished running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:32:05.285087 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:32:05.285295 (Thread-1): 10:32:05 | 11 of 25 SKIP relation DBT_SHOPIFY.W_CUSTOMERS_D..................... [SKIP]
2022-03-03 13:32:05.285408 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:32:05.285516 (Thread-1): Began running node model.snowflake_aicd.W_DATE_D
2022-03-03 13:32:05.285866 (Thread-1): 10:32:05 | 12 of 25 START table model DBT_SHOPIFY.W_DATE_D...................... [RUN]
2022-03-03 13:32:05.286098 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:32:05.286214 (Thread-1): Compiling model.snowflake_aicd.W_DATE_D
2022-03-03 13:32:05.288659 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-03 13:32:05.289518 (Thread-1): finished collecting timing info
2022-03-03 13:32:05.305052 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-03 13:32:05.308040 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:32:05.308145 (Thread-1): On model.snowflake_aicd.W_DATE_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_DATE_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_DATE_D  as
      (

SELECT 
	CAST(DATE_KEY AS NUMBER(9)) AS K_DATE_INTEGER_BK
	,CAST(DATE_COLUMN AS DATE) AS K_DATE_BK
	,CAST(FULL_DATE_DESC AS VARCHAR(64)) AS A_FULL_DATE_DESC
	,CAST(DAY_NUM_IN_WEEK AS NUMBER(1)) AS A_DAY_NUM_IN_WEEK
	,CAST(DAY_NUM_IN_MONTH AS NUMBER(2)) AS A_DAY_NUM_IN_MONTH
	,CAST(DAY_NUM_IN_YEAR AS NUMBER(3)) AS A_DAY_NUM_IN_YEAR
	,CAST(DAY_NAME AS VARCHAR(10)) AS A_DAY_NAME
	,CAST(DAY_ABBREV AS VARCHAR(3)) AS A_DAY_ABBREV
	,CAST(WEEKDAY_IND AS VARCHAR(64)) AS A_WEEKDAY_IND
	,CAST(US_HOLIDAY_IND AS VARCHAR(64)) AS A_US_HOLIDAY_IND
	,CAST(COMPANY_HOLIDAY_IND AS VARCHAR(64)) AS A_COMPANY_HOLIDAY_IND
	,CAST(MONTH_END_IND AS VARCHAR(64)) AS A_MONTH_END_IND
	,CAST(WEEK_BEGIN_DATE_NKEY AS NUMBER(9)) AS A_WEEK_BEGIN_DATE_NKEY
	,CAST(WEEK_BEGIN_DATE AS DATE) AS A_WEEK_BEGIN_DATE
	,CAST(WEEK_END_DATE_NKEY AS NUMBER(9)) AS A_WEEK_END_DATE_NKEY
	,CAST(WEEK_END_DATE AS DATE) AS A_WEEK_END_DATE
	,CAST(WEEK_NUM_IN_YEAR AS NUMBER(9)) AS A_WEEK_NUM_IN_YEAR
	,CAST(MONTH_NAME AS VARCHAR(10)) AS A_MONTH_NAME
	,CAST(MONTH_ABBREV AS VARCHAR(3)) AS A_MONTH_ABBREV
	,CAST(MONTH_NUM_IN_YEAR AS NUMBER(2)) AS A_MONTH_NUM_IN_YEAR
	,CAST(YEARMONTH AS VARCHAR(10)) AS A_YEARMONTH
	,CAST(CURRENT_QUARTER AS NUMBER(1)) AS A_QUARTER
	,CAST(YEARQUARTER AS VARCHAR(10)) AS A_YEARQUARTER
	,CAST(CURRENT_YEAR AS NUMBER(5)) AS A_YEAR
	,CAST(FISCAL_WEEK_NUM AS NUMBER(2)) AS A_FISCAL_WEEK_NUM
	,CAST(FISCAL_MONTH_NUM AS NUMBER(2)) AS A_FISCAL_MONTH_NUM
	,CAST(FISCAL_YEARMONTH AS VARCHAR(10)) AS A_FISCAL_YEARMONTH
	,CAST(FISCAL_QUARTER AS NUMBER(1)) AS A_FISCAL_QUARTER
	,CAST(FISCAL_YEARQUARTER AS VARCHAR(10)) AS A_FISCAL_YEARQUARTER
	,CAST(FISCAL_HALFYEAR AS NUMBER(1)) AS A_FISCAL_HALFYEAR
	,CAST(FISCAL_YEAR AS NUMBER(5)) AS A_FISCAL_YEAR
	,CAST(SQL_TIMESTAMP AS TIMESTAMP_NTZ) AS A_SQL_TIMESTAMP_DTS
	,CAST(CURRENT_ROW_IND AS CHAR(1)) AS A_CURRENT_ROW_IND
	,CAST(EFFECTIVE_DATE AS DATE) AS A_EFFECTIVE_DATE
	,CAST(EXPIRA_DATE AS DATE) AS A_EXPIRATION_DATE
FROM
DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG
      );
2022-03-03 13:32:05.308251 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:32:10.124663 (Thread-1): SQL status: SUCCESS 1 in 4.82 seconds
2022-03-03 13:32:10.130078 (Thread-1): finished collecting timing info
2022-03-03 13:32:10.130273 (Thread-1): On model.snowflake_aicd.W_DATE_D: Close
2022-03-03 13:32:10.575061 (Thread-1): 10:32:10 | 12 of 25 OK created table model DBT_SHOPIFY.W_DATE_D................. [SUCCESS 1 in 5.29s]
2022-03-03 13:32:10.575441 (Thread-1): Finished running node model.snowflake_aicd.W_DATE_D
2022-03-03 13:32:10.575904 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:32:10.576442 (Thread-1): 10:32:10 | 13 of 25 START table model DBT_SHOPIFY.W_LOCATION_D.................. [RUN]
2022-03-03 13:32:10.576734 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:32:10.576860 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:32:10.579769 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-03 13:32:10.580326 (Thread-1): finished collecting timing info
2022-03-03 13:32:10.582853 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-03 13:32:10.583466 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:32:10.583560 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-03 13:32:10.583654 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:32:14.041988 (Thread-1): SQL status: SUCCESS 1 in 3.46 seconds
2022-03-03 13:32:14.046865 (Thread-1): finished collecting timing info
2022-03-03 13:32:14.047358 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-03 13:32:14.506499 (Thread-1): 10:32:14 | 13 of 25 OK created table model DBT_SHOPIFY.W_LOCATION_D............. [SUCCESS 1 in 3.93s]
2022-03-03 13:32:14.506720 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:32:14.506901 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:32:14.507064 (Thread-1): 10:32:14 | 14 of 25 START view model DBT_SHOPIFY.V_PRODUCTS_D_STG............... [RUN]
2022-03-03 13:32:14.507287 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:32:14.507423 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:32:14.511178 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-03 13:32:14.511968 (Thread-1): finished collecting timing info
2022-03-03 13:32:14.513371 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-03 13:32:14.516641 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:32:14.516795 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCTS_D_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG  as (
    
 

WITH product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG
),
product_variant AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG
),

rename as (


SELECT
    MD5(CONCAT(P.K_PRODUCT_BK,'-',COALESCE(V.K_PRODUCT_VARIANT_BK,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
    ,P.K_PRODUCT_DLHK
    ,V.K_PRODUCT_VARIANT_DLHK AS K_PRODUCT_VARIANT_DLHK
    ,V.K_PRODUCT_VARIANT_BK AS K_PRODUCT_VARIANT_BK
    ,P.K_PRODUCT_BK AS K_PRODUCT_BK
    ,V.K_INVENTORY_ITEM_BK AS K_VARIANT_INVENTORY_ITEM_BK
    ,V.K_IMAGE_BK AS K_VARIANT_IMAGE_BK
    --ATTRIBUTES
    ,P.A_TITLE
    ,P.A_HANDLE
    ,P.A_PRODUCT_TYPE
    ,P.A_VENDOR
    ,P.A_CREATED_AT_DTS
    ,P.A_UPDATED_AT_DTS
    ,P.A_PUBLISHED_AT_DTS
    ,P.A_PUBLISHED_SCOPE
    ,P.A_STATUS
    ,P.A_TEMPLATE_SUFFIX       
    ,V.A_TITLE AS A_VARIANT_TITLE
    ,V.A_SKU AS A_VARIANT_SKU
    ,V.A_FULFILLMENT_SERVICE AS A_VARIANT_FULFILLMENT_SERVICE
    ,V.A_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
    ,V.A_BARCODE AS A_VARIANT_BARCODE
    ,V.A_INVENTORY_POLICY AS A_VARIANT_INVENTORY_POLICY
    ,V.A_GRAMS AS A_VARIANT_GRAMS
    ,V.A_WEIGHT_UNIT AS A_VARIANT_WEIGHT_UNIT
    ,V.A_OPTION_1 AS A_VARIANT_OPTION_1
    ,V.A_OPTION_2 AS A_VARIANT_OPTION_2
    ,V.A_OPTION_3 AS A_VARIANT_OPTION_3
    ,V.A_TAX_CODE AS A_VARIANT_TAX_CODE
    ,V.A_PRESENTMENT_PRICES AS A_VARIANT_PRESENTMENT_PRICES
    ,V.A_CREATED_AT_DTS AS A_VARIANT_CREATED_AT_DTS
    ,V.A_UPDATED_AT_DTS AS A_VARIANT_UPDATED_AT_DTS
    --BOOLEAN
    ,V.B_REQUIRES_SHIPPING AS B_VARIANT_REQUIRES_SHIPPING
    ,V.B_TAXABLE AS B_VARIANT_TAXABLE
    --METRICS
    ,V.M_PRICE AS M_VARIANT_PRICE
    ,V.M_POSITION AS M_VARIANT_POSITION
    ,V.M_COMPARE_AT_PRICE AS M_VARIANT_COMPARE_AT_PRICE
    ,V.M_INVENTORY_QUANTITY AS M_VARIANT_INVENTORY_QUANTITY
    ,V.M_INVENTORY_QUANTITY_ADJUSTMENT AS M_VARIANT_INVENTORY_QUANTITY_ADJUSTMENT
    ,V.M_WEIGHT AS M_VARIANT_WEIGHT
    --metadata (MD)
    ,P.MD_IS_DELETED AS MD_IS_DELETED_PRODUCT
    ,V.MD_IS_DELETED AS MD_IS_DELETED_VARIANT
    , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
    , '36e04cbb-d882-41af-a65d-fd2ae2567729' AS MD_INTGR_ID
FROM
    product P
    LEFT JOIN product_variant V ON V.K_PRODUCT_BK = P.K_PRODUCT_BK
)

SELECT * FROM rename
  );
2022-03-03 13:32:14.516906 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:32:16.694584 (Thread-1): SQL status: SUCCESS 1 in 2.18 seconds
2022-03-03 13:32:16.697317 (Thread-1): finished collecting timing info
2022-03-03 13:32:16.697498 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: Close
2022-03-03 13:32:17.182899 (Thread-1): 10:32:17 | 14 of 25 OK created view model DBT_SHOPIFY.V_PRODUCTS_D_STG.......... [SUCCESS 1 in 2.68s]
2022-03-03 13:32:17.183119 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:32:17.183262 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:32:17.183387 (Thread-1): 10:32:17 | 15 of 25 SKIP relation DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.......... [SKIP]
2022-03-03 13:32:17.183496 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:32:17.183603 (Thread-1): Began running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:32:17.183749 (Thread-1): 10:32:17 | 16 of 25 START view model DBT_SHOPIFY.V_TRANSACTIONS_STG............. [RUN]
2022-03-03 13:32:17.183964 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:32:17.184076 (Thread-1): Compiling model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:32:17.187132 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-03 13:32:17.187771 (Thread-1): finished collecting timing info
2022-03-03 13:32:17.189285 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-03 13:32:17.191275 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:32:17.191381 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_TRANSACTIONS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."TRANSACTION"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_TRANSACTION_DLHK
  ,L.K_LOCATION_DLHK  
  ,MD5(S.USER_ID) AS K_USER_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_TRANSACTION_BK
  ,S.DEVICE_ID AS K_DEVICE_BK  
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.ORDER_ID AS K_ORDER_BK
  ,S.PARENT_ID AS K_PARENT_BK
  ,S.REFUND_ID AS K_REFUND_BK
  ,S.USER_ID AS K_USER_BK  
  --ATTRIBUTES
  ,S.AUTHORIZATION AS A_AUTHORIZATION
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CURRENCY_EXCHANGE_ADJUSTMENT AS A_CURRENCY_EXCHANGE_ADJUSTMENT
  ,S.ERROR_CODE AS A_ERROR_CODE
  ,S.GATEWAY AS A_GATEWAY
  ,S.KIND AS A_KIND
  ,S.MESSAGE AS A_MESSAGE
  ,S.PAYMENT_DETAILS AS A_PAYMENT_DETAILS
  ,S.PROCESSED_AT AS A_PROCESSED_AT
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.STATUS AS A_STATUS
  --boolean
  ,S.TEST AS B_TEST
  --METRICS
  ,S.AMOUNT::decimal(15,2) AS M_AMOUNT   
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'36e04cbb-d882-41af-a65d-fd2ae2567729' AS MD_INTGR_ID
  FROM
    source S  
  left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-03 13:32:17.191579 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:32:18.820200 (Thread-1): SQL status: SUCCESS 1 in 1.63 seconds
2022-03-03 13:32:18.822741 (Thread-1): finished collecting timing info
2022-03-03 13:32:18.822985 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: Close
2022-03-03 13:32:19.306891 (Thread-1): 10:32:19 | 16 of 25 OK created view model DBT_SHOPIFY.V_TRANSACTIONS_STG........ [SUCCESS 1 in 2.12s]
2022-03-03 13:32:19.307331 (Thread-1): Finished running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:32:19.307675 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:32:19.307902 (Thread-1): 10:32:19 | 17 of 25 START table model DBT_SHOPIFY.W_PRODUCTS_D.................. [RUN]
2022-03-03 13:32:19.308175 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:32:19.308284 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:32:19.311028 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-03 13:32:19.311491 (Thread-1): finished collecting timing info
2022-03-03 13:32:19.312874 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-03 13:32:19.313439 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:32:19.313534 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCTS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG AS C
      );
2022-03-03 13:32:19.313631 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:32:22.729369 (Thread-1): SQL status: SUCCESS 1 in 3.42 seconds
2022-03-03 13:32:22.734100 (Thread-1): finished collecting timing info
2022-03-03 13:32:22.734288 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: Close
2022-03-03 13:32:23.201968 (Thread-1): 10:32:23 | 17 of 25 OK created table model DBT_SHOPIFY.W_PRODUCTS_D............. [SUCCESS 1 in 3.89s]
2022-03-03 13:32:23.202199 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:32:23.202450 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:32:23.202704 (Thread-1): 10:32:23 | 18 of 25 SKIP relation DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F............ [SKIP]
2022-03-03 13:32:23.202985 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:32:23.203281 (Thread-1): Began running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:32:23.203471 (Thread-1): 10:32:23 | 19 of 25 START table model DBT_SHOPIFY.W_TRANSACTIONS_F.............. [RUN]
2022-03-03 13:32:23.203732 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:32:23.203851 (Thread-1): Compiling model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:32:23.206432 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-03 13:32:23.206895 (Thread-1): finished collecting timing info
2022-03-03 13:32:23.208318 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-03 13:32:23.208886 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:32:23.208981 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_TRANSACTIONS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_TRANSACTIONS_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG AS C
      );
2022-03-03 13:32:23.209078 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:32:25.566107 (Thread-1): SQL status: SUCCESS 1 in 2.36 seconds
2022-03-03 13:32:25.572041 (Thread-1): finished collecting timing info
2022-03-03 13:32:25.572364 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: Close
2022-03-03 13:32:26.004662 (Thread-1): 10:32:26 | 19 of 25 OK created table model DBT_SHOPIFY.W_TRANSACTIONS_F......... [SUCCESS 1 in 2.80s]
2022-03-03 13:32:26.004928 (Thread-1): Finished running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:32:26.005296 (Thread-1): Began running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:32:26.005510 (Thread-1): 10:32:26 | 20 of 25 START view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG........... [RUN]
2022-03-03 13:32:26.005800 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:32:26.006009 (Thread-1): Compiling model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:32:26.010437 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-03 13:32:26.010874 (Thread-1): finished collecting timing info
2022-03-03 13:32:26.012464 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-03 13:32:26.014544 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:32:26.014648 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_INVENTORY_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_ITEM"
),
inventory_level AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_LEVEL"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
products AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename AS 
(   
  SELECT   
  MD5(S.ID) AS K_INVENTORY_ITEM_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
  ,L.K_LOCATION_DLHK
  ,L.K_LOCATION_BK  
  ,S.ID AS K_INVENTORY_ITEM_BK
  ,S.COUNTRY_CODE_OF_ORIGIN AS A_COUNTRY_CODE_OF_ORIGIN
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.PROVINCE_CODE_OF_ORIGIN AS A_PROVINCE_CODE_OF_ORIGIN
  ,S.SKU AS A_SKU
  ,S.UPDATED_AT AS A_UPDATED_AT
  ,S.HARMONIZED_SYSTEM_CODE AS A_HARMONIZED_SYSTEM_CODE  
  --BOOLEAN
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TRACKED AS B_TRACKED
  --METRICS
  ,S.COST::decimal(15,2) AS M_COST 
  ,IL.AVAILABLE AS M_AVAIABLE  
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'36e04cbb-d882-41af-a65d-fd2ae2567729' AS MD_INTGR_ID
  FROM
      source S
      left join inventory_level IL ON IL.INVENTORY_ITEM_ID = S.ID      
      left join locations L ON L.K_LOCATION_BK = IL.LOCATION_ID
      left join products P ON P.K_VARIANT_INVENTORY_ITEM_BK = S.ID 
)


SELECT * FROM rename
  );
2022-03-03 13:32:26.014748 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:32:27.974484 (Thread-1): SQL status: SUCCESS 1 in 1.96 seconds
2022-03-03 13:32:27.977204 (Thread-1): finished collecting timing info
2022-03-03 13:32:27.977422 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: Close
2022-03-03 13:32:28.448479 (Thread-1): 10:32:28 | 20 of 25 OK created view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG...... [SUCCESS 1 in 2.44s]
2022-03-03 13:32:28.448706 (Thread-1): Finished running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:32:28.448928 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:32:28.449325 (Thread-1): 10:32:28 | 21 of 25 START view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG......... [RUN]
2022-03-03 13:32:28.449729 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:32:28.449886 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:32:28.454007 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-03 13:32:28.454668 (Thread-1): finished collecting timing info
2022-03-03 13:32:28.456326 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-03 13:32:28.460349 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:32:28.460655 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM" AS A
),
products AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D AS A
),
taxes AS (
  SELECT 
      K_ORDER_LINE_ITEM_BK,
      AVG(M_RATE) AS M_RATE,
      SUM(M_TAX) AS M_TAX,
      SUM(M_TAX_PRIMARY) AS M_TAX_PRIMARY
    FROM 
      DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG AS A
    GROUP BY K_ORDER_LINE_ITEM_BK
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_LINE_ITEM_DLHK  
  ,MD5(ORDER_ID) AS K_ORDER_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
 --business keys
  ,O.PRODUCT_ID AS K_PRODUCT_BK
  ,O.VARIANT_ID AS K_VARIANT_BK
  
  ,O.ORDER_ID AS K_ORDER_BK
  ,O.ID AS K_ORDER_LINE_ITEM_BK
  --attribubtes
  ,O.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
  ,O.NAME AS A_NAME  
  ,O.PROPERTIES AS A_PROPERTIES
  ,O.SKU AS A_SKU
  ,O.TITLE AS A_TITLE  
  ,O.VARIANT_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
  ,O.VARIANT_TITLE AS A_VARIANT_TITLE
  ,O.VENDOR AS A_VENDOR
  --boolean
  ,O.GIFT_CARD AS B_GIFT_CARD
  ,O.PRODUCT_EXISTS AS B_PRODUCT_EXISTS
  ,O.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,O.TAXABLE AS B_TAXABLE
  --metrics
  ,O.FULFILLABLE_QUANTITY AS M_FULFILLABLE_QUANTITY
  ,O.GRAMS::DECIMAL(15,2) AS M_GRAMS
  ,O.QUANTITY::DECIMAL(15,2) AS M_QUANTITY
  ,M_RATE AS M_TAX_RATE
  ,COALESCE(T.M_TAX_PRIMARY,0)::DECIMAL(15,2) AS M_TAX_AMOUNT
  ,COALESCE(T.M_TAX,0)::DECIMAL(15,2) AS M_TAX_AMOUNT_PRIMARY

  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE_PRIMARY 
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT_PRIMARY 
  ,(O.QUANTITY * M_UNIT_PRICE)::DECIMAL(15,2) AS M_TOTAL_PRICE  
  ,(O.QUANTITY * M_UNIT_PRICE_PRIMARY)::DECIMAL(15,2) AS M_TOTAL_PRICE_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'36e04cbb-d882-41af-a65d-fd2ae2567729' AS MD_INTGR_ID
FROM source O
  left join products P ON P.K_PRODUCT_BK = O.PRODUCT_ID AND CASE WHEN O.VARIANT_ID IS NOT NULL THEN O.VARIANT_ID = P.K_PRODUCT_VARIANT_BK ELSE 1=1 END
  left join taxes T ON T.K_ORDER_LINE_ITEM_BK = O.ID
)

SELECT * FROM rename
  );
2022-03-03 13:32:28.460824 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:32:30.093669 (Thread-1): SQL status: SUCCESS 1 in 1.63 seconds
2022-03-03 13:32:30.096087 (Thread-1): finished collecting timing info
2022-03-03 13:32:30.096269 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: Close
2022-03-03 13:32:30.582902 (Thread-1): 10:32:30 | 21 of 25 OK created view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG.... [SUCCESS 1 in 2.13s]
2022-03-03 13:32:30.583126 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:32:30.583397 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:32:30.583643 (Thread-1): 10:32:30 | 22 of 25 START view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG....... [RUN]
2022-03-03 13:32:30.583895 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:32:30.584245 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:32:30.588859 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-03 13:32:30.589262 (Thread-1): finished collecting timing info
2022-03-03 13:32:30.590861 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-03 13:32:30.592973 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:32:30.593106 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECT"
),
source_collection AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECTION"
),
product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename as (

SELECT
  MD5(S.ID) AS K_PRODUCT_COLLECT_DLHK
  ,MD5(CC.ID) AS K_COLLECTION_DLHK
  ,P.K_PRODUCT_DLHK  
  ,S.ID AS K_PRODUCT_COLLECT_BK
  ,CC.ID AS K_COLLECTION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,S.POSITION AS A_POSITION
  ,S.SORT_ORDER AS A_SORT_ORDER  
  ,S.CREATED_AT AS A_CREATED_AT_DTS
  ,S.UPDATED_AT AS A_UPDATED_AT_DTS
  ,CC.PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,CC.BODY_HTML AS A_BODY_HTML
  ,CC.TITLE AS A_TITLE
  ,CC.HANDLE AS A_HANDLE
  ,CC.PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE  
  ,CC.COLLECTION_TYPE AS A_COLLECTION_TYPE  
  --metrics
  ,CC.PRODUCTS_COUNT AS M_PRODUCTS_COUNT
  --metadata (MD)
  ,S.__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '36e04cbb-d882-41af-a65d-fd2ae2567729' AS MD_INTGR_ID
FROM
    source S
    LEFT JOIN source_collection CC ON CC.ID = S.COLLECTION_ID
    LEFT JOIN product P ON P.K_PRODUCT_BK = S.PRODUCT_ID
)

SELECT * FROM rename
  );
2022-03-03 13:32:30.593208 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:32:32.478886 (Thread-1): SQL status: SUCCESS 1 in 1.89 seconds
2022-03-03 13:32:32.481785 (Thread-1): finished collecting timing info
2022-03-03 13:32:32.481996 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: Close
2022-03-03 13:32:32.931126 (Thread-1): 10:32:32 | 22 of 25 OK created view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG.. [SUCCESS 1 in 2.35s]
2022-03-03 13:32:32.931821 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:32:32.932070 (Thread-1): Began running node model.snowflake_aicd.W_INVENTORY_F
2022-03-03 13:32:32.932274 (Thread-1): 10:32:32 | 23 of 25 START table model DBT_SHOPIFY.W_INVENTORY_F................. [RUN]
2022-03-03 13:32:32.932507 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:32:32.932649 (Thread-1): Compiling model.snowflake_aicd.W_INVENTORY_F
2022-03-03 13:32:32.935830 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-03 13:32:32.936347 (Thread-1): finished collecting timing info
2022-03-03 13:32:32.937759 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-03 13:32:32.938320 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:32:32.938414 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_INVENTORY_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_INVENTORY_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG AS C
      );
2022-03-03 13:32:32.938506 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:32:36.174157 (Thread-1): SQL status: SUCCESS 1 in 3.24 seconds
2022-03-03 13:32:36.177391 (Thread-1): finished collecting timing info
2022-03-03 13:32:36.177632 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: Close
2022-03-03 13:32:36.749681 (Thread-1): 10:32:36 | 23 of 25 OK created table model DBT_SHOPIFY.W_INVENTORY_F............ [SUCCESS 1 in 3.82s]
2022-03-03 13:32:36.749932 (Thread-1): Finished running node model.snowflake_aicd.W_INVENTORY_F
2022-03-03 13:32:36.750085 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:32:36.750254 (Thread-1): 10:32:36 | 24 of 25 START table model DBT_SHOPIFY.W_ORDERS_F.................... [RUN]
2022-03-03 13:32:36.750492 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:32:36.750605 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:32:36.755813 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-03 13:32:36.756565 (Thread-1): finished collecting timing info
2022-03-03 13:32:36.758043 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-03 13:32:36.763506 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:32:36.763658 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ORDERS_F  as
      (

SELECT
  O.K_ORDER_DLHK AS K_ORDER_DLHK
  ,OLI.K_ORDER_LINE_ITEM_DLHK AS K_ORDER_LINE_ITEM_DLHK
  ,O.K_CUSTOMER_DLHK AS K_CUSTOMER_DLHK
  ,O.K_LOCATION_DLHK AS K_LOCATION_DLHK
  ,O.K_BILLING_ADDRESS_DLHK AS K_BILLING_ADDRESS_DLHK
  ,O.K_SHIPPING_ADDRESS_DLHK AS K_SHIPPING_ADDRESS_DLHK
  ,OLI.K_PRODUCT_VARIATION_DLHK AS K_ITEM_PRODUCT_VARIATION_DLHK
  ,OLI.K_PRODUCT_BK AS K_ITEM_PRODUCT_BK
  ,OLI.K_VARIANT_BK AS K_ITEM_VARIANT_BK
  ,OLI.K_ORDER_BK AS K_ITEM_ORDER_BK
  ,O.K_ORDER_BK AS K_ORDER_BK
  ,OLI.K_ORDER_LINE_ITEM_BK AS K_ITEM_ORDER_LINE_ITEM_BK
  ,O.K_APP_BK AS K_HEADER_APP_BK
  
  ,O.K_CUSTOMER_BK AS K_CUSTOMER_BK
  ,O.K_DEVICE_BK AS K_DEVICE_BK
  ,O.K_LOCATION_BK AS K_LOCATION_BK
  ,O.K_SOURCE_ENTIFIER_BK AS K_SOURCE_ENTIFIER_BK
  ,O.A_BROWSER_IP AS A_HEADER_BROWSER_IP
  ,O.A_CANCELLED_AT_DTS AS A_HEADER_CANCELLED_AT_DTS
  ,O.A_CANCEL_REASON AS A_HEADER_CANCEL_REASON
  ,O.A_CART_TOKEN AS A_HEADER_CART_TOKEN
  ,O.A_CHECKOUT_TOKEN AS A_HEADER_CHECKOUT_TOKEN
  ,O.A_CLIENT_DETAILS AS A_HEADER_CLIENT_DETAILS
  ,O.A_CLOSED_AT_DTS AS A_HEADER_CLOSED_AT_DTS
  ,O.A_CREATED_AT_DTS AS A_HEADER_CREATED_AT_DTS
  ,O.A_CURRENCY AS A_HEADER_CURRENCY
  ,O.A_PRESENTMENT_CURRENCY AS A_HEADER_PRESENTMENT_CURRENCY
  ,O.A_CUSTOMER_LOCALE AS A_HEADER_CUSTOMER_LOCALE
  ,O.A_EMAIL AS A_HEADER_EMAIL
  ,O.A_FINANCIAL_STATUS AS A_HEADER_FINANCIAL_STATUS
  ,O.A_FULFILLMENT_STATUS AS A_HEADER_FULFILLMENT_STATUS
  ,O.A_LANDING_SITE_BASE_URL AS A_HEADER_LANDING_SITE_BASE_URL
  ,O.A_LANDING_SITE_REF AS A_HEADER_LANDING_SITE_REF
  ,O.A_NAME AS A_HEADER_NAME
  ,O.A_NOTE AS A_HEADER_NOTE
  ,O.A_NOTE_ATTRIBUTES AS A_HEADER_NOTE_ATTRIBUTES
  ,O.A_PAYMENT_GATEWAY_NAMES AS A_HEADER_PAYMENT_GATEWAY_NAMES
  ,O.A_PROCESSED_AT_DTS AS A_HEADER_PROCESSED_AT_DTS
  ,O.A_PROCESSING_METHOD AS A_HEADER_PROCESSING_METHOD
  ,O.A_REFERENCE AS A_HEADER_REFERENCE
  ,O.A_REFERRING_SITE AS A_HEADER_REFERRING_SITE
  ,O.A_SOURCE_NAME AS A_HEADER_SOURCE_NAME
  ,O.A_SOURCE_URL AS A_HEADER_SOURCE_URL
  ,O.A_ORDER_NUMBER AS A_HEADER_ORDER_NUMBER
  ,O.A_POSION_NUMBER AS A_HEADER_POSION_NUMBER
  ,O.A_UPDATED_AT_DTS AS A_HEADER_UPDATED_AT_DTS
  ,O.B_BUYER_ACCEPTS_MARKETING AS B_HEADER_BUYER_ACCEPTS_MARKETING
  ,O.B_CONFIRMED AS B_HEADER_CONFIRMED
  ,O.B_TAXES_INCLUDED  AS B_HEADER_TAXES_INCLUDED   
  ,OLI.A_FULFILLMENT_SERVICE AS A_ITEM_FULFILLMENT_SERVICE
  ,OLI.A_FULFILLMENT_STATUS AS A_ITEM_FULFILLMENT_STATUS
  ,OLI.A_NAME AS A_ITEM_NAME
  ,OLI.A_PROPERTIES AS A_ITEM_PROPERTIES
  ,OLI.A_SKU AS A_ITEM_SKU
  ,OLI.A_TITLE AS A_ITEM_TITLE  
  ,OLI.A_VARIANT_INVENTORY_MANAGEMENT AS A_ITEM_VARIANT_INVENTORY_MANAGEMENT
  ,OLI.A_VARIANT_TITLE AS A_ITEM_VARIANT_TITLE
  ,OLI.A_VENDOR AS A_ITEM_VENDOR
  ,OLI.B_GIFT_CARD AS B_ITEM_GIFT_CARD
  ,OLI.B_PRODUCT_EXISTS AS B_ITEM_PRODUCT_EXISTS
  ,OLI.B_REQUIRES_SHIPPING AS B_ITEM_REQUIRES_SHIPPING
  ,OLI.B_TAXABLE AS B_ITEM_TAXABLE
  ,OLI.M_FULFILLABLE_QUANTITY AS M_ITEM_FULFILLABLE_QUANTITY
  ,OLI.M_GRAMS AS M_ITEM_GRAMS
  ,OLI.M_QUANTITY AS M_ITEM_QUANTITY
  ,OLI.M_UNIT_PRICE AS M_ITEM_UNIT_PRICE
  ,OLI.M_UNIT_PRICE_PRIMARY AS M_ITEM_UNIT_PRICE_PRIMARY
  ,OLI.M_TOTAL_PRICE AS M_ITEM_TOTAL_PRICE
  ,OLI.M_TOTAL_PRICE_PRIMARY AS M_ITEM_TOTAL_PRICE_PRIMARY
  ,OLI.M_TOTAL_DISCOUNT AS M_ITEM_TOTAL_DISCOUNT
  ,OLI.M_TOTAL_DISCOUNT_PRIMARY AS M_ITEM_TOTAL_DISCOUNT_PRIMARY
  ,OLI.M_TAX_AMOUNT AS M_TAX_AMOUNT
  ,OLI.M_TAX_AMOUNT_PRIMARY AS M_TAX_AMOUNT_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_TIP_RECEIVED * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_TIP_AMOUNT_PRIMARY  
  --,ROUND(DIV0((O.M_TOTAL_DISCOUNTS_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_HEADER_DISCOUNT
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE * OLI.M_TOTAL_PRICE),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE



   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'36e04cbb-d882-41af-a65d-fd2ae2567729' AS MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG OLI ON OLI.K_ORDER_DLHK = O.K_ORDER_DLHK
      );
2022-03-03 13:32:36.763769 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:32:39.897875 (Thread-1): SQL status: SUCCESS 1 in 3.13 seconds
2022-03-03 13:32:39.902231 (Thread-1): finished collecting timing info
2022-03-03 13:32:39.902684 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-03 13:32:40.370936 (Thread-1): 10:32:40 | 24 of 25 OK created table model DBT_SHOPIFY.W_ORDERS_F............... [SUCCESS 1 in 3.62s]
2022-03-03 13:32:40.371408 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:32:40.371617 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:32:40.371779 (Thread-1): 10:32:40 | 25 of 25 START table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F........ [RUN]
2022-03-03 13:32:40.371977 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:32:40.372086 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:32:40.374549 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-03 13:32:40.375058 (Thread-1): finished collecting timing info
2022-03-03 13:32:40.376620 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-03 13:32:40.377330 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:32:40.377439 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCT_COLLECTION_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG AS C
      );
2022-03-03 13:32:40.377544 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:32:43.104433 (Thread-1): SQL status: SUCCESS 1 in 2.73 seconds
2022-03-03 13:32:43.107449 (Thread-1): finished collecting timing info
2022-03-03 13:32:43.107874 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: Close
2022-03-03 13:32:43.623224 (Thread-1): 10:32:43 | 25 of 25 OK created table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F... [SUCCESS 1 in 3.25s]
2022-03-03 13:32:43.623484 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:32:43.627423 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 13:32:43.628398 (MainThread): 10:32:43 | 
2022-03-03 13:32:43.628674 (MainThread): 10:32:43 | Finished running 16 view models, 9 table models in 68.95s.
2022-03-03 13:32:43.628792 (MainThread): Connection 'master' was properly closed.
2022-03-03 13:32:43.628872 (MainThread): Connection 'model.snowflake_aicd.W_PRODUCT_COLLECTION_F' was properly closed.
2022-03-03 13:32:43.636689 (MainThread): 
2022-03-03 13:32:43.636875 (MainThread): Completed with 1 error and 0 warnings:
2022-03-03 13:32:43.636980 (MainThread): 
2022-03-03 13:32:43.637083 (MainThread): Database Error in model V_CUSTOMER_STG (models/staging/CUSTOMERS/V_CUSTOMER_STG.sql)
2022-03-03 13:32:43.637175 (MainThread):   001003 (42000): SQL compilation error:
2022-03-03 13:32:43.637261 (MainThread):   syntax error line 24 at position 5 unexpected ','.
2022-03-03 13:32:43.637346 (MainThread):   compiled SQL at target/run/snowflake_aicd/models/staging/CUSTOMERS/V_CUSTOMER_STG.sql
2022-03-03 13:32:43.637468 (MainThread): 
Done. PASS=21 WARN=0 ERROR=1 SKIP=3 TOTAL=25
2022-03-03 13:32:43.637666 (MainThread): Flushing usage events
2022-03-03 13:34:02.977211 (MainThread): Running with dbt=0.21.1
2022-03-03 13:34:03.551218 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-03 13:34:03.552764 (MainThread): Tracking: do not track
2022-03-03 13:34:03.563057 (MainThread): Partial parsing not enabled
2022-03-03 13:34:03.583435 (MainThread): Parsing macros/common.sql
2022-03-03 13:34:03.586439 (MainThread): Parsing macros/catalog.sql
2022-03-03 13:34:03.588161 (MainThread): Parsing macros/adapters.sql
2022-03-03 13:34:03.619328 (MainThread): Parsing macros/materializations/merge.sql
2022-03-03 13:34:03.622530 (MainThread): Parsing macros/materializations/seed.sql
2022-03-03 13:34:03.626217 (MainThread): Parsing macros/materializations/view.sql
2022-03-03 13:34:03.627266 (MainThread): Parsing macros/materializations/table.sql
2022-03-03 13:34:03.629681 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-03 13:34:03.636593 (MainThread): Parsing macros/core.sql
2022-03-03 13:34:03.639501 (MainThread): Parsing macros/materializations/test.sql
2022-03-03 13:34:03.644836 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-03 13:34:03.652660 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-03 13:34:03.653972 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-03 13:34:03.667921 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-03 13:34:03.696610 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-03 13:34:03.715595 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-03 13:34:03.717007 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-03 13:34:03.725355 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-03 13:34:03.742429 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-03 13:34:03.754167 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-03 13:34:03.760958 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-03 13:34:03.767106 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-03 13:34:03.770322 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-03 13:34:03.771505 (MainThread): Parsing macros/etc/query.sql
2022-03-03 13:34:03.772222 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-03 13:34:03.773360 (MainThread): Parsing macros/etc/datetime.sql
2022-03-03 13:34:03.780293 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-03 13:34:03.781803 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-03 13:34:03.783715 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-03 13:34:03.784934 (MainThread): Parsing macros/adapters/common.sql
2022-03-03 13:34:03.831310 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-03 13:34:03.832714 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-03 13:34:03.833596 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-03 13:34:03.834598 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-03 13:34:03.983030 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:34:03.991876 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:03.994800 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:34:03.997822 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:03.998693 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:34:04.001607 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.002366 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:34:04.007200 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.008001 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:34:04.011193 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.011944 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:34:04.015105 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.015836 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:34:04.018572 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.019329 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:34:04.021976 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.022763 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:34:04.025378 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.026143 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:34:04.030027 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.030790 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:34:04.033820 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.034557 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:34:04.039311 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.040096 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:34:04.045620 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.046391 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:34:04.049266 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.050003 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:34:04.053296 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.054032 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:34:04.057543 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.058280 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:34:04.061197 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.061933 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:34:04.064944 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.065673 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:34:04.103619 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.104464 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:34:04.107023 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.107744 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:34:04.109943 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.110644 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:34:04.113008 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.114012 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:34:04.116809 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.117595 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:34:04.120006 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.120767 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:34:04.123176 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.143579 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.144878 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.146019 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.147617 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.149124 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.150346 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.151557 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.152770 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:34:04.188721 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-03 13:34:04.189413 (MainThread): Found 25 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 23 sources, 0 exposures
2022-03-03 13:34:04.191634 (MainThread): 
2022-03-03 13:34:04.191901 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 13:34:04.193366 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 13:34:04.203254 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 13:34:04.203403 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-03 13:34:04.203497 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-03 13:34:06.293544 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 2.09 seconds
2022-03-03 13:34:06.297322 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-03 13:34:06.757827 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 13:34:06.762816 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 13:34:06.762955 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-03 13:34:06.763055 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-03 13:34:08.501665 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 26 in 1.74 seconds
2022-03-03 13:34:08.510967 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-03 13:34:08.964668 (MainThread): 10:34:08 | Concurrency: 1 threads (target='dev')
2022-03-03 13:34:08.965294 (MainThread): 10:34:08 | 
2022-03-03 13:34:08.966626 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:34:08.966867 (Thread-1): 10:34:08 | 1 of 25 START view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG.......... [RUN]
2022-03-03 13:34:08.967098 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:34:08.967209 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:34:08.969463 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-03 13:34:08.970192 (Thread-1): finished collecting timing info
2022-03-03 13:34:08.989147 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-03 13:34:08.991145 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:34:08.991354 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER_ADDRESS"
),
rename AS 
(   
SELECT 
    MD5(ID) AS K_CUSTOMER_ADDRESS_DLHK
    ,ID AS K_CUSTOMER_ADDRESS_BK
    ,MD5(CONCAT(
        COALESCE(ADDRESS1,'00'),
        COALESCE(ADDRESS2,'00'),
        COALESCE(CITY,'00'),
        COALESCE(COUNTRY,'00'),
        COALESCE(COUNTRY_CODE,'00'),
        COALESCE(FIRST_NAME,'00'),
        COALESCE(LAST_NAME,'00'),
        COALESCE(PROVINCE,'00'),
        COALESCE(PROVINCE_CODE,'00'),
        COALESCE(ZIP,'00')
    )) AS K_ADDRESS_DLHK
    ,CUSTOMER_ID AS K_CUSTOMER_BK
    ,ADDRESS1 AS A_ADDRESS1
    ,ADDRESS2 AS A_ADDRESS2
    ,CITY AS A_CITY
    ,COMPANY AS A_COMPANY
    ,COUNTRY AS A_COUNTRY
    ,COUNTRY_CODE AS A_COUNTRY_CODE
    ,COUNTRY_NAME AS A_COUNTRY_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,PHONE AS A_PHONE
    ,PROVINCE AS A_PROVINCE
    ,PROVINCE_CODE AS A_PROVINCE_CODE
    ,ZIP AS A_ZIP
    ,IS_DEFAULT AS B_IS_DEFAULT  
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-03 13:34:08.991483 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:10.643488 (Thread-1): SQL status: SUCCESS 1 in 1.65 seconds
2022-03-03 13:34:10.680503 (Thread-1): finished collecting timing info
2022-03-03 13:34:10.680788 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: Close
2022-03-03 13:34:11.323605 (Thread-1): 10:34:11 | 1 of 25 OK created view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG..... [SUCCESS 1 in 2.36s]
2022-03-03 13:34:11.324452 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:34:11.325277 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:34:11.326856 (Thread-1): 10:34:11 | 2 of 25 START view model DBT_SHOPIFY.V_CUSTOMER_STG.................. [RUN]
2022-03-03 13:34:11.328027 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:34:11.328733 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:34:11.342588 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-03 13:34:11.343671 (Thread-1): finished collecting timing info
2022-03-03 13:34:11.345234 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-03 13:34:11.347722 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:34:11.347899 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER"
),
rename AS 
(   
SELECT 
    --KEYS
    MD5(ID) AS K_CUSTOMER_DLHK    
    --BUSINESS KEYS
    ,ID AS K_CUSTOMER_BK
    ,LAST_ORDER_ID AS K_LAST_ORDER_BK
    ,MULTIPASS_IDENTIFIER AS K_MULTIPASS_BKENTIFIER
    --ATTRIBUTES
    ,ACCEPTS_MARKETING_UPDATED_AT AS A_ACCEPTS_MARKETING_UPDATED_AT_DTS
    ,CREATED_AT AS A_CREATED_AT_DTS
    ,CURRENCY AS A_CURRENCY
    ,EMAIL AS A_EMAIL
    ,
    (COALESCE(FIRST_NAME,'') || ' ' || COALESCE(LAST_NAME,''))
 AS A_FULL_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,LAST_ORDER_NAME AS A_LAST_ORDER_NAME
    ,MARKETING_OPT_IN_LEVEL AS A_MARKETING_OPT_IN_LEVEL
    ,NOTE AS A_NOTE
    ,PHONE AS A_PHONE
    ,SMS_MARKETING_CONSENT AS A_SMS_MARKETING_CONSENT
    ,STATE AS A_STATE
    ,TAGS AS A_TAGS
    ,TAX_EXEMPTIONS AS A_TAX_EXEMPTIONS
    ,TOTAL_SPENT AS A_TOTAL_SPENT
    ,UPDATED_AT AS A_UPDATED_AT
    --BOOLEAN
    ,ACCEPTS_MARKETING AS B_ACCEPTS_MARKETING
    ,TAX_EXEMPT AS B_TAX_EXEMPT
    ,VERIFIED_EMAIL AS B_VERIFIED_EMAIL
    --METRICS
    ,ORDERS_COUNT AS M_ORDERS_COUNT
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-03 13:34:11.348016 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:13.093123 (Thread-1): SQL status: SUCCESS 1 in 1.75 seconds
2022-03-03 13:34:13.096071 (Thread-1): finished collecting timing info
2022-03-03 13:34:13.096530 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-03 13:34:13.569397 (Thread-1): 10:34:13 | 2 of 25 OK created view model DBT_SHOPIFY.V_CUSTOMER_STG............. [SUCCESS 1 in 2.24s]
2022-03-03 13:34:13.569999 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:34:13.570559 (Thread-1): Began running node model.snowflake_aicd.V_DATE_STG
2022-03-03 13:34:13.571217 (Thread-1): 10:34:13 | 3 of 25 START view model DBT_SHOPIFY.V_DATE_STG...................... [RUN]
2022-03-03 13:34:13.572294 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:34:13.572872 (Thread-1): Compiling model.snowflake_aicd.V_DATE_STG
2022-03-03 13:34:13.589715 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-03 13:34:13.590298 (Thread-1): finished collecting timing info
2022-03-03 13:34:13.591754 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-03 13:34:13.612859 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:34:13.613048 (Thread-1): On model.snowflake_aicd.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-03 13:34:13.613221 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:15.706735 (Thread-1): SQL status: SUCCESS 1 in 2.09 seconds
2022-03-03 13:34:15.710222 (Thread-1): finished collecting timing info
2022-03-03 13:34:15.710675 (Thread-1): On model.snowflake_aicd.V_DATE_STG: Close
2022-03-03 13:34:16.160382 (Thread-1): 10:34:16 | 3 of 25 OK created view model DBT_SHOPIFY.V_DATE_STG................. [SUCCESS 1 in 2.59s]
2022-03-03 13:34:16.161156 (Thread-1): Finished running node model.snowflake_aicd.V_DATE_STG
2022-03-03 13:34:16.161861 (Thread-1): Began running node model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:34:16.162730 (Thread-1): 10:34:16 | 4 of 25 START view model DBT_SHOPIFY.V_LOCATION_STG.................. [RUN]
2022-03-03 13:34:16.163712 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:34:16.164541 (Thread-1): Compiling model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:34:16.175639 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-03 13:34:16.176276 (Thread-1): finished collecting timing info
2022-03-03 13:34:16.177783 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-03 13:34:16.179244 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:34:16.179339 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:34:16.179436 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:18.040823 (Thread-1): SQL status: SUCCESS 1 in 1.86 seconds
2022-03-03 13:34:18.043866 (Thread-1): finished collecting timing info
2022-03-03 13:34:18.044052 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-03 13:34:18.590680 (Thread-1): 10:34:18 | 4 of 25 OK created view model DBT_SHOPIFY.V_LOCATION_STG............. [SUCCESS 1 in 2.43s]
2022-03-03 13:34:18.591174 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:34:18.591671 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:34:18.592259 (Thread-1): 10:34:18 | 5 of 25 START view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG......... [RUN]
2022-03-03 13:34:18.594156 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:34:18.594579 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:34:18.605892 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-03 13:34:18.606368 (Thread-1): finished collecting timing info
2022-03-03 13:34:18.608229 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-03 13:34:18.610453 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:34:18.610564 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_ADJUSTMENT" AS A
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_ADJUSTMENT_DLHK
  --BK
  ,ID AS K_ORDER_ADJUSTMENT_BK
  ,ORDER_ID AS K_ORDER_BK
  ,REFUND_ID AS K_REFUND_BK
  --ATTRIBUTE
  ,KIND AS A_KIND
  ,REASON AS A_REASON
  --METRIC
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT_PRIMARY
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-03 13:34:18.610671 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:20.455213 (Thread-1): SQL status: SUCCESS 1 in 1.84 seconds
2022-03-03 13:34:20.458080 (Thread-1): finished collecting timing info
2022-03-03 13:34:20.458451 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: Close
2022-03-03 13:34:20.961569 (Thread-1): 10:34:20 | 5 of 25 OK created view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG.... [SUCCESS 1 in 2.37s]
2022-03-03 13:34:20.962225 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:34:20.963142 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:34:20.968092 (Thread-1): 10:34:20 | 6 of 25 START view model DBT_SHOPIFY.V_ORDERS_HEADER_STG............. [RUN]
2022-03-03 13:34:20.969487 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:34:20.969997 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:34:20.979036 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-03 13:34:20.979476 (Thread-1): finished collecting timing info
2022-03-03 13:34:20.981002 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-03 13:34:20.989629 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:34:20.989813 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDERS" AS A
),
rename AS 
(
SELECT
    MD5(O.ID) AS K_ORDER_DLHK    
    ,MD5(O.CUSTOMER_ID) AS K_CUSTOMER_DLHK
    ,MD5(O.LOCATION_ID) AS K_LOCATION_DLHK    
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
    --BUSINESS_KEYS
    ,O.APP_ID AS K_APP_BK
    ,O.ID AS K_ORDER_BK
    ,O.CUSTOMER_ID AS K_CUSTOMER_BK
    ,O.DEVICE_ID AS K_DEVICE_BK  
    ,O.LOCATION_ID AS K_LOCATION_BK
    ,O.SOURCE_IDENTIFIER AS K_SOURCE_ENTIFIER_BK
    --ATTRIBUTES
    ,O.BROWSER_IP AS A_BROWSER_IP
    ,O.CANCELLED_AT AS A_CANCELLED_AT_DTS
    ,O.CANCEL_REASON AS A_CANCEL_REASON
    ,O.CART_TOKEN AS A_CART_TOKEN
    ,O.CHECKOUT_TOKEN AS A_CHECKOUT_TOKEN
    ,O.CLIENT_DETAILS AS A_CLIENT_DETAILS
    ,O.CLOSED_AT AS A_CLOSED_AT_DTS
    ,O.CREATED_AT AS A_CREATED_AT_DTS
    ,O.CURRENCY AS A_CURRENCY
    ,O.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
    ,O.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
    ,O.EMAIL AS A_EMAIL
    ,O.FINANCIAL_STATUS AS A_FINANCIAL_STATUS
    ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
    ,O.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
    ,O.LANDING_SITE_REF AS A_LANDING_SITE_REF
    ,O.NAME AS A_NAME
    ,O.NOTE AS A_NOTE
    ,O.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES    
    ,O.PAYMENT_GATEWAY_NAMES AS A_PAYMENT_GATEWAY_NAMES    
    ,O.PROCESSED_AT AS A_PROCESSED_AT_DTS
    ,O.PROCESSING_METHOD AS A_PROCESSING_METHOD
    ,O.REFERENCE AS A_REFERENCE
    ,O.REFERRING_SITE AS A_REFERRING_SITE    
    ,O.SOURCE_NAME AS A_SOURCE_NAME
    ,O.SOURCE_URL AS A_SOURCE_URL    
    ,O.ORDER_NUMBER AS A_ORDER_NUMBER
    ,O.POSION_NUMBER AS A_POSION_NUMBER  
    ,O.UPDATED_AT AS A_UPDATED_AT_DTS
    --BOOLEAN
    ,O.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
    ,O.CONFIRMED AS B_CONFIRMED
    ,O.TAXES_INCLUDED AS B_TAXES_INCLUDED
    --METRICS
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE_PRIMARY 
    ,O.TOTAL_TIP_RECEIVED::DECIMAL(15,2) AS M_TOTAL_TIP_RECEIVED   
    ,O.TOTAL_WEIGHT::DECIMAL(15,2) AS M_TOTAL_WEIGHT
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
FROM source O
)

SELECT * FROM rename
  );
2022-03-03 13:34:20.989955 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:22.846901 (Thread-1): SQL status: SUCCESS 1 in 1.86 seconds
2022-03-03 13:34:22.870100 (Thread-1): finished collecting timing info
2022-03-03 13:34:22.871111 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: Close
2022-03-03 13:34:23.337893 (Thread-1): 10:34:23 | 6 of 25 OK created view model DBT_SHOPIFY.V_ORDERS_HEADER_STG........ [SUCCESS 1 in 2.37s]
2022-03-03 13:34:23.338145 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:34:23.338366 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:34:23.338534 (Thread-1): 10:34:23 | 7 of 25 START view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG.. [RUN]
2022-03-03 13:34:23.338805 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:34:23.339344 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:34:23.344396 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-03 13:34:23.350760 (Thread-1): finished collecting timing info
2022-03-03 13:34:23.352618 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-03 13:34:23.354598 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:34:23.354731 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM_TAX_LINE" AS A
),
rename AS 
(
SELECT
  CONCAT(COALESCE(ORDER_ID,'0000000000'),'-',COALESCE(ORDER_LINE_ID,'0000000000')) AS K_ORDER_LINE_ITEM_TAX_DLHK
  ,ORDER_ID AS K_ORDER_BK
  ,ORDER_LINE_ID AS K_ORDER_LINE_ITEM_BK
  ,TITLE AS A_TITLE
  ,CHANNEL_LIABLE AS B_CHANNEL_LIABLE
  ,RATE AS M_RATE
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-03 13:34:23.354841 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:25.236646 (Thread-1): SQL status: SUCCESS 1 in 1.88 seconds
2022-03-03 13:34:25.242311 (Thread-1): finished collecting timing info
2022-03-03 13:34:25.242835 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: Close
2022-03-03 13:34:25.696460 (Thread-1): 10:34:25 | 7 of 25 OK created view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG [SUCCESS 1 in 2.36s]
2022-03-03 13:34:25.696990 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:34:25.697540 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:34:25.698355 (Thread-1): 10:34:25 | 8 of 25 START view model DBT_SHOPIFY.V_PRODUCT_STG................... [RUN]
2022-03-03 13:34:25.699118 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:34:25.699762 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:34:25.713930 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-03 13:34:25.714708 (Thread-1): finished collecting timing info
2022-03-03 13:34:25.717382 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-03 13:34:25.721795 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:34:25.722030 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_DLHK
  ,ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE
  ,HANDLE AS A_HANDLE
  ,PRODUCT_TYPE AS A_PRODUCT_TYPE
  ,VENDOR AS A_VENDOR
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE
  ,STATUS AS A_STATUS
  ,TEMPLATE_SUFFIX AS A_TEMPLATE_SUFFIX   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:34:25.722264 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:29.173773 (Thread-1): SQL status: SUCCESS 1 in 3.45 seconds
2022-03-03 13:34:29.180786 (Thread-1): finished collecting timing info
2022-03-03 13:34:29.181328 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: Close
2022-03-03 13:34:29.677618 (Thread-1): 10:34:29 | 8 of 25 OK created view model DBT_SHOPIFY.V_PRODUCT_STG.............. [SUCCESS 1 in 3.98s]
2022-03-03 13:34:29.678124 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:34:29.678794 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:34:29.679579 (Thread-1): 10:34:29 | 9 of 25 START view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG........... [RUN]
2022-03-03 13:34:29.680368 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:34:29.680923 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:34:29.698486 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-03 13:34:29.699012 (Thread-1): finished collecting timing info
2022-03-03 13:34:29.700497 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-03 13:34:29.702649 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:34:29.702753 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT_VARIANT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_VARIANT_DLHK
  ,MD5(PRODUCT_ID) AS K_PRODUCT_DLHK  
  --BUSINESS KEYS  
  ,ID AS K_PRODUCT_VARIANT_BK
  ,PRODUCT_ID AS K_PRODUCT_BK  
  ,INVENTORY_ITEM_ID AS K_INVENTORY_ITEM_BK
  ,IMAGE_ID AS K_IMAGE_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE  
  ,SKU AS A_SKU    
  ,FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,INVENTORY_MANAGEMENT AS A_INVENTORY_MANAGEMENT
  ,INVENTORY_POLICY AS A_INVENTORY_POLICY
  ,BARCODE AS A_BARCODE
  ,GRAMS AS A_GRAMS
  ,WEIGHT_UNIT AS A_WEIGHT_UNIT
  ,OPTION_1 AS A_OPTION_1
  ,OPTION_2 AS A_OPTION_2
  ,OPTION_3 AS A_OPTION_3
  ,TAX_CODE AS A_TAX_CODE  
  ,PRESENTMENT_PRICES AS A_PRESENTMENT_PRICES  
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  --BOOLEAN
  ,REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,TAXABLE AS B_TAXABLE
  --METRICS
  ,PRICE AS M_PRICE
  ,POSITION AS M_POSITION
  ,COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,INVENTORY_QUANTITY AS M_INVENTORY_QUANTITY
  ,INVENTORY_QUANTITY_ADJUSTMENT AS M_INVENTORY_QUANTITY_ADJUSTMENT
  ,WEIGHT AS M_WEIGHT
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:34:29.702859 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:31.736598 (Thread-1): SQL status: SUCCESS 1 in 2.03 seconds
2022-03-03 13:34:31.740348 (Thread-1): finished collecting timing info
2022-03-03 13:34:31.740910 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: Close
2022-03-03 13:34:32.224424 (Thread-1): 10:34:32 | 9 of 25 OK created view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG...... [SUCCESS 1 in 2.54s]
2022-03-03 13:34:32.225101 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:34:32.225629 (Thread-1): Began running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:34:32.227140 (Thread-1): 10:34:32 | 10 of 25 START view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG......... [RUN]
2022-03-03 13:34:32.232731 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:34:32.233213 (Thread-1): Compiling model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:34:32.242291 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-03 13:34:32.242921 (Thread-1): finished collecting timing info
2022-03-03 13:34:32.244344 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-03 13:34:32.246794 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:34:32.246891 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG  as (
    


WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND" AS A
),
refund_line as (
    SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND_LINE_ITEM" AS A
),
rename AS 
(
SELECT
  MD5(RL.ID) AS K_REFUND_LINE_DLHK
  ,MD5(R.ID) AS K_REFUND_DLHK
  ,R.ID AS K_REFUND_BK
  ,RL.ID AS K_REFUND_LINE_BK
  ,R.ORDER_ID AS K_ORDER_BK
  ,R.USER_ID AS K_USER_BK
  ,RL.LOCATION_ID AS K_LOCATION_BK
  ,RL.LINE_ITEM_ID AS K_ORDER_LINE_ITEM_BK
  ,R.NOTE AS A_NOTE
  ,R.RESTOCK AS B_RESTOCK
  ,RL.QUANTITY AS M_QUANTITY
  ,RL.RESTOCK_TYPE AS A_RESTOCK_TYPE
   
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL


  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
FROM source R
LEFT JOIN refund_line RL ON RL.REFUND_ID = R.ID
)

SELECT * FROM rename
  );
2022-03-03 13:34:32.246992 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:36.675273 (Thread-1): SQL status: SUCCESS 1 in 4.43 seconds
2022-03-03 13:34:36.683428 (Thread-1): finished collecting timing info
2022-03-03 13:34:36.685375 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: Close
2022-03-03 13:34:37.122233 (Thread-1): 10:34:37 | 10 of 25 OK created view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG.... [SUCCESS 1 in 4.89s]
2022-03-03 13:34:37.122714 (Thread-1): Finished running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:34:37.123270 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:34:37.124039 (Thread-1): 10:34:37 | 11 of 25 START table model DBT_SHOPIFY.W_CUSTOMERS_D................. [RUN]
2022-03-03 13:34:37.124897 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:34:37.125401 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:34:37.141125 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-03 13:34:37.142445 (Thread-1): finished collecting timing info
2022-03-03 13:34:37.161125 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-03 13:34:37.161882 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:34:37.161987 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG AS C
      );
2022-03-03 13:34:37.162085 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:39.935149 (Thread-1): SQL status: SUCCESS 1 in 2.77 seconds
2022-03-03 13:34:39.953026 (Thread-1): finished collecting timing info
2022-03-03 13:34:39.953699 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-03 13:34:40.398348 (Thread-1): 10:34:40 | 11 of 25 OK created table model DBT_SHOPIFY.W_CUSTOMERS_D............ [SUCCESS 1 in 3.27s]
2022-03-03 13:34:40.398818 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:34:40.408062 (Thread-1): Began running node model.snowflake_aicd.W_DATE_D
2022-03-03 13:34:40.409247 (Thread-1): 10:34:40 | 12 of 25 START table model DBT_SHOPIFY.W_DATE_D...................... [RUN]
2022-03-03 13:34:40.410438 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:34:40.410895 (Thread-1): Compiling model.snowflake_aicd.W_DATE_D
2022-03-03 13:34:40.415162 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-03 13:34:40.415570 (Thread-1): finished collecting timing info
2022-03-03 13:34:40.416978 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-03 13:34:40.420003 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:34:40.420141 (Thread-1): On model.snowflake_aicd.W_DATE_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_DATE_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_DATE_D  as
      (

SELECT 
	CAST(DATE_KEY AS NUMBER(9)) AS K_DATE_INTEGER_BK
	,CAST(DATE_COLUMN AS DATE) AS K_DATE_BK
	,CAST(FULL_DATE_DESC AS VARCHAR(64)) AS A_FULL_DATE_DESC
	,CAST(DAY_NUM_IN_WEEK AS NUMBER(1)) AS A_DAY_NUM_IN_WEEK
	,CAST(DAY_NUM_IN_MONTH AS NUMBER(2)) AS A_DAY_NUM_IN_MONTH
	,CAST(DAY_NUM_IN_YEAR AS NUMBER(3)) AS A_DAY_NUM_IN_YEAR
	,CAST(DAY_NAME AS VARCHAR(10)) AS A_DAY_NAME
	,CAST(DAY_ABBREV AS VARCHAR(3)) AS A_DAY_ABBREV
	,CAST(WEEKDAY_IND AS VARCHAR(64)) AS A_WEEKDAY_IND
	,CAST(US_HOLIDAY_IND AS VARCHAR(64)) AS A_US_HOLIDAY_IND
	,CAST(COMPANY_HOLIDAY_IND AS VARCHAR(64)) AS A_COMPANY_HOLIDAY_IND
	,CAST(MONTH_END_IND AS VARCHAR(64)) AS A_MONTH_END_IND
	,CAST(WEEK_BEGIN_DATE_NKEY AS NUMBER(9)) AS A_WEEK_BEGIN_DATE_NKEY
	,CAST(WEEK_BEGIN_DATE AS DATE) AS A_WEEK_BEGIN_DATE
	,CAST(WEEK_END_DATE_NKEY AS NUMBER(9)) AS A_WEEK_END_DATE_NKEY
	,CAST(WEEK_END_DATE AS DATE) AS A_WEEK_END_DATE
	,CAST(WEEK_NUM_IN_YEAR AS NUMBER(9)) AS A_WEEK_NUM_IN_YEAR
	,CAST(MONTH_NAME AS VARCHAR(10)) AS A_MONTH_NAME
	,CAST(MONTH_ABBREV AS VARCHAR(3)) AS A_MONTH_ABBREV
	,CAST(MONTH_NUM_IN_YEAR AS NUMBER(2)) AS A_MONTH_NUM_IN_YEAR
	,CAST(YEARMONTH AS VARCHAR(10)) AS A_YEARMONTH
	,CAST(CURRENT_QUARTER AS NUMBER(1)) AS A_QUARTER
	,CAST(YEARQUARTER AS VARCHAR(10)) AS A_YEARQUARTER
	,CAST(CURRENT_YEAR AS NUMBER(5)) AS A_YEAR
	,CAST(FISCAL_WEEK_NUM AS NUMBER(2)) AS A_FISCAL_WEEK_NUM
	,CAST(FISCAL_MONTH_NUM AS NUMBER(2)) AS A_FISCAL_MONTH_NUM
	,CAST(FISCAL_YEARMONTH AS VARCHAR(10)) AS A_FISCAL_YEARMONTH
	,CAST(FISCAL_QUARTER AS NUMBER(1)) AS A_FISCAL_QUARTER
	,CAST(FISCAL_YEARQUARTER AS VARCHAR(10)) AS A_FISCAL_YEARQUARTER
	,CAST(FISCAL_HALFYEAR AS NUMBER(1)) AS A_FISCAL_HALFYEAR
	,CAST(FISCAL_YEAR AS NUMBER(5)) AS A_FISCAL_YEAR
	,CAST(SQL_TIMESTAMP AS TIMESTAMP_NTZ) AS A_SQL_TIMESTAMP_DTS
	,CAST(CURRENT_ROW_IND AS CHAR(1)) AS A_CURRENT_ROW_IND
	,CAST(EFFECTIVE_DATE AS DATE) AS A_EFFECTIVE_DATE
	,CAST(EXPIRA_DATE AS DATE) AS A_EXPIRATION_DATE
FROM
DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG
      );
2022-03-03 13:34:40.420251 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:44.222131 (Thread-1): SQL status: SUCCESS 1 in 3.80 seconds
2022-03-03 13:34:44.227045 (Thread-1): finished collecting timing info
2022-03-03 13:34:44.227473 (Thread-1): On model.snowflake_aicd.W_DATE_D: Close
2022-03-03 13:34:44.672954 (Thread-1): 10:34:44 | 12 of 25 OK created table model DBT_SHOPIFY.W_DATE_D................. [SUCCESS 1 in 4.26s]
2022-03-03 13:34:44.673634 (Thread-1): Finished running node model.snowflake_aicd.W_DATE_D
2022-03-03 13:34:44.674241 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:34:44.674918 (Thread-1): 10:34:44 | 13 of 25 START table model DBT_SHOPIFY.W_LOCATION_D.................. [RUN]
2022-03-03 13:34:44.675809 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:34:44.676301 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:34:44.684095 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-03 13:34:44.684486 (Thread-1): finished collecting timing info
2022-03-03 13:34:44.685957 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-03 13:34:44.686684 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:34:44.686783 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-03 13:34:44.686880 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:47.122175 (Thread-1): SQL status: SUCCESS 1 in 2.44 seconds
2022-03-03 13:34:47.123857 (Thread-1): finished collecting timing info
2022-03-03 13:34:47.124113 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-03 13:34:47.599646 (Thread-1): 10:34:47 | 13 of 25 OK created table model DBT_SHOPIFY.W_LOCATION_D............. [SUCCESS 1 in 2.92s]
2022-03-03 13:34:47.600438 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:34:47.601161 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:34:47.606059 (Thread-1): 10:34:47 | 14 of 25 START view model DBT_SHOPIFY.V_PRODUCTS_D_STG............... [RUN]
2022-03-03 13:34:47.611175 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:34:47.612287 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:34:47.616078 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-03 13:34:47.617697 (Thread-1): finished collecting timing info
2022-03-03 13:34:47.619618 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-03 13:34:47.623948 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:34:47.624111 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCTS_D_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG  as (
    
 

WITH product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG
),
product_variant AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG
),

rename as (


SELECT
    MD5(CONCAT(P.K_PRODUCT_BK,'-',COALESCE(V.K_PRODUCT_VARIANT_BK,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
    ,P.K_PRODUCT_DLHK
    ,V.K_PRODUCT_VARIANT_DLHK AS K_PRODUCT_VARIANT_DLHK
    ,V.K_PRODUCT_VARIANT_BK AS K_PRODUCT_VARIANT_BK
    ,P.K_PRODUCT_BK AS K_PRODUCT_BK
    ,V.K_INVENTORY_ITEM_BK AS K_VARIANT_INVENTORY_ITEM_BK
    ,V.K_IMAGE_BK AS K_VARIANT_IMAGE_BK
    --ATTRIBUTES
    ,P.A_TITLE
    ,P.A_HANDLE
    ,P.A_PRODUCT_TYPE
    ,P.A_VENDOR
    ,P.A_CREATED_AT_DTS
    ,P.A_UPDATED_AT_DTS
    ,P.A_PUBLISHED_AT_DTS
    ,P.A_PUBLISHED_SCOPE
    ,P.A_STATUS
    ,P.A_TEMPLATE_SUFFIX       
    ,V.A_TITLE AS A_VARIANT_TITLE
    ,V.A_SKU AS A_VARIANT_SKU
    ,V.A_FULFILLMENT_SERVICE AS A_VARIANT_FULFILLMENT_SERVICE
    ,V.A_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
    ,V.A_BARCODE AS A_VARIANT_BARCODE
    ,V.A_INVENTORY_POLICY AS A_VARIANT_INVENTORY_POLICY
    ,V.A_GRAMS AS A_VARIANT_GRAMS
    ,V.A_WEIGHT_UNIT AS A_VARIANT_WEIGHT_UNIT
    ,V.A_OPTION_1 AS A_VARIANT_OPTION_1
    ,V.A_OPTION_2 AS A_VARIANT_OPTION_2
    ,V.A_OPTION_3 AS A_VARIANT_OPTION_3
    ,V.A_TAX_CODE AS A_VARIANT_TAX_CODE
    ,V.A_PRESENTMENT_PRICES AS A_VARIANT_PRESENTMENT_PRICES
    ,V.A_CREATED_AT_DTS AS A_VARIANT_CREATED_AT_DTS
    ,V.A_UPDATED_AT_DTS AS A_VARIANT_UPDATED_AT_DTS
    --BOOLEAN
    ,V.B_REQUIRES_SHIPPING AS B_VARIANT_REQUIRES_SHIPPING
    ,V.B_TAXABLE AS B_VARIANT_TAXABLE
    --METRICS
    ,V.M_PRICE AS M_VARIANT_PRICE
    ,V.M_POSITION AS M_VARIANT_POSITION
    ,V.M_COMPARE_AT_PRICE AS M_VARIANT_COMPARE_AT_PRICE
    ,V.M_INVENTORY_QUANTITY AS M_VARIANT_INVENTORY_QUANTITY
    ,V.M_INVENTORY_QUANTITY_ADJUSTMENT AS M_VARIANT_INVENTORY_QUANTITY_ADJUSTMENT
    ,V.M_WEIGHT AS M_VARIANT_WEIGHT
    --metadata (MD)
    ,P.MD_IS_DELETED AS MD_IS_DELETED_PRODUCT
    ,V.MD_IS_DELETED AS MD_IS_DELETED_VARIANT
    , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
    , 'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
FROM
    product P
    LEFT JOIN product_variant V ON V.K_PRODUCT_BK = P.K_PRODUCT_BK
)

SELECT * FROM rename
  );
2022-03-03 13:34:47.624225 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:49.289453 (Thread-1): SQL status: SUCCESS 1 in 1.67 seconds
2022-03-03 13:34:49.295150 (Thread-1): finished collecting timing info
2022-03-03 13:34:49.295666 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: Close
2022-03-03 13:34:49.767807 (Thread-1): 10:34:49 | 14 of 25 OK created view model DBT_SHOPIFY.V_PRODUCTS_D_STG.......... [SUCCESS 1 in 2.16s]
2022-03-03 13:34:49.768326 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:34:49.768829 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:34:49.771031 (Thread-1): 10:34:49 | 15 of 25 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG....... [RUN]
2022-03-03 13:34:49.772264 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:34:49.772753 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:34:49.783856 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-03 13:34:49.784274 (Thread-1): finished collecting timing info
2022-03-03 13:34:49.786017 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-03 13:34:49.792059 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:34:49.792248 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT"
),
customer AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 

  MD5(S.ID) AS K_ABANDONED_CHECKOUT_DLHK
  ,C.K_CUSTOMER_DLHK
  ,L.K_LOCATION_DLHK
  ,MD5(S.USER_ID) AS K_USER_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK  
  ,S.ID AS K_ABANDONED_CHECKOUT_BK
  ,S.CUSTOMER_ID AS K_CUSTOMER_BK
  ,S.DEVICE_ID AS K_DEVICE_BK
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.SOURCE_IDENTIFIER AS K_SOURCE_BKENTIFIER
  ,S.USER_ID AS K_USER_BK
  ,S.ABANDONED_CHECKOUT_URL AS A_ABANDONED_CHECKOUT_URL  
  ,S.CART_TOKEN AS A_CART_TOKEN
  ,S.CLOSED_AT AS A_CLOSED_AT
  ,S.COMPLETED_AT AS A_COMPLETED_AT
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
  ,S.EMAIL AS A_EMAIL
  ,S.GATEWAY AS A_GATEWAY
  ,S.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
  ,S.NAME AS A_NAME
  ,S.NOTE AS A_NOTE
  ,S.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES
  ,S.PHONE AS A_PHONE
  ,S.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
  ,S.REFERRING_SITE AS A_REFERRING_SITE    
  ,S.SOURCE AS A_SOURCE
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.SOURCE_URL AS A_SOURCE_URL
  ,S.TOKEN AS A_TOKEN
  ,S.UPDATED_AT AS A_UPDATED_AT  
  --BOOLEAN
  ,S.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
  ,S.TAXES_INCLUDED AS B_TAXES_INCLUDED
  --METRIC
  ,S.SUBTOTAL_PRICE::decimal(15,2) AS M_SUBTOTAL_PRICE
  ,S.TOTAL_DISCOUNTS::decimal(15,2) AS M_TOTAL_DISCOUNTS
  ,S.TOTAL_DUTIES::decimal(15,2) AS M_TOTAL_DUTIES
  ,S.TOTAL_LINE_ITEMS_PRICE::decimal(15,2) AS M_TOTAL_LINE_ITEMS_PRICE
  ,S.TOTAL_PRICE::decimal(15,2) AS M_TOTAL_PRICE
  ,S.TOTAL_TAX::decimal(15,2) AS M_TOTAL_TAX
  ,S.TOTAL_WEIGHT::decimal(15,2) AS M_TOTAL_WEIGHT
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
  FROM
      source S
      left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
      left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-03 13:34:49.792371 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:51.629435 (Thread-1): SQL status: SUCCESS 1 in 1.84 seconds
2022-03-03 13:34:51.633877 (Thread-1): finished collecting timing info
2022-03-03 13:34:51.634389 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: Close
2022-03-03 13:34:52.100826 (Thread-1): 10:34:52 | 15 of 25 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.. [SUCCESS 1 in 2.33s]
2022-03-03 13:34:52.101038 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:34:52.101185 (Thread-1): Began running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:34:52.101637 (Thread-1): 10:34:52 | 16 of 25 START view model DBT_SHOPIFY.V_TRANSACTIONS_STG............. [RUN]
2022-03-03 13:34:52.102069 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:34:52.102299 (Thread-1): Compiling model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:34:52.105737 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-03 13:34:52.106184 (Thread-1): finished collecting timing info
2022-03-03 13:34:52.107887 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-03 13:34:52.110287 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:34:52.110436 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_TRANSACTIONS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."TRANSACTION"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_TRANSACTION_DLHK
  ,L.K_LOCATION_DLHK  
  ,MD5(S.USER_ID) AS K_USER_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_TRANSACTION_BK
  ,S.DEVICE_ID AS K_DEVICE_BK  
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.ORDER_ID AS K_ORDER_BK
  ,S.PARENT_ID AS K_PARENT_BK
  ,S.REFUND_ID AS K_REFUND_BK
  ,S.USER_ID AS K_USER_BK  
  --ATTRIBUTES
  ,S.AUTHORIZATION AS A_AUTHORIZATION
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CURRENCY_EXCHANGE_ADJUSTMENT AS A_CURRENCY_EXCHANGE_ADJUSTMENT
  ,S.ERROR_CODE AS A_ERROR_CODE
  ,S.GATEWAY AS A_GATEWAY
  ,S.KIND AS A_KIND
  ,S.MESSAGE AS A_MESSAGE
  ,S.PAYMENT_DETAILS AS A_PAYMENT_DETAILS
  ,S.PROCESSED_AT AS A_PROCESSED_AT
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.STATUS AS A_STATUS
  --boolean
  ,S.TEST AS B_TEST
  --METRICS
  ,S.AMOUNT::decimal(15,2) AS M_AMOUNT   
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
  FROM
    source S  
  left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-03 13:34:52.110553 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:53.746321 (Thread-1): SQL status: SUCCESS 1 in 1.64 seconds
2022-03-03 13:34:53.755851 (Thread-1): finished collecting timing info
2022-03-03 13:34:53.756458 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: Close
2022-03-03 13:34:54.258236 (Thread-1): 10:34:54 | 16 of 25 OK created view model DBT_SHOPIFY.V_TRANSACTIONS_STG........ [SUCCESS 1 in 2.16s]
2022-03-03 13:34:54.258443 (Thread-1): Finished running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:34:54.258588 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:34:54.258831 (Thread-1): 10:34:54 | 17 of 25 START table model DBT_SHOPIFY.W_PRODUCTS_D.................. [RUN]
2022-03-03 13:34:54.259048 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:34:54.259156 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:34:54.262036 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-03 13:34:54.262442 (Thread-1): finished collecting timing info
2022-03-03 13:34:54.263970 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-03 13:34:54.282602 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:34:54.283187 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCTS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG AS C
      );
2022-03-03 13:34:54.283455 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:34:56.698815 (Thread-1): SQL status: SUCCESS 1 in 2.42 seconds
2022-03-03 13:34:56.700908 (Thread-1): finished collecting timing info
2022-03-03 13:34:56.701071 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: Close
2022-03-03 13:35:00.175199 (Thread-1): 10:35:00 | 17 of 25 OK created table model DBT_SHOPIFY.W_PRODUCTS_D............. [SUCCESS 1 in 5.92s]
2022-03-03 13:35:00.176179 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:35:00.176725 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:35:00.177509 (Thread-1): 10:35:00 | 18 of 25 START table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F........ [RUN]
2022-03-03 13:35:00.178528 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:35:00.179148 (Thread-1): Compiling model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:35:00.190598 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-03 13:35:00.191050 (Thread-1): finished collecting timing info
2022-03-03 13:35:00.192476 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-03 13:35:00.193339 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:35:00.193515 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG AS C
      );
2022-03-03 13:35:00.193664 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:35:03.228069 (Thread-1): SQL status: SUCCESS 1 in 3.03 seconds
2022-03-03 13:35:03.232193 (Thread-1): finished collecting timing info
2022-03-03 13:35:03.232710 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: Close
2022-03-03 13:35:03.697128 (Thread-1): 10:35:03 | 18 of 25 OK created table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F... [SUCCESS 1 in 3.52s]
2022-03-03 13:35:03.697606 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:35:03.698073 (Thread-1): Began running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:35:03.698678 (Thread-1): 10:35:03 | 19 of 25 START table model DBT_SHOPIFY.W_TRANSACTIONS_F.............. [RUN]
2022-03-03 13:35:03.699564 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:35:03.700083 (Thread-1): Compiling model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:35:03.713513 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-03 13:35:03.714029 (Thread-1): finished collecting timing info
2022-03-03 13:35:03.715491 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-03 13:35:03.716275 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:35:03.716399 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_TRANSACTIONS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_TRANSACTIONS_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG AS C
      );
2022-03-03 13:35:03.716512 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:35:06.236983 (Thread-1): SQL status: SUCCESS 1 in 2.52 seconds
2022-03-03 13:35:06.241494 (Thread-1): finished collecting timing info
2022-03-03 13:35:06.242253 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: Close
2022-03-03 13:35:06.710237 (Thread-1): 10:35:06 | 19 of 25 OK created table model DBT_SHOPIFY.W_TRANSACTIONS_F......... [SUCCESS 1 in 3.01s]
2022-03-03 13:35:06.710788 (Thread-1): Finished running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:35:06.711152 (Thread-1): Began running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:35:06.714564 (Thread-1): 10:35:06 | 20 of 25 START view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG........... [RUN]
2022-03-03 13:35:06.717053 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:35:06.717210 (Thread-1): Compiling model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:35:06.722532 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-03 13:35:06.722971 (Thread-1): finished collecting timing info
2022-03-03 13:35:06.724421 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-03 13:35:06.726457 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:35:06.726558 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_INVENTORY_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_ITEM"
),
inventory_level AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_LEVEL"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
products AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename AS 
(   
  SELECT   
  MD5(S.ID) AS K_INVENTORY_ITEM_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
  ,L.K_LOCATION_DLHK
  ,L.K_LOCATION_BK  
  ,S.ID AS K_INVENTORY_ITEM_BK
  ,S.COUNTRY_CODE_OF_ORIGIN AS A_COUNTRY_CODE_OF_ORIGIN
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.PROVINCE_CODE_OF_ORIGIN AS A_PROVINCE_CODE_OF_ORIGIN
  ,S.SKU AS A_SKU
  ,S.UPDATED_AT AS A_UPDATED_AT
  ,S.HARMONIZED_SYSTEM_CODE AS A_HARMONIZED_SYSTEM_CODE  
  --BOOLEAN
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TRACKED AS B_TRACKED
  --METRICS
  ,S.COST::decimal(15,2) AS M_COST 
  ,IL.AVAILABLE AS M_AVAIABLE  
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
  FROM
      source S
      left join inventory_level IL ON IL.INVENTORY_ITEM_ID = S.ID      
      left join locations L ON L.K_LOCATION_BK = IL.LOCATION_ID
      left join products P ON P.K_VARIANT_INVENTORY_ITEM_BK = S.ID 
)


SELECT * FROM rename
  );
2022-03-03 13:35:06.726661 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:35:08.728225 (Thread-1): SQL status: SUCCESS 1 in 2.00 seconds
2022-03-03 13:35:08.731969 (Thread-1): finished collecting timing info
2022-03-03 13:35:08.732474 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: Close
2022-03-03 13:35:09.179582 (Thread-1): 10:35:09 | 20 of 25 OK created view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG...... [SUCCESS 1 in 2.46s]
2022-03-03 13:35:09.180213 (Thread-1): Finished running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:35:09.180594 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:35:09.181309 (Thread-1): 10:35:09 | 21 of 25 START view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG......... [RUN]
2022-03-03 13:35:09.182135 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:35:09.182600 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:35:09.193492 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-03 13:35:09.193949 (Thread-1): finished collecting timing info
2022-03-03 13:35:09.195370 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-03 13:35:09.199315 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:35:09.199427 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM" AS A
),
products AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D AS A
),
taxes AS (
  SELECT 
      K_ORDER_LINE_ITEM_BK,
      AVG(M_RATE) AS M_RATE,
      SUM(M_TAX) AS M_TAX,
      SUM(M_TAX_PRIMARY) AS M_TAX_PRIMARY
    FROM 
      DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG AS A
    GROUP BY K_ORDER_LINE_ITEM_BK
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_LINE_ITEM_DLHK  
  ,MD5(ORDER_ID) AS K_ORDER_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
 --business keys
  ,O.PRODUCT_ID AS K_PRODUCT_BK
  ,O.VARIANT_ID AS K_VARIANT_BK
  
  ,O.ORDER_ID AS K_ORDER_BK
  ,O.ID AS K_ORDER_LINE_ITEM_BK
  --attribubtes
  ,O.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
  ,O.NAME AS A_NAME  
  ,O.PROPERTIES AS A_PROPERTIES
  ,O.SKU AS A_SKU
  ,O.TITLE AS A_TITLE  
  ,O.VARIANT_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
  ,O.VARIANT_TITLE AS A_VARIANT_TITLE
  ,O.VENDOR AS A_VENDOR
  --boolean
  ,O.GIFT_CARD AS B_GIFT_CARD
  ,O.PRODUCT_EXISTS AS B_PRODUCT_EXISTS
  ,O.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,O.TAXABLE AS B_TAXABLE
  --metrics
  ,O.FULFILLABLE_QUANTITY AS M_FULFILLABLE_QUANTITY
  ,O.GRAMS::DECIMAL(15,2) AS M_GRAMS
  ,O.QUANTITY::DECIMAL(15,2) AS M_QUANTITY
  ,M_RATE AS M_TAX_RATE
  ,COALESCE(T.M_TAX_PRIMARY,0)::DECIMAL(15,2) AS M_TAX_AMOUNT
  ,COALESCE(T.M_TAX,0)::DECIMAL(15,2) AS M_TAX_AMOUNT_PRIMARY

  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE_PRIMARY 
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT_PRIMARY 
  ,(O.QUANTITY * M_UNIT_PRICE)::DECIMAL(15,2) AS M_TOTAL_PRICE  
  ,(O.QUANTITY * M_UNIT_PRICE_PRIMARY)::DECIMAL(15,2) AS M_TOTAL_PRICE_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
FROM source O
  left join products P ON P.K_PRODUCT_BK = O.PRODUCT_ID AND CASE WHEN O.VARIANT_ID IS NOT NULL THEN O.VARIANT_ID = P.K_PRODUCT_VARIANT_BK ELSE 1=1 END
  left join taxes T ON T.K_ORDER_LINE_ITEM_BK = O.ID
)

SELECT * FROM rename
  );
2022-03-03 13:35:09.199538 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:35:10.950652 (Thread-1): SQL status: SUCCESS 1 in 1.75 seconds
2022-03-03 13:35:10.965429 (Thread-1): finished collecting timing info
2022-03-03 13:35:10.965749 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: Close
2022-03-03 13:35:11.413152 (Thread-1): 10:35:11 | 21 of 25 OK created view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG.... [SUCCESS 1 in 2.23s]
2022-03-03 13:35:11.414140 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:35:11.415045 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:35:11.416191 (Thread-1): 10:35:11 | 22 of 25 START view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG....... [RUN]
2022-03-03 13:35:11.421165 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:35:11.421999 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:35:11.433071 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-03 13:35:11.433632 (Thread-1): finished collecting timing info
2022-03-03 13:35:11.435150 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-03 13:35:11.437382 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:35:11.437521 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECT"
),
source_collection AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECTION"
),
product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename as (

SELECT
  MD5(S.ID) AS K_PRODUCT_COLLECT_DLHK
  ,MD5(CC.ID) AS K_COLLECTION_DLHK
  ,P.K_PRODUCT_DLHK  
  ,S.ID AS K_PRODUCT_COLLECT_BK
  ,CC.ID AS K_COLLECTION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,S.POSITION AS A_POSITION
  ,S.SORT_ORDER AS A_SORT_ORDER  
  ,S.CREATED_AT AS A_CREATED_AT_DTS
  ,S.UPDATED_AT AS A_UPDATED_AT_DTS
  ,CC.PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,CC.BODY_HTML AS A_BODY_HTML
  ,CC.TITLE AS A_TITLE
  ,CC.HANDLE AS A_HANDLE
  ,CC.PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE  
  ,CC.COLLECTION_TYPE AS A_COLLECTION_TYPE  
  --metrics
  ,CC.PRODUCTS_COUNT AS M_PRODUCTS_COUNT
  --metadata (MD)
  ,S.__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
FROM
    source S
    LEFT JOIN source_collection CC ON CC.ID = S.COLLECTION_ID
    LEFT JOIN product P ON P.K_PRODUCT_BK = S.PRODUCT_ID
)

SELECT * FROM rename
  );
2022-03-03 13:35:11.437638 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:35:13.328183 (Thread-1): SQL status: SUCCESS 1 in 1.89 seconds
2022-03-03 13:35:13.331154 (Thread-1): finished collecting timing info
2022-03-03 13:35:13.331645 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: Close
2022-03-03 13:35:13.794631 (Thread-1): 10:35:13 | 22 of 25 OK created view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG.. [SUCCESS 1 in 2.38s]
2022-03-03 13:35:13.795139 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:35:13.795500 (Thread-1): Began running node model.snowflake_aicd.W_INVENTORY_F
2022-03-03 13:35:13.799379 (Thread-1): 10:35:13 | 23 of 25 START table model DBT_SHOPIFY.W_INVENTORY_F................. [RUN]
2022-03-03 13:35:13.803729 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:35:13.804256 (Thread-1): Compiling model.snowflake_aicd.W_INVENTORY_F
2022-03-03 13:35:13.807734 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-03 13:35:13.808384 (Thread-1): finished collecting timing info
2022-03-03 13:35:13.809899 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-03 13:35:13.810528 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:35:13.810629 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_INVENTORY_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_INVENTORY_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG AS C
      );
2022-03-03 13:35:13.810732 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:35:16.746113 (Thread-1): SQL status: SUCCESS 1 in 2.94 seconds
2022-03-03 13:35:16.751706 (Thread-1): finished collecting timing info
2022-03-03 13:35:16.752251 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: Close
2022-03-03 13:35:17.199152 (Thread-1): 10:35:17 | 23 of 25 OK created table model DBT_SHOPIFY.W_INVENTORY_F............ [SUCCESS 1 in 3.40s]
2022-03-03 13:35:17.199617 (Thread-1): Finished running node model.snowflake_aicd.W_INVENTORY_F
2022-03-03 13:35:17.200184 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:35:17.212925 (Thread-1): 10:35:17 | 24 of 25 START table model DBT_SHOPIFY.W_ORDERS_F.................... [RUN]
2022-03-03 13:35:17.213261 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:35:17.213385 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:35:17.217327 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-03 13:35:17.217954 (Thread-1): finished collecting timing info
2022-03-03 13:35:17.219732 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-03 13:35:17.225399 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:35:17.225546 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ORDERS_F  as
      (

SELECT
  O.K_ORDER_DLHK AS K_ORDER_DLHK
  ,OLI.K_ORDER_LINE_ITEM_DLHK AS K_ORDER_LINE_ITEM_DLHK
  ,O.K_CUSTOMER_DLHK AS K_CUSTOMER_DLHK
  ,O.K_LOCATION_DLHK AS K_LOCATION_DLHK
  ,O.K_BILLING_ADDRESS_DLHK AS K_BILLING_ADDRESS_DLHK
  ,O.K_SHIPPING_ADDRESS_DLHK AS K_SHIPPING_ADDRESS_DLHK
  ,OLI.K_PRODUCT_VARIATION_DLHK AS K_ITEM_PRODUCT_VARIATION_DLHK
  ,OLI.K_PRODUCT_BK AS K_ITEM_PRODUCT_BK
  ,OLI.K_VARIANT_BK AS K_ITEM_VARIANT_BK
  ,OLI.K_ORDER_BK AS K_ITEM_ORDER_BK
  ,O.K_ORDER_BK AS K_ORDER_BK
  ,OLI.K_ORDER_LINE_ITEM_BK AS K_ITEM_ORDER_LINE_ITEM_BK
  ,O.K_APP_BK AS K_HEADER_APP_BK
  
  ,O.K_CUSTOMER_BK AS K_CUSTOMER_BK
  ,O.K_DEVICE_BK AS K_DEVICE_BK
  ,O.K_LOCATION_BK AS K_LOCATION_BK
  ,O.K_SOURCE_ENTIFIER_BK AS K_SOURCE_ENTIFIER_BK
  ,O.A_BROWSER_IP AS A_HEADER_BROWSER_IP
  ,O.A_CANCELLED_AT_DTS AS A_HEADER_CANCELLED_AT_DTS
  ,O.A_CANCEL_REASON AS A_HEADER_CANCEL_REASON
  ,O.A_CART_TOKEN AS A_HEADER_CART_TOKEN
  ,O.A_CHECKOUT_TOKEN AS A_HEADER_CHECKOUT_TOKEN
  ,O.A_CLIENT_DETAILS AS A_HEADER_CLIENT_DETAILS
  ,O.A_CLOSED_AT_DTS AS A_HEADER_CLOSED_AT_DTS
  ,O.A_CREATED_AT_DTS AS A_HEADER_CREATED_AT_DTS
  ,O.A_CURRENCY AS A_HEADER_CURRENCY
  ,O.A_PRESENTMENT_CURRENCY AS A_HEADER_PRESENTMENT_CURRENCY
  ,O.A_CUSTOMER_LOCALE AS A_HEADER_CUSTOMER_LOCALE
  ,O.A_EMAIL AS A_HEADER_EMAIL
  ,O.A_FINANCIAL_STATUS AS A_HEADER_FINANCIAL_STATUS
  ,O.A_FULFILLMENT_STATUS AS A_HEADER_FULFILLMENT_STATUS
  ,O.A_LANDING_SITE_BASE_URL AS A_HEADER_LANDING_SITE_BASE_URL
  ,O.A_LANDING_SITE_REF AS A_HEADER_LANDING_SITE_REF
  ,O.A_NAME AS A_HEADER_NAME
  ,O.A_NOTE AS A_HEADER_NOTE
  ,O.A_NOTE_ATTRIBUTES AS A_HEADER_NOTE_ATTRIBUTES
  ,O.A_PAYMENT_GATEWAY_NAMES AS A_HEADER_PAYMENT_GATEWAY_NAMES
  ,O.A_PROCESSED_AT_DTS AS A_HEADER_PROCESSED_AT_DTS
  ,O.A_PROCESSING_METHOD AS A_HEADER_PROCESSING_METHOD
  ,O.A_REFERENCE AS A_HEADER_REFERENCE
  ,O.A_REFERRING_SITE AS A_HEADER_REFERRING_SITE
  ,O.A_SOURCE_NAME AS A_HEADER_SOURCE_NAME
  ,O.A_SOURCE_URL AS A_HEADER_SOURCE_URL
  ,O.A_ORDER_NUMBER AS A_HEADER_ORDER_NUMBER
  ,O.A_POSION_NUMBER AS A_HEADER_POSION_NUMBER
  ,O.A_UPDATED_AT_DTS AS A_HEADER_UPDATED_AT_DTS
  ,O.B_BUYER_ACCEPTS_MARKETING AS B_HEADER_BUYER_ACCEPTS_MARKETING
  ,O.B_CONFIRMED AS B_HEADER_CONFIRMED
  ,O.B_TAXES_INCLUDED  AS B_HEADER_TAXES_INCLUDED   
  ,OLI.A_FULFILLMENT_SERVICE AS A_ITEM_FULFILLMENT_SERVICE
  ,OLI.A_FULFILLMENT_STATUS AS A_ITEM_FULFILLMENT_STATUS
  ,OLI.A_NAME AS A_ITEM_NAME
  ,OLI.A_PROPERTIES AS A_ITEM_PROPERTIES
  ,OLI.A_SKU AS A_ITEM_SKU
  ,OLI.A_TITLE AS A_ITEM_TITLE  
  ,OLI.A_VARIANT_INVENTORY_MANAGEMENT AS A_ITEM_VARIANT_INVENTORY_MANAGEMENT
  ,OLI.A_VARIANT_TITLE AS A_ITEM_VARIANT_TITLE
  ,OLI.A_VENDOR AS A_ITEM_VENDOR
  ,OLI.B_GIFT_CARD AS B_ITEM_GIFT_CARD
  ,OLI.B_PRODUCT_EXISTS AS B_ITEM_PRODUCT_EXISTS
  ,OLI.B_REQUIRES_SHIPPING AS B_ITEM_REQUIRES_SHIPPING
  ,OLI.B_TAXABLE AS B_ITEM_TAXABLE
  ,OLI.M_FULFILLABLE_QUANTITY AS M_ITEM_FULFILLABLE_QUANTITY
  ,OLI.M_GRAMS AS M_ITEM_GRAMS
  ,OLI.M_QUANTITY AS M_ITEM_QUANTITY
  ,OLI.M_UNIT_PRICE AS M_ITEM_UNIT_PRICE
  ,OLI.M_UNIT_PRICE_PRIMARY AS M_ITEM_UNIT_PRICE_PRIMARY
  ,OLI.M_TOTAL_PRICE AS M_ITEM_TOTAL_PRICE
  ,OLI.M_TOTAL_PRICE_PRIMARY AS M_ITEM_TOTAL_PRICE_PRIMARY
  ,OLI.M_TOTAL_DISCOUNT AS M_ITEM_TOTAL_DISCOUNT
  ,OLI.M_TOTAL_DISCOUNT_PRIMARY AS M_ITEM_TOTAL_DISCOUNT_PRIMARY
  ,OLI.M_TAX_AMOUNT AS M_TAX_AMOUNT
  ,OLI.M_TAX_AMOUNT_PRIMARY AS M_TAX_AMOUNT_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_TIP_RECEIVED * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_TIP_AMOUNT_PRIMARY  
  --,ROUND(DIV0((O.M_TOTAL_DISCOUNTS_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_HEADER_DISCOUNT
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE * OLI.M_TOTAL_PRICE),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE



   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fc1cc01a-eb72-4705-abc4-012095c3c4ff' AS MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG OLI ON OLI.K_ORDER_DLHK = O.K_ORDER_DLHK
      );
2022-03-03 13:35:17.225685 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:35:21.509841 (Thread-1): SQL status: SUCCESS 1 in 4.28 seconds
2022-03-03 13:35:21.513145 (Thread-1): finished collecting timing info
2022-03-03 13:35:21.513536 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-03 13:35:22.019231 (Thread-1): 10:35:22 | 24 of 25 OK created table model DBT_SHOPIFY.W_ORDERS_F............... [SUCCESS 1 in 4.81s]
2022-03-03 13:35:22.019734 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:35:22.020520 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:35:22.021597 (Thread-1): 10:35:22 | 25 of 25 START table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F........ [RUN]
2022-03-03 13:35:22.023754 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:35:22.024893 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:35:22.032930 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-03 13:35:22.034364 (Thread-1): finished collecting timing info
2022-03-03 13:35:22.035919 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-03 13:35:22.036656 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:35:22.036756 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCT_COLLECTION_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG AS C
      );
2022-03-03 13:35:22.036851 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:35:25.337699 (Thread-1): SQL status: SUCCESS 1 in 3.30 seconds
2022-03-03 13:35:25.344251 (Thread-1): finished collecting timing info
2022-03-03 13:35:25.344888 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: Close
2022-03-03 13:35:25.906218 (Thread-1): 10:35:25 | 25 of 25 OK created table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F... [SUCCESS 1 in 3.88s]
2022-03-03 13:35:25.906782 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:35:25.915462 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 13:35:25.916763 (MainThread): 10:35:25 | 
2022-03-03 13:35:25.922499 (MainThread): 10:35:25 | Finished running 16 view models, 9 table models in 81.72s.
2022-03-03 13:35:25.922644 (MainThread): Connection 'master' was properly closed.
2022-03-03 13:35:25.922736 (MainThread): Connection 'model.snowflake_aicd.W_PRODUCT_COLLECTION_F' was properly closed.
2022-03-03 13:35:25.930057 (MainThread): 
2022-03-03 13:35:25.930249 (MainThread): Completed successfully
2022-03-03 13:35:25.930515 (MainThread): 
Done. PASS=25 WARN=0 ERROR=0 SKIP=0 TOTAL=25
2022-03-03 13:35:25.930758 (MainThread): Flushing usage events
2022-03-03 13:51:02.121215 (MainThread): Running with dbt=0.21.1
2022-03-03 13:51:02.635592 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-03 13:51:02.636978 (MainThread): Tracking: do not track
2022-03-03 13:51:02.646722 (MainThread): Partial parsing not enabled
2022-03-03 13:51:02.668127 (MainThread): Parsing macros/common.sql
2022-03-03 13:51:02.671184 (MainThread): Parsing macros/catalog.sql
2022-03-03 13:51:02.673182 (MainThread): Parsing macros/adapters.sql
2022-03-03 13:51:02.703864 (MainThread): Parsing macros/materializations/merge.sql
2022-03-03 13:51:02.706948 (MainThread): Parsing macros/materializations/seed.sql
2022-03-03 13:51:02.710781 (MainThread): Parsing macros/materializations/view.sql
2022-03-03 13:51:02.711842 (MainThread): Parsing macros/materializations/table.sql
2022-03-03 13:51:02.714271 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-03 13:51:02.721465 (MainThread): Parsing macros/core.sql
2022-03-03 13:51:02.724569 (MainThread): Parsing macros/materializations/test.sql
2022-03-03 13:51:02.729858 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-03 13:51:02.737475 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-03 13:51:02.738756 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-03 13:51:02.752082 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-03 13:51:02.781643 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-03 13:51:02.800146 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-03 13:51:02.801446 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-03 13:51:02.809486 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-03 13:51:02.825804 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-03 13:51:02.837028 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-03 13:51:02.843548 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-03 13:51:02.849383 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-03 13:51:02.852252 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-03 13:51:02.853313 (MainThread): Parsing macros/etc/query.sql
2022-03-03 13:51:02.853982 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-03 13:51:02.855106 (MainThread): Parsing macros/etc/datetime.sql
2022-03-03 13:51:02.861785 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-03 13:51:02.863400 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-03 13:51:02.865428 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-03 13:51:02.866680 (MainThread): Parsing macros/adapters/common.sql
2022-03-03 13:51:02.914506 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-03 13:51:02.915843 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-03 13:51:02.916687 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-03 13:51:02.917661 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-03 13:51:03.060687 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:51:03.069025 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.071872 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:51:03.074270 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.074983 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:51:03.077535 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.078234 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:51:03.082503 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.083205 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:51:03.085995 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.086693 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:51:03.089504 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.090198 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:51:03.092804 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.093499 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:51:03.095884 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.096585 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:51:03.098936 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.099628 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:51:03.103573 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.104271 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:51:03.107111 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.107802 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:51:03.112135 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.112834 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:51:03.118128 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.118819 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:51:03.121493 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.122184 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:51:03.125308 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.126001 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:51:03.129369 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.130072 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:51:03.132915 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.133608 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:51:03.136375 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.137059 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:51:03.171656 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.172453 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:51:03.174907 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.175607 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:51:03.177735 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.178418 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:51:03.180536 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.181222 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:51:03.183349 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.184031 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:51:03.186147 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.186833 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:51:03.188956 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.208248 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.209508 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.210603 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.211710 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.212947 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.214042 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.215130 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.216233 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:51:03.250630 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-03 13:51:03.251173 (MainThread): Found 25 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 23 sources, 0 exposures
2022-03-03 13:51:03.253192 (MainThread): 
2022-03-03 13:51:03.253428 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 13:51:03.254877 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 13:51:03.264148 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 13:51:03.264298 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-03 13:51:03.264392 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-03 13:51:06.040969 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 2.78 seconds
2022-03-03 13:51:06.044268 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-03 13:51:06.534571 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 13:51:06.545440 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 13:51:06.545655 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-03 13:51:06.545830 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-03 13:51:08.233086 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 26 in 1.69 seconds
2022-03-03 13:51:08.238303 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-03 13:51:08.715372 (MainThread): 10:51:08 | Concurrency: 1 threads (target='dev')
2022-03-03 13:51:08.715625 (MainThread): 10:51:08 | 
2022-03-03 13:51:08.717051 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:51:08.717290 (Thread-1): 10:51:08 | 1 of 25 START view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG.......... [RUN]
2022-03-03 13:51:08.717524 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:51:08.717643 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:51:08.719945 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-03 13:51:08.720304 (Thread-1): finished collecting timing info
2022-03-03 13:51:08.738018 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-03 13:51:08.739989 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:51:08.740097 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER_ADDRESS"
),
rename AS 
(   
SELECT 
    MD5(ID) AS K_CUSTOMER_ADDRESS_DLHK
    ,ID AS K_CUSTOMER_ADDRESS_BK
    ,MD5(CONCAT(
        COALESCE(ADDRESS1,'00'),
        COALESCE(ADDRESS2,'00'),
        COALESCE(CITY,'00'),
        COALESCE(COUNTRY,'00'),
        COALESCE(COUNTRY_CODE,'00'),
        COALESCE(FIRST_NAME,'00'),
        COALESCE(LAST_NAME,'00'),
        COALESCE(PROVINCE,'00'),
        COALESCE(PROVINCE_CODE,'00'),
        COALESCE(ZIP,'00')
    )) AS K_ADDRESS_DLHK
    ,CUSTOMER_ID AS K_CUSTOMER_BK
    ,ADDRESS1 AS A_ADDRESS1
    ,ADDRESS2 AS A_ADDRESS2
    ,CITY AS A_CITY
    ,COMPANY AS A_COMPANY
    ,COUNTRY AS A_COUNTRY
    ,COUNTRY_CODE AS A_COUNTRY_CODE
    ,COUNTRY_NAME AS A_COUNTRY_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,PHONE AS A_PHONE
    ,PROVINCE AS A_PROVINCE
    ,PROVINCE_CODE AS A_PROVINCE_CODE
    ,ZIP AS A_ZIP
    ,IS_DEFAULT AS B_IS_DEFAULT  
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-03 13:51:08.740310 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:10.447966 (Thread-1): SQL status: SUCCESS 1 in 1.71 seconds
2022-03-03 13:51:10.454713 (Thread-1): finished collecting timing info
2022-03-03 13:51:10.454941 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: Close
2022-03-03 13:51:10.921848 (Thread-1): 10:51:10 | 1 of 25 OK created view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG..... [SUCCESS 1 in 2.20s]
2022-03-03 13:51:10.922069 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-03 13:51:10.922356 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:51:10.922563 (Thread-1): 10:51:10 | 2 of 25 START view model DBT_SHOPIFY.V_CUSTOMER_STG.................. [RUN]
2022-03-03 13:51:10.922816 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:51:10.922925 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:51:10.925789 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-03 13:51:10.926332 (Thread-1): finished collecting timing info
2022-03-03 13:51:10.927682 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-03 13:51:10.929797 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:51:10.929922 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER"
),
rename AS 
(   
SELECT 
    --KEYS
    MD5(ID) AS K_CUSTOMER_DLHK    
    --BUSINESS KEYS
    ,ID AS K_CUSTOMER_BK
    ,LAST_ORDER_ID AS K_LAST_ORDER_BK
    ,MULTIPASS_IDENTIFIER AS K_MULTIPASS_BKENTIFIER
    --ATTRIBUTES
    ,ACCEPTS_MARKETING_UPDATED_AT AS A_ACCEPTS_MARKETING_UPDATED_AT_DTS
    ,CREATED_AT AS A_CREATED_AT_DTS
    ,CURRENCY AS A_CURRENCY
    ,EMAIL AS A_EMAIL
    ,
    (COALESCE(FIRST_NAME,'') || ' ' || COALESCE(LAST_NAME,''))
 AS A_FULL_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,LAST_ORDER_NAME AS A_LAST_ORDER_NAME
    ,MARKETING_OPT_IN_LEVEL AS A_MARKETING_OPT_IN_LEVEL
    ,NOTE AS A_NOTE
    ,PHONE AS A_PHONE
    ,SMS_MARKETING_CONSENT AS A_SMS_MARKETING_CONSENT
    ,STATE AS A_STATE
    ,TAGS AS A_TAGS
    ,TAX_EXEMPTIONS AS A_TAX_EXEMPTIONS
    ,TOTAL_SPENT AS A_TOTAL_SPENT
    ,UPDATED_AT AS A_UPDATED_AT
    --BOOLEAN
    ,ACCEPTS_MARKETING AS B_ACCEPTS_MARKETING
    ,TAX_EXEMPT AS B_TAX_EXEMPT
    ,VERIFIED_EMAIL AS B_VERIFIED_EMAIL
    --METRICS
    ,ORDERS_COUNT AS M_ORDERS_COUNT
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-03 13:51:10.930027 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:12.625405 (Thread-1): SQL status: SUCCESS 1 in 1.70 seconds
2022-03-03 13:51:12.629105 (Thread-1): finished collecting timing info
2022-03-03 13:51:12.629591 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-03 13:51:13.077145 (Thread-1): 10:51:13 | 2 of 25 OK created view model DBT_SHOPIFY.V_CUSTOMER_STG............. [SUCCESS 1 in 2.15s]
2022-03-03 13:51:13.077338 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-03 13:51:13.077473 (Thread-1): Began running node model.snowflake_aicd.V_DATE_STG
2022-03-03 13:51:13.078004 (Thread-1): 10:51:13 | 3 of 25 START view model DBT_SHOPIFY.V_DATE_STG...................... [RUN]
2022-03-03 13:51:13.078474 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:51:13.078766 (Thread-1): Compiling model.snowflake_aicd.V_DATE_STG
2022-03-03 13:51:13.083630 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-03 13:51:13.084271 (Thread-1): finished collecting timing info
2022-03-03 13:51:13.086717 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-03 13:51:13.109581 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:51:13.109775 (Thread-1): On model.snowflake_aicd.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-03 13:51:13.109957 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:15.086695 (Thread-1): SQL status: SUCCESS 1 in 1.98 seconds
2022-03-03 13:51:15.089784 (Thread-1): finished collecting timing info
2022-03-03 13:51:15.090027 (Thread-1): On model.snowflake_aicd.V_DATE_STG: Close
2022-03-03 13:51:15.539828 (Thread-1): 10:51:15 | 3 of 25 OK created view model DBT_SHOPIFY.V_DATE_STG................. [SUCCESS 1 in 2.46s]
2022-03-03 13:51:15.540180 (Thread-1): Finished running node model.snowflake_aicd.V_DATE_STG
2022-03-03 13:51:15.540373 (Thread-1): Began running node model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:51:15.540573 (Thread-1): 10:51:15 | 4 of 25 START view model DBT_SHOPIFY.V_LOCATION_STG.................. [RUN]
2022-03-03 13:51:15.540816 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:51:15.540930 (Thread-1): Compiling model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:51:15.543543 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-03 13:51:15.544007 (Thread-1): finished collecting timing info
2022-03-03 13:51:15.545289 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-03 13:51:15.547140 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:51:15.547311 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:51:15.547528 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:17.357428 (Thread-1): SQL status: SUCCESS 1 in 1.81 seconds
2022-03-03 13:51:17.360647 (Thread-1): finished collecting timing info
2022-03-03 13:51:17.361149 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-03 13:51:17.836056 (Thread-1): 10:51:17 | 4 of 25 OK created view model DBT_SHOPIFY.V_LOCATION_STG............. [SUCCESS 1 in 2.30s]
2022-03-03 13:51:17.836258 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-03 13:51:17.836396 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:51:17.836663 (Thread-1): 10:51:17 | 5 of 25 START view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG......... [RUN]
2022-03-03 13:51:17.836877 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:51:17.836989 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:51:17.840651 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-03 13:51:17.841193 (Thread-1): finished collecting timing info
2022-03-03 13:51:17.842536 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-03 13:51:17.846726 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:51:17.846895 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_ADJUSTMENT" AS A
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_ADJUSTMENT_DLHK
  --BK
  ,ID AS K_ORDER_ADJUSTMENT_BK
  ,ORDER_ID AS K_ORDER_BK
  ,REFUND_ID AS K_REFUND_BK
  --ATTRIBUTE
  ,KIND AS A_KIND
  ,REASON AS A_REASON
  --METRIC
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT_PRIMARY
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-03 13:51:17.847008 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:19.481105 (Thread-1): SQL status: SUCCESS 1 in 1.63 seconds
2022-03-03 13:51:19.483396 (Thread-1): finished collecting timing info
2022-03-03 13:51:19.483627 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: Close
2022-03-03 13:51:19.966456 (Thread-1): 10:51:19 | 5 of 25 OK created view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG.... [SUCCESS 1 in 2.13s]
2022-03-03 13:51:19.967315 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-03 13:51:19.969034 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:51:19.970417 (Thread-1): 10:51:19 | 6 of 25 START view model DBT_SHOPIFY.V_ORDERS_HEADER_STG............. [RUN]
2022-03-03 13:51:19.971501 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:51:19.972200 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:51:19.985128 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-03 13:51:19.986419 (Thread-1): finished collecting timing info
2022-03-03 13:51:19.987961 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-03 13:51:19.996884 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:51:19.997029 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDERS" AS A
),
rename AS 
(
SELECT
    MD5(O.ID) AS K_ORDER_DLHK    
    ,MD5(O.CUSTOMER_ID) AS K_CUSTOMER_DLHK
    ,MD5(O.LOCATION_ID) AS K_LOCATION_DLHK    
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
    --BUSINESS_KEYS
    ,O.APP_ID AS K_APP_BK
    ,O.ID AS K_ORDER_BK
    ,O.CUSTOMER_ID AS K_CUSTOMER_BK
    ,O.DEVICE_ID AS K_DEVICE_BK  
    ,O.LOCATION_ID AS K_LOCATION_BK
    ,O.SOURCE_IDENTIFIER AS K_SOURCE_ENTIFIER_BK
    --ATTRIBUTES
    ,O.BROWSER_IP AS A_BROWSER_IP
    ,O.CANCELLED_AT AS A_CANCELLED_AT_DTS
    ,O.CANCEL_REASON AS A_CANCEL_REASON
    ,O.CART_TOKEN AS A_CART_TOKEN
    ,O.CHECKOUT_TOKEN AS A_CHECKOUT_TOKEN
    ,O.CLIENT_DETAILS AS A_CLIENT_DETAILS
    ,O.CLOSED_AT AS A_CLOSED_AT_DTS
    ,O.CREATED_AT AS A_CREATED_AT_DTS
    ,O.CURRENCY AS A_CURRENCY
    ,O.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
    ,O.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
    ,O.EMAIL AS A_EMAIL
    ,O.FINANCIAL_STATUS AS A_FINANCIAL_STATUS
    ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
    ,O.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
    ,O.LANDING_SITE_REF AS A_LANDING_SITE_REF
    ,O.NAME AS A_NAME
    ,O.NOTE AS A_NOTE
    ,O.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES    
    ,O.PAYMENT_GATEWAY_NAMES AS A_PAYMENT_GATEWAY_NAMES    
    ,O.PROCESSED_AT AS A_PROCESSED_AT_DTS
    ,O.PROCESSING_METHOD AS A_PROCESSING_METHOD
    ,O.REFERENCE AS A_REFERENCE
    ,O.REFERRING_SITE AS A_REFERRING_SITE    
    ,O.SOURCE_NAME AS A_SOURCE_NAME
    ,O.SOURCE_URL AS A_SOURCE_URL    
    ,O.ORDER_NUMBER AS A_ORDER_NUMBER
    ,O.POSION_NUMBER AS A_POSION_NUMBER  
    ,O.UPDATED_AT AS A_UPDATED_AT_DTS
    --BOOLEAN
    ,O.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
    ,O.CONFIRMED AS B_CONFIRMED
    ,O.TAXES_INCLUDED AS B_TAXES_INCLUDED
    --METRICS
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE_PRIMARY 
    ,O.TOTAL_TIP_RECEIVED::DECIMAL(15,2) AS M_TOTAL_TIP_RECEIVED   
    ,O.TOTAL_WEIGHT::DECIMAL(15,2) AS M_TOTAL_WEIGHT
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
FROM source O
)

SELECT * FROM rename
  );
2022-03-03 13:51:19.997153 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:21.907867 (Thread-1): SQL status: SUCCESS 1 in 1.91 seconds
2022-03-03 13:51:21.912311 (Thread-1): finished collecting timing info
2022-03-03 13:51:21.912758 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: Close
2022-03-03 13:51:22.390971 (Thread-1): 10:51:22 | 6 of 25 OK created view model DBT_SHOPIFY.V_ORDERS_HEADER_STG........ [SUCCESS 1 in 2.42s]
2022-03-03 13:51:22.391645 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-03 13:51:22.395179 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:51:22.396268 (Thread-1): 10:51:22 | 7 of 25 START view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG.. [RUN]
2022-03-03 13:51:22.397386 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:51:22.397944 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:51:22.405702 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-03 13:51:22.406150 (Thread-1): finished collecting timing info
2022-03-03 13:51:22.407655 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-03 13:51:22.409296 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:51:22.409401 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM_TAX_LINE" AS A
),
rename AS 
(
SELECT
  CONCAT(COALESCE(ORDER_ID,'0000000000'),'-',COALESCE(ORDER_LINE_ID,'0000000000')) AS K_ORDER_LINE_ITEM_TAX_DLHK
  ,ORDER_ID AS K_ORDER_BK
  ,ORDER_LINE_ID AS K_ORDER_LINE_ITEM_BK
  ,TITLE AS A_TITLE
  ,CHANNEL_LIABLE AS B_CHANNEL_LIABLE
  ,RATE AS M_RATE
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-03 13:51:22.409504 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:24.338004 (Thread-1): SQL status: SUCCESS 1 in 1.93 seconds
2022-03-03 13:51:24.344091 (Thread-1): finished collecting timing info
2022-03-03 13:51:24.344675 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: Close
2022-03-03 13:51:24.785185 (Thread-1): 10:51:24 | 7 of 25 OK created view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG [SUCCESS 1 in 2.39s]
2022-03-03 13:51:24.786045 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-03 13:51:24.786630 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:51:24.787393 (Thread-1): 10:51:24 | 8 of 25 START view model DBT_SHOPIFY.V_PRODUCT_STG................... [RUN]
2022-03-03 13:51:24.790053 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:51:24.793221 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:51:24.798731 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-03 13:51:24.799117 (Thread-1): finished collecting timing info
2022-03-03 13:51:24.800469 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-03 13:51:24.801902 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:51:24.802047 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_DLHK
  ,ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE
  ,HANDLE AS A_HANDLE
  ,PRODUCT_TYPE AS A_PRODUCT_TYPE
  ,VENDOR AS A_VENDOR
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE
  ,STATUS AS A_STATUS
  ,TEMPLATE_SUFFIX AS A_TEMPLATE_SUFFIX   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:51:24.802157 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:26.449948 (Thread-1): SQL status: SUCCESS 1 in 1.65 seconds
2022-03-03 13:51:26.455834 (Thread-1): finished collecting timing info
2022-03-03 13:51:26.456454 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: Close
2022-03-03 13:51:27.045384 (Thread-1): 10:51:27 | 8 of 25 OK created view model DBT_SHOPIFY.V_PRODUCT_STG.............. [SUCCESS 1 in 2.26s]
2022-03-03 13:51:27.046389 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-03 13:51:27.047229 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:51:27.048364 (Thread-1): 10:51:27 | 9 of 25 START view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG........... [RUN]
2022-03-03 13:51:27.050111 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:51:27.050716 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:51:27.061325 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-03 13:51:27.062513 (Thread-1): finished collecting timing info
2022-03-03 13:51:27.064174 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-03 13:51:27.066441 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:51:27.066557 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT_VARIANT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_VARIANT_DLHK
  ,MD5(PRODUCT_ID) AS K_PRODUCT_DLHK  
  --BUSINESS KEYS  
  ,ID AS K_PRODUCT_VARIANT_BK
  ,PRODUCT_ID AS K_PRODUCT_BK  
  ,INVENTORY_ITEM_ID AS K_INVENTORY_ITEM_BK
  ,IMAGE_ID AS K_IMAGE_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE  
  ,SKU AS A_SKU    
  ,FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,INVENTORY_MANAGEMENT AS A_INVENTORY_MANAGEMENT
  ,INVENTORY_POLICY AS A_INVENTORY_POLICY
  ,BARCODE AS A_BARCODE
  ,GRAMS AS A_GRAMS
  ,WEIGHT_UNIT AS A_WEIGHT_UNIT
  ,OPTION_1 AS A_OPTION_1
  ,OPTION_2 AS A_OPTION_2
  ,OPTION_3 AS A_OPTION_3
  ,TAX_CODE AS A_TAX_CODE  
  ,PRESENTMENT_PRICES AS A_PRESENTMENT_PRICES  
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  --BOOLEAN
  ,REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,TAXABLE AS B_TAXABLE
  --METRICS
  ,PRICE AS M_PRICE
  ,POSITION AS M_POSITION
  ,COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,INVENTORY_QUANTITY AS M_INVENTORY_QUANTITY
  ,INVENTORY_QUANTITY_ADJUSTMENT AS M_INVENTORY_QUANTITY_ADJUSTMENT
  ,WEIGHT AS M_WEIGHT
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-03 13:51:27.066659 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:28.905451 (Thread-1): SQL status: SUCCESS 1 in 1.84 seconds
2022-03-03 13:51:28.908049 (Thread-1): finished collecting timing info
2022-03-03 13:51:28.908279 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: Close
2022-03-03 13:51:29.498018 (Thread-1): 10:51:29 | 9 of 25 OK created view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG...... [SUCCESS 1 in 2.45s]
2022-03-03 13:51:29.498584 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-03 13:51:29.499006 (Thread-1): Began running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:51:29.499229 (Thread-1): 10:51:29 | 10 of 25 START view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG......... [RUN]
2022-03-03 13:51:29.499482 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:51:29.499727 (Thread-1): Compiling model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:51:29.504015 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-03 13:51:29.505405 (Thread-1): finished collecting timing info
2022-03-03 13:51:29.507232 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-03 13:51:29.511156 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:51:29.511396 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG  as (
    


WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND" AS A
),
refund_line as (
    SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND_LINE_ITEM" AS A
),
rename AS 
(
SELECT
  MD5(RL.ID) AS K_REFUND_LINE_DLHK
  ,MD5(R.ID) AS K_REFUND_DLHK
  ,R.ID AS K_REFUND_BK
  ,RL.ID AS K_REFUND_LINE_BK
  ,R.ORDER_ID AS K_ORDER_BK
  ,R.USER_ID AS K_USER_BK
  ,RL.LOCATION_ID AS K_LOCATION_BK
  ,RL.LINE_ITEM_ID AS K_ORDER_LINE_ITEM_BK
  ,R.NOTE AS A_NOTE
  ,R.RESTOCK AS B_RESTOCK
  ,RL.QUANTITY AS M_QUANTITY
  ,RL.RESTOCK_TYPE AS A_RESTOCK_TYPE
   
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL


  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
FROM source R
LEFT JOIN refund_line RL ON RL.REFUND_ID = R.ID
)

SELECT * FROM rename
  );
2022-03-03 13:51:29.511522 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:31.228241 (Thread-1): SQL status: SUCCESS 1 in 1.72 seconds
2022-03-03 13:51:31.230889 (Thread-1): finished collecting timing info
2022-03-03 13:51:31.231131 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: Close
2022-03-03 13:51:31.678386 (Thread-1): 10:51:31 | 10 of 25 OK created view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG.... [SUCCESS 1 in 2.18s]
2022-03-03 13:51:31.678648 (Thread-1): Finished running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-03 13:51:31.679109 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:51:31.679605 (Thread-1): 10:51:31 | 11 of 25 START table model DBT_SHOPIFY.W_CUSTOMERS_D................. [RUN]
2022-03-03 13:51:31.680170 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:51:31.680274 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:51:31.682813 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-03 13:51:31.683297 (Thread-1): finished collecting timing info
2022-03-03 13:51:31.698705 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-03 13:51:31.699493 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:51:31.699592 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG AS C
      );
2022-03-03 13:51:31.699686 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:35.355127 (Thread-1): SQL status: SUCCESS 1 in 3.66 seconds
2022-03-03 13:51:35.361026 (Thread-1): finished collecting timing info
2022-03-03 13:51:35.361210 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-03 13:51:35.806736 (Thread-1): 10:51:35 | 11 of 25 OK created table model DBT_SHOPIFY.W_CUSTOMERS_D............ [SUCCESS 1 in 4.13s]
2022-03-03 13:51:35.806994 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-03 13:51:35.807300 (Thread-1): Began running node model.snowflake_aicd.W_DATE_D
2022-03-03 13:51:35.807510 (Thread-1): 10:51:35 | 12 of 25 START table model DBT_SHOPIFY.W_DATE_D...................... [RUN]
2022-03-03 13:51:35.807760 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:51:35.807870 (Thread-1): Compiling model.snowflake_aicd.W_DATE_D
2022-03-03 13:51:35.810632 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-03 13:51:35.811027 (Thread-1): finished collecting timing info
2022-03-03 13:51:35.812302 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-03 13:51:35.815280 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:51:35.815407 (Thread-1): On model.snowflake_aicd.W_DATE_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_DATE_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_DATE_D  as
      (

SELECT 
	CAST(DATE_KEY AS NUMBER(9)) AS K_DATE_INTEGER_BK
	,CAST(DATE_COLUMN AS DATE) AS K_DATE_BK
	,CAST(FULL_DATE_DESC AS VARCHAR(64)) AS A_FULL_DATE_DESC
	,CAST(DAY_NUM_IN_WEEK AS NUMBER(1)) AS A_DAY_NUM_IN_WEEK
	,CAST(DAY_NUM_IN_MONTH AS NUMBER(2)) AS A_DAY_NUM_IN_MONTH
	,CAST(DAY_NUM_IN_YEAR AS NUMBER(3)) AS A_DAY_NUM_IN_YEAR
	,CAST(DAY_NAME AS VARCHAR(10)) AS A_DAY_NAME
	,CAST(DAY_ABBREV AS VARCHAR(3)) AS A_DAY_ABBREV
	,CAST(WEEKDAY_IND AS VARCHAR(64)) AS A_WEEKDAY_IND
	,CAST(US_HOLIDAY_IND AS VARCHAR(64)) AS A_US_HOLIDAY_IND
	,CAST(COMPANY_HOLIDAY_IND AS VARCHAR(64)) AS A_COMPANY_HOLIDAY_IND
	,CAST(MONTH_END_IND AS VARCHAR(64)) AS A_MONTH_END_IND
	,CAST(WEEK_BEGIN_DATE_NKEY AS NUMBER(9)) AS A_WEEK_BEGIN_DATE_NKEY
	,CAST(WEEK_BEGIN_DATE AS DATE) AS A_WEEK_BEGIN_DATE
	,CAST(WEEK_END_DATE_NKEY AS NUMBER(9)) AS A_WEEK_END_DATE_NKEY
	,CAST(WEEK_END_DATE AS DATE) AS A_WEEK_END_DATE
	,CAST(WEEK_NUM_IN_YEAR AS NUMBER(9)) AS A_WEEK_NUM_IN_YEAR
	,CAST(MONTH_NAME AS VARCHAR(10)) AS A_MONTH_NAME
	,CAST(MONTH_ABBREV AS VARCHAR(3)) AS A_MONTH_ABBREV
	,CAST(MONTH_NUM_IN_YEAR AS NUMBER(2)) AS A_MONTH_NUM_IN_YEAR
	,CAST(YEARMONTH AS VARCHAR(10)) AS A_YEARMONTH
	,CAST(CURRENT_QUARTER AS NUMBER(1)) AS A_QUARTER
	,CAST(YEARQUARTER AS VARCHAR(10)) AS A_YEARQUARTER
	,CAST(CURRENT_YEAR AS NUMBER(5)) AS A_YEAR
	,CAST(FISCAL_WEEK_NUM AS NUMBER(2)) AS A_FISCAL_WEEK_NUM
	,CAST(FISCAL_MONTH_NUM AS NUMBER(2)) AS A_FISCAL_MONTH_NUM
	,CAST(FISCAL_YEARMONTH AS VARCHAR(10)) AS A_FISCAL_YEARMONTH
	,CAST(FISCAL_QUARTER AS NUMBER(1)) AS A_FISCAL_QUARTER
	,CAST(FISCAL_YEARQUARTER AS VARCHAR(10)) AS A_FISCAL_YEARQUARTER
	,CAST(FISCAL_HALFYEAR AS NUMBER(1)) AS A_FISCAL_HALFYEAR
	,CAST(FISCAL_YEAR AS NUMBER(5)) AS A_FISCAL_YEAR
	,CAST(SQL_TIMESTAMP AS TIMESTAMP_NTZ) AS A_SQL_TIMESTAMP_DTS
	,CAST(CURRENT_ROW_IND AS CHAR(1)) AS A_CURRENT_ROW_IND
	,CAST(EFFECTIVE_DATE AS DATE) AS A_EFFECTIVE_DATE
	,CAST(EXPIRA_DATE AS DATE) AS A_EXPIRATION_DATE
FROM
DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG
      );
2022-03-03 13:51:35.815515 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:39.923520 (Thread-1): SQL status: SUCCESS 1 in 4.11 seconds
2022-03-03 13:51:39.927635 (Thread-1): finished collecting timing info
2022-03-03 13:51:39.927891 (Thread-1): On model.snowflake_aicd.W_DATE_D: Close
2022-03-03 13:51:40.393222 (Thread-1): 10:51:40 | 12 of 25 OK created table model DBT_SHOPIFY.W_DATE_D................. [SUCCESS 1 in 4.59s]
2022-03-03 13:51:40.393466 (Thread-1): Finished running node model.snowflake_aicd.W_DATE_D
2022-03-03 13:51:40.393782 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:51:40.393991 (Thread-1): 10:51:40 | 13 of 25 START table model DBT_SHOPIFY.W_LOCATION_D.................. [RUN]
2022-03-03 13:51:40.394327 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:51:40.394458 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:51:40.396983 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-03 13:51:40.397365 (Thread-1): finished collecting timing info
2022-03-03 13:51:40.398678 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-03 13:51:40.399234 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:51:40.399328 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-03 13:51:40.399419 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:42.788940 (Thread-1): SQL status: SUCCESS 1 in 2.39 seconds
2022-03-03 13:51:42.792063 (Thread-1): finished collecting timing info
2022-03-03 13:51:42.792320 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-03 13:51:43.244529 (Thread-1): 10:51:43 | 13 of 25 OK created table model DBT_SHOPIFY.W_LOCATION_D............. [SUCCESS 1 in 2.85s]
2022-03-03 13:51:43.244872 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-03 13:51:43.245285 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:51:43.245500 (Thread-1): 10:51:43 | 14 of 25 START view model DBT_SHOPIFY.V_PRODUCTS_D_STG............... [RUN]
2022-03-03 13:51:43.245798 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:51:43.245980 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:51:43.250180 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-03 13:51:43.250848 (Thread-1): finished collecting timing info
2022-03-03 13:51:43.254160 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-03 13:51:43.258437 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:51:43.258617 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCTS_D_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG  as (
    
 

WITH product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG
),
product_variant AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG
),

rename as (


SELECT
    MD5(CONCAT(P.K_PRODUCT_BK,'-',COALESCE(V.K_PRODUCT_VARIANT_BK,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
    ,P.K_PRODUCT_DLHK
    ,V.K_PRODUCT_VARIANT_DLHK AS K_PRODUCT_VARIANT_DLHK
    ,V.K_PRODUCT_VARIANT_BK AS K_PRODUCT_VARIANT_BK
    ,P.K_PRODUCT_BK AS K_PRODUCT_BK
    ,V.K_INVENTORY_ITEM_BK AS K_VARIANT_INVENTORY_ITEM_BK
    ,V.K_IMAGE_BK AS K_VARIANT_IMAGE_BK
    --ATTRIBUTES
    ,P.A_TITLE
    ,P.A_HANDLE
    ,P.A_PRODUCT_TYPE
    ,P.A_VENDOR
    ,P.A_CREATED_AT_DTS
    ,P.A_UPDATED_AT_DTS
    ,P.A_PUBLISHED_AT_DTS
    ,P.A_PUBLISHED_SCOPE
    ,P.A_STATUS
    ,P.A_TEMPLATE_SUFFIX       
    ,V.A_TITLE AS A_VARIANT_TITLE
    ,V.A_SKU AS A_VARIANT_SKU
    ,V.A_FULFILLMENT_SERVICE AS A_VARIANT_FULFILLMENT_SERVICE
    ,V.A_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
    ,V.A_BARCODE AS A_VARIANT_BARCODE
    ,V.A_INVENTORY_POLICY AS A_VARIANT_INVENTORY_POLICY
    ,V.A_GRAMS AS A_VARIANT_GRAMS
    ,V.A_WEIGHT_UNIT AS A_VARIANT_WEIGHT_UNIT
    ,V.A_OPTION_1 AS A_VARIANT_OPTION_1
    ,V.A_OPTION_2 AS A_VARIANT_OPTION_2
    ,V.A_OPTION_3 AS A_VARIANT_OPTION_3
    ,V.A_TAX_CODE AS A_VARIANT_TAX_CODE
    ,V.A_PRESENTMENT_PRICES AS A_VARIANT_PRESENTMENT_PRICES
    ,V.A_CREATED_AT_DTS AS A_VARIANT_CREATED_AT_DTS
    ,V.A_UPDATED_AT_DTS AS A_VARIANT_UPDATED_AT_DTS
    --BOOLEAN
    ,V.B_REQUIRES_SHIPPING AS B_VARIANT_REQUIRES_SHIPPING
    ,V.B_TAXABLE AS B_VARIANT_TAXABLE
    --METRICS
    ,V.M_PRICE AS M_VARIANT_PRICE
    ,V.M_POSITION AS M_VARIANT_POSITION
    ,V.M_COMPARE_AT_PRICE AS M_VARIANT_COMPARE_AT_PRICE
    ,V.M_INVENTORY_QUANTITY AS M_VARIANT_INVENTORY_QUANTITY
    ,V.M_INVENTORY_QUANTITY_ADJUSTMENT AS M_VARIANT_INVENTORY_QUANTITY_ADJUSTMENT
    ,V.M_WEIGHT AS M_VARIANT_WEIGHT
    --metadata (MD)
    ,P.MD_IS_DELETED AS MD_IS_DELETED_PRODUCT
    ,V.MD_IS_DELETED AS MD_IS_DELETED_VARIANT
    , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
    , '8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
FROM
    product P
    LEFT JOIN product_variant V ON V.K_PRODUCT_BK = P.K_PRODUCT_BK
)

SELECT * FROM rename
  );
2022-03-03 13:51:43.258743 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:45.301187 (Thread-1): SQL status: SUCCESS 1 in 2.04 seconds
2022-03-03 13:51:45.303811 (Thread-1): finished collecting timing info
2022-03-03 13:51:45.304050 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: Close
2022-03-03 13:51:45.940127 (Thread-1): 10:51:45 | 14 of 25 OK created view model DBT_SHOPIFY.V_PRODUCTS_D_STG.......... [SUCCESS 1 in 2.69s]
2022-03-03 13:51:45.940654 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-03 13:51:45.940970 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:51:45.941203 (Thread-1): 10:51:45 | 15 of 25 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG....... [RUN]
2022-03-03 13:51:45.941474 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:51:45.941587 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:51:45.945174 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-03 13:51:45.945752 (Thread-1): finished collecting timing info
2022-03-03 13:51:45.947081 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-03 13:51:45.954359 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:51:45.954549 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT"
),
customer AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 

  MD5(S.ID) AS K_ABANDONED_CHECKOUT_DLHK
  ,C.K_CUSTOMER_DLHK
  ,L.K_LOCATION_DLHK
  ,MD5(S.USER_ID) AS K_USER_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK  
  ,S.ID AS K_ABANDONED_CHECKOUT_BK
  ,S.CUSTOMER_ID AS K_CUSTOMER_BK
  ,S.DEVICE_ID AS K_DEVICE_BK
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.SOURCE_IDENTIFIER AS K_SOURCE_BKENTIFIER
  ,S.USER_ID AS K_USER_BK
  ,S.ABANDONED_CHECKOUT_URL AS A_ABANDONED_CHECKOUT_URL  
  ,S.CART_TOKEN AS A_CART_TOKEN
  ,S.CLOSED_AT AS A_CLOSED_AT
  ,S.COMPLETED_AT AS A_COMPLETED_AT
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
  ,S.EMAIL AS A_EMAIL
  ,S.GATEWAY AS A_GATEWAY
  ,S.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
  ,S.NAME AS A_NAME
  ,S.NOTE AS A_NOTE
  ,S.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES
  ,S.PHONE AS A_PHONE
  ,S.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
  ,S.REFERRING_SITE AS A_REFERRING_SITE    
  ,S.SOURCE AS A_SOURCE
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.SOURCE_URL AS A_SOURCE_URL
  ,S.TOKEN AS A_TOKEN
  ,S.UPDATED_AT AS A_UPDATED_AT  
  --BOOLEAN
  ,S.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
  ,S.TAXES_INCLUDED AS B_TAXES_INCLUDED
  --METRIC
  ,S.SUBTOTAL_PRICE::decimal(15,2) AS M_SUBTOTAL_PRICE
  ,S.TOTAL_DISCOUNTS::decimal(15,2) AS M_TOTAL_DISCOUNTS
  ,S.TOTAL_DUTIES::decimal(15,2) AS M_TOTAL_DUTIES
  ,S.TOTAL_LINE_ITEMS_PRICE::decimal(15,2) AS M_TOTAL_LINE_ITEMS_PRICE
  ,S.TOTAL_PRICE::decimal(15,2) AS M_TOTAL_PRICE
  ,S.TOTAL_TAX::decimal(15,2) AS M_TOTAL_TAX
  ,S.TOTAL_WEIGHT::decimal(15,2) AS M_TOTAL_WEIGHT
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
  FROM
      source S
      left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
      left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-03 13:51:45.954663 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:48.571281 (Thread-1): SQL status: SUCCESS 1 in 2.62 seconds
2022-03-03 13:51:48.574423 (Thread-1): finished collecting timing info
2022-03-03 13:51:48.574618 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: Close
2022-03-03 13:51:49.039604 (Thread-1): 10:51:49 | 15 of 25 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.. [SUCCESS 1 in 3.10s]
2022-03-03 13:51:49.040118 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-03 13:51:49.040546 (Thread-1): Began running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:51:49.041021 (Thread-1): 10:51:49 | 16 of 25 START view model DBT_SHOPIFY.V_TRANSACTIONS_STG............. [RUN]
2022-03-03 13:51:49.041935 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:51:49.042104 (Thread-1): Compiling model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:51:49.045142 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-03 13:51:49.047426 (Thread-1): finished collecting timing info
2022-03-03 13:51:49.048988 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-03 13:51:49.051028 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:51:49.051136 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_TRANSACTIONS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."TRANSACTION"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_TRANSACTION_DLHK
  ,L.K_LOCATION_DLHK  
  ,MD5(S.USER_ID) AS K_USER_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_TRANSACTION_BK
  ,S.DEVICE_ID AS K_DEVICE_BK  
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.ORDER_ID AS K_ORDER_BK
  ,S.PARENT_ID AS K_PARENT_BK
  ,S.REFUND_ID AS K_REFUND_BK
  ,S.USER_ID AS K_USER_BK  
  --ATTRIBUTES
  ,S.AUTHORIZATION AS A_AUTHORIZATION
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CURRENCY_EXCHANGE_ADJUSTMENT AS A_CURRENCY_EXCHANGE_ADJUSTMENT
  ,S.ERROR_CODE AS A_ERROR_CODE
  ,S.GATEWAY AS A_GATEWAY
  ,S.KIND AS A_KIND
  ,S.MESSAGE AS A_MESSAGE
  ,S.PAYMENT_DETAILS AS A_PAYMENT_DETAILS
  ,S.PROCESSED_AT AS A_PROCESSED_AT
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.STATUS AS A_STATUS
  --boolean
  ,S.TEST AS B_TEST
  --METRICS
  ,S.AMOUNT::decimal(15,2) AS M_AMOUNT   
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
  FROM
    source S  
  left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-03 13:51:49.051238 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:50.807655 (Thread-1): SQL status: SUCCESS 1 in 1.76 seconds
2022-03-03 13:51:50.810698 (Thread-1): finished collecting timing info
2022-03-03 13:51:50.810990 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: Close
2022-03-03 13:51:51.257851 (Thread-1): 10:51:51 | 16 of 25 OK created view model DBT_SHOPIFY.V_TRANSACTIONS_STG........ [SUCCESS 1 in 2.22s]
2022-03-03 13:51:51.258310 (Thread-1): Finished running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-03 13:51:51.258528 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:51:51.258964 (Thread-1): 10:51:51 | 17 of 25 START table model DBT_SHOPIFY.W_PRODUCTS_D.................. [RUN]
2022-03-03 13:51:51.259807 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:51:51.259993 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:51:51.263772 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-03 13:51:51.264290 (Thread-1): finished collecting timing info
2022-03-03 13:51:51.266099 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-03 13:51:51.266775 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:51:51.266877 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCTS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG AS C
      );
2022-03-03 13:51:51.266977 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:53.807635 (Thread-1): SQL status: SUCCESS 1 in 2.54 seconds
2022-03-03 13:51:53.808925 (Thread-1): finished collecting timing info
2022-03-03 13:51:53.809077 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: Close
2022-03-03 13:51:54.252468 (Thread-1): 10:51:54 | 17 of 25 OK created table model DBT_SHOPIFY.W_PRODUCTS_D............. [SUCCESS 1 in 2.99s]
2022-03-03 13:51:54.253605 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-03 13:51:54.254090 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:51:54.254601 (Thread-1): 10:51:54 | 18 of 25 START table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F........ [RUN]
2022-03-03 13:51:54.255363 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:51:54.255691 (Thread-1): Compiling model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:51:54.261177 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-03 13:51:54.261688 (Thread-1): finished collecting timing info
2022-03-03 13:51:54.263034 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-03 13:51:54.263655 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:51:54.263752 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG AS C
      );
2022-03-03 13:51:54.263845 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:51:57.224567 (Thread-1): SQL status: SUCCESS 1 in 2.96 seconds
2022-03-03 13:51:57.227044 (Thread-1): finished collecting timing info
2022-03-03 13:51:57.227280 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: Close
2022-03-03 13:51:57.686536 (Thread-1): 10:51:57 | 18 of 25 OK created table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F... [SUCCESS 1 in 3.43s]
2022-03-03 13:51:57.687036 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-03 13:51:57.687403 (Thread-1): Began running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:51:57.687977 (Thread-1): 10:51:57 | 19 of 25 START table model DBT_SHOPIFY.W_TRANSACTIONS_F.............. [RUN]
2022-03-03 13:51:57.688779 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:51:57.689373 (Thread-1): Compiling model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:51:57.694963 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-03 13:51:57.695343 (Thread-1): finished collecting timing info
2022-03-03 13:51:57.696656 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-03 13:51:57.697234 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:51:57.697332 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_TRANSACTIONS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_TRANSACTIONS_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG AS C
      );
2022-03-03 13:51:57.697426 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:52:00.126903 (Thread-1): SQL status: SUCCESS 1 in 2.43 seconds
2022-03-03 13:52:00.129923 (Thread-1): finished collecting timing info
2022-03-03 13:52:00.130159 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: Close
2022-03-03 13:52:00.570303 (Thread-1): 10:52:00 | 19 of 25 OK created table model DBT_SHOPIFY.W_TRANSACTIONS_F......... [SUCCESS 1 in 2.88s]
2022-03-03 13:52:00.570573 (Thread-1): Finished running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-03 13:52:00.570846 (Thread-1): Began running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:52:00.571042 (Thread-1): 10:52:00 | 20 of 25 START view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG........... [RUN]
2022-03-03 13:52:00.571284 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:52:00.571392 (Thread-1): Compiling model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:52:00.574834 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-03 13:52:00.575650 (Thread-1): finished collecting timing info
2022-03-03 13:52:00.577175 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-03 13:52:00.579451 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:52:00.579585 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_INVENTORY_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_ITEM"
),
inventory_level AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_LEVEL"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
products AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename AS 
(   
  SELECT   
  MD5(S.ID) AS K_INVENTORY_ITEM_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
  ,L.K_LOCATION_DLHK
  ,L.K_LOCATION_BK  
  ,S.ID AS K_INVENTORY_ITEM_BK
  ,S.COUNTRY_CODE_OF_ORIGIN AS A_COUNTRY_CODE_OF_ORIGIN
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.PROVINCE_CODE_OF_ORIGIN AS A_PROVINCE_CODE_OF_ORIGIN
  ,S.SKU AS A_SKU
  ,S.UPDATED_AT AS A_UPDATED_AT
  ,S.HARMONIZED_SYSTEM_CODE AS A_HARMONIZED_SYSTEM_CODE  
  --BOOLEAN
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TRACKED AS B_TRACKED
  --METRICS
  ,S.COST::decimal(15,2) AS M_COST 
  ,IL.AVAILABLE AS M_AVAIABLE  
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
  FROM
      source S
      left join inventory_level IL ON IL.INVENTORY_ITEM_ID = S.ID      
      left join locations L ON L.K_LOCATION_BK = IL.LOCATION_ID
      left join products P ON P.K_VARIANT_INVENTORY_ITEM_BK = S.ID 
)


SELECT * FROM rename
  );
2022-03-03 13:52:00.579692 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:52:02.470857 (Thread-1): SQL status: SUCCESS 1 in 1.89 seconds
2022-03-03 13:52:02.473650 (Thread-1): finished collecting timing info
2022-03-03 13:52:02.473889 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: Close
2022-03-03 13:52:02.926763 (Thread-1): 10:52:02 | 20 of 25 OK created view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG...... [SUCCESS 1 in 2.36s]
2022-03-03 13:52:02.927003 (Thread-1): Finished running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-03 13:52:02.927316 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:52:02.927533 (Thread-1): 10:52:02 | 21 of 25 START view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG......... [RUN]
2022-03-03 13:52:02.927947 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:52:02.928102 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:52:02.932693 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-03 13:52:02.934539 (Thread-1): finished collecting timing info
2022-03-03 13:52:02.936043 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-03 13:52:02.940048 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:52:02.940151 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM" AS A
),
products AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D AS A
),
taxes AS (
  SELECT 
      K_ORDER_LINE_ITEM_BK,
      AVG(M_RATE) AS M_RATE,
      SUM(M_TAX) AS M_TAX,
      SUM(M_TAX_PRIMARY) AS M_TAX_PRIMARY
    FROM 
      DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG AS A
    GROUP BY K_ORDER_LINE_ITEM_BK
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_LINE_ITEM_DLHK  
  ,MD5(ORDER_ID) AS K_ORDER_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
 --business keys
  ,O.PRODUCT_ID AS K_PRODUCT_BK
  ,O.VARIANT_ID AS K_VARIANT_BK
  
  ,O.ORDER_ID AS K_ORDER_BK
  ,O.ID AS K_ORDER_LINE_ITEM_BK
  --attribubtes
  ,O.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
  ,O.NAME AS A_NAME  
  ,O.PROPERTIES AS A_PROPERTIES
  ,O.SKU AS A_SKU
  ,O.TITLE AS A_TITLE  
  ,O.VARIANT_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
  ,O.VARIANT_TITLE AS A_VARIANT_TITLE
  ,O.VENDOR AS A_VENDOR
  --boolean
  ,O.GIFT_CARD AS B_GIFT_CARD
  ,O.PRODUCT_EXISTS AS B_PRODUCT_EXISTS
  ,O.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,O.TAXABLE AS B_TAXABLE
  --metrics
  ,O.FULFILLABLE_QUANTITY AS M_FULFILLABLE_QUANTITY
  ,O.GRAMS::DECIMAL(15,2) AS M_GRAMS
  ,O.QUANTITY::DECIMAL(15,2) AS M_QUANTITY
  ,M_RATE AS M_TAX_RATE
  ,COALESCE(T.M_TAX_PRIMARY,0)::DECIMAL(15,2) AS M_TAX_AMOUNT
  ,COALESCE(T.M_TAX,0)::DECIMAL(15,2) AS M_TAX_AMOUNT_PRIMARY

  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE_PRIMARY 
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT_PRIMARY 
  ,(O.QUANTITY * M_UNIT_PRICE)::DECIMAL(15,2) AS M_TOTAL_PRICE  
  ,(O.QUANTITY * M_UNIT_PRICE_PRIMARY)::DECIMAL(15,2) AS M_TOTAL_PRICE_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
FROM source O
  left join products P ON P.K_PRODUCT_BK = O.PRODUCT_ID AND CASE WHEN O.VARIANT_ID IS NOT NULL THEN O.VARIANT_ID = P.K_PRODUCT_VARIANT_BK ELSE 1=1 END
  left join taxes T ON T.K_ORDER_LINE_ITEM_BK = O.ID
)

SELECT * FROM rename
  );
2022-03-03 13:52:02.940253 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:52:05.548697 (Thread-1): SQL status: SUCCESS 1 in 2.61 seconds
2022-03-03 13:52:05.551054 (Thread-1): finished collecting timing info
2022-03-03 13:52:05.551276 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: Close
2022-03-03 13:52:05.999400 (Thread-1): 10:52:05 | 21 of 25 OK created view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG.... [SUCCESS 1 in 3.07s]
2022-03-03 13:52:06.000079 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-03 13:52:06.000422 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:52:06.000629 (Thread-1): 10:52:06 | 22 of 25 START view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG....... [RUN]
2022-03-03 13:52:06.000870 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:52:06.000993 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:52:06.004561 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-03 13:52:06.004940 (Thread-1): finished collecting timing info
2022-03-03 13:52:06.006199 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-03 13:52:06.008099 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:52:06.008199 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECT"
),
source_collection AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECTION"
),
product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename as (

SELECT
  MD5(S.ID) AS K_PRODUCT_COLLECT_DLHK
  ,MD5(CC.ID) AS K_COLLECTION_DLHK
  ,P.K_PRODUCT_DLHK  
  ,S.ID AS K_PRODUCT_COLLECT_BK
  ,CC.ID AS K_COLLECTION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,S.POSITION AS A_POSITION
  ,S.SORT_ORDER AS A_SORT_ORDER  
  ,S.CREATED_AT AS A_CREATED_AT_DTS
  ,S.UPDATED_AT AS A_UPDATED_AT_DTS
  ,CC.PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,CC.BODY_HTML AS A_BODY_HTML
  ,CC.TITLE AS A_TITLE
  ,CC.HANDLE AS A_HANDLE
  ,CC.PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE  
  ,CC.COLLECTION_TYPE AS A_COLLECTION_TYPE  
  --metrics
  ,CC.PRODUCTS_COUNT AS M_PRODUCTS_COUNT
  --metadata (MD)
  ,S.__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
FROM
    source S
    LEFT JOIN source_collection CC ON CC.ID = S.COLLECTION_ID
    LEFT JOIN product P ON P.K_PRODUCT_BK = S.PRODUCT_ID
)

SELECT * FROM rename
  );
2022-03-03 13:52:06.008298 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:52:07.601760 (Thread-1): SQL status: SUCCESS 1 in 1.59 seconds
2022-03-03 13:52:07.604872 (Thread-1): finished collecting timing info
2022-03-03 13:52:07.605119 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: Close
2022-03-03 13:52:08.060799 (Thread-1): 10:52:08 | 22 of 25 OK created view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG.. [SUCCESS 1 in 2.06s]
2022-03-03 13:52:08.061018 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-03 13:52:08.061244 (Thread-1): Began running node model.snowflake_aicd.W_INVENTORY_F
2022-03-03 13:52:08.061435 (Thread-1): 10:52:08 | 23 of 25 START table model DBT_SHOPIFY.W_INVENTORY_F................. [RUN]
2022-03-03 13:52:08.061670 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:52:08.061788 (Thread-1): Compiling model.snowflake_aicd.W_INVENTORY_F
2022-03-03 13:52:08.064369 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-03 13:52:08.064972 (Thread-1): finished collecting timing info
2022-03-03 13:52:08.066408 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-03 13:52:08.067094 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:52:08.067276 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_INVENTORY_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_INVENTORY_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG AS C
      );
2022-03-03 13:52:08.067411 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:52:10.854188 (Thread-1): SQL status: SUCCESS 1 in 2.79 seconds
2022-03-03 13:52:10.857343 (Thread-1): finished collecting timing info
2022-03-03 13:52:10.857576 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: Close
2022-03-03 13:52:11.346174 (Thread-1): 10:52:11 | 23 of 25 OK created table model DBT_SHOPIFY.W_INVENTORY_F............ [SUCCESS 1 in 3.28s]
2022-03-03 13:52:11.346518 (Thread-1): Finished running node model.snowflake_aicd.W_INVENTORY_F
2022-03-03 13:52:11.346821 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:52:11.347104 (Thread-1): 10:52:11 | 24 of 25 START table model DBT_SHOPIFY.W_ORDERS_F.................... [RUN]
2022-03-03 13:52:11.347367 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:52:11.347481 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:52:11.408904 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-03 13:52:11.409317 (Thread-1): finished collecting timing info
2022-03-03 13:52:11.410807 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-03 13:52:11.416190 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:52:11.416285 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ORDERS_F  as
      (

SELECT
  O.K_ORDER_DLHK AS K_ORDER_DLHK
  ,OLI.K_ORDER_LINE_ITEM_DLHK AS K_ORDER_LINE_ITEM_DLHK
  ,O.K_CUSTOMER_DLHK AS K_CUSTOMER_DLHK
  ,O.K_LOCATION_DLHK AS K_LOCATION_DLHK
  ,O.K_BILLING_ADDRESS_DLHK AS K_BILLING_ADDRESS_DLHK
  ,O.K_SHIPPING_ADDRESS_DLHK AS K_SHIPPING_ADDRESS_DLHK
  ,OLI.K_PRODUCT_VARIATION_DLHK AS K_ITEM_PRODUCT_VARIATION_DLHK
  ,OLI.K_PRODUCT_BK AS K_ITEM_PRODUCT_BK
  ,OLI.K_VARIANT_BK AS K_ITEM_VARIANT_BK
  ,OLI.K_ORDER_BK AS K_ITEM_ORDER_BK
  ,O.K_ORDER_BK AS K_ORDER_BK
  ,OLI.K_ORDER_LINE_ITEM_BK AS K_ITEM_ORDER_LINE_ITEM_BK
  ,O.K_APP_BK AS K_HEADER_APP_BK
  
  ,O.K_CUSTOMER_BK AS K_CUSTOMER_BK
  ,O.K_DEVICE_BK AS K_DEVICE_BK
  ,O.K_LOCATION_BK AS K_LOCATION_BK
  ,O.K_SOURCE_ENTIFIER_BK AS K_SOURCE_ENTIFIER_BK
  ,O.A_BROWSER_IP AS A_HEADER_BROWSER_IP
  ,O.A_CANCELLED_AT_DTS AS A_HEADER_CANCELLED_AT_DTS
  ,O.A_CANCEL_REASON AS A_HEADER_CANCEL_REASON
  ,O.A_CART_TOKEN AS A_HEADER_CART_TOKEN
  ,O.A_CHECKOUT_TOKEN AS A_HEADER_CHECKOUT_TOKEN
  ,O.A_CLIENT_DETAILS AS A_HEADER_CLIENT_DETAILS
  ,O.A_CLOSED_AT_DTS AS A_HEADER_CLOSED_AT_DTS
  ,O.A_CREATED_AT_DTS AS A_HEADER_CREATED_AT_DTS
  ,O.A_CURRENCY AS A_HEADER_CURRENCY
  ,O.A_PRESENTMENT_CURRENCY AS A_HEADER_PRESENTMENT_CURRENCY
  ,O.A_CUSTOMER_LOCALE AS A_HEADER_CUSTOMER_LOCALE
  ,O.A_EMAIL AS A_HEADER_EMAIL
  ,O.A_FINANCIAL_STATUS AS A_HEADER_FINANCIAL_STATUS
  ,O.A_FULFILLMENT_STATUS AS A_HEADER_FULFILLMENT_STATUS
  ,O.A_LANDING_SITE_BASE_URL AS A_HEADER_LANDING_SITE_BASE_URL
  ,O.A_LANDING_SITE_REF AS A_HEADER_LANDING_SITE_REF
  ,O.A_NAME AS A_HEADER_NAME
  ,O.A_NOTE AS A_HEADER_NOTE
  ,O.A_NOTE_ATTRIBUTES AS A_HEADER_NOTE_ATTRIBUTES
  ,O.A_PAYMENT_GATEWAY_NAMES AS A_HEADER_PAYMENT_GATEWAY_NAMES
  ,O.A_PROCESSED_AT_DTS AS A_HEADER_PROCESSED_AT_DTS
  ,O.A_PROCESSING_METHOD AS A_HEADER_PROCESSING_METHOD
  ,O.A_REFERENCE AS A_HEADER_REFERENCE
  ,O.A_REFERRING_SITE AS A_HEADER_REFERRING_SITE
  ,O.A_SOURCE_NAME AS A_HEADER_SOURCE_NAME
  ,O.A_SOURCE_URL AS A_HEADER_SOURCE_URL
  ,O.A_ORDER_NUMBER AS A_HEADER_ORDER_NUMBER
  ,O.A_POSION_NUMBER AS A_HEADER_POSION_NUMBER
  ,O.A_UPDATED_AT_DTS AS A_HEADER_UPDATED_AT_DTS
  ,O.B_BUYER_ACCEPTS_MARKETING AS B_HEADER_BUYER_ACCEPTS_MARKETING
  ,O.B_CONFIRMED AS B_HEADER_CONFIRMED
  ,O.B_TAXES_INCLUDED  AS B_HEADER_TAXES_INCLUDED   
  ,OLI.A_FULFILLMENT_SERVICE AS A_ITEM_FULFILLMENT_SERVICE
  ,OLI.A_FULFILLMENT_STATUS AS A_ITEM_FULFILLMENT_STATUS
  ,OLI.A_NAME AS A_ITEM_NAME
  ,OLI.A_PROPERTIES AS A_ITEM_PROPERTIES
  ,OLI.A_SKU AS A_ITEM_SKU
  ,OLI.A_TITLE AS A_ITEM_TITLE  
  ,OLI.A_VARIANT_INVENTORY_MANAGEMENT AS A_ITEM_VARIANT_INVENTORY_MANAGEMENT
  ,OLI.A_VARIANT_TITLE AS A_ITEM_VARIANT_TITLE
  ,OLI.A_VENDOR AS A_ITEM_VENDOR
  ,OLI.B_GIFT_CARD AS B_ITEM_GIFT_CARD
  ,OLI.B_PRODUCT_EXISTS AS B_ITEM_PRODUCT_EXISTS
  ,OLI.B_REQUIRES_SHIPPING AS B_ITEM_REQUIRES_SHIPPING
  ,OLI.B_TAXABLE AS B_ITEM_TAXABLE
  ,OLI.M_FULFILLABLE_QUANTITY AS M_ITEM_FULFILLABLE_QUANTITY
  ,OLI.M_GRAMS AS M_ITEM_GRAMS
  ,OLI.M_QUANTITY AS M_ITEM_QUANTITY
  ,OLI.M_UNIT_PRICE AS M_ITEM_UNIT_PRICE
  ,OLI.M_UNIT_PRICE_PRIMARY AS M_ITEM_UNIT_PRICE_PRIMARY
  ,OLI.M_TOTAL_PRICE AS M_ITEM_TOTAL_PRICE
  ,OLI.M_TOTAL_PRICE_PRIMARY AS M_ITEM_TOTAL_PRICE_PRIMARY
  ,OLI.M_TOTAL_DISCOUNT AS M_ITEM_TOTAL_DISCOUNT
  ,OLI.M_TOTAL_DISCOUNT_PRIMARY AS M_ITEM_TOTAL_DISCOUNT_PRIMARY
  ,OLI.M_TAX_AMOUNT AS M_TAX_AMOUNT
  ,OLI.M_TAX_AMOUNT_PRIMARY AS M_TAX_AMOUNT_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_TIP_RECEIVED * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_TIP_AMOUNT_PRIMARY  
  --,ROUND(DIV0((O.M_TOTAL_DISCOUNTS_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_HEADER_DISCOUNT
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE * OLI.M_TOTAL_PRICE),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE



   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'8efb9b23-4e71-4e58-b3ab-37e38a0fea70' AS MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG OLI ON OLI.K_ORDER_DLHK = O.K_ORDER_DLHK
      );
2022-03-03 13:52:11.416392 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:52:14.484124 (Thread-1): SQL status: SUCCESS 1 in 3.07 seconds
2022-03-03 13:52:14.487443 (Thread-1): finished collecting timing info
2022-03-03 13:52:14.487703 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-03 13:52:15.029352 (Thread-1): 10:52:15 | 24 of 25 OK created table model DBT_SHOPIFY.W_ORDERS_F............... [SUCCESS 1 in 3.68s]
2022-03-03 13:52:15.029581 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-03 13:52:15.029808 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:52:15.030029 (Thread-1): 10:52:15 | 25 of 25 START table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F........ [RUN]
2022-03-03 13:52:15.030292 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:52:15.030706 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:52:15.036602 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-03 13:52:15.036987 (Thread-1): finished collecting timing info
2022-03-03 13:52:15.038298 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-03 13:52:15.038889 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:52:15.038983 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCT_COLLECTION_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG AS C
      );
2022-03-03 13:52:15.039076 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:52:17.803461 (Thread-1): SQL status: SUCCESS 1 in 2.76 seconds
2022-03-03 13:52:17.805725 (Thread-1): finished collecting timing info
2022-03-03 13:52:17.805932 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: Close
2022-03-03 13:52:18.250914 (Thread-1): 10:52:18 | 25 of 25 OK created table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F... [SUCCESS 1 in 3.22s]
2022-03-03 13:52:18.251141 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-03 13:52:18.252638 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 13:52:18.253003 (MainThread): 10:52:18 | 
2022-03-03 13:52:18.253127 (MainThread): 10:52:18 | Finished running 16 view models, 9 table models in 75.00s.
2022-03-03 13:52:18.253232 (MainThread): Connection 'master' was properly closed.
2022-03-03 13:52:18.253318 (MainThread): Connection 'model.snowflake_aicd.W_PRODUCT_COLLECTION_F' was properly closed.
2022-03-03 13:52:18.261323 (MainThread): 
2022-03-03 13:52:18.262018 (MainThread): Completed successfully
2022-03-03 13:52:18.262410 (MainThread): 
Done. PASS=25 WARN=0 ERROR=0 SKIP=0 TOTAL=25
2022-03-03 13:52:18.262790 (MainThread): Flushing usage events
2022-03-03 13:56:20.233041 (MainThread): Running with dbt=0.21.1
2022-03-03 13:56:20.851764 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=['W_CUSTOMER_ADDRESS_F'], selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-03 13:56:20.853243 (MainThread): Tracking: do not track
2022-03-03 13:56:20.867100 (MainThread): Partial parsing not enabled
2022-03-03 13:56:20.894492 (MainThread): Parsing macros/common.sql
2022-03-03 13:56:20.897770 (MainThread): Parsing macros/catalog.sql
2022-03-03 13:56:20.899636 (MainThread): Parsing macros/adapters.sql
2022-03-03 13:56:20.933632 (MainThread): Parsing macros/materializations/merge.sql
2022-03-03 13:56:20.937011 (MainThread): Parsing macros/materializations/seed.sql
2022-03-03 13:56:20.940914 (MainThread): Parsing macros/materializations/view.sql
2022-03-03 13:56:20.942030 (MainThread): Parsing macros/materializations/table.sql
2022-03-03 13:56:20.944741 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-03 13:56:20.951655 (MainThread): Parsing macros/core.sql
2022-03-03 13:56:20.954950 (MainThread): Parsing macros/materializations/test.sql
2022-03-03 13:56:20.960867 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-03 13:56:20.969227 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-03 13:56:20.970657 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-03 13:56:20.984894 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-03 13:56:21.015928 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-03 13:56:21.036291 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-03 13:56:21.037786 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-03 13:56:21.046795 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-03 13:56:21.065283 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-03 13:56:21.077700 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-03 13:56:21.084945 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-03 13:56:21.091471 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-03 13:56:21.095021 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-03 13:56:21.096274 (MainThread): Parsing macros/etc/query.sql
2022-03-03 13:56:21.097014 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-03 13:56:21.098209 (MainThread): Parsing macros/etc/datetime.sql
2022-03-03 13:56:21.105424 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-03 13:56:21.106856 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-03 13:56:21.108744 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-03 13:56:21.109966 (MainThread): Parsing macros/adapters/common.sql
2022-03-03 13:56:21.159445 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-03 13:56:21.160835 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-03 13:56:21.161713 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-03 13:56:21.162735 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-03 13:56:21.315507 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:56:21.325133 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.328380 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:56:21.331203 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.332017 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:56:21.334934 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.335669 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:56:21.340006 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.340718 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:56:21.343831 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.344694 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:56:21.348063 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.348856 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:56:21.351908 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.352706 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:56:21.355389 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.356160 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:56:21.358764 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.359538 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:56:21.363939 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.364745 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:56:21.368132 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.368911 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:56:21.373421 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.374147 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:56:21.380101 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.380992 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:56:21.384095 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.385049 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:56:21.388925 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.389770 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:56:21.393533 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.394324 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:56:21.397502 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.398374 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:56:21.401518 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.405851 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:56:21.443395 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.444206 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:56:21.446616 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.447606 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:56:21.450543 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.451402 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:56:21.453823 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.454585 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:56:21.456924 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.457686 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:56:21.460007 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.460751 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:56:21.463104 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.463910 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-03 13:56:21.466350 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.487336 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.488838 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.490064 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.491312 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.492717 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.493920 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.495110 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.496303 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:21.533037 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-03 13:56:21.533698 (MainThread): Found 26 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 23 sources, 0 exposures
2022-03-03 13:56:21.534535 (MainThread): The selection criterion 'W_CUSTOMER_ADDRESS_F' does not match any nodes
2022-03-03 13:56:21.535542 (MainThread): 
WARNING: Nothing to do. Try checking your model configs and model specification args
2022-03-03 13:56:21.541759 (MainThread): Flushing usage events
2022-03-03 13:56:21.541975 (MainThread): Connection 'model.snowflake_aicd.W_CUSTOMER_ADDRESS_D' was properly closed.
2022-03-03 13:56:29.511246 (MainThread): Running with dbt=0.21.1
2022-03-03 13:56:30.039291 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=['W_CUSTOMER_ADDRESS_D'], selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-03 13:56:30.041773 (MainThread): Tracking: do not track
2022-03-03 13:56:30.053710 (MainThread): Partial parsing not enabled
2022-03-03 13:56:30.079716 (MainThread): Parsing macros/common.sql
2022-03-03 13:56:30.083712 (MainThread): Parsing macros/catalog.sql
2022-03-03 13:56:30.086862 (MainThread): Parsing macros/adapters.sql
2022-03-03 13:56:30.119144 (MainThread): Parsing macros/materializations/merge.sql
2022-03-03 13:56:30.122295 (MainThread): Parsing macros/materializations/seed.sql
2022-03-03 13:56:30.126140 (MainThread): Parsing macros/materializations/view.sql
2022-03-03 13:56:30.127363 (MainThread): Parsing macros/materializations/table.sql
2022-03-03 13:56:30.130027 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-03 13:56:30.137642 (MainThread): Parsing macros/core.sql
2022-03-03 13:56:30.140750 (MainThread): Parsing macros/materializations/test.sql
2022-03-03 13:56:30.146440 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-03 13:56:30.154666 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-03 13:56:30.156079 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-03 13:56:30.171575 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-03 13:56:30.201660 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-03 13:56:30.221510 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-03 13:56:30.222912 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-03 13:56:30.231457 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-03 13:56:30.248834 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-03 13:56:30.261004 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-03 13:56:30.268111 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-03 13:56:30.274602 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-03 13:56:30.277843 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-03 13:56:30.279082 (MainThread): Parsing macros/etc/query.sql
2022-03-03 13:56:30.279834 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-03 13:56:30.280980 (MainThread): Parsing macros/etc/datetime.sql
2022-03-03 13:56:30.288427 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-03 13:56:30.289920 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-03 13:56:30.291845 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-03 13:56:30.293052 (MainThread): Parsing macros/adapters/common.sql
2022-03-03 13:56:30.340477 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-03 13:56:30.341884 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-03 13:56:30.342764 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-03 13:56:30.343754 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-03 13:56:30.519343 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 13:56:30.534298 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.538010 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 13:56:30.540789 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.541605 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 13:56:30.544771 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.545579 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 13:56:30.551189 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.552158 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 13:56:30.556562 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.557486 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 13:56:30.561717 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.562589 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 13:56:30.565613 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.566431 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 13:56:30.569584 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.570508 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 13:56:30.573617 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.574655 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 13:56:30.579195 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.580089 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 13:56:30.583578 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.584398 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 13:56:30.589564 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.590645 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 13:56:30.596971 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.597899 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 13:56:30.601955 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.602945 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 13:56:30.607540 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.608892 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 13:56:30.613359 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.614241 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 13:56:30.617940 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.618993 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 13:56:30.622837 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.623668 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 13:56:30.699174 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.702035 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 13:56:30.707317 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.708277 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 13:56:30.718748 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.719719 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 13:56:30.729825 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.730780 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 13:56:30.737014 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.737968 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 13:56:30.741012 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.741957 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 13:56:30.746583 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.763008 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-03 13:56:30.765851 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.790745 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.792447 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.794261 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.795884 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.797801 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.799670 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.800932 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.802138 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 13:56:30.842969 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-03 13:56:30.843583 (MainThread): Found 26 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 23 sources, 0 exposures
2022-03-03 13:56:30.846038 (MainThread): 
2022-03-03 13:56:30.846370 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 13:56:30.847274 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 13:56:30.860266 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 13:56:30.860454 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-03 13:56:30.860568 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-03 13:56:32.997870 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 2.14 seconds
2022-03-03 13:56:33.007132 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-03 13:56:33.588646 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 13:56:33.600536 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 13:56:33.600705 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-03 13:56:33.600810 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-03 13:56:35.801668 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 26 in 2.20 seconds
2022-03-03 13:56:35.808196 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-03 13:56:36.282139 (MainThread): 10:56:36 | Concurrency: 1 threads (target='dev')
2022-03-03 13:56:36.282649 (MainThread): 10:56:36 | 
2022-03-03 13:56:36.288713 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-03 13:56:36.289925 (Thread-1): 10:56:36 | 1 of 1 START table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D............ [RUN]
2022-03-03 13:56:36.291382 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-03 13:56:36.291954 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-03 13:56:36.299202 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-03 13:56:36.299663 (Thread-1): finished collecting timing info
2022-03-03 13:56:36.322623 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-03 13:56:36.323477 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-03 13:56:36.323583 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG AS C
      );
2022-03-03 13:56:36.323685 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 13:56:39.495016 (Thread-1): SQL status: SUCCESS 1 in 3.17 seconds
2022-03-03 13:56:39.533664 (Thread-1): finished collecting timing info
2022-03-03 13:56:39.534001 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: Close
2022-03-03 13:56:40.073324 (Thread-1): 10:56:40 | 1 of 1 OK created table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D....... [SUCCESS 1 in 3.78s]
2022-03-03 13:56:40.073595 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-03 13:56:40.078299 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 13:56:40.078655 (MainThread): 10:56:40 | 
2022-03-03 13:56:40.078781 (MainThread): 10:56:40 | Finished running 1 table model in 9.23s.
2022-03-03 13:56:40.078884 (MainThread): Connection 'master' was properly closed.
2022-03-03 13:56:40.079128 (MainThread): Connection 'model.snowflake_aicd.W_CUSTOMER_ADDRESS_D' was properly closed.
2022-03-03 13:56:40.091553 (MainThread): 
2022-03-03 13:56:40.091759 (MainThread): Completed successfully
2022-03-03 13:56:40.091883 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2022-03-03 13:56:40.092141 (MainThread): Flushing usage events
2022-03-03 14:17:55.401067 (MainThread): Running with dbt=0.21.1
2022-03-03 14:17:55.947745 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=['W_CUSTOMER_ADDRESS_D'], selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-03 14:17:55.949176 (MainThread): Tracking: do not track
2022-03-03 14:17:55.959297 (MainThread): Partial parsing not enabled
2022-03-03 14:17:55.984500 (MainThread): Parsing macros/common.sql
2022-03-03 14:17:55.988312 (MainThread): Parsing macros/catalog.sql
2022-03-03 14:17:55.990155 (MainThread): Parsing macros/adapters.sql
2022-03-03 14:17:56.021456 (MainThread): Parsing macros/materializations/merge.sql
2022-03-03 14:17:56.024553 (MainThread): Parsing macros/materializations/seed.sql
2022-03-03 14:17:56.028168 (MainThread): Parsing macros/materializations/view.sql
2022-03-03 14:17:56.029167 (MainThread): Parsing macros/materializations/table.sql
2022-03-03 14:17:56.031581 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-03 14:17:56.038259 (MainThread): Parsing macros/core.sql
2022-03-03 14:17:56.041059 (MainThread): Parsing macros/materializations/test.sql
2022-03-03 14:17:56.046296 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-03 14:17:56.053838 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-03 14:17:56.055087 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-03 14:17:56.068507 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-03 14:17:56.098212 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-03 14:17:56.116875 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-03 14:17:56.118204 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-03 14:17:56.126482 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-03 14:17:56.143387 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-03 14:17:56.154928 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-03 14:17:56.161834 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-03 14:17:56.167967 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-03 14:17:56.170849 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-03 14:17:56.171920 (MainThread): Parsing macros/etc/query.sql
2022-03-03 14:17:56.172597 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-03 14:17:56.173742 (MainThread): Parsing macros/etc/datetime.sql
2022-03-03 14:17:56.180711 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-03 14:17:56.182061 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-03 14:17:56.183864 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-03 14:17:56.185010 (MainThread): Parsing macros/adapters/common.sql
2022-03-03 14:17:56.230529 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-03 14:17:56.231768 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-03 14:17:56.232598 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-03 14:17:56.233551 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-03 14:17:56.377791 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-03 14:17:56.386083 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.388938 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-03 14:17:56.391327 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.392049 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-03 14:17:56.394608 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.395317 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-03 14:17:56.399604 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.400318 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-03 14:17:56.403200 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.403913 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-03 14:17:56.406759 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.407463 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-03 14:17:56.410056 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.410759 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-03 14:17:56.413136 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.413842 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-03 14:17:56.416312 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.417079 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-03 14:17:56.421170 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.421961 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-03 14:17:56.425049 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.425797 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-03 14:17:56.430743 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.431598 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-03 14:17:56.437482 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.438272 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-03 14:17:56.441084 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.441806 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-03 14:17:56.445072 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.445981 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-03 14:17:56.449847 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.450623 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-03 14:17:56.454881 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.455906 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-03 14:17:56.459954 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.460899 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-03 14:17:56.503465 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.504490 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-03 14:17:56.508559 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.509601 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-03 14:17:56.514752 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.515725 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-03 14:17:56.523119 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.524137 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-03 14:17:56.527024 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.527940 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-03 14:17:56.530663 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.531542 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-03 14:17:56.534162 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.535013 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-03 14:17:56.537782 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.560198 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.561585 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.563273 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.564612 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.566001 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.567224 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.568466 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.569694 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-03 14:17:56.606544 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-03 14:17:56.607104 (MainThread): Found 26 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 23 sources, 0 exposures
2022-03-03 14:17:56.608728 (MainThread): 
2022-03-03 14:17:56.608978 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 14:17:56.609543 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 14:17:56.619019 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-03 14:17:56.619175 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-03 14:17:56.619269 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-03 14:17:58.625409 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 2.01 seconds
2022-03-03 14:17:58.637807 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-03 14:17:59.130265 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 14:17:59.147280 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-03 14:17:59.147674 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-03 14:17:59.147915 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-03 14:18:00.938155 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 27 in 1.79 seconds
2022-03-03 14:18:00.949935 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-03 14:18:01.419245 (MainThread): 11:18:01 | Concurrency: 1 threads (target='dev')
2022-03-03 14:18:01.419800 (MainThread): 11:18:01 | 
2022-03-03 14:18:01.422975 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-03 14:18:01.426074 (Thread-1): 11:18:01 | 1 of 1 START table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D............ [RUN]
2022-03-03 14:18:01.428244 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-03 14:18:01.428847 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-03 14:18:01.434748 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-03 14:18:01.435555 (Thread-1): finished collecting timing info
2022-03-03 14:18:01.458657 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-03 14:18:01.459495 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-03 14:18:01.459607 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG AS C
      );
2022-03-03 14:18:01.459712 (Thread-1): Opening a new connection, currently in state closed
2022-03-03 14:18:04.341178 (Thread-1): SQL status: SUCCESS 1 in 2.88 seconds
2022-03-03 14:18:04.368187 (Thread-1): finished collecting timing info
2022-03-03 14:18:04.368417 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: Close
2022-03-03 14:18:04.818189 (Thread-1): 11:18:04 | 1 of 1 OK created table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D....... [SUCCESS 1 in 3.39s]
2022-03-03 14:18:04.818947 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-03 14:18:04.823832 (MainThread): Acquiring new snowflake connection "master".
2022-03-03 14:18:04.825067 (MainThread): 11:18:04 | 
2022-03-03 14:18:04.825660 (MainThread): 11:18:04 | Finished running 1 table model in 8.22s.
2022-03-03 14:18:04.826165 (MainThread): Connection 'master' was properly closed.
2022-03-03 14:18:04.826708 (MainThread): Connection 'model.snowflake_aicd.W_CUSTOMER_ADDRESS_D' was properly closed.
2022-03-03 14:18:04.840554 (MainThread): 
2022-03-03 14:18:04.840724 (MainThread): Completed successfully
2022-03-03 14:18:04.840838 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2022-03-03 14:18:04.840995 (MainThread): Flushing usage events
2022-03-04 00:34:26.807727 (MainThread): Running with dbt=0.21.1
2022-03-04 00:34:27.448764 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-04 00:34:27.450800 (MainThread): Tracking: do not track
2022-03-04 00:34:27.461177 (MainThread): Partial parsing not enabled
2022-03-04 00:34:27.484681 (MainThread): Parsing macros/common.sql
2022-03-04 00:34:27.487754 (MainThread): Parsing macros/catalog.sql
2022-03-04 00:34:27.489503 (MainThread): Parsing macros/adapters.sql
2022-03-04 00:34:27.520416 (MainThread): Parsing macros/materializations/merge.sql
2022-03-04 00:34:27.523454 (MainThread): Parsing macros/materializations/seed.sql
2022-03-04 00:34:27.527042 (MainThread): Parsing macros/materializations/view.sql
2022-03-04 00:34:27.528031 (MainThread): Parsing macros/materializations/table.sql
2022-03-04 00:34:27.530417 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-04 00:34:27.537067 (MainThread): Parsing macros/core.sql
2022-03-04 00:34:27.539843 (MainThread): Parsing macros/materializations/test.sql
2022-03-04 00:34:27.545063 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-04 00:34:27.552584 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-04 00:34:27.553816 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-04 00:34:27.567672 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-04 00:34:27.597221 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-04 00:34:27.615838 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-04 00:34:27.617139 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-04 00:34:27.625359 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-04 00:34:27.642146 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-04 00:34:27.653601 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-04 00:34:27.660418 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-04 00:34:27.666505 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-04 00:34:27.669373 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-04 00:34:27.670446 (MainThread): Parsing macros/etc/query.sql
2022-03-04 00:34:27.671127 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-04 00:34:27.672252 (MainThread): Parsing macros/etc/datetime.sql
2022-03-04 00:34:27.678973 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-04 00:34:27.680308 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-04 00:34:27.682092 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-04 00:34:27.683240 (MainThread): Parsing macros/adapters/common.sql
2022-03-04 00:34:27.729923 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-04 00:34:27.731346 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-04 00:34:27.732183 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-04 00:34:27.733145 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-04 00:34:27.882664 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-04 00:34:27.893871 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.897367 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-04 00:34:27.900195 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.900995 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-04 00:34:27.903814 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.904584 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-04 00:34:27.909172 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.909980 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-04 00:34:27.913247 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.914061 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-04 00:34:27.917121 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.917884 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-04 00:34:27.920544 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.921262 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-04 00:34:27.923728 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.924434 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-04 00:34:27.926788 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.927488 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-04 00:34:27.931077 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.931774 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-04 00:34:27.934688 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.935390 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-04 00:34:27.939781 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.940479 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-04 00:34:27.945851 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.946550 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-04 00:34:27.949250 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.949947 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-04 00:34:27.953091 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.953796 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-04 00:34:27.957167 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.957858 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-04 00:34:27.960596 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.961293 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-04 00:34:27.964095 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:27.964780 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-04 00:34:27.999457 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.000302 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-04 00:34:28.002718 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.003416 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-04 00:34:28.005564 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.006251 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-04 00:34:28.008402 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.009111 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-04 00:34:28.012034 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.012887 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-04 00:34:28.015155 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.015857 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-04 00:34:28.018061 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.018753 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-04 00:34:28.021441 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.041334 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.042611 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.043721 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.044841 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.046113 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.047222 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.048315 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.049410 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 00:34:28.089896 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-04 00:34:28.090639 (MainThread): Found 26 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 23 sources, 0 exposures
2022-03-04 00:34:28.092935 (MainThread): 
2022-03-04 00:34:28.093189 (MainThread): Acquiring new snowflake connection "master".
2022-03-04 00:34:28.094686 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-04 00:34:28.104009 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-04 00:34:28.104117 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-04 00:34:28.104206 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-04 00:34:30.153634 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 2.05 seconds
2022-03-04 00:34:30.159881 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-04 00:34:30.646332 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-04 00:34:30.657117 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-04 00:34:30.657325 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-04 00:34:30.657501 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-04 00:34:32.719576 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 27 in 2.06 seconds
2022-03-04 00:34:32.724995 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-04 00:34:33.273682 (MainThread): 21:34:33 | Concurrency: 1 threads (target='dev')
2022-03-04 00:34:33.274149 (MainThread): 21:34:33 | 
2022-03-04 00:34:33.275612 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-04 00:34:33.276022 (Thread-1): 21:34:33 | 1 of 26 START view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG.......... [RUN]
2022-03-04 00:34:33.276286 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-04 00:34:33.276404 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-04 00:34:33.278725 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-04 00:34:33.280254 (Thread-1): finished collecting timing info
2022-03-04 00:34:33.302854 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-04 00:34:33.304865 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-04 00:34:33.305009 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER_ADDRESS"
),
rename AS 
(   
SELECT 
    MD5(ID) AS K_CUSTOMER_ADDRESS_DLHK
    ,ID AS K_CUSTOMER_ADDRESS_BK
    ,MD5(CONCAT(
        COALESCE(ADDRESS1,'00'),
        COALESCE(ADDRESS2,'00'),
        COALESCE(CITY,'00'),
        COALESCE(COUNTRY,'00'),
        COALESCE(COUNTRY_CODE,'00'),
        COALESCE(FIRST_NAME,'00'),
        COALESCE(LAST_NAME,'00'),
        COALESCE(PROVINCE,'00'),
        COALESCE(PROVINCE_CODE,'00'),
        COALESCE(ZIP,'00')
    )) AS K_ADDRESS_DLHK
    ,CUSTOMER_ID AS K_CUSTOMER_BK
    ,ADDRESS1 AS A_ADDRESS1
    ,ADDRESS2 AS A_ADDRESS2
    ,CITY AS A_CITY
    ,COMPANY AS A_COMPANY
    ,COUNTRY AS A_COUNTRY
    ,COUNTRY_CODE AS A_COUNTRY_CODE
    ,COUNTRY_NAME AS A_COUNTRY_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,PHONE AS A_PHONE
    ,PROVINCE AS A_PROVINCE
    ,PROVINCE_CODE AS A_PROVINCE_CODE
    ,ZIP AS A_ZIP
    ,IS_DEFAULT AS B_IS_DEFAULT  
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-04 00:34:33.305112 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:34:35.212010 (Thread-1): SQL status: SUCCESS 1 in 1.91 seconds
2022-03-04 00:34:35.217929 (Thread-1): finished collecting timing info
2022-03-04 00:34:35.218140 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: Close
2022-03-04 00:34:36.931152 (Thread-1): 21:34:36 | 1 of 26 OK created view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG..... [SUCCESS 1 in 3.65s]
2022-03-04 00:34:36.934500 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-04 00:34:36.934915 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-04 00:34:36.935803 (Thread-1): 21:34:36 | 2 of 26 START view model DBT_SHOPIFY.V_CUSTOMER_STG.................. [RUN]
2022-03-04 00:34:36.936342 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-04 00:34:36.936633 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-04 00:34:36.942382 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-04 00:34:36.943379 (Thread-1): finished collecting timing info
2022-03-04 00:34:36.947955 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-04 00:34:36.950153 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-04 00:34:36.950254 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER"
),
rename AS 
(   
SELECT 
    --KEYS
    MD5(ID) AS K_CUSTOMER_DLHK    
    --BUSINESS KEYS
    ,ID AS K_CUSTOMER_BK
    ,LAST_ORDER_ID AS K_LAST_ORDER_BK
    ,MULTIPASS_IDENTIFIER AS K_MULTIPASS_BKENTIFIER
    --ATTRIBUTES
    ,ACCEPTS_MARKETING_UPDATED_AT AS A_ACCEPTS_MARKETING_UPDATED_AT_DTS
    ,CREATED_AT AS A_CREATED_AT_DTS
    ,CURRENCY AS A_CURRENCY
    ,EMAIL AS A_EMAIL
    ,
    (COALESCE(FIRST_NAME,'') || ' ' || COALESCE(LAST_NAME,''))
 AS A_FULL_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,LAST_ORDER_NAME AS A_LAST_ORDER_NAME
    ,MARKETING_OPT_IN_LEVEL AS A_MARKETING_OPT_IN_LEVEL
    ,NOTE AS A_NOTE
    ,PHONE AS A_PHONE
    ,SMS_MARKETING_CONSENT AS A_SMS_MARKETING_CONSENT
    ,STATE AS A_STATE
    ,TAGS AS A_TAGS
    ,TAX_EXEMPTIONS AS A_TAX_EXEMPTIONS
    ,TOTAL_SPENT AS A_TOTAL_SPENT
    ,UPDATED_AT AS A_UPDATED_AT
    --BOOLEAN
    ,ACCEPTS_MARKETING AS B_ACCEPTS_MARKETING
    ,TAX_EXEMPT AS B_TAX_EXEMPT
    ,VERIFIED_EMAIL AS B_VERIFIED_EMAIL
    --METRICS
    ,ORDERS_COUNT AS M_ORDERS_COUNT
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-04 00:34:36.950379 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:34:38.573518 (Thread-1): SQL status: SUCCESS 1 in 1.62 seconds
2022-03-04 00:34:38.578720 (Thread-1): finished collecting timing info
2022-03-04 00:34:38.578911 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-04 00:34:39.039559 (Thread-1): 21:34:39 | 2 of 26 OK created view model DBT_SHOPIFY.V_CUSTOMER_STG............. [SUCCESS 1 in 2.10s]
2022-03-04 00:34:39.039802 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-04 00:34:39.039952 (Thread-1): Began running node model.snowflake_aicd.V_DATE_STG
2022-03-04 00:34:39.040142 (Thread-1): 21:34:39 | 3 of 26 START view model DBT_SHOPIFY.V_DATE_STG...................... [RUN]
2022-03-04 00:34:39.040391 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-04 00:34:39.040502 (Thread-1): Compiling model.snowflake_aicd.V_DATE_STG
2022-03-04 00:34:39.045864 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-04 00:34:39.048466 (Thread-1): finished collecting timing info
2022-03-04 00:34:39.050076 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-04 00:34:39.075146 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-04 00:34:39.075354 (Thread-1): On model.snowflake_aicd.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-04 00:34:39.075542 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:34:41.115351 (Thread-1): SQL status: SUCCESS 1 in 2.04 seconds
2022-03-04 00:34:41.118681 (Thread-1): finished collecting timing info
2022-03-04 00:34:41.118926 (Thread-1): On model.snowflake_aicd.V_DATE_STG: Close
2022-03-04 00:34:41.568384 (Thread-1): 21:34:41 | 3 of 26 OK created view model DBT_SHOPIFY.V_DATE_STG................. [SUCCESS 1 in 2.53s]
2022-03-04 00:34:41.568957 (Thread-1): Finished running node model.snowflake_aicd.V_DATE_STG
2022-03-04 00:34:41.569564 (Thread-1): Began running node model.snowflake_aicd.V_LOCATION_STG
2022-03-04 00:34:41.570494 (Thread-1): 21:34:41 | 4 of 26 START view model DBT_SHOPIFY.V_LOCATION_STG.................. [RUN]
2022-03-04 00:34:41.571023 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-04 00:34:41.571140 (Thread-1): Compiling model.snowflake_aicd.V_LOCATION_STG
2022-03-04 00:34:41.573843 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-04 00:34:41.577213 (Thread-1): finished collecting timing info
2022-03-04 00:34:41.578729 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-04 00:34:41.597058 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-04 00:34:41.597201 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-04 00:34:41.597299 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:34:43.469714 (Thread-1): SQL status: SUCCESS 1 in 1.87 seconds
2022-03-04 00:34:43.472654 (Thread-1): finished collecting timing info
2022-03-04 00:34:43.472906 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-04 00:34:43.922556 (Thread-1): 21:34:43 | 4 of 26 OK created view model DBT_SHOPIFY.V_LOCATION_STG............. [SUCCESS 1 in 2.35s]
2022-03-04 00:34:43.922902 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-04 00:34:43.923051 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-04 00:34:43.923236 (Thread-1): 21:34:43 | 5 of 26 START view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG......... [RUN]
2022-03-04 00:34:43.923819 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-04 00:34:43.924243 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-04 00:34:43.929300 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-04 00:34:43.930271 (Thread-1): finished collecting timing info
2022-03-04 00:34:43.931838 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-04 00:34:43.934242 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-04 00:34:43.934334 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_ADJUSTMENT" AS A
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_ADJUSTMENT_DLHK
  --BK
  ,ID AS K_ORDER_ADJUSTMENT_BK
  ,ORDER_ID AS K_ORDER_BK
  ,REFUND_ID AS K_REFUND_BK
  --ATTRIBUTE
  ,KIND AS A_KIND
  ,REASON AS A_REASON
  --METRIC
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT_PRIMARY
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-04 00:34:43.934429 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:34:45.895324 (Thread-1): SQL status: SUCCESS 1 in 1.96 seconds
2022-03-04 00:34:45.898323 (Thread-1): finished collecting timing info
2022-03-04 00:34:45.898632 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: Close
2022-03-04 00:34:46.343534 (Thread-1): 21:34:46 | 5 of 26 OK created view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG.... [SUCCESS 1 in 2.42s]
2022-03-04 00:34:46.343804 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-04 00:34:46.344066 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-04 00:34:46.344506 (Thread-1): 21:34:46 | 6 of 26 START view model DBT_SHOPIFY.V_ORDERS_HEADER_STG............. [RUN]
2022-03-04 00:34:46.344764 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-04 00:34:46.344895 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-04 00:34:46.353209 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-04 00:34:46.354610 (Thread-1): finished collecting timing info
2022-03-04 00:34:46.356376 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-04 00:34:46.365178 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-04 00:34:46.365332 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDERS" AS A
),
rename AS 
(
SELECT
    MD5(O.ID) AS K_ORDER_DLHK    
    ,MD5(O.CUSTOMER_ID) AS K_CUSTOMER_DLHK
    ,MD5(O.LOCATION_ID) AS K_LOCATION_DLHK    
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
    --BUSINESS_KEYS
    ,O.APP_ID AS K_APP_BK
    ,O.ID AS K_ORDER_BK
    ,O.CUSTOMER_ID AS K_CUSTOMER_BK
    ,O.DEVICE_ID AS K_DEVICE_BK  
    ,O.LOCATION_ID AS K_LOCATION_BK
    ,O.SOURCE_IDENTIFIER AS K_SOURCE_ENTIFIER_BK
    --ATTRIBUTES
    ,O.BROWSER_IP AS A_BROWSER_IP
    ,O.CANCELLED_AT AS A_CANCELLED_AT_DTS
    ,O.CANCEL_REASON AS A_CANCEL_REASON
    ,O.CART_TOKEN AS A_CART_TOKEN
    ,O.CHECKOUT_TOKEN AS A_CHECKOUT_TOKEN
    ,O.CLIENT_DETAILS AS A_CLIENT_DETAILS
    ,O.CLOSED_AT AS A_CLOSED_AT_DTS
    ,O.CREATED_AT AS A_CREATED_AT_DTS
    ,O.CURRENCY AS A_CURRENCY
    ,O.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
    ,O.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
    ,O.EMAIL AS A_EMAIL
    ,O.FINANCIAL_STATUS AS A_FINANCIAL_STATUS
    ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
    ,O.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
    ,O.LANDING_SITE_REF AS A_LANDING_SITE_REF
    ,O.NAME AS A_NAME
    ,O.NOTE AS A_NOTE
    ,O.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES    
    ,O.PAYMENT_GATEWAY_NAMES AS A_PAYMENT_GATEWAY_NAMES    
    ,O.PROCESSED_AT AS A_PROCESSED_AT_DTS
    ,O.PROCESSING_METHOD AS A_PROCESSING_METHOD
    ,O.REFERENCE AS A_REFERENCE
    ,O.REFERRING_SITE AS A_REFERRING_SITE    
    ,O.SOURCE_NAME AS A_SOURCE_NAME
    ,O.SOURCE_URL AS A_SOURCE_URL    
    ,O.ORDER_NUMBER AS A_ORDER_NUMBER
    ,O.POSION_NUMBER AS A_POSION_NUMBER  
    ,O.UPDATED_AT AS A_UPDATED_AT_DTS
    --BOOLEAN
    ,O.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
    ,O.CONFIRMED AS B_CONFIRMED
    ,O.TAXES_INCLUDED AS B_TAXES_INCLUDED
    --METRICS
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE_PRIMARY 
    ,O.TOTAL_TIP_RECEIVED::DECIMAL(15,2) AS M_TOTAL_TIP_RECEIVED   
    ,O.TOTAL_WEIGHT::DECIMAL(15,2) AS M_TOTAL_WEIGHT
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
FROM source O
)

SELECT * FROM rename
  );
2022-03-04 00:34:46.365462 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:34:48.184142 (Thread-1): SQL status: SUCCESS 1 in 1.82 seconds
2022-03-04 00:34:48.188382 (Thread-1): finished collecting timing info
2022-03-04 00:34:48.188850 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: Close
2022-03-04 00:34:48.659633 (Thread-1): 21:34:48 | 6 of 26 OK created view model DBT_SHOPIFY.V_ORDERS_HEADER_STG........ [SUCCESS 1 in 2.31s]
2022-03-04 00:34:48.659881 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-04 00:34:48.660087 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-04 00:34:48.660278 (Thread-1): 21:34:48 | 7 of 26 START view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG.. [RUN]
2022-03-04 00:34:48.660520 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-04 00:34:48.660628 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-04 00:34:48.663538 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-04 00:34:48.664233 (Thread-1): finished collecting timing info
2022-03-04 00:34:48.665708 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-04 00:34:48.668126 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-04 00:34:48.684587 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM_TAX_LINE" AS A
),
rename AS 
(
SELECT
  CONCAT(COALESCE(ORDER_ID,'0000000000'),'-',COALESCE(ORDER_LINE_ID,'0000000000')) AS K_ORDER_LINE_ITEM_TAX_DLHK
  ,ORDER_ID AS K_ORDER_BK
  ,ORDER_LINE_ID AS K_ORDER_LINE_ITEM_BK
  ,TITLE AS A_TITLE
  ,CHANNEL_LIABLE AS B_CHANNEL_LIABLE
  ,RATE AS M_RATE
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-04 00:34:48.684892 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:34:50.603733 (Thread-1): SQL status: SUCCESS 1 in 1.92 seconds
2022-03-04 00:34:50.607708 (Thread-1): finished collecting timing info
2022-03-04 00:34:50.607931 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: Close
2022-03-04 00:34:51.057415 (Thread-1): 21:34:51 | 7 of 26 OK created view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG [SUCCESS 1 in 2.40s]
2022-03-04 00:34:51.057638 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-04 00:34:51.057785 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-04 00:34:51.057950 (Thread-1): 21:34:51 | 8 of 26 START view model DBT_SHOPIFY.V_PRODUCT_STG................... [RUN]
2022-03-04 00:34:51.058204 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-04 00:34:51.058318 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_STG
2022-03-04 00:34:51.061130 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-04 00:34:51.061596 (Thread-1): finished collecting timing info
2022-03-04 00:34:51.064659 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-04 00:34:51.066622 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-04 00:34:51.066776 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_DLHK
  ,ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE
  ,HANDLE AS A_HANDLE
  ,PRODUCT_TYPE AS A_PRODUCT_TYPE
  ,VENDOR AS A_VENDOR
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE
  ,STATUS AS A_STATUS
  ,TEMPLATE_SUFFIX AS A_TEMPLATE_SUFFIX   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-04 00:34:51.066881 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:34:53.968686 (Thread-1): SQL status: SUCCESS 1 in 2.90 seconds
2022-03-04 00:34:53.970995 (Thread-1): finished collecting timing info
2022-03-04 00:34:53.971176 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: Close
2022-03-04 00:34:57.154045 (Thread-1): 21:34:57 | 8 of 26 OK created view model DBT_SHOPIFY.V_PRODUCT_STG.............. [SUCCESS 1 in 6.10s]
2022-03-04 00:34:57.154924 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-04 00:34:57.155141 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-04 00:34:57.155318 (Thread-1): 21:34:57 | 9 of 26 START view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG........... [RUN]
2022-03-04 00:34:57.155536 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-04 00:34:57.155644 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-04 00:34:57.158186 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-04 00:34:57.158674 (Thread-1): finished collecting timing info
2022-03-04 00:34:57.159992 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-04 00:34:57.162017 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-04 00:34:57.162218 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT_VARIANT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_VARIANT_DLHK
  ,MD5(PRODUCT_ID) AS K_PRODUCT_DLHK  
  --BUSINESS KEYS  
  ,ID AS K_PRODUCT_VARIANT_BK
  ,PRODUCT_ID AS K_PRODUCT_BK  
  ,INVENTORY_ITEM_ID AS K_INVENTORY_ITEM_BK
  ,IMAGE_ID AS K_IMAGE_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE  
  ,SKU AS A_SKU    
  ,FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,INVENTORY_MANAGEMENT AS A_INVENTORY_MANAGEMENT
  ,INVENTORY_POLICY AS A_INVENTORY_POLICY
  ,BARCODE AS A_BARCODE
  ,GRAMS AS A_GRAMS
  ,WEIGHT_UNIT AS A_WEIGHT_UNIT
  ,OPTION_1 AS A_OPTION_1
  ,OPTION_2 AS A_OPTION_2
  ,OPTION_3 AS A_OPTION_3
  ,TAX_CODE AS A_TAX_CODE  
  ,PRESENTMENT_PRICES AS A_PRESENTMENT_PRICES  
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  --BOOLEAN
  ,REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,TAXABLE AS B_TAXABLE
  --METRICS
  ,PRICE AS M_PRICE
  ,POSITION AS M_POSITION
  ,COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,INVENTORY_QUANTITY AS M_INVENTORY_QUANTITY
  ,INVENTORY_QUANTITY_ADJUSTMENT AS M_INVENTORY_QUANTITY_ADJUSTMENT
  ,WEIGHT AS M_WEIGHT
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-04 00:34:57.162335 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:34:58.830027 (Thread-1): SQL status: SUCCESS 1 in 1.67 seconds
2022-03-04 00:34:58.833202 (Thread-1): finished collecting timing info
2022-03-04 00:34:58.833392 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: Close
2022-03-04 00:34:59.398814 (Thread-1): 21:34:59 | 9 of 26 OK created view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG...... [SUCCESS 1 in 2.24s]
2022-03-04 00:34:59.399439 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-04 00:34:59.399784 (Thread-1): Began running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-04 00:34:59.400439 (Thread-1): 21:34:59 | 10 of 26 START view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG......... [RUN]
2022-03-04 00:34:59.401167 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-04 00:34:59.401487 (Thread-1): Compiling model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-04 00:34:59.410416 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-04 00:34:59.411187 (Thread-1): finished collecting timing info
2022-03-04 00:34:59.413745 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-04 00:34:59.418840 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-04 00:34:59.419019 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG  as (
    


WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND" AS A
),
refund_line as (
    SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND_LINE_ITEM" AS A
),
rename AS 
(
SELECT
  MD5(RL.ID) AS K_REFUND_LINE_DLHK
  ,MD5(R.ID) AS K_REFUND_DLHK
  ,R.ID AS K_REFUND_BK
  ,RL.ID AS K_REFUND_LINE_BK
  ,R.ORDER_ID AS K_ORDER_BK
  ,R.USER_ID AS K_USER_BK
  ,RL.LOCATION_ID AS K_LOCATION_BK
  ,RL.LINE_ITEM_ID AS K_ORDER_LINE_ITEM_BK
  ,R.NOTE AS A_NOTE
  ,R.RESTOCK AS B_RESTOCK
  ,RL.QUANTITY AS M_QUANTITY
  ,RL.RESTOCK_TYPE AS A_RESTOCK_TYPE
   
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL


  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
FROM source R
LEFT JOIN refund_line RL ON RL.REFUND_ID = R.ID
)

SELECT * FROM rename
  );
2022-03-04 00:34:59.419204 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:01.403526 (Thread-1): SQL status: SUCCESS 1 in 1.98 seconds
2022-03-04 00:35:01.405380 (Thread-1): finished collecting timing info
2022-03-04 00:35:01.405585 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: Close
2022-03-04 00:35:01.833808 (Thread-1): 21:35:01 | 10 of 26 OK created view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG.... [SUCCESS 1 in 2.43s]
2022-03-04 00:35:01.834105 (Thread-1): Finished running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-04 00:35:01.834248 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-04 00:35:01.834410 (Thread-1): 21:35:01 | 11 of 26 START table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D.......... [RUN]
2022-03-04 00:35:01.834728 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-04 00:35:01.834857 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-04 00:35:01.837301 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-04 00:35:01.838530 (Thread-1): finished collecting timing info
2022-03-04 00:35:01.856824 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-04 00:35:01.862656 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-04 00:35:01.862781 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG AS C
      );
2022-03-04 00:35:01.862882 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:04.768968 (Thread-1): SQL status: SUCCESS 1 in 2.91 seconds
2022-03-04 00:35:04.775247 (Thread-1): finished collecting timing info
2022-03-04 00:35:04.775441 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: Close
2022-03-04 00:35:05.212668 (Thread-1): 21:35:05 | 11 of 26 OK created table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D..... [SUCCESS 1 in 3.38s]
2022-03-04 00:35:05.212892 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-04 00:35:05.213145 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-04 00:35:05.213365 (Thread-1): 21:35:05 | 12 of 26 START table model DBT_SHOPIFY.W_CUSTOMERS_D................. [RUN]
2022-03-04 00:35:05.213610 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-04 00:35:05.213719 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-04 00:35:05.218018 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-04 00:35:05.219198 (Thread-1): finished collecting timing info
2022-03-04 00:35:05.220799 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-04 00:35:05.221918 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-04 00:35:05.222045 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG AS C
      );
2022-03-04 00:35:05.222140 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:07.588965 (Thread-1): SQL status: SUCCESS 1 in 2.37 seconds
2022-03-04 00:35:07.592075 (Thread-1): finished collecting timing info
2022-03-04 00:35:07.592578 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-04 00:35:08.060499 (Thread-1): 21:35:08 | 12 of 26 OK created table model DBT_SHOPIFY.W_CUSTOMERS_D............ [SUCCESS 1 in 2.85s]
2022-03-04 00:35:08.061171 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-04 00:35:08.061778 (Thread-1): Began running node model.snowflake_aicd.W_DATE_D
2022-03-04 00:35:08.062684 (Thread-1): 21:35:08 | 13 of 26 START table model DBT_SHOPIFY.W_DATE_D...................... [RUN]
2022-03-04 00:35:08.062976 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-04 00:35:08.063085 (Thread-1): Compiling model.snowflake_aicd.W_DATE_D
2022-03-04 00:35:08.065602 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-04 00:35:08.066571 (Thread-1): finished collecting timing info
2022-03-04 00:35:08.068184 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-04 00:35:08.071682 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-04 00:35:08.071827 (Thread-1): On model.snowflake_aicd.W_DATE_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_DATE_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_DATE_D  as
      (

SELECT 
	CAST(DATE_KEY AS NUMBER(9)) AS K_DATE_INTEGER_BK
	,CAST(DATE_COLUMN AS DATE) AS K_DATE_BK
	,CAST(FULL_DATE_DESC AS VARCHAR(64)) AS A_FULL_DATE_DESC
	,CAST(DAY_NUM_IN_WEEK AS NUMBER(1)) AS A_DAY_NUM_IN_WEEK
	,CAST(DAY_NUM_IN_MONTH AS NUMBER(2)) AS A_DAY_NUM_IN_MONTH
	,CAST(DAY_NUM_IN_YEAR AS NUMBER(3)) AS A_DAY_NUM_IN_YEAR
	,CAST(DAY_NAME AS VARCHAR(10)) AS A_DAY_NAME
	,CAST(DAY_ABBREV AS VARCHAR(3)) AS A_DAY_ABBREV
	,CAST(WEEKDAY_IND AS VARCHAR(64)) AS A_WEEKDAY_IND
	,CAST(US_HOLIDAY_IND AS VARCHAR(64)) AS A_US_HOLIDAY_IND
	,CAST(COMPANY_HOLIDAY_IND AS VARCHAR(64)) AS A_COMPANY_HOLIDAY_IND
	,CAST(MONTH_END_IND AS VARCHAR(64)) AS A_MONTH_END_IND
	,CAST(WEEK_BEGIN_DATE_NKEY AS NUMBER(9)) AS A_WEEK_BEGIN_DATE_NKEY
	,CAST(WEEK_BEGIN_DATE AS DATE) AS A_WEEK_BEGIN_DATE
	,CAST(WEEK_END_DATE_NKEY AS NUMBER(9)) AS A_WEEK_END_DATE_NKEY
	,CAST(WEEK_END_DATE AS DATE) AS A_WEEK_END_DATE
	,CAST(WEEK_NUM_IN_YEAR AS NUMBER(9)) AS A_WEEK_NUM_IN_YEAR
	,CAST(MONTH_NAME AS VARCHAR(10)) AS A_MONTH_NAME
	,CAST(MONTH_ABBREV AS VARCHAR(3)) AS A_MONTH_ABBREV
	,CAST(MONTH_NUM_IN_YEAR AS NUMBER(2)) AS A_MONTH_NUM_IN_YEAR
	,CAST(YEARMONTH AS VARCHAR(10)) AS A_YEARMONTH
	,CAST(CURRENT_QUARTER AS NUMBER(1)) AS A_QUARTER
	,CAST(YEARQUARTER AS VARCHAR(10)) AS A_YEARQUARTER
	,CAST(CURRENT_YEAR AS NUMBER(5)) AS A_YEAR
	,CAST(FISCAL_WEEK_NUM AS NUMBER(2)) AS A_FISCAL_WEEK_NUM
	,CAST(FISCAL_MONTH_NUM AS NUMBER(2)) AS A_FISCAL_MONTH_NUM
	,CAST(FISCAL_YEARMONTH AS VARCHAR(10)) AS A_FISCAL_YEARMONTH
	,CAST(FISCAL_QUARTER AS NUMBER(1)) AS A_FISCAL_QUARTER
	,CAST(FISCAL_YEARQUARTER AS VARCHAR(10)) AS A_FISCAL_YEARQUARTER
	,CAST(FISCAL_HALFYEAR AS NUMBER(1)) AS A_FISCAL_HALFYEAR
	,CAST(FISCAL_YEAR AS NUMBER(5)) AS A_FISCAL_YEAR
	,CAST(SQL_TIMESTAMP AS TIMESTAMP_NTZ) AS A_SQL_TIMESTAMP_DTS
	,CAST(CURRENT_ROW_IND AS CHAR(1)) AS A_CURRENT_ROW_IND
	,CAST(EFFECTIVE_DATE AS DATE) AS A_EFFECTIVE_DATE
	,CAST(EXPIRA_DATE AS DATE) AS A_EXPIRATION_DATE
FROM
DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG
      );
2022-03-04 00:35:08.071931 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:11.792668 (Thread-1): SQL status: SUCCESS 1 in 3.72 seconds
2022-03-04 00:35:11.796499 (Thread-1): finished collecting timing info
2022-03-04 00:35:11.796762 (Thread-1): On model.snowflake_aicd.W_DATE_D: Close
2022-03-04 00:35:12.247550 (Thread-1): 21:35:12 | 13 of 26 OK created table model DBT_SHOPIFY.W_DATE_D................. [SUCCESS 1 in 4.18s]
2022-03-04 00:35:12.247764 (Thread-1): Finished running node model.snowflake_aicd.W_DATE_D
2022-03-04 00:35:12.247950 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-04 00:35:12.248463 (Thread-1): 21:35:12 | 14 of 26 START table model DBT_SHOPIFY.W_LOCATION_D.................. [RUN]
2022-03-04 00:35:12.248831 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-04 00:35:12.249010 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-04 00:35:12.252393 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-04 00:35:12.253011 (Thread-1): finished collecting timing info
2022-03-04 00:35:12.254578 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-04 00:35:12.255582 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-04 00:35:12.255722 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-04 00:35:12.255819 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:16.551121 (Thread-1): SQL status: SUCCESS 1 in 4.30 seconds
2022-03-04 00:35:16.554194 (Thread-1): finished collecting timing info
2022-03-04 00:35:16.554439 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-04 00:35:16.977837 (Thread-1): 21:35:16 | 14 of 26 OK created table model DBT_SHOPIFY.W_LOCATION_D............. [SUCCESS 1 in 4.73s]
2022-03-04 00:35:16.978049 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-04 00:35:16.978211 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-04 00:35:16.978395 (Thread-1): 21:35:16 | 15 of 26 START view model DBT_SHOPIFY.V_PRODUCTS_D_STG............... [RUN]
2022-03-04 00:35:16.978605 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-04 00:35:16.978734 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-04 00:35:16.982472 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-04 00:35:16.983011 (Thread-1): finished collecting timing info
2022-03-04 00:35:16.984625 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-04 00:35:16.988131 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-04 00:35:16.988261 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCTS_D_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG  as (
    
 

WITH product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG
),
product_variant AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG
),

rename as (


SELECT
    MD5(CONCAT(P.K_PRODUCT_BK,'-',COALESCE(V.K_PRODUCT_VARIANT_BK,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
    ,P.K_PRODUCT_DLHK
    ,V.K_PRODUCT_VARIANT_DLHK AS K_PRODUCT_VARIANT_DLHK
    ,V.K_PRODUCT_VARIANT_BK AS K_PRODUCT_VARIANT_BK
    ,P.K_PRODUCT_BK AS K_PRODUCT_BK
    ,V.K_INVENTORY_ITEM_BK AS K_VARIANT_INVENTORY_ITEM_BK
    ,V.K_IMAGE_BK AS K_VARIANT_IMAGE_BK
    --ATTRIBUTES
    ,P.A_TITLE
    ,P.A_HANDLE
    ,P.A_PRODUCT_TYPE
    ,P.A_VENDOR
    ,P.A_CREATED_AT_DTS
    ,P.A_UPDATED_AT_DTS
    ,P.A_PUBLISHED_AT_DTS
    ,P.A_PUBLISHED_SCOPE
    ,P.A_STATUS
    ,P.A_TEMPLATE_SUFFIX       
    ,V.A_TITLE AS A_VARIANT_TITLE
    ,V.A_SKU AS A_VARIANT_SKU
    ,V.A_FULFILLMENT_SERVICE AS A_VARIANT_FULFILLMENT_SERVICE
    ,V.A_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
    ,V.A_BARCODE AS A_VARIANT_BARCODE
    ,V.A_INVENTORY_POLICY AS A_VARIANT_INVENTORY_POLICY
    ,V.A_GRAMS AS A_VARIANT_GRAMS
    ,V.A_WEIGHT_UNIT AS A_VARIANT_WEIGHT_UNIT
    ,V.A_OPTION_1 AS A_VARIANT_OPTION_1
    ,V.A_OPTION_2 AS A_VARIANT_OPTION_2
    ,V.A_OPTION_3 AS A_VARIANT_OPTION_3
    ,V.A_TAX_CODE AS A_VARIANT_TAX_CODE
    ,V.A_PRESENTMENT_PRICES AS A_VARIANT_PRESENTMENT_PRICES
    ,V.A_CREATED_AT_DTS AS A_VARIANT_CREATED_AT_DTS
    ,V.A_UPDATED_AT_DTS AS A_VARIANT_UPDATED_AT_DTS
    --BOOLEAN
    ,V.B_REQUIRES_SHIPPING AS B_VARIANT_REQUIRES_SHIPPING
    ,V.B_TAXABLE AS B_VARIANT_TAXABLE
    --METRICS
    ,V.M_PRICE AS M_VARIANT_PRICE
    ,V.M_POSITION AS M_VARIANT_POSITION
    ,V.M_COMPARE_AT_PRICE AS M_VARIANT_COMPARE_AT_PRICE
    ,V.M_INVENTORY_QUANTITY AS M_VARIANT_INVENTORY_QUANTITY
    ,V.M_INVENTORY_QUANTITY_ADJUSTMENT AS M_VARIANT_INVENTORY_QUANTITY_ADJUSTMENT
    ,V.M_WEIGHT AS M_VARIANT_WEIGHT
    --metadata (MD)
    ,P.MD_IS_DELETED AS MD_IS_DELETED_PRODUCT
    ,V.MD_IS_DELETED AS MD_IS_DELETED_VARIANT
    , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
    , '28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
FROM
    product P
    LEFT JOIN product_variant V ON V.K_PRODUCT_BK = P.K_PRODUCT_BK
)

SELECT * FROM rename
  );
2022-03-04 00:35:16.988368 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:18.849830 (Thread-1): SQL status: SUCCESS 1 in 1.86 seconds
2022-03-04 00:35:18.852321 (Thread-1): finished collecting timing info
2022-03-04 00:35:18.852514 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: Close
2022-03-04 00:35:19.296382 (Thread-1): 21:35:19 | 15 of 26 OK created view model DBT_SHOPIFY.V_PRODUCTS_D_STG.......... [SUCCESS 1 in 2.32s]
2022-03-04 00:35:19.296603 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-04 00:35:19.296761 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-04 00:35:19.296952 (Thread-1): 21:35:19 | 16 of 26 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG....... [RUN]
2022-03-04 00:35:19.297200 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-04 00:35:19.297345 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-04 00:35:19.300906 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-04 00:35:19.301717 (Thread-1): finished collecting timing info
2022-03-04 00:35:19.303408 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-04 00:35:19.308732 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-04 00:35:19.308872 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT"
),
customer AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 

  MD5(S.ID) AS K_ABANDONED_CHECKOUT_DLHK
  ,C.K_CUSTOMER_DLHK
  ,L.K_LOCATION_DLHK
  ,MD5(S.USER_ID) AS K_USER_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK  
  ,S.ID AS K_ABANDONED_CHECKOUT_BK
  ,S.CUSTOMER_ID AS K_CUSTOMER_BK
  ,S.DEVICE_ID AS K_DEVICE_BK
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.SOURCE_IDENTIFIER AS K_SOURCE_BKENTIFIER
  ,S.USER_ID AS K_USER_BK
  ,S.ABANDONED_CHECKOUT_URL AS A_ABANDONED_CHECKOUT_URL  
  ,S.CART_TOKEN AS A_CART_TOKEN
  ,S.CLOSED_AT AS A_CLOSED_AT
  ,S.COMPLETED_AT AS A_COMPLETED_AT
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
  ,S.EMAIL AS A_EMAIL
  ,S.GATEWAY AS A_GATEWAY
  ,S.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
  ,S.NAME AS A_NAME
  ,S.NOTE AS A_NOTE
  ,S.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES
  ,S.PHONE AS A_PHONE
  ,S.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
  ,S.REFERRING_SITE AS A_REFERRING_SITE    
  ,S.SOURCE AS A_SOURCE
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.SOURCE_URL AS A_SOURCE_URL
  ,S.TOKEN AS A_TOKEN
  ,S.UPDATED_AT AS A_UPDATED_AT  
  --BOOLEAN
  ,S.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
  ,S.TAXES_INCLUDED AS B_TAXES_INCLUDED
  --METRIC
  ,S.SUBTOTAL_PRICE::decimal(15,2) AS M_SUBTOTAL_PRICE
  ,S.TOTAL_DISCOUNTS::decimal(15,2) AS M_TOTAL_DISCOUNTS
  ,S.TOTAL_DUTIES::decimal(15,2) AS M_TOTAL_DUTIES
  ,S.TOTAL_LINE_ITEMS_PRICE::decimal(15,2) AS M_TOTAL_LINE_ITEMS_PRICE
  ,S.TOTAL_PRICE::decimal(15,2) AS M_TOTAL_PRICE
  ,S.TOTAL_TAX::decimal(15,2) AS M_TOTAL_TAX
  ,S.TOTAL_WEIGHT::decimal(15,2) AS M_TOTAL_WEIGHT
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
  FROM
      source S
      left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
      left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-04 00:35:19.308990 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:21.585308 (Thread-1): SQL status: SUCCESS 1 in 2.28 seconds
2022-03-04 00:35:21.588070 (Thread-1): finished collecting timing info
2022-03-04 00:35:21.588300 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: Close
2022-03-04 00:35:22.026959 (Thread-1): 21:35:22 | 16 of 26 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.. [SUCCESS 1 in 2.73s]
2022-03-04 00:35:22.027775 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-04 00:35:22.028175 (Thread-1): Began running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-04 00:35:22.028375 (Thread-1): 21:35:22 | 17 of 26 START view model DBT_SHOPIFY.V_TRANSACTIONS_STG............. [RUN]
2022-03-04 00:35:22.028741 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-04 00:35:22.028866 (Thread-1): Compiling model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-04 00:35:22.031632 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-04 00:35:22.032203 (Thread-1): finished collecting timing info
2022-03-04 00:35:22.033567 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-04 00:35:22.035468 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-04 00:35:22.035562 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_TRANSACTIONS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."TRANSACTION"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_TRANSACTION_DLHK
  ,L.K_LOCATION_DLHK  
  ,MD5(S.USER_ID) AS K_USER_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_TRANSACTION_BK
  ,S.DEVICE_ID AS K_DEVICE_BK  
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.ORDER_ID AS K_ORDER_BK
  ,S.PARENT_ID AS K_PARENT_BK
  ,S.REFUND_ID AS K_REFUND_BK
  ,S.USER_ID AS K_USER_BK  
  --ATTRIBUTES
  ,S.AUTHORIZATION AS A_AUTHORIZATION
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CURRENCY_EXCHANGE_ADJUSTMENT AS A_CURRENCY_EXCHANGE_ADJUSTMENT
  ,S.ERROR_CODE AS A_ERROR_CODE
  ,S.GATEWAY AS A_GATEWAY
  ,S.KIND AS A_KIND
  ,S.MESSAGE AS A_MESSAGE
  ,S.PAYMENT_DETAILS AS A_PAYMENT_DETAILS
  ,S.PROCESSED_AT AS A_PROCESSED_AT
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.STATUS AS A_STATUS
  --boolean
  ,S.TEST AS B_TEST
  --METRICS
  ,S.AMOUNT::decimal(15,2) AS M_AMOUNT   
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
  FROM
    source S  
  left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-04 00:35:22.035659 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:23.652037 (Thread-1): SQL status: SUCCESS 1 in 1.62 seconds
2022-03-04 00:35:23.654632 (Thread-1): finished collecting timing info
2022-03-04 00:35:23.654821 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: Close
2022-03-04 00:35:24.106547 (Thread-1): 21:35:24 | 17 of 26 OK created view model DBT_SHOPIFY.V_TRANSACTIONS_STG........ [SUCCESS 1 in 2.08s]
2022-03-04 00:35:24.106763 (Thread-1): Finished running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-04 00:35:24.106898 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-04 00:35:24.107064 (Thread-1): 21:35:24 | 18 of 26 START table model DBT_SHOPIFY.W_PRODUCTS_D.................. [RUN]
2022-03-04 00:35:24.107260 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-04 00:35:24.107367 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCTS_D
2022-03-04 00:35:24.109872 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-04 00:35:24.110389 (Thread-1): finished collecting timing info
2022-03-04 00:35:24.111763 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-04 00:35:24.112600 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-04 00:35:24.112694 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCTS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG AS C
      );
2022-03-04 00:35:24.112787 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:27.168665 (Thread-1): SQL status: SUCCESS 1 in 3.06 seconds
2022-03-04 00:35:27.171455 (Thread-1): finished collecting timing info
2022-03-04 00:35:27.171667 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: Close
2022-03-04 00:35:27.622625 (Thread-1): 21:35:27 | 18 of 26 OK created table model DBT_SHOPIFY.W_PRODUCTS_D............. [SUCCESS 1 in 3.51s]
2022-03-04 00:35:27.623698 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-04 00:35:27.623950 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-04 00:35:27.624134 (Thread-1): 21:35:27 | 19 of 26 START table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F........ [RUN]
2022-03-04 00:35:27.624580 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-04 00:35:27.624704 (Thread-1): Compiling model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-04 00:35:27.627275 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-04 00:35:27.628190 (Thread-1): finished collecting timing info
2022-03-04 00:35:27.629514 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-04 00:35:27.630091 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-04 00:35:27.630184 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG AS C
      );
2022-03-04 00:35:27.630274 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:30.716860 (Thread-1): SQL status: SUCCESS 1 in 3.09 seconds
2022-03-04 00:35:30.721162 (Thread-1): finished collecting timing info
2022-03-04 00:35:30.721358 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: Close
2022-03-04 00:35:31.179994 (Thread-1): 21:35:31 | 19 of 26 OK created table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F... [SUCCESS 1 in 3.56s]
2022-03-04 00:35:31.180209 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-04 00:35:31.180362 (Thread-1): Began running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-04 00:35:31.180515 (Thread-1): 21:35:31 | 20 of 26 START table model DBT_SHOPIFY.W_TRANSACTIONS_F.............. [RUN]
2022-03-04 00:35:31.180714 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-04 00:35:31.180826 (Thread-1): Compiling model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-04 00:35:31.183290 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-04 00:35:31.184055 (Thread-1): finished collecting timing info
2022-03-04 00:35:31.185410 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-04 00:35:31.186353 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-04 00:35:31.186447 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_TRANSACTIONS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_TRANSACTIONS_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG AS C
      );
2022-03-04 00:35:31.186538 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:34.179972 (Thread-1): SQL status: SUCCESS 1 in 2.99 seconds
2022-03-04 00:35:34.183324 (Thread-1): finished collecting timing info
2022-03-04 00:35:34.183564 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: Close
2022-03-04 00:35:34.645040 (Thread-1): 21:35:34 | 20 of 26 OK created table model DBT_SHOPIFY.W_TRANSACTIONS_F......... [SUCCESS 1 in 3.46s]
2022-03-04 00:35:34.645246 (Thread-1): Finished running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-04 00:35:34.645383 (Thread-1): Began running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-04 00:35:34.645547 (Thread-1): 21:35:34 | 21 of 26 START view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG........... [RUN]
2022-03-04 00:35:34.645974 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-04 00:35:34.646105 (Thread-1): Compiling model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-04 00:35:34.649371 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-04 00:35:34.650174 (Thread-1): finished collecting timing info
2022-03-04 00:35:34.651640 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-04 00:35:34.653725 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-04 00:35:34.653825 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_INVENTORY_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_ITEM"
),
inventory_level AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_LEVEL"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
products AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename AS 
(   
  SELECT   
  MD5(S.ID) AS K_INVENTORY_ITEM_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
  ,L.K_LOCATION_DLHK
  ,L.K_LOCATION_BK  
  ,S.ID AS K_INVENTORY_ITEM_BK
  ,S.COUNTRY_CODE_OF_ORIGIN AS A_COUNTRY_CODE_OF_ORIGIN
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.PROVINCE_CODE_OF_ORIGIN AS A_PROVINCE_CODE_OF_ORIGIN
  ,S.SKU AS A_SKU
  ,S.UPDATED_AT AS A_UPDATED_AT
  ,S.HARMONIZED_SYSTEM_CODE AS A_HARMONIZED_SYSTEM_CODE  
  --BOOLEAN
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TRACKED AS B_TRACKED
  --METRICS
  ,S.COST::decimal(15,2) AS M_COST 
  ,IL.AVAILABLE AS M_AVAIABLE  
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
  FROM
      source S
      left join inventory_level IL ON IL.INVENTORY_ITEM_ID = S.ID      
      left join locations L ON L.K_LOCATION_BK = IL.LOCATION_ID
      left join products P ON P.K_VARIANT_INVENTORY_ITEM_BK = S.ID 
)


SELECT * FROM rename
  );
2022-03-04 00:35:34.653927 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:36.430290 (Thread-1): SQL status: SUCCESS 1 in 1.78 seconds
2022-03-04 00:35:36.433067 (Thread-1): finished collecting timing info
2022-03-04 00:35:36.433262 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: Close
2022-03-04 00:35:36.875683 (Thread-1): 21:35:36 | 21 of 26 OK created view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG...... [SUCCESS 1 in 2.23s]
2022-03-04 00:35:36.875892 (Thread-1): Finished running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-04 00:35:36.876027 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-04 00:35:36.876181 (Thread-1): 21:35:36 | 22 of 26 START view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG......... [RUN]
2022-03-04 00:35:36.876404 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-04 00:35:36.876509 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-04 00:35:36.880600 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-04 00:35:36.881325 (Thread-1): finished collecting timing info
2022-03-04 00:35:36.884645 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-04 00:35:36.892148 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-04 00:35:36.892308 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM" AS A
),
products AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D AS A
),
taxes AS (
  SELECT 
      K_ORDER_LINE_ITEM_BK,
      AVG(M_RATE) AS M_RATE,
      SUM(M_TAX) AS M_TAX,
      SUM(M_TAX_PRIMARY) AS M_TAX_PRIMARY
    FROM 
      DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG AS A
    GROUP BY K_ORDER_LINE_ITEM_BK
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_LINE_ITEM_DLHK  
  ,MD5(ORDER_ID) AS K_ORDER_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
 --business keys
  ,O.PRODUCT_ID AS K_PRODUCT_BK
  ,O.VARIANT_ID AS K_VARIANT_BK
  
  ,O.ORDER_ID AS K_ORDER_BK
  ,O.ID AS K_ORDER_LINE_ITEM_BK
  --attribubtes
  ,O.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
  ,O.NAME AS A_NAME  
  ,O.PROPERTIES AS A_PROPERTIES
  ,O.SKU AS A_SKU
  ,O.TITLE AS A_TITLE  
  ,O.VARIANT_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
  ,O.VARIANT_TITLE AS A_VARIANT_TITLE
  ,O.VENDOR AS A_VENDOR
  --boolean
  ,O.GIFT_CARD AS B_GIFT_CARD
  ,O.PRODUCT_EXISTS AS B_PRODUCT_EXISTS
  ,O.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,O.TAXABLE AS B_TAXABLE
  --metrics
  ,O.FULFILLABLE_QUANTITY AS M_FULFILLABLE_QUANTITY
  ,O.GRAMS::DECIMAL(15,2) AS M_GRAMS
  ,O.QUANTITY::DECIMAL(15,2) AS M_QUANTITY
  ,M_RATE AS M_TAX_RATE
  ,COALESCE(T.M_TAX_PRIMARY,0)::DECIMAL(15,2) AS M_TAX_AMOUNT
  ,COALESCE(T.M_TAX,0)::DECIMAL(15,2) AS M_TAX_AMOUNT_PRIMARY

  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE_PRIMARY 
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT_PRIMARY 
  ,(O.QUANTITY * M_UNIT_PRICE)::DECIMAL(15,2) AS M_TOTAL_PRICE  
  ,(O.QUANTITY * M_UNIT_PRICE_PRIMARY)::DECIMAL(15,2) AS M_TOTAL_PRICE_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
FROM source O
  left join products P ON P.K_PRODUCT_BK = O.PRODUCT_ID AND CASE WHEN O.VARIANT_ID IS NOT NULL THEN O.VARIANT_ID = P.K_PRODUCT_VARIANT_BK ELSE 1=1 END
  left join taxes T ON T.K_ORDER_LINE_ITEM_BK = O.ID
)

SELECT * FROM rename
  );
2022-03-04 00:35:36.892415 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:38.547830 (Thread-1): SQL status: SUCCESS 1 in 1.66 seconds
2022-03-04 00:35:38.553179 (Thread-1): finished collecting timing info
2022-03-04 00:35:38.553403 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: Close
2022-03-04 00:35:38.999722 (Thread-1): 21:35:38 | 22 of 26 OK created view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG.... [SUCCESS 1 in 2.12s]
2022-03-04 00:35:39.000337 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-04 00:35:39.000805 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-04 00:35:39.001047 (Thread-1): 21:35:39 | 23 of 26 START view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG....... [RUN]
2022-03-04 00:35:39.001404 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-04 00:35:39.001544 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-04 00:35:39.004815 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-04 00:35:39.005288 (Thread-1): finished collecting timing info
2022-03-04 00:35:39.006680 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-04 00:35:39.008790 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-04 00:35:39.008894 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECT"
),
source_collection AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECTION"
),
product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename as (

SELECT
  MD5(S.ID) AS K_PRODUCT_COLLECT_DLHK
  ,MD5(CC.ID) AS K_COLLECTION_DLHK
  ,P.K_PRODUCT_DLHK  
  ,S.ID AS K_PRODUCT_COLLECT_BK
  ,CC.ID AS K_COLLECTION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,S.POSITION AS A_POSITION
  ,S.SORT_ORDER AS A_SORT_ORDER  
  ,S.CREATED_AT AS A_CREATED_AT_DTS
  ,S.UPDATED_AT AS A_UPDATED_AT_DTS
  ,CC.PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,CC.BODY_HTML AS A_BODY_HTML
  ,CC.TITLE AS A_TITLE
  ,CC.HANDLE AS A_HANDLE
  ,CC.PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE  
  ,CC.COLLECTION_TYPE AS A_COLLECTION_TYPE  
  --metrics
  ,CC.PRODUCTS_COUNT AS M_PRODUCTS_COUNT
  --metadata (MD)
  ,S.__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
FROM
    source S
    LEFT JOIN source_collection CC ON CC.ID = S.COLLECTION_ID
    LEFT JOIN product P ON P.K_PRODUCT_BK = S.PRODUCT_ID
)

SELECT * FROM rename
  );
2022-03-04 00:35:39.008994 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:46.308748 (Thread-1): SQL status: SUCCESS 1 in 7.30 seconds
2022-03-04 00:35:46.314222 (Thread-1): finished collecting timing info
2022-03-04 00:35:46.314787 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: Close
2022-03-04 00:35:46.805636 (Thread-1): 21:35:46 | 23 of 26 OK created view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG.. [SUCCESS 1 in 7.80s]
2022-03-04 00:35:46.816615 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-04 00:35:46.817398 (Thread-1): Began running node model.snowflake_aicd.W_INVENTORY_F
2022-03-04 00:35:46.818053 (Thread-1): 21:35:46 | 24 of 26 START table model DBT_SHOPIFY.W_INVENTORY_F................. [RUN]
2022-03-04 00:35:46.818802 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-04 00:35:46.819199 (Thread-1): Compiling model.snowflake_aicd.W_INVENTORY_F
2022-03-04 00:35:46.823090 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-04 00:35:46.823767 (Thread-1): finished collecting timing info
2022-03-04 00:35:46.825354 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-04 00:35:46.826033 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-04 00:35:46.826131 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_INVENTORY_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_INVENTORY_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG AS C
      );
2022-03-04 00:35:46.826224 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:49.739056 (Thread-1): SQL status: SUCCESS 1 in 2.91 seconds
2022-03-04 00:35:49.744851 (Thread-1): finished collecting timing info
2022-03-04 00:35:49.745042 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: Close
2022-03-04 00:35:50.192553 (Thread-1): 21:35:50 | 24 of 26 OK created table model DBT_SHOPIFY.W_INVENTORY_F............ [SUCCESS 1 in 3.37s]
2022-03-04 00:35:50.192764 (Thread-1): Finished running node model.snowflake_aicd.W_INVENTORY_F
2022-03-04 00:35:50.192893 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-04 00:35:50.193043 (Thread-1): 21:35:50 | 25 of 26 START table model DBT_SHOPIFY.W_ORDERS_F.................... [RUN]
2022-03-04 00:35:50.193240 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-04 00:35:50.193343 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-04 00:35:50.196377 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-04 00:35:50.197043 (Thread-1): finished collecting timing info
2022-03-04 00:35:50.198384 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-04 00:35:50.203561 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-04 00:35:50.203676 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ORDERS_F  as
      (

SELECT
  O.K_ORDER_DLHK AS K_ORDER_DLHK
  ,OLI.K_ORDER_LINE_ITEM_DLHK AS K_ORDER_LINE_ITEM_DLHK
  ,O.K_CUSTOMER_DLHK AS K_CUSTOMER_DLHK
  ,O.K_LOCATION_DLHK AS K_LOCATION_DLHK
  ,O.K_BILLING_ADDRESS_DLHK AS K_BILLING_ADDRESS_DLHK
  ,O.K_SHIPPING_ADDRESS_DLHK AS K_SHIPPING_ADDRESS_DLHK
  ,OLI.K_PRODUCT_VARIATION_DLHK AS K_ITEM_PRODUCT_VARIATION_DLHK
  ,OLI.K_PRODUCT_BK AS K_ITEM_PRODUCT_BK
  ,OLI.K_VARIANT_BK AS K_ITEM_VARIANT_BK
  ,OLI.K_ORDER_BK AS K_ITEM_ORDER_BK
  ,O.K_ORDER_BK AS K_ORDER_BK
  ,OLI.K_ORDER_LINE_ITEM_BK AS K_ITEM_ORDER_LINE_ITEM_BK
  ,O.K_APP_BK AS K_HEADER_APP_BK
  
  ,O.K_CUSTOMER_BK AS K_CUSTOMER_BK
  ,O.K_DEVICE_BK AS K_DEVICE_BK
  ,O.K_LOCATION_BK AS K_LOCATION_BK
  ,O.K_SOURCE_ENTIFIER_BK AS K_SOURCE_ENTIFIER_BK
  ,O.A_BROWSER_IP AS A_HEADER_BROWSER_IP
  ,O.A_CANCELLED_AT_DTS AS A_HEADER_CANCELLED_AT_DTS
  ,O.A_CANCEL_REASON AS A_HEADER_CANCEL_REASON
  ,O.A_CART_TOKEN AS A_HEADER_CART_TOKEN
  ,O.A_CHECKOUT_TOKEN AS A_HEADER_CHECKOUT_TOKEN
  ,O.A_CLIENT_DETAILS AS A_HEADER_CLIENT_DETAILS
  ,O.A_CLOSED_AT_DTS AS A_HEADER_CLOSED_AT_DTS
  ,O.A_CREATED_AT_DTS AS A_HEADER_CREATED_AT_DTS
  ,O.A_CURRENCY AS A_HEADER_CURRENCY
  ,O.A_PRESENTMENT_CURRENCY AS A_HEADER_PRESENTMENT_CURRENCY
  ,O.A_CUSTOMER_LOCALE AS A_HEADER_CUSTOMER_LOCALE
  ,O.A_EMAIL AS A_HEADER_EMAIL
  ,O.A_FINANCIAL_STATUS AS A_HEADER_FINANCIAL_STATUS
  ,O.A_FULFILLMENT_STATUS AS A_HEADER_FULFILLMENT_STATUS
  ,O.A_LANDING_SITE_BASE_URL AS A_HEADER_LANDING_SITE_BASE_URL
  ,O.A_LANDING_SITE_REF AS A_HEADER_LANDING_SITE_REF
  ,O.A_NAME AS A_HEADER_NAME
  ,O.A_NOTE AS A_HEADER_NOTE
  ,O.A_NOTE_ATTRIBUTES AS A_HEADER_NOTE_ATTRIBUTES
  ,O.A_PAYMENT_GATEWAY_NAMES AS A_HEADER_PAYMENT_GATEWAY_NAMES
  ,O.A_PROCESSED_AT_DTS AS A_HEADER_PROCESSED_AT_DTS
  ,O.A_PROCESSING_METHOD AS A_HEADER_PROCESSING_METHOD
  ,O.A_REFERENCE AS A_HEADER_REFERENCE
  ,O.A_REFERRING_SITE AS A_HEADER_REFERRING_SITE
  ,O.A_SOURCE_NAME AS A_HEADER_SOURCE_NAME
  ,O.A_SOURCE_URL AS A_HEADER_SOURCE_URL
  ,O.A_ORDER_NUMBER AS A_HEADER_ORDER_NUMBER
  ,O.A_POSION_NUMBER AS A_HEADER_POSION_NUMBER
  ,O.A_UPDATED_AT_DTS AS A_HEADER_UPDATED_AT_DTS
  ,O.B_BUYER_ACCEPTS_MARKETING AS B_HEADER_BUYER_ACCEPTS_MARKETING
  ,O.B_CONFIRMED AS B_HEADER_CONFIRMED
  ,O.B_TAXES_INCLUDED  AS B_HEADER_TAXES_INCLUDED   
  ,OLI.A_FULFILLMENT_SERVICE AS A_ITEM_FULFILLMENT_SERVICE
  ,OLI.A_FULFILLMENT_STATUS AS A_ITEM_FULFILLMENT_STATUS    
  ,OLI.A_VARIANT_INVENTORY_MANAGEMENT AS A_ITEM_VARIANT_INVENTORY_MANAGEMENT  
  
  ,OLI.B_GIFT_CARD AS B_ITEM_GIFT_CARD
  ,OLI.B_PRODUCT_EXISTS AS B_ITEM_PRODUCT_EXISTS
  ,OLI.B_REQUIRES_SHIPPING AS B_ITEM_REQUIRES_SHIPPING
  ,OLI.B_TAXABLE AS B_ITEM_TAXABLE
  ,OLI.M_FULFILLABLE_QUANTITY AS M_ITEM_FULFILLABLE_QUANTITY
  ,OLI.M_GRAMS AS M_ITEM_GRAMS
  ,OLI.M_QUANTITY AS M_ITEM_QUANTITY
  ,OLI.M_UNIT_PRICE AS M_ITEM_UNIT_PRICE
  ,OLI.M_UNIT_PRICE_PRIMARY AS M_ITEM_UNIT_PRICE_PRIMARY
  ,OLI.M_TOTAL_PRICE AS M_ITEM_TOTAL_PRICE
  ,OLI.M_TOTAL_PRICE_PRIMARY AS M_ITEM_TOTAL_PRICE_PRIMARY
  ,OLI.M_TOTAL_DISCOUNT AS M_ITEM_TOTAL_DISCOUNT
  ,OLI.M_TOTAL_DISCOUNT_PRIMARY AS M_ITEM_TOTAL_DISCOUNT_PRIMARY
  ,OLI.M_TAX_AMOUNT AS M_TAX_AMOUNT
  ,OLI.M_TAX_AMOUNT_PRIMARY AS M_TAX_AMOUNT_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_TIP_RECEIVED * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_TIP_AMOUNT_PRIMARY  
  --,ROUND(DIV0((O.M_TOTAL_DISCOUNTS_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_HEADER_DISCOUNT
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE * OLI.M_TOTAL_PRICE),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE



   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'28846d55-fc60-48db-afd8-e9aed2db8ed1' AS MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG OLI ON OLI.K_ORDER_DLHK = O.K_ORDER_DLHK
      );
2022-03-04 00:35:50.203781 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:52.874371 (Thread-1): SQL status: SUCCESS 1 in 2.67 seconds
2022-03-04 00:35:52.877333 (Thread-1): finished collecting timing info
2022-03-04 00:35:52.877536 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-04 00:35:53.319394 (Thread-1): 21:35:53 | 25 of 26 OK created table model DBT_SHOPIFY.W_ORDERS_F............... [SUCCESS 1 in 3.13s]
2022-03-04 00:35:53.319658 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-04 00:35:53.319814 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-04 00:35:53.319982 (Thread-1): 21:35:53 | 26 of 26 START table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F........ [RUN]
2022-03-04 00:35:53.320205 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-04 00:35:53.320332 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-04 00:35:53.322993 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-04 00:35:53.323652 (Thread-1): finished collecting timing info
2022-03-04 00:35:53.325018 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-04 00:35:53.325646 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-04 00:35:53.325740 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCT_COLLECTION_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG AS C
      );
2022-03-04 00:35:53.325837 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 00:35:55.990086 (Thread-1): SQL status: SUCCESS 1 in 2.66 seconds
2022-03-04 00:35:55.992935 (Thread-1): finished collecting timing info
2022-03-04 00:35:55.993174 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: Close
2022-03-04 00:35:56.427849 (Thread-1): 21:35:56 | 26 of 26 OK created table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F... [SUCCESS 1 in 3.11s]
2022-03-04 00:35:56.428094 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-04 00:35:56.432492 (MainThread): Acquiring new snowflake connection "master".
2022-03-04 00:35:56.432874 (MainThread): 21:35:56 | 
2022-03-04 00:35:56.432993 (MainThread): 21:35:56 | Finished running 16 view models, 10 table models in 88.34s.
2022-03-04 00:35:56.433091 (MainThread): Connection 'master' was properly closed.
2022-03-04 00:35:56.433170 (MainThread): Connection 'model.snowflake_aicd.W_PRODUCT_COLLECTION_F' was properly closed.
2022-03-04 00:35:56.440294 (MainThread): 
2022-03-04 00:35:56.440473 (MainThread): Completed successfully
2022-03-04 00:35:56.440619 (MainThread): 
Done. PASS=26 WARN=0 ERROR=0 SKIP=0 TOTAL=26
2022-03-04 00:35:56.440830 (MainThread): Flushing usage events
2022-03-04 11:46:03.617480 (MainThread): Running with dbt=0.21.1
2022-03-04 11:46:04.695577 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-04 11:46:04.697156 (MainThread): Tracking: do not track
2022-03-04 11:46:04.707762 (MainThread): Partial parsing not enabled
2022-03-04 11:46:04.730118 (MainThread): Parsing macros/common.sql
2022-03-04 11:46:04.733129 (MainThread): Parsing macros/catalog.sql
2022-03-04 11:46:04.734848 (MainThread): Parsing macros/adapters.sql
2022-03-04 11:46:04.764813 (MainThread): Parsing macros/materializations/merge.sql
2022-03-04 11:46:04.767873 (MainThread): Parsing macros/materializations/seed.sql
2022-03-04 11:46:04.771870 (MainThread): Parsing macros/materializations/view.sql
2022-03-04 11:46:04.773077 (MainThread): Parsing macros/materializations/table.sql
2022-03-04 11:46:04.775659 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-04 11:46:04.783101 (MainThread): Parsing macros/core.sql
2022-03-04 11:46:04.786238 (MainThread): Parsing macros/materializations/test.sql
2022-03-04 11:46:04.791954 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-04 11:46:04.799957 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-04 11:46:04.801366 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-04 11:46:04.816248 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-04 11:46:04.844267 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-04 11:46:04.862468 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-04 11:46:04.863770 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-04 11:46:04.871711 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-04 11:46:04.887798 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-04 11:46:04.898905 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-04 11:46:04.905411 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-04 11:46:04.911191 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-04 11:46:04.914051 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-04 11:46:04.915115 (MainThread): Parsing macros/etc/query.sql
2022-03-04 11:46:04.915807 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-04 11:46:04.916921 (MainThread): Parsing macros/etc/datetime.sql
2022-03-04 11:46:04.923510 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-04 11:46:04.924824 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-04 11:46:04.926588 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-04 11:46:04.927711 (MainThread): Parsing macros/adapters/common.sql
2022-03-04 11:46:04.971471 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-04 11:46:04.972720 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-04 11:46:04.973539 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-04 11:46:04.974485 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-04 11:46:05.116664 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-04 11:46:05.126563 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.129382 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-04 11:46:05.131733 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.132433 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-04 11:46:05.134943 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.135626 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-04 11:46:05.139869 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.140557 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-04 11:46:05.143660 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.144444 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-04 11:46:05.147755 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.148479 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-04 11:46:05.151155 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.151860 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-04 11:46:05.154738 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.155621 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-04 11:46:05.158343 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.159063 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-04 11:46:05.162823 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.163744 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-04 11:46:05.166868 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.167702 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-04 11:46:05.172191 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.172895 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-04 11:46:05.178248 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.178946 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-04 11:46:05.181644 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.182334 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-04 11:46:05.185450 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.186153 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-04 11:46:05.189502 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.190193 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-04 11:46:05.193219 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.193977 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-04 11:46:05.196984 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.197665 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-04 11:46:05.234351 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.235215 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-04 11:46:05.237673 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.238359 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-04 11:46:05.240493 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.241188 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-04 11:46:05.243343 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.244034 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-04 11:46:05.246171 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.246846 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-04 11:46:05.248979 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.249665 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-04 11:46:05.251796 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.252476 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-04 11:46:05.254602 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.273988 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.275246 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.276363 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.277463 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.278710 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.279812 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.280930 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.282046 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 11:46:05.317269 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-04 11:46:05.317988 (MainThread): Found 26 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 23 sources, 0 exposures
2022-03-04 11:46:05.320175 (MainThread): 
2022-03-04 11:46:05.320418 (MainThread): Acquiring new snowflake connection "master".
2022-03-04 11:46:05.321884 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-04 11:46:05.331043 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-04 11:46:05.331162 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-04 11:46:05.331250 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-04 11:46:07.925579 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 2.59 seconds
2022-03-04 11:46:07.933388 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-04 11:46:08.472673 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-04 11:46:08.483910 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-04 11:46:08.484136 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-04 11:46:08.484319 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-04 11:46:09.987346 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 27 in 1.50 seconds
2022-03-04 11:46:09.990699 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-04 11:46:10.458446 (MainThread): 08:46:10 | Concurrency: 1 threads (target='dev')
2022-03-04 11:46:10.459006 (MainThread): 08:46:10 | 
2022-03-04 11:46:10.462805 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-04 11:46:10.463771 (Thread-1): 08:46:10 | 1 of 26 START view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG.......... [RUN]
2022-03-04 11:46:10.464107 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-04 11:46:10.464334 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-04 11:46:10.466736 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-04 11:46:10.467836 (Thread-1): finished collecting timing info
2022-03-04 11:46:10.485547 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-04 11:46:10.487631 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-04 11:46:10.487776 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER_ADDRESS"
),
rename AS 
(   
SELECT 
    MD5(ID) AS K_CUSTOMER_ADDRESS_DLHK
    ,ID AS K_CUSTOMER_ADDRESS_BK
    ,MD5(CONCAT(
        COALESCE(ADDRESS1,'00'),
        COALESCE(ADDRESS2,'00'),
        COALESCE(CITY,'00'),
        COALESCE(COUNTRY,'00'),
        COALESCE(COUNTRY_CODE,'00'),
        COALESCE(FIRST_NAME,'00'),
        COALESCE(LAST_NAME,'00'),
        COALESCE(PROVINCE,'00'),
        COALESCE(PROVINCE_CODE,'00'),
        COALESCE(ZIP,'00')
    )) AS K_ADDRESS_DLHK
    ,CUSTOMER_ID AS K_CUSTOMER_BK
    ,ADDRESS1 AS A_ADDRESS1
    ,ADDRESS2 AS A_ADDRESS2
    ,CITY AS A_CITY
    ,COMPANY AS A_COMPANY
    ,COUNTRY AS A_COUNTRY
    ,COUNTRY_CODE AS A_COUNTRY_CODE
    ,COUNTRY_NAME AS A_COUNTRY_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,PHONE AS A_PHONE
    ,PROVINCE AS A_PROVINCE
    ,PROVINCE_CODE AS A_PROVINCE_CODE
    ,ZIP AS A_ZIP
    ,IS_DEFAULT AS B_IS_DEFAULT  
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-04 11:46:10.487887 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:12.278060 (Thread-1): SQL status: SUCCESS 1 in 1.79 seconds
2022-03-04 11:46:12.288283 (Thread-1): finished collecting timing info
2022-03-04 11:46:12.288487 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: Close
2022-03-04 11:46:12.737840 (Thread-1): 08:46:12 | 1 of 26 OK created view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG..... [SUCCESS 1 in 2.27s]
2022-03-04 11:46:12.738035 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-04 11:46:12.738175 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-04 11:46:12.738328 (Thread-1): 08:46:12 | 2 of 26 START view model DBT_SHOPIFY.V_CUSTOMER_STG.................. [RUN]
2022-03-04 11:46:12.739182 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-04 11:46:12.739370 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-04 11:46:12.742336 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-04 11:46:12.743357 (Thread-1): finished collecting timing info
2022-03-04 11:46:12.744733 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-04 11:46:12.747191 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-04 11:46:12.747345 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER"
),
rename AS 
(   
SELECT 
    --KEYS
    MD5(ID) AS K_CUSTOMER_DLHK    
    --BUSINESS KEYS
    ,ID AS K_CUSTOMER_BK
    ,LAST_ORDER_ID AS K_LAST_ORDER_BK
    ,MULTIPASS_IDENTIFIER AS K_MULTIPASS_BKENTIFIER
    --ATTRIBUTES
    ,ACCEPTS_MARKETING_UPDATED_AT AS A_ACCEPTS_MARKETING_UPDATED_AT_DTS
    ,CREATED_AT AS A_CREATED_AT_DTS
    ,CURRENCY AS A_CURRENCY
    ,EMAIL AS A_EMAIL
    ,
    (COALESCE(FIRST_NAME,'') || ' ' || COALESCE(LAST_NAME,''))
 AS A_FULL_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,LAST_ORDER_NAME AS A_LAST_ORDER_NAME
    ,MARKETING_OPT_IN_LEVEL AS A_MARKETING_OPT_IN_LEVEL
    ,NOTE AS A_NOTE
    ,PHONE AS A_PHONE
    ,SMS_MARKETING_CONSENT AS A_SMS_MARKETING_CONSENT
    ,STATE AS A_STATE
    ,TAGS AS A_TAGS
    ,TAX_EXEMPTIONS AS A_TAX_EXEMPTIONS
    ,TOTAL_SPENT AS A_TOTAL_SPENT
    ,UPDATED_AT AS A_UPDATED_AT
    --BOOLEAN
    ,ACCEPTS_MARKETING AS B_ACCEPTS_MARKETING
    ,TAX_EXEMPT AS B_TAX_EXEMPT
    ,VERIFIED_EMAIL AS B_VERIFIED_EMAIL
    --METRICS
    ,ORDERS_COUNT AS M_ORDERS_COUNT
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-04 11:46:12.747461 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:14.582379 (Thread-1): SQL status: SUCCESS 1 in 1.83 seconds
2022-03-04 11:46:14.585325 (Thread-1): finished collecting timing info
2022-03-04 11:46:14.585571 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-04 11:46:15.023894 (Thread-1): 08:46:15 | 2 of 26 OK created view model DBT_SHOPIFY.V_CUSTOMER_STG............. [SUCCESS 1 in 2.28s]
2022-03-04 11:46:15.024113 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-04 11:46:15.024321 (Thread-1): Began running node model.snowflake_aicd.V_DATE_STG
2022-03-04 11:46:15.024517 (Thread-1): 08:46:15 | 3 of 26 START view model DBT_SHOPIFY.V_DATE_STG...................... [RUN]
2022-03-04 11:46:15.024951 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-04 11:46:15.025209 (Thread-1): Compiling model.snowflake_aicd.V_DATE_STG
2022-03-04 11:46:15.029598 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-04 11:46:15.030556 (Thread-1): finished collecting timing info
2022-03-04 11:46:15.032288 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-04 11:46:15.054437 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-04 11:46:15.054615 (Thread-1): On model.snowflake_aicd.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-04 11:46:15.054794 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:16.856090 (Thread-1): SQL status: SUCCESS 1 in 1.80 seconds
2022-03-04 11:46:16.858391 (Thread-1): finished collecting timing info
2022-03-04 11:46:16.858559 (Thread-1): On model.snowflake_aicd.V_DATE_STG: Close
2022-03-04 11:46:17.322072 (Thread-1): 08:46:17 | 3 of 26 OK created view model DBT_SHOPIFY.V_DATE_STG................. [SUCCESS 1 in 2.30s]
2022-03-04 11:46:17.322304 (Thread-1): Finished running node model.snowflake_aicd.V_DATE_STG
2022-03-04 11:46:17.322613 (Thread-1): Began running node model.snowflake_aicd.V_LOCATION_STG
2022-03-04 11:46:17.322825 (Thread-1): 08:46:17 | 4 of 26 START view model DBT_SHOPIFY.V_LOCATION_STG.................. [RUN]
2022-03-04 11:46:17.323278 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-04 11:46:17.323506 (Thread-1): Compiling model.snowflake_aicd.V_LOCATION_STG
2022-03-04 11:46:17.326487 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-04 11:46:17.327308 (Thread-1): finished collecting timing info
2022-03-04 11:46:17.328659 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-04 11:46:17.330683 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-04 11:46:17.330847 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-04 11:46:17.330948 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:19.272038 (Thread-1): SQL status: SUCCESS 1 in 1.94 seconds
2022-03-04 11:46:19.276093 (Thread-1): finished collecting timing info
2022-03-04 11:46:19.276325 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-04 11:46:19.727865 (Thread-1): 08:46:19 | 4 of 26 OK created view model DBT_SHOPIFY.V_LOCATION_STG............. [SUCCESS 1 in 2.40s]
2022-03-04 11:46:19.728092 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-04 11:46:19.728399 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-04 11:46:19.728605 (Thread-1): 08:46:19 | 5 of 26 START view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG......... [RUN]
2022-03-04 11:46:19.728856 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-04 11:46:19.728966 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-04 11:46:19.732737 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-04 11:46:19.733238 (Thread-1): finished collecting timing info
2022-03-04 11:46:19.734814 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-04 11:46:19.737324 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-04 11:46:19.737436 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_ADJUSTMENT" AS A
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_ADJUSTMENT_DLHK
  --BK
  ,ID AS K_ORDER_ADJUSTMENT_BK
  ,ORDER_ID AS K_ORDER_BK
  ,REFUND_ID AS K_REFUND_BK
  --ATTRIBUTE
  ,KIND AS A_KIND
  ,REASON AS A_REASON
  --METRIC
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT_PRIMARY
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-04 11:46:19.737535 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:21.340005 (Thread-1): SQL status: SUCCESS 1 in 1.60 seconds
2022-03-04 11:46:21.342534 (Thread-1): finished collecting timing info
2022-03-04 11:46:21.342772 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: Close
2022-03-04 11:46:21.795184 (Thread-1): 08:46:21 | 5 of 26 OK created view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG.... [SUCCESS 1 in 2.07s]
2022-03-04 11:46:21.795399 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-04 11:46:21.795692 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-04 11:46:21.795916 (Thread-1): 08:46:21 | 6 of 26 START view model DBT_SHOPIFY.V_ORDERS_HEADER_STG............. [RUN]
2022-03-04 11:46:21.796235 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-04 11:46:21.796392 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-04 11:46:21.802444 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-04 11:46:21.803625 (Thread-1): finished collecting timing info
2022-03-04 11:46:21.805343 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-04 11:46:21.816107 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-04 11:46:21.816215 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDERS" AS A
),
rename AS 
(
SELECT
    MD5(O.ID) AS K_ORDER_DLHK    
    ,MD5(O.CUSTOMER_ID) AS K_CUSTOMER_DLHK
    ,MD5(O.LOCATION_ID) AS K_LOCATION_DLHK    
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
    --BUSINESS_KEYS
    ,O.APP_ID AS K_APP_BK
    ,O.ID AS K_ORDER_BK
    ,O.CUSTOMER_ID AS K_CUSTOMER_BK
    ,O.DEVICE_ID AS K_DEVICE_BK  
    ,O.LOCATION_ID AS K_LOCATION_BK
    ,O.SOURCE_IDENTIFIER AS K_SOURCE_ENTIFIER_BK
    --ATTRIBUTES
    ,O.BROWSER_IP AS A_BROWSER_IP
    ,O.CANCELLED_AT AS A_CANCELLED_AT_DTS
    ,O.CANCEL_REASON AS A_CANCEL_REASON
    ,O.CART_TOKEN AS A_CART_TOKEN
    ,O.CHECKOUT_TOKEN AS A_CHECKOUT_TOKEN
    ,O.CLIENT_DETAILS AS A_CLIENT_DETAILS
    ,O.CLOSED_AT AS A_CLOSED_AT_DTS
    ,O.CREATED_AT AS A_CREATED_AT_DTS
    ,O.CURRENCY AS A_CURRENCY
    ,O.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
    ,O.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
    ,O.EMAIL AS A_EMAIL
    ,O.FINANCIAL_STATUS AS A_FINANCIAL_STATUS
    ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
    ,O.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
    ,O.LANDING_SITE_REF AS A_LANDING_SITE_REF
    ,O.NAME AS A_NAME
    ,O.NOTE AS A_NOTE
    ,O.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES    
    ,O.PAYMENT_GATEWAY_NAMES AS A_PAYMENT_GATEWAY_NAMES    
    ,O.PROCESSED_AT AS A_PROCESSED_AT_DTS
    ,O.PROCESSING_METHOD AS A_PROCESSING_METHOD
    ,O.REFERENCE AS A_REFERENCE
    ,O.REFERRING_SITE AS A_REFERRING_SITE    
    ,O.SOURCE_NAME AS A_SOURCE_NAME
    ,O.SOURCE_URL AS A_SOURCE_URL    
    ,O.ORDER_NUMBER AS A_ORDER_NUMBER
    ,O.POSION_NUMBER AS A_POSION_NUMBER  
    ,O.UPDATED_AT AS A_UPDATED_AT_DTS
    --BOOLEAN
    ,O.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
    ,O.CONFIRMED AS B_CONFIRMED
    ,O.TAXES_INCLUDED AS B_TAXES_INCLUDED
    --METRICS
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE_PRIMARY 
    ,O.TOTAL_TIP_RECEIVED::DECIMAL(15,2) AS M_TOTAL_TIP_RECEIVED   
    ,O.TOTAL_WEIGHT::DECIMAL(15,2) AS M_TOTAL_WEIGHT
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
FROM source O
)

SELECT * FROM rename
  );
2022-03-04 11:46:21.816332 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:23.410134 (Thread-1): SQL status: SUCCESS 1 in 1.59 seconds
2022-03-04 11:46:23.412695 (Thread-1): finished collecting timing info
2022-03-04 11:46:23.412911 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: Close
2022-03-04 11:46:23.846301 (Thread-1): 08:46:23 | 6 of 26 OK created view model DBT_SHOPIFY.V_ORDERS_HEADER_STG........ [SUCCESS 1 in 2.05s]
2022-03-04 11:46:23.846530 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-04 11:46:23.846748 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-04 11:46:23.847055 (Thread-1): 08:46:23 | 7 of 26 START view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG.. [RUN]
2022-03-04 11:46:23.847290 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-04 11:46:23.847406 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-04 11:46:23.850517 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-04 11:46:23.851124 (Thread-1): finished collecting timing info
2022-03-04 11:46:23.852846 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-04 11:46:23.854607 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-04 11:46:23.854723 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM_TAX_LINE" AS A
),
rename AS 
(
SELECT
  CONCAT(COALESCE(ORDER_ID,'0000000000'),'-',COALESCE(ORDER_LINE_ID,'0000000000')) AS K_ORDER_LINE_ITEM_TAX_DLHK
  ,ORDER_ID AS K_ORDER_BK
  ,ORDER_LINE_ID AS K_ORDER_LINE_ITEM_BK
  ,TITLE AS A_TITLE
  ,CHANNEL_LIABLE AS B_CHANNEL_LIABLE
  ,RATE AS M_RATE
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-04 11:46:23.854820 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:25.672813 (Thread-1): SQL status: SUCCESS 1 in 1.82 seconds
2022-03-04 11:46:25.675883 (Thread-1): finished collecting timing info
2022-03-04 11:46:25.676057 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: Close
2022-03-04 11:46:26.118200 (Thread-1): 08:46:26 | 7 of 26 OK created view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG [SUCCESS 1 in 2.27s]
2022-03-04 11:46:26.118402 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-04 11:46:26.118534 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-04 11:46:26.118779 (Thread-1): 08:46:26 | 8 of 26 START view model DBT_SHOPIFY.V_PRODUCT_STG................... [RUN]
2022-03-04 11:46:26.119007 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-04 11:46:26.119118 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_STG
2022-03-04 11:46:26.122334 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-04 11:46:26.122898 (Thread-1): finished collecting timing info
2022-03-04 11:46:26.124282 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-04 11:46:26.126040 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-04 11:46:26.126154 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_DLHK
  ,ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE
  ,HANDLE AS A_HANDLE
  ,PRODUCT_TYPE AS A_PRODUCT_TYPE
  ,VENDOR AS A_VENDOR
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE
  ,STATUS AS A_STATUS
  ,TEMPLATE_SUFFIX AS A_TEMPLATE_SUFFIX   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-04 11:46:26.126256 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:28.135888 (Thread-1): SQL status: SUCCESS 1 in 2.01 seconds
2022-03-04 11:46:28.138794 (Thread-1): finished collecting timing info
2022-03-04 11:46:28.139249 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: Close
2022-03-04 11:46:28.605557 (Thread-1): 08:46:28 | 8 of 26 OK created view model DBT_SHOPIFY.V_PRODUCT_STG.............. [SUCCESS 1 in 2.49s]
2022-03-04 11:46:28.605789 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-04 11:46:28.606011 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-04 11:46:28.606201 (Thread-1): 08:46:28 | 9 of 26 START view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG........... [RUN]
2022-03-04 11:46:28.606431 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-04 11:46:28.606545 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-04 11:46:28.609477 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-04 11:46:28.610587 (Thread-1): finished collecting timing info
2022-03-04 11:46:28.612015 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-04 11:46:28.614485 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-04 11:46:28.614601 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT_VARIANT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_VARIANT_DLHK
  ,MD5(PRODUCT_ID) AS K_PRODUCT_DLHK  
  --BUSINESS KEYS  
  ,ID AS K_PRODUCT_VARIANT_BK
  ,PRODUCT_ID AS K_PRODUCT_BK  
  ,INVENTORY_ITEM_ID AS K_INVENTORY_ITEM_BK
  ,IMAGE_ID AS K_IMAGE_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE  
  ,SKU AS A_SKU    
  ,FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,INVENTORY_MANAGEMENT AS A_INVENTORY_MANAGEMENT
  ,INVENTORY_POLICY AS A_INVENTORY_POLICY
  ,BARCODE AS A_BARCODE
  ,GRAMS AS A_GRAMS
  ,WEIGHT_UNIT AS A_WEIGHT_UNIT
  ,OPTION_1 AS A_OPTION_1
  ,OPTION_2 AS A_OPTION_2
  ,OPTION_3 AS A_OPTION_3
  ,TAX_CODE AS A_TAX_CODE  
  ,PRESENTMENT_PRICES AS A_PRESENTMENT_PRICES  
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  --BOOLEAN
  ,REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,TAXABLE AS B_TAXABLE
  --METRICS
  ,PRICE AS M_PRICE
  ,POSITION AS M_POSITION
  ,COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,INVENTORY_QUANTITY AS M_INVENTORY_QUANTITY
  ,INVENTORY_QUANTITY_ADJUSTMENT AS M_INVENTORY_QUANTITY_ADJUSTMENT
  ,WEIGHT AS M_WEIGHT
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-04 11:46:28.614709 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:30.613891 (Thread-1): SQL status: SUCCESS 1 in 2.00 seconds
2022-03-04 11:46:30.618777 (Thread-1): finished collecting timing info
2022-03-04 11:46:30.619217 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: Close
2022-03-04 11:46:31.087410 (Thread-1): 08:46:31 | 9 of 26 OK created view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG...... [SUCCESS 1 in 2.48s]
2022-03-04 11:46:31.087886 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-04 11:46:31.088431 (Thread-1): Began running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-04 11:46:31.089110 (Thread-1): 08:46:31 | 10 of 26 START view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG......... [RUN]
2022-03-04 11:46:31.102931 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-04 11:46:31.103356 (Thread-1): Compiling model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-04 11:46:31.107780 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-04 11:46:31.108673 (Thread-1): finished collecting timing info
2022-03-04 11:46:31.110476 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-04 11:46:31.113078 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-04 11:46:31.113180 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG  as (
    


WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND" AS A
),
refund_line as (
    SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND_LINE_ITEM" AS A
),
rename AS 
(
SELECT
  MD5(RL.ID) AS K_REFUND_LINE_DLHK
  ,MD5(R.ID) AS K_REFUND_DLHK
  ,R.ID AS K_REFUND_BK
  ,RL.ID AS K_REFUND_LINE_BK
  ,R.ORDER_ID AS K_ORDER_BK
  ,R.USER_ID AS K_USER_BK
  ,RL.LOCATION_ID AS K_LOCATION_BK
  ,RL.LINE_ITEM_ID AS K_ORDER_LINE_ITEM_BK
  ,R.NOTE AS A_NOTE
  ,R.RESTOCK AS B_RESTOCK
  ,RL.QUANTITY AS M_QUANTITY
  ,RL.RESTOCK_TYPE AS A_RESTOCK_TYPE
   
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL


  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
FROM source R
LEFT JOIN refund_line RL ON RL.REFUND_ID = R.ID
)

SELECT * FROM rename
  );
2022-03-04 11:46:31.113281 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:33.256276 (Thread-1): SQL status: SUCCESS 1 in 2.14 seconds
2022-03-04 11:46:33.260560 (Thread-1): finished collecting timing info
2022-03-04 11:46:33.261033 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: Close
2022-03-04 11:46:33.720430 (Thread-1): 08:46:33 | 10 of 26 OK created view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG.... [SUCCESS 1 in 2.63s]
2022-03-04 11:46:33.720935 (Thread-1): Finished running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-04 11:46:33.721413 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-04 11:46:33.722066 (Thread-1): 08:46:33 | 11 of 26 START table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D.......... [RUN]
2022-03-04 11:46:33.739232 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-04 11:46:33.739479 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-04 11:46:33.742973 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-04 11:46:33.744797 (Thread-1): finished collecting timing info
2022-03-04 11:46:33.759331 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-04 11:46:33.760800 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-04 11:46:33.761008 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG AS C
      );
2022-03-04 11:46:33.761198 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:36.913788 (Thread-1): SQL status: SUCCESS 1 in 3.15 seconds
2022-03-04 11:46:36.931578 (Thread-1): finished collecting timing info
2022-03-04 11:46:36.932118 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: Close
2022-03-04 11:46:37.563591 (Thread-1): 08:46:37 | 11 of 26 OK created table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D..... [SUCCESS 1 in 3.84s]
2022-03-04 11:46:37.564070 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-04 11:46:37.564457 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-04 11:46:37.564975 (Thread-1): 08:46:37 | 12 of 26 START table model DBT_SHOPIFY.W_CUSTOMERS_D................. [RUN]
2022-03-04 11:46:37.565661 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-04 11:46:37.566051 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-04 11:46:37.578701 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-04 11:46:37.580083 (Thread-1): finished collecting timing info
2022-03-04 11:46:37.582007 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-04 11:46:37.582730 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-04 11:46:37.582833 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG AS C
      );
2022-03-04 11:46:37.582932 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:40.085645 (Thread-1): SQL status: SUCCESS 1 in 2.50 seconds
2022-03-04 11:46:40.088248 (Thread-1): finished collecting timing info
2022-03-04 11:46:40.088460 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-04 11:46:40.573141 (Thread-1): 08:46:40 | 12 of 26 OK created table model DBT_SHOPIFY.W_CUSTOMERS_D............ [SUCCESS 1 in 3.01s]
2022-03-04 11:46:40.573900 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-04 11:46:40.574607 (Thread-1): Began running node model.snowflake_aicd.W_DATE_D
2022-03-04 11:46:40.575456 (Thread-1): 08:46:40 | 13 of 26 START table model DBT_SHOPIFY.W_DATE_D...................... [RUN]
2022-03-04 11:46:40.577157 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-04 11:46:40.578040 (Thread-1): Compiling model.snowflake_aicd.W_DATE_D
2022-03-04 11:46:40.590582 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-04 11:46:40.591055 (Thread-1): finished collecting timing info
2022-03-04 11:46:40.592559 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-04 11:46:40.595510 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-04 11:46:40.595608 (Thread-1): On model.snowflake_aicd.W_DATE_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_DATE_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_DATE_D  as
      (

SELECT 
	CAST(DATE_KEY AS NUMBER(9)) AS K_DATE_INTEGER_BK
	,CAST(DATE_COLUMN AS DATE) AS K_DATE_BK
	,CAST(FULL_DATE_DESC AS VARCHAR(64)) AS A_FULL_DATE_DESC
	,CAST(DAY_NUM_IN_WEEK AS NUMBER(1)) AS A_DAY_NUM_IN_WEEK
	,CAST(DAY_NUM_IN_MONTH AS NUMBER(2)) AS A_DAY_NUM_IN_MONTH
	,CAST(DAY_NUM_IN_YEAR AS NUMBER(3)) AS A_DAY_NUM_IN_YEAR
	,CAST(DAY_NAME AS VARCHAR(10)) AS A_DAY_NAME
	,CAST(DAY_ABBREV AS VARCHAR(3)) AS A_DAY_ABBREV
	,CAST(WEEKDAY_IND AS VARCHAR(64)) AS A_WEEKDAY_IND
	,CAST(US_HOLIDAY_IND AS VARCHAR(64)) AS A_US_HOLIDAY_IND
	,CAST(COMPANY_HOLIDAY_IND AS VARCHAR(64)) AS A_COMPANY_HOLIDAY_IND
	,CAST(MONTH_END_IND AS VARCHAR(64)) AS A_MONTH_END_IND
	,CAST(WEEK_BEGIN_DATE_NKEY AS NUMBER(9)) AS A_WEEK_BEGIN_DATE_NKEY
	,CAST(WEEK_BEGIN_DATE AS DATE) AS A_WEEK_BEGIN_DATE
	,CAST(WEEK_END_DATE_NKEY AS NUMBER(9)) AS A_WEEK_END_DATE_NKEY
	,CAST(WEEK_END_DATE AS DATE) AS A_WEEK_END_DATE
	,CAST(WEEK_NUM_IN_YEAR AS NUMBER(9)) AS A_WEEK_NUM_IN_YEAR
	,CAST(MONTH_NAME AS VARCHAR(10)) AS A_MONTH_NAME
	,CAST(MONTH_ABBREV AS VARCHAR(3)) AS A_MONTH_ABBREV
	,CAST(MONTH_NUM_IN_YEAR AS NUMBER(2)) AS A_MONTH_NUM_IN_YEAR
	,CAST(YEARMONTH AS VARCHAR(10)) AS A_YEARMONTH
	,CAST(CURRENT_QUARTER AS NUMBER(1)) AS A_QUARTER
	,CAST(YEARQUARTER AS VARCHAR(10)) AS A_YEARQUARTER
	,CAST(CURRENT_YEAR AS NUMBER(5)) AS A_YEAR
	,CAST(FISCAL_WEEK_NUM AS NUMBER(2)) AS A_FISCAL_WEEK_NUM
	,CAST(FISCAL_MONTH_NUM AS NUMBER(2)) AS A_FISCAL_MONTH_NUM
	,CAST(FISCAL_YEARMONTH AS VARCHAR(10)) AS A_FISCAL_YEARMONTH
	,CAST(FISCAL_QUARTER AS NUMBER(1)) AS A_FISCAL_QUARTER
	,CAST(FISCAL_YEARQUARTER AS VARCHAR(10)) AS A_FISCAL_YEARQUARTER
	,CAST(FISCAL_HALFYEAR AS NUMBER(1)) AS A_FISCAL_HALFYEAR
	,CAST(FISCAL_YEAR AS NUMBER(5)) AS A_FISCAL_YEAR
	,CAST(SQL_TIMESTAMP AS TIMESTAMP_NTZ) AS A_SQL_TIMESTAMP_DTS
	,CAST(CURRENT_ROW_IND AS CHAR(1)) AS A_CURRENT_ROW_IND
	,CAST(EFFECTIVE_DATE AS DATE) AS A_EFFECTIVE_DATE
	,CAST(EXPIRA_DATE AS DATE) AS A_EXPIRATION_DATE
FROM
DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG
      );
2022-03-04 11:46:40.595714 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:44.666348 (Thread-1): SQL status: SUCCESS 1 in 4.07 seconds
2022-03-04 11:46:44.673018 (Thread-1): finished collecting timing info
2022-03-04 11:46:44.674187 (Thread-1): On model.snowflake_aicd.W_DATE_D: Close
2022-03-04 11:46:45.113351 (Thread-1): 08:46:45 | 13 of 26 OK created table model DBT_SHOPIFY.W_DATE_D................. [SUCCESS 1 in 4.54s]
2022-03-04 11:46:45.113834 (Thread-1): Finished running node model.snowflake_aicd.W_DATE_D
2022-03-04 11:46:45.114347 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-04 11:46:45.114936 (Thread-1): 08:46:45 | 14 of 26 START table model DBT_SHOPIFY.W_LOCATION_D.................. [RUN]
2022-03-04 11:46:45.116355 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-04 11:46:45.120421 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-04 11:46:45.126935 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-04 11:46:45.128719 (Thread-1): finished collecting timing info
2022-03-04 11:46:45.131924 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-04 11:46:45.133025 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-04 11:46:45.133156 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-04 11:46:45.133257 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:49.994698 (Thread-1): SQL status: SUCCESS 1 in 4.86 seconds
2022-03-04 11:46:50.001885 (Thread-1): finished collecting timing info
2022-03-04 11:46:50.002753 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-04 11:46:50.456795 (Thread-1): 08:46:50 | 14 of 26 OK created table model DBT_SHOPIFY.W_LOCATION_D............. [SUCCESS 1 in 5.34s]
2022-03-04 11:46:50.458198 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-04 11:46:50.458970 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-04 11:46:50.460136 (Thread-1): 08:46:50 | 15 of 26 START view model DBT_SHOPIFY.V_PRODUCTS_D_STG............... [RUN]
2022-03-04 11:46:50.461510 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-04 11:46:50.462323 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-04 11:46:50.473696 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-04 11:46:50.475566 (Thread-1): finished collecting timing info
2022-03-04 11:46:50.477107 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-04 11:46:50.480367 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-04 11:46:50.480554 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCTS_D_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG  as (
    
 

WITH product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG
),
product_variant AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG
),

rename as (


SELECT
    MD5(CONCAT(P.K_PRODUCT_BK,'-',COALESCE(V.K_PRODUCT_VARIANT_BK,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
    ,P.K_PRODUCT_DLHK
    ,V.K_PRODUCT_VARIANT_DLHK AS K_PRODUCT_VARIANT_DLHK
    ,V.K_PRODUCT_VARIANT_BK AS K_PRODUCT_VARIANT_BK
    ,P.K_PRODUCT_BK AS K_PRODUCT_BK
    ,V.K_INVENTORY_ITEM_BK AS K_VARIANT_INVENTORY_ITEM_BK
    ,V.K_IMAGE_BK AS K_VARIANT_IMAGE_BK
    --ATTRIBUTES
    ,P.A_TITLE
    ,P.A_HANDLE
    ,P.A_PRODUCT_TYPE
    ,P.A_VENDOR
    ,P.A_CREATED_AT_DTS
    ,P.A_UPDATED_AT_DTS
    ,P.A_PUBLISHED_AT_DTS
    ,P.A_PUBLISHED_SCOPE
    ,P.A_STATUS
    ,P.A_TEMPLATE_SUFFIX       
    ,V.A_TITLE AS A_VARIANT_TITLE
    ,V.A_SKU AS A_VARIANT_SKU
    ,V.A_FULFILLMENT_SERVICE AS A_VARIANT_FULFILLMENT_SERVICE
    ,V.A_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
    ,V.A_BARCODE AS A_VARIANT_BARCODE
    ,V.A_INVENTORY_POLICY AS A_VARIANT_INVENTORY_POLICY
    ,V.A_GRAMS AS A_VARIANT_GRAMS
    ,V.A_WEIGHT_UNIT AS A_VARIANT_WEIGHT_UNIT
    ,V.A_OPTION_1 AS A_VARIANT_OPTION_1
    ,V.A_OPTION_2 AS A_VARIANT_OPTION_2
    ,V.A_OPTION_3 AS A_VARIANT_OPTION_3
    ,V.A_TAX_CODE AS A_VARIANT_TAX_CODE
    ,V.A_PRESENTMENT_PRICES AS A_VARIANT_PRESENTMENT_PRICES
    ,V.A_CREATED_AT_DTS AS A_VARIANT_CREATED_AT_DTS
    ,V.A_UPDATED_AT_DTS AS A_VARIANT_UPDATED_AT_DTS
    --BOOLEAN
    ,V.B_REQUIRES_SHIPPING AS B_VARIANT_REQUIRES_SHIPPING
    ,V.B_TAXABLE AS B_VARIANT_TAXABLE
    --METRICS
    ,V.M_PRICE AS M_VARIANT_PRICE
    ,V.M_POSITION AS M_VARIANT_POSITION
    ,V.M_COMPARE_AT_PRICE AS M_VARIANT_COMPARE_AT_PRICE
    ,V.M_INVENTORY_QUANTITY AS M_VARIANT_INVENTORY_QUANTITY
    ,V.M_INVENTORY_QUANTITY_ADJUSTMENT AS M_VARIANT_INVENTORY_QUANTITY_ADJUSTMENT
    ,V.M_WEIGHT AS M_VARIANT_WEIGHT
    --metadata (MD)
    ,P.MD_IS_DELETED AS MD_IS_DELETED_PRODUCT
    ,V.MD_IS_DELETED AS MD_IS_DELETED_VARIANT
    , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
    , '2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
FROM
    product P
    LEFT JOIN product_variant V ON V.K_PRODUCT_BK = P.K_PRODUCT_BK
)

SELECT * FROM rename
  );
2022-03-04 11:46:50.480694 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:52.327085 (Thread-1): SQL status: SUCCESS 1 in 1.85 seconds
2022-03-04 11:46:52.332189 (Thread-1): finished collecting timing info
2022-03-04 11:46:52.332869 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: Close
2022-03-04 11:46:52.780137 (Thread-1): 08:46:52 | 15 of 26 OK created view model DBT_SHOPIFY.V_PRODUCTS_D_STG.......... [SUCCESS 1 in 2.32s]
2022-03-04 11:46:52.780783 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-04 11:46:52.782034 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-04 11:46:52.783169 (Thread-1): 08:46:52 | 16 of 26 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG....... [RUN]
2022-03-04 11:46:52.787340 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-04 11:46:52.787802 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-04 11:46:52.798063 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-04 11:46:52.799571 (Thread-1): finished collecting timing info
2022-03-04 11:46:52.801058 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-04 11:46:52.806241 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-04 11:46:52.806361 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT"
),
customer AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 

  MD5(S.ID) AS K_ABANDONED_CHECKOUT_DLHK
  ,C.K_CUSTOMER_DLHK
  ,L.K_LOCATION_DLHK
  ,MD5(S.USER_ID) AS K_USER_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK  
  ,S.ID AS K_ABANDONED_CHECKOUT_BK
  ,S.CUSTOMER_ID AS K_CUSTOMER_BK
  ,S.DEVICE_ID AS K_DEVICE_BK
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.SOURCE_IDENTIFIER AS K_SOURCE_BKENTIFIER
  ,S.USER_ID AS K_USER_BK
  ,S.ABANDONED_CHECKOUT_URL AS A_ABANDONED_CHECKOUT_URL  
  ,S.CART_TOKEN AS A_CART_TOKEN
  ,S.CLOSED_AT AS A_CLOSED_AT
  ,S.COMPLETED_AT AS A_COMPLETED_AT
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
  ,S.EMAIL AS A_EMAIL
  ,S.GATEWAY AS A_GATEWAY
  ,S.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
  ,S.NAME AS A_NAME
  ,S.NOTE AS A_NOTE
  ,S.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES
  ,S.PHONE AS A_PHONE
  ,S.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
  ,S.REFERRING_SITE AS A_REFERRING_SITE    
  ,S.SOURCE AS A_SOURCE
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.SOURCE_URL AS A_SOURCE_URL
  ,S.TOKEN AS A_TOKEN
  ,S.UPDATED_AT AS A_UPDATED_AT  
  --BOOLEAN
  ,S.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
  ,S.TAXES_INCLUDED AS B_TAXES_INCLUDED
  --METRIC
  ,S.SUBTOTAL_PRICE::decimal(15,2) AS M_SUBTOTAL_PRICE
  ,S.TOTAL_DISCOUNTS::decimal(15,2) AS M_TOTAL_DISCOUNTS
  ,S.TOTAL_DUTIES::decimal(15,2) AS M_TOTAL_DUTIES
  ,S.TOTAL_LINE_ITEMS_PRICE::decimal(15,2) AS M_TOTAL_LINE_ITEMS_PRICE
  ,S.TOTAL_PRICE::decimal(15,2) AS M_TOTAL_PRICE
  ,S.TOTAL_TAX::decimal(15,2) AS M_TOTAL_TAX
  ,S.TOTAL_WEIGHT::decimal(15,2) AS M_TOTAL_WEIGHT
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
  FROM
      source S
      left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
      left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-04 11:46:52.806472 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:54.725242 (Thread-1): SQL status: SUCCESS 1 in 1.92 seconds
2022-03-04 11:46:54.728154 (Thread-1): finished collecting timing info
2022-03-04 11:46:54.728551 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: Close
2022-03-04 11:46:55.188172 (Thread-1): 08:46:55 | 16 of 26 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.. [SUCCESS 1 in 2.40s]
2022-03-04 11:46:55.188678 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-04 11:46:55.189037 (Thread-1): Began running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-04 11:46:55.189597 (Thread-1): 08:46:55 | 17 of 26 START view model DBT_SHOPIFY.V_TRANSACTIONS_STG............. [RUN]
2022-03-04 11:46:55.190842 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-04 11:46:55.191537 (Thread-1): Compiling model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-04 11:46:55.204855 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-04 11:46:55.205554 (Thread-1): finished collecting timing info
2022-03-04 11:46:55.207129 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-04 11:46:55.209391 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-04 11:46:55.209524 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_TRANSACTIONS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."TRANSACTION"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_TRANSACTION_DLHK
  ,L.K_LOCATION_DLHK  
  ,MD5(S.USER_ID) AS K_USER_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_TRANSACTION_BK
  ,S.DEVICE_ID AS K_DEVICE_BK  
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.ORDER_ID AS K_ORDER_BK
  ,S.PARENT_ID AS K_PARENT_BK
  ,S.REFUND_ID AS K_REFUND_BK
  ,S.USER_ID AS K_USER_BK  
  --ATTRIBUTES
  ,S.AUTHORIZATION AS A_AUTHORIZATION
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CURRENCY_EXCHANGE_ADJUSTMENT AS A_CURRENCY_EXCHANGE_ADJUSTMENT
  ,S.ERROR_CODE AS A_ERROR_CODE
  ,S.GATEWAY AS A_GATEWAY
  ,S.KIND AS A_KIND
  ,S.MESSAGE AS A_MESSAGE
  ,S.PAYMENT_DETAILS AS A_PAYMENT_DETAILS
  ,S.PROCESSED_AT AS A_PROCESSED_AT
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.STATUS AS A_STATUS
  --boolean
  ,S.TEST AS B_TEST
  --METRICS
  ,S.AMOUNT::decimal(15,2) AS M_AMOUNT   
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
  FROM
    source S  
  left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-04 11:46:55.209628 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:46:57.046684 (Thread-1): SQL status: SUCCESS 1 in 1.84 seconds
2022-03-04 11:46:57.047894 (Thread-1): finished collecting timing info
2022-03-04 11:46:57.048042 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: Close
2022-03-04 11:46:57.688138 (Thread-1): 08:46:57 | 17 of 26 OK created view model DBT_SHOPIFY.V_TRANSACTIONS_STG........ [SUCCESS 1 in 2.50s]
2022-03-04 11:46:57.688979 (Thread-1): Finished running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-04 11:46:57.689845 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-04 11:46:57.691271 (Thread-1): 08:46:57 | 18 of 26 START table model DBT_SHOPIFY.W_PRODUCTS_D.................. [RUN]
2022-03-04 11:46:57.692552 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-04 11:46:57.693389 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCTS_D
2022-03-04 11:46:57.705160 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-04 11:46:57.706535 (Thread-1): finished collecting timing info
2022-03-04 11:46:57.709194 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-04 11:46:57.710305 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-04 11:46:57.710432 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCTS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG AS C
      );
2022-03-04 11:46:57.710538 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:47:00.743886 (Thread-1): SQL status: SUCCESS 1 in 3.03 seconds
2022-03-04 11:47:00.749124 (Thread-1): finished collecting timing info
2022-03-04 11:47:00.749816 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: Close
2022-03-04 11:47:01.210574 (Thread-1): 08:47:01 | 18 of 26 OK created table model DBT_SHOPIFY.W_PRODUCTS_D............. [SUCCESS 1 in 3.52s]
2022-03-04 11:47:01.211056 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-04 11:47:01.211560 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-04 11:47:01.213844 (Thread-1): 08:47:01 | 19 of 26 START table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F........ [RUN]
2022-03-04 11:47:01.214636 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-04 11:47:01.215043 (Thread-1): Compiling model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-04 11:47:01.221504 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-04 11:47:01.222792 (Thread-1): finished collecting timing info
2022-03-04 11:47:01.224444 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-04 11:47:01.225417 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-04 11:47:01.225515 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG AS C
      );
2022-03-04 11:47:01.225605 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:47:04.180201 (Thread-1): SQL status: SUCCESS 1 in 2.95 seconds
2022-03-04 11:47:04.197751 (Thread-1): finished collecting timing info
2022-03-04 11:47:04.198462 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: Close
2022-03-04 11:47:04.664926 (Thread-1): 08:47:04 | 19 of 26 OK created table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F... [SUCCESS 1 in 3.45s]
2022-03-04 11:47:04.665634 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-04 11:47:04.666318 (Thread-1): Began running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-04 11:47:04.667257 (Thread-1): 08:47:04 | 20 of 26 START table model DBT_SHOPIFY.W_TRANSACTIONS_F.............. [RUN]
2022-03-04 11:47:04.667651 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-04 11:47:04.667856 (Thread-1): Compiling model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-04 11:47:04.673542 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-04 11:47:04.674039 (Thread-1): finished collecting timing info
2022-03-04 11:47:04.676296 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-04 11:47:04.677402 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-04 11:47:04.677551 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_TRANSACTIONS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_TRANSACTIONS_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG AS C
      );
2022-03-04 11:47:04.677667 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:47:07.115838 (Thread-1): SQL status: SUCCESS 1 in 2.44 seconds
2022-03-04 11:47:07.119541 (Thread-1): finished collecting timing info
2022-03-04 11:47:07.120451 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: Close
2022-03-04 11:47:07.572161 (Thread-1): 08:47:07 | 20 of 26 OK created table model DBT_SHOPIFY.W_TRANSACTIONS_F......... [SUCCESS 1 in 2.90s]
2022-03-04 11:47:07.574390 (Thread-1): Finished running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-04 11:47:07.575098 (Thread-1): Began running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-04 11:47:07.575778 (Thread-1): 08:47:07 | 21 of 26 START view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG........... [RUN]
2022-03-04 11:47:07.576944 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-04 11:47:07.577436 (Thread-1): Compiling model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-04 11:47:07.593719 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-04 11:47:07.595362 (Thread-1): finished collecting timing info
2022-03-04 11:47:07.596846 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-04 11:47:07.598856 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-04 11:47:07.598952 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_INVENTORY_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_ITEM"
),
inventory_level AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_LEVEL"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
products AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename AS 
(   
  SELECT   
  MD5(S.ID) AS K_INVENTORY_ITEM_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
  ,L.K_LOCATION_DLHK
  ,L.K_LOCATION_BK  
  ,S.ID AS K_INVENTORY_ITEM_BK
  ,S.COUNTRY_CODE_OF_ORIGIN AS A_COUNTRY_CODE_OF_ORIGIN
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.PROVINCE_CODE_OF_ORIGIN AS A_PROVINCE_CODE_OF_ORIGIN
  ,S.SKU AS A_SKU
  ,S.UPDATED_AT AS A_UPDATED_AT
  ,S.HARMONIZED_SYSTEM_CODE AS A_HARMONIZED_SYSTEM_CODE  
  --BOOLEAN
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TRACKED AS B_TRACKED
  --METRICS
  ,S.COST::decimal(15,2) AS M_COST 
  ,IL.AVAILABLE AS M_AVAIABLE  
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
  FROM
      source S
      left join inventory_level IL ON IL.INVENTORY_ITEM_ID = S.ID      
      left join locations L ON L.K_LOCATION_BK = IL.LOCATION_ID
      left join products P ON P.K_VARIANT_INVENTORY_ITEM_BK = S.ID 
)


SELECT * FROM rename
  );
2022-03-04 11:47:07.599051 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:47:09.286916 (Thread-1): SQL status: SUCCESS 1 in 1.69 seconds
2022-03-04 11:47:09.298247 (Thread-1): finished collecting timing info
2022-03-04 11:47:09.298806 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: Close
2022-03-04 11:47:09.831941 (Thread-1): 08:47:09 | 21 of 26 OK created view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG...... [SUCCESS 1 in 2.25s]
2022-03-04 11:47:09.833110 (Thread-1): Finished running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-04 11:47:09.833946 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-04 11:47:09.835591 (Thread-1): 08:47:09 | 22 of 26 START view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG......... [RUN]
2022-03-04 11:47:09.836664 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-04 11:47:09.837278 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-04 11:47:09.849674 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-04 11:47:09.850744 (Thread-1): finished collecting timing info
2022-03-04 11:47:09.852207 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-04 11:47:09.856112 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-04 11:47:09.856216 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM" AS A
),
products AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D AS A
),
taxes AS (
  SELECT 
      K_ORDER_LINE_ITEM_BK,
      AVG(M_RATE) AS M_RATE,
      SUM(M_TAX) AS M_TAX,
      SUM(M_TAX_PRIMARY) AS M_TAX_PRIMARY
    FROM 
      DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG AS A
    GROUP BY K_ORDER_LINE_ITEM_BK
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_LINE_ITEM_DLHK  
  ,MD5(ORDER_ID) AS K_ORDER_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
 --business keys
  ,O.PRODUCT_ID AS K_PRODUCT_BK
  ,O.VARIANT_ID AS K_VARIANT_BK
  
  ,O.ORDER_ID AS K_ORDER_BK
  ,O.ID AS K_ORDER_LINE_ITEM_BK
  --attribubtes
  ,O.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
  ,O.NAME AS A_NAME  
  ,O.PROPERTIES AS A_PROPERTIES
  ,O.SKU AS A_SKU
  ,O.TITLE AS A_TITLE  
  ,O.VARIANT_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
  ,O.VARIANT_TITLE AS A_VARIANT_TITLE
  ,O.VENDOR AS A_VENDOR
  --boolean
  ,O.GIFT_CARD AS B_GIFT_CARD
  ,O.PRODUCT_EXISTS AS B_PRODUCT_EXISTS
  ,O.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,O.TAXABLE AS B_TAXABLE
  --metrics
  ,O.FULFILLABLE_QUANTITY AS M_FULFILLABLE_QUANTITY
  ,O.GRAMS::DECIMAL(15,2) AS M_GRAMS
  ,O.QUANTITY::DECIMAL(15,2) AS M_QUANTITY
  ,M_RATE AS M_TAX_RATE
  ,COALESCE(T.M_TAX_PRIMARY,0)::DECIMAL(15,2) AS M_TAX_AMOUNT
  ,COALESCE(T.M_TAX,0)::DECIMAL(15,2) AS M_TAX_AMOUNT_PRIMARY

  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE_PRIMARY 
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT_PRIMARY 
  ,(O.QUANTITY * M_UNIT_PRICE)::DECIMAL(15,2) AS M_TOTAL_PRICE  
  ,(O.QUANTITY * M_UNIT_PRICE_PRIMARY)::DECIMAL(15,2) AS M_TOTAL_PRICE_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
FROM source O
  left join products P ON P.K_PRODUCT_BK = O.PRODUCT_ID AND CASE WHEN O.VARIANT_ID IS NOT NULL THEN O.VARIANT_ID = P.K_PRODUCT_VARIANT_BK ELSE 1=1 END
  left join taxes T ON T.K_ORDER_LINE_ITEM_BK = O.ID
)

SELECT * FROM rename
  );
2022-03-04 11:47:09.856321 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:47:11.840991 (Thread-1): SQL status: SUCCESS 1 in 1.98 seconds
2022-03-04 11:47:11.844246 (Thread-1): finished collecting timing info
2022-03-04 11:47:11.844697 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: Close
2022-03-04 11:47:12.310749 (Thread-1): 08:47:12 | 22 of 26 OK created view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG.... [SUCCESS 1 in 2.47s]
2022-03-04 11:47:12.311583 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-04 11:47:12.312615 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-04 11:47:12.313570 (Thread-1): 08:47:12 | 23 of 26 START view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG....... [RUN]
2022-03-04 11:47:12.314612 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-04 11:47:12.315318 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-04 11:47:12.327525 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-04 11:47:12.328321 (Thread-1): finished collecting timing info
2022-03-04 11:47:12.329865 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-04 11:47:12.331958 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-04 11:47:12.332064 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECT"
),
source_collection AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECTION"
),
product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename as (

SELECT
  MD5(S.ID) AS K_PRODUCT_COLLECT_DLHK
  ,MD5(CC.ID) AS K_COLLECTION_DLHK
  ,P.K_PRODUCT_DLHK  
  ,S.ID AS K_PRODUCT_COLLECT_BK
  ,CC.ID AS K_COLLECTION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,S.POSITION AS A_POSITION
  ,S.SORT_ORDER AS A_SORT_ORDER  
  ,S.CREATED_AT AS A_CREATED_AT_DTS
  ,S.UPDATED_AT AS A_UPDATED_AT_DTS
  ,CC.PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,CC.BODY_HTML AS A_BODY_HTML
  ,CC.TITLE AS A_TITLE
  ,CC.HANDLE AS A_HANDLE
  ,CC.PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE  
  ,CC.COLLECTION_TYPE AS A_COLLECTION_TYPE  
  --metrics
  ,CC.PRODUCTS_COUNT AS M_PRODUCTS_COUNT
  --metadata (MD)
  ,S.__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
FROM
    source S
    LEFT JOIN source_collection CC ON CC.ID = S.COLLECTION_ID
    LEFT JOIN product P ON P.K_PRODUCT_BK = S.PRODUCT_ID
)

SELECT * FROM rename
  );
2022-03-04 11:47:12.332171 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:47:14.307496 (Thread-1): SQL status: SUCCESS 1 in 1.98 seconds
2022-03-04 11:47:14.310817 (Thread-1): finished collecting timing info
2022-03-04 11:47:14.311247 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: Close
2022-03-04 11:47:14.761834 (Thread-1): 08:47:14 | 23 of 26 OK created view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG.. [SUCCESS 1 in 2.45s]
2022-03-04 11:47:14.762394 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-04 11:47:14.762815 (Thread-1): Began running node model.snowflake_aicd.W_INVENTORY_F
2022-03-04 11:47:14.763653 (Thread-1): 08:47:14 | 24 of 26 START table model DBT_SHOPIFY.W_INVENTORY_F................. [RUN]
2022-03-04 11:47:14.764617 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-04 11:47:14.765090 (Thread-1): Compiling model.snowflake_aicd.W_INVENTORY_F
2022-03-04 11:47:14.775024 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-04 11:47:14.777153 (Thread-1): finished collecting timing info
2022-03-04 11:47:14.780097 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-04 11:47:14.781285 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-04 11:47:14.781399 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_INVENTORY_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_INVENTORY_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG AS C
      );
2022-03-04 11:47:14.781502 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:47:18.735699 (Thread-1): SQL status: SUCCESS 1 in 3.95 seconds
2022-03-04 11:47:18.738045 (Thread-1): finished collecting timing info
2022-03-04 11:47:18.738274 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: Close
2022-03-04 11:47:19.192819 (Thread-1): 08:47:19 | 24 of 26 OK created table model DBT_SHOPIFY.W_INVENTORY_F............ [SUCCESS 1 in 4.43s]
2022-03-04 11:47:19.193048 (Thread-1): Finished running node model.snowflake_aicd.W_INVENTORY_F
2022-03-04 11:47:19.193277 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-04 11:47:19.193472 (Thread-1): 08:47:19 | 25 of 26 START table model DBT_SHOPIFY.W_ORDERS_F.................... [RUN]
2022-03-04 11:47:19.193885 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-04 11:47:19.194056 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-04 11:47:19.197275 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-04 11:47:19.198572 (Thread-1): finished collecting timing info
2022-03-04 11:47:19.200290 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-04 11:47:19.205845 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-04 11:47:19.205976 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ORDERS_F  as
      (

SELECT
  O.K_ORDER_DLHK AS K_ORDER_DLHK
  ,OLI.K_ORDER_LINE_ITEM_DLHK AS K_ORDER_LINE_ITEM_DLHK
  ,O.K_CUSTOMER_DLHK AS K_CUSTOMER_DLHK
  ,O.K_LOCATION_DLHK AS K_LOCATION_DLHK
  ,O.K_BILLING_ADDRESS_DLHK AS K_BILLING_ADDRESS_DLHK
  ,O.K_SHIPPING_ADDRESS_DLHK AS K_SHIPPING_ADDRESS_DLHK
  ,OLI.K_PRODUCT_VARIATION_DLHK AS K_ITEM_PRODUCT_VARIATION_DLHK
  ,OLI.K_PRODUCT_BK AS K_ITEM_PRODUCT_BK
  ,OLI.K_VARIANT_BK AS K_ITEM_VARIANT_BK
  ,OLI.K_ORDER_BK AS K_ITEM_ORDER_BK
  ,O.K_ORDER_BK AS K_ORDER_BK
  ,OLI.K_ORDER_LINE_ITEM_BK AS K_ITEM_ORDER_LINE_ITEM_BK
  ,O.K_APP_BK AS K_HEADER_APP_BK
  
  ,O.K_CUSTOMER_BK AS K_CUSTOMER_BK
  ,O.K_DEVICE_BK AS K_DEVICE_BK
  ,O.K_LOCATION_BK AS K_LOCATION_BK
  ,O.K_SOURCE_ENTIFIER_BK AS K_SOURCE_ENTIFIER_BK
  ,O.A_BROWSER_IP AS A_HEADER_BROWSER_IP
  ,O.A_CANCELLED_AT_DTS AS A_HEADER_CANCELLED_AT_DTS
  ,O.A_CANCEL_REASON AS A_HEADER_CANCEL_REASON
  ,O.A_CART_TOKEN AS A_HEADER_CART_TOKEN
  ,O.A_CHECKOUT_TOKEN AS A_HEADER_CHECKOUT_TOKEN
  ,O.A_CLIENT_DETAILS AS A_HEADER_CLIENT_DETAILS
  ,O.A_CLOSED_AT_DTS AS A_HEADER_CLOSED_AT_DTS
  ,O.A_CREATED_AT_DTS AS A_HEADER_CREATED_AT_DTS
  ,O.A_CURRENCY AS A_HEADER_CURRENCY
  ,O.A_PRESENTMENT_CURRENCY AS A_HEADER_PRESENTMENT_CURRENCY
  ,O.A_CUSTOMER_LOCALE AS A_HEADER_CUSTOMER_LOCALE
  ,O.A_EMAIL AS A_HEADER_EMAIL
  ,O.A_FINANCIAL_STATUS AS A_HEADER_FINANCIAL_STATUS
  ,O.A_FULFILLMENT_STATUS AS A_HEADER_FULFILLMENT_STATUS
  ,O.A_LANDING_SITE_BASE_URL AS A_HEADER_LANDING_SITE_BASE_URL
  ,O.A_LANDING_SITE_REF AS A_HEADER_LANDING_SITE_REF
  ,O.A_NAME AS A_HEADER_NAME
  ,O.A_NOTE AS A_HEADER_NOTE
  ,O.A_NOTE_ATTRIBUTES AS A_HEADER_NOTE_ATTRIBUTES
  ,O.A_PAYMENT_GATEWAY_NAMES AS A_HEADER_PAYMENT_GATEWAY_NAMES
  ,O.A_PROCESSED_AT_DTS AS A_HEADER_PROCESSED_AT_DTS
  ,O.A_PROCESSING_METHOD AS A_HEADER_PROCESSING_METHOD
  ,O.A_REFERENCE AS A_HEADER_REFERENCE
  ,O.A_REFERRING_SITE AS A_HEADER_REFERRING_SITE
  ,O.A_SOURCE_NAME AS A_HEADER_SOURCE_NAME
  ,O.A_SOURCE_URL AS A_HEADER_SOURCE_URL
  ,O.A_ORDER_NUMBER AS A_HEADER_ORDER_NUMBER
  ,O.A_POSION_NUMBER AS A_HEADER_POSION_NUMBER
  ,O.A_UPDATED_AT_DTS AS A_HEADER_UPDATED_AT_DTS
  ,O.B_BUYER_ACCEPTS_MARKETING AS B_HEADER_BUYER_ACCEPTS_MARKETING
  ,O.B_CONFIRMED AS B_HEADER_CONFIRMED
  ,O.B_TAXES_INCLUDED  AS B_HEADER_TAXES_INCLUDED   
  ,OLI.A_FULFILLMENT_SERVICE AS A_ITEM_FULFILLMENT_SERVICE
  ,OLI.A_FULFILLMENT_STATUS AS A_ITEM_FULFILLMENT_STATUS    
  ,OLI.A_VARIANT_INVENTORY_MANAGEMENT AS A_ITEM_VARIANT_INVENTORY_MANAGEMENT  
  
  ,OLI.B_GIFT_CARD AS B_ITEM_GIFT_CARD
  ,OLI.B_PRODUCT_EXISTS AS B_ITEM_PRODUCT_EXISTS
  ,OLI.B_REQUIRES_SHIPPING AS B_ITEM_REQUIRES_SHIPPING
  ,OLI.B_TAXABLE AS B_ITEM_TAXABLE
  ,OLI.M_FULFILLABLE_QUANTITY AS M_ITEM_FULFILLABLE_QUANTITY
  ,OLI.M_GRAMS AS M_ITEM_GRAMS
  ,OLI.M_QUANTITY AS M_ITEM_QUANTITY
  ,OLI.M_UNIT_PRICE AS M_ITEM_UNIT_PRICE
  ,OLI.M_UNIT_PRICE_PRIMARY AS M_ITEM_UNIT_PRICE_PRIMARY
  ,OLI.M_TOTAL_PRICE AS M_ITEM_TOTAL_PRICE
  ,OLI.M_TOTAL_PRICE_PRIMARY AS M_ITEM_TOTAL_PRICE_PRIMARY
  ,OLI.M_TOTAL_DISCOUNT AS M_ITEM_TOTAL_DISCOUNT
  ,OLI.M_TOTAL_DISCOUNT_PRIMARY AS M_ITEM_TOTAL_DISCOUNT_PRIMARY
  ,OLI.M_TAX_AMOUNT AS M_TAX_AMOUNT
  ,OLI.M_TAX_AMOUNT_PRIMARY AS M_TAX_AMOUNT_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_TIP_RECEIVED * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_TIP_AMOUNT_PRIMARY  
  --,ROUND(DIV0((O.M_TOTAL_DISCOUNTS_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_HEADER_DISCOUNT
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE * OLI.M_TOTAL_PRICE),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE



   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'2a48a977-2c30-44a6-9e08-fca12e375d82' AS MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG OLI ON OLI.K_ORDER_DLHK = O.K_ORDER_DLHK
      );
2022-03-04 11:47:19.206091 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:47:22.422584 (Thread-1): SQL status: SUCCESS 1 in 3.22 seconds
2022-03-04 11:47:22.427031 (Thread-1): finished collecting timing info
2022-03-04 11:47:22.427672 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-04 11:47:23.014832 (Thread-1): 08:47:23 | 25 of 26 OK created table model DBT_SHOPIFY.W_ORDERS_F............... [SUCCESS 1 in 3.82s]
2022-03-04 11:47:23.015033 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-04 11:47:23.015312 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-04 11:47:23.015522 (Thread-1): 08:47:23 | 26 of 26 START table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F........ [RUN]
2022-03-04 11:47:23.015758 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-04 11:47:23.015865 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-04 11:47:23.018915 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-04 11:47:23.020513 (Thread-1): finished collecting timing info
2022-03-04 11:47:23.022043 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-04 11:47:23.022698 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-04 11:47:23.022799 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCT_COLLECTION_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG AS C
      );
2022-03-04 11:47:23.022897 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 11:47:25.800886 (Thread-1): SQL status: SUCCESS 1 in 2.78 seconds
2022-03-04 11:47:25.803916 (Thread-1): finished collecting timing info
2022-03-04 11:47:25.804338 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: Close
2022-03-04 11:47:26.244565 (Thread-1): 08:47:26 | 26 of 26 OK created table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F... [SUCCESS 1 in 3.23s]
2022-03-04 11:47:26.244815 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-04 11:47:26.248099 (MainThread): Acquiring new snowflake connection "master".
2022-03-04 11:47:26.248616 (MainThread): 08:47:26 | 
2022-03-04 11:47:26.248751 (MainThread): 08:47:26 | Finished running 16 view models, 10 table models in 80.93s.
2022-03-04 11:47:26.248859 (MainThread): Connection 'master' was properly closed.
2022-03-04 11:47:26.248943 (MainThread): Connection 'model.snowflake_aicd.W_PRODUCT_COLLECTION_F' was properly closed.
2022-03-04 11:47:26.256511 (MainThread): 
2022-03-04 11:47:26.257576 (MainThread): Completed successfully
2022-03-04 11:47:26.257792 (MainThread): 
Done. PASS=26 WARN=0 ERROR=0 SKIP=0 TOTAL=26
2022-03-04 11:47:26.258034 (MainThread): Flushing usage events
2022-03-04 12:29:37.270987 (MainThread): Running with dbt=0.21.1
2022-03-04 12:29:37.983961 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-04 12:29:37.985809 (MainThread): Tracking: do not track
2022-03-04 12:29:37.999992 (MainThread): Partial parsing not enabled
2022-03-04 12:29:38.029724 (MainThread): Parsing macros/common.sql
2022-03-04 12:29:38.034140 (MainThread): Parsing macros/catalog.sql
2022-03-04 12:29:38.036415 (MainThread): Parsing macros/adapters.sql
2022-03-04 12:29:38.068333 (MainThread): Parsing macros/materializations/merge.sql
2022-03-04 12:29:38.071475 (MainThread): Parsing macros/materializations/seed.sql
2022-03-04 12:29:38.075186 (MainThread): Parsing macros/materializations/view.sql
2022-03-04 12:29:38.076477 (MainThread): Parsing macros/materializations/table.sql
2022-03-04 12:29:38.079133 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-04 12:29:38.086329 (MainThread): Parsing macros/core.sql
2022-03-04 12:29:38.089271 (MainThread): Parsing macros/materializations/test.sql
2022-03-04 12:29:38.094598 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-04 12:29:38.102583 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-04 12:29:38.104098 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-04 12:29:38.119187 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-04 12:29:38.149662 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-04 12:29:38.169815 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-04 12:29:38.171225 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-04 12:29:38.179784 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-04 12:29:38.197291 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-04 12:29:38.209025 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-04 12:29:38.215666 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-04 12:29:38.221706 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-04 12:29:38.224759 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-04 12:29:38.225875 (MainThread): Parsing macros/etc/query.sql
2022-03-04 12:29:38.226567 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-04 12:29:38.227682 (MainThread): Parsing macros/etc/datetime.sql
2022-03-04 12:29:38.234306 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-04 12:29:38.235623 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-04 12:29:38.237410 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-04 12:29:38.238539 (MainThread): Parsing macros/adapters/common.sql
2022-03-04 12:29:38.283916 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-04 12:29:38.285228 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-04 12:29:38.286064 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-04 12:29:38.287038 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-04 12:29:38.443624 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-04 12:29:38.453184 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.456158 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-04 12:29:38.458704 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.459431 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-04 12:29:38.462373 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.463107 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-04 12:29:38.467812 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.468608 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-04 12:29:38.471794 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.472829 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-04 12:29:38.476042 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.476796 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-04 12:29:38.479839 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.480830 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-04 12:29:38.484156 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.485048 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-04 12:29:38.487614 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.488328 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-04 12:29:38.492871 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.493631 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-04 12:29:38.496731 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.497458 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-04 12:29:38.502702 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.503624 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-04 12:29:38.509771 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.510570 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-04 12:29:38.514325 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.515379 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-04 12:29:38.519090 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.519811 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-04 12:29:38.523759 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.524624 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-04 12:29:38.527809 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.528532 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-04 12:29:38.531479 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.532240 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-04 12:29:38.570854 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.571926 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-04 12:29:38.574898 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.575695 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-04 12:29:38.577945 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.578672 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-04 12:29:38.581116 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.582087 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-04 12:29:38.584720 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.585440 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-04 12:29:38.587634 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.588345 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-04 12:29:38.590491 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.591189 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-04 12:29:38.593453 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.614109 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.616289 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.634028 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.635283 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.636665 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.637853 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.639027 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.640204 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:29:38.675808 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-04 12:29:38.676663 (MainThread): Found 26 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 23 sources, 0 exposures
2022-03-04 12:29:38.679047 (MainThread): 
2022-03-04 12:29:38.679318 (MainThread): Acquiring new snowflake connection "master".
2022-03-04 12:29:38.680839 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-04 12:29:38.690480 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-04 12:29:38.690654 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-04 12:29:38.690755 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-04 12:29:40.858564 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 2.17 seconds
2022-03-04 12:29:40.870198 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-04 12:29:41.337530 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-04 12:29:41.346629 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-04 12:29:41.346853 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-04 12:29:41.347000 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-04 12:29:42.924274 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 27 in 1.58 seconds
2022-03-04 12:29:42.935938 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-04 12:29:43.385838 (MainThread): 09:29:43 | Concurrency: 1 threads (target='dev')
2022-03-04 12:29:43.386467 (MainThread): 09:29:43 | 
2022-03-04 12:29:43.394537 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-04 12:29:43.395631 (Thread-1): 09:29:43 | 1 of 26 START view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG.......... [RUN]
2022-03-04 12:29:43.396774 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-04 12:29:43.397302 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-04 12:29:43.411916 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-04 12:29:43.413015 (Thread-1): finished collecting timing info
2022-03-04 12:29:43.436176 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-04 12:29:43.438349 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-04 12:29:43.438589 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER_ADDRESS"
),
rename AS 
(   
SELECT 
    MD5(ID) AS K_CUSTOMER_ADDRESS_DLHK
    ,ID AS K_CUSTOMER_ADDRESS_BK
    ,MD5(CONCAT(
        COALESCE(ADDRESS1,'00'),
        COALESCE(ADDRESS2,'00'),
        COALESCE(CITY,'00'),
        COALESCE(COUNTRY,'00'),
        COALESCE(COUNTRY_CODE,'00'),
        COALESCE(FIRST_NAME,'00'),
        COALESCE(LAST_NAME,'00'),
        COALESCE(PROVINCE,'00'),
        COALESCE(PROVINCE_CODE,'00'),
        COALESCE(ZIP,'00')
    )) AS K_ADDRESS_DLHK
    ,CUSTOMER_ID AS K_CUSTOMER_BK
    ,ADDRESS1 AS A_ADDRESS1
    ,ADDRESS2 AS A_ADDRESS2
    ,CITY AS A_CITY
    ,COMPANY AS A_COMPANY
    ,COUNTRY AS A_COUNTRY
    ,COUNTRY_CODE AS A_COUNTRY_CODE
    ,COUNTRY_NAME AS A_COUNTRY_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,PHONE AS A_PHONE
    ,PROVINCE AS A_PROVINCE
    ,PROVINCE_CODE AS A_PROVINCE_CODE
    ,ZIP AS A_ZIP
    ,IS_DEFAULT AS B_IS_DEFAULT  
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-04 12:29:43.438809 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:29:45.265773 (Thread-1): SQL status: SUCCESS 1 in 1.83 seconds
2022-03-04 12:29:45.281527 (Thread-1): finished collecting timing info
2022-03-04 12:29:45.281749 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: Close
2022-03-04 12:29:45.724925 (Thread-1): 09:29:45 | 1 of 26 OK created view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG..... [SUCCESS 1 in 2.33s]
2022-03-04 12:29:45.725501 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-04 12:29:45.725931 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-04 12:29:45.726617 (Thread-1): 09:29:45 | 2 of 26 START view model DBT_SHOPIFY.V_CUSTOMER_STG.................. [RUN]
2022-03-04 12:29:45.727433 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-04 12:29:45.727916 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-04 12:29:45.740566 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-04 12:29:45.741641 (Thread-1): finished collecting timing info
2022-03-04 12:29:45.745562 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-04 12:29:45.748292 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-04 12:29:45.748463 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER"
),
rename AS 
(   
SELECT 
    --KEYS
    MD5(ID) AS K_CUSTOMER_DLHK    
    --BUSINESS KEYS
    ,ID AS K_CUSTOMER_BK
    ,LAST_ORDER_ID AS K_LAST_ORDER_BK
    ,MULTIPASS_IDENTIFIER AS K_MULTIPASS_BKENTIFIER
    --ATTRIBUTES
    ,ACCEPTS_MARKETING_UPDATED_AT AS A_ACCEPTS_MARKETING_UPDATED_AT_DTS
    ,CREATED_AT AS A_CREATED_AT_DTS
    ,CURRENCY AS A_CURRENCY
    ,EMAIL AS A_EMAIL
    ,
    (COALESCE(FIRST_NAME,'') || ' ' || COALESCE(LAST_NAME,''))
 AS A_FULL_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,LAST_ORDER_NAME AS A_LAST_ORDER_NAME
    ,MARKETING_OPT_IN_LEVEL AS A_MARKETING_OPT_IN_LEVEL
    ,NOTE AS A_NOTE
    ,PHONE AS A_PHONE
    ,SMS_MARKETING_CONSENT AS A_SMS_MARKETING_CONSENT
    ,STATE AS A_STATE
    ,TAGS AS A_TAGS
    ,TAX_EXEMPTIONS AS A_TAX_EXEMPTIONS
    ,TOTAL_SPENT AS A_TOTAL_SPENT
    ,UPDATED_AT AS A_UPDATED_AT
    --BOOLEAN
    ,ACCEPTS_MARKETING AS B_ACCEPTS_MARKETING
    ,TAX_EXEMPT AS B_TAX_EXEMPT
    ,VERIFIED_EMAIL AS B_VERIFIED_EMAIL
    --METRICS
    ,ORDERS_COUNT AS M_ORDERS_COUNT
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-04 12:29:45.748575 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:29:47.417621 (Thread-1): SQL status: SUCCESS 1 in 1.67 seconds
2022-03-04 12:29:47.421042 (Thread-1): finished collecting timing info
2022-03-04 12:29:47.421517 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-04 12:29:47.874967 (Thread-1): 09:29:47 | 2 of 26 OK created view model DBT_SHOPIFY.V_CUSTOMER_STG............. [SUCCESS 1 in 2.15s]
2022-03-04 12:29:47.875643 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-04 12:29:47.882180 (Thread-1): Began running node model.snowflake_aicd.V_DATE_STG
2022-03-04 12:29:47.882876 (Thread-1): 09:29:47 | 3 of 26 START view model DBT_SHOPIFY.V_DATE_STG...................... [RUN]
2022-03-04 12:29:47.883498 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-04 12:29:47.883688 (Thread-1): Compiling model.snowflake_aicd.V_DATE_STG
2022-03-04 12:29:47.888058 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-04 12:29:47.888895 (Thread-1): finished collecting timing info
2022-03-04 12:29:47.890850 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-04 12:29:47.913634 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-04 12:29:47.913844 (Thread-1): On model.snowflake_aicd.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-04 12:29:47.914050 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:29:49.694060 (Thread-1): SQL status: SUCCESS 1 in 1.78 seconds
2022-03-04 12:29:49.697726 (Thread-1): finished collecting timing info
2022-03-04 12:29:49.698149 (Thread-1): On model.snowflake_aicd.V_DATE_STG: Close
2022-03-04 12:29:50.155269 (Thread-1): 09:29:50 | 3 of 26 OK created view model DBT_SHOPIFY.V_DATE_STG................. [SUCCESS 1 in 2.27s]
2022-03-04 12:29:50.156140 (Thread-1): Finished running node model.snowflake_aicd.V_DATE_STG
2022-03-04 12:29:50.157825 (Thread-1): Began running node model.snowflake_aicd.V_LOCATION_STG
2022-03-04 12:29:50.158866 (Thread-1): 09:29:50 | 4 of 26 START view model DBT_SHOPIFY.V_LOCATION_STG.................. [RUN]
2022-03-04 12:29:50.160169 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-04 12:29:50.160796 (Thread-1): Compiling model.snowflake_aicd.V_LOCATION_STG
2022-03-04 12:29:50.174781 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-04 12:29:50.175263 (Thread-1): finished collecting timing info
2022-03-04 12:29:50.176724 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-04 12:29:50.178394 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-04 12:29:50.178495 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-04 12:29:50.178592 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:29:52.069660 (Thread-1): SQL status: SUCCESS 1 in 1.89 seconds
2022-03-04 12:29:52.077302 (Thread-1): finished collecting timing info
2022-03-04 12:29:52.077739 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-04 12:29:52.537607 (Thread-1): 09:29:52 | 4 of 26 OK created view model DBT_SHOPIFY.V_LOCATION_STG............. [SUCCESS 1 in 2.38s]
2022-03-04 12:29:52.538097 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-04 12:29:52.538631 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-04 12:29:52.539360 (Thread-1): 09:29:52 | 5 of 26 START view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG......... [RUN]
2022-03-04 12:29:52.540191 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-04 12:29:52.540847 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-04 12:29:52.551581 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-04 12:29:52.552573 (Thread-1): finished collecting timing info
2022-03-04 12:29:52.554175 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-04 12:29:52.556232 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-04 12:29:52.556329 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_ADJUSTMENT" AS A
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_ADJUSTMENT_DLHK
  --BK
  ,ID AS K_ORDER_ADJUSTMENT_BK
  ,ORDER_ID AS K_ORDER_BK
  ,REFUND_ID AS K_REFUND_BK
  --ATTRIBUTE
  ,KIND AS A_KIND
  ,REASON AS A_REASON
  --METRIC
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT_PRIMARY
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-04 12:29:52.556426 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:29:54.398970 (Thread-1): SQL status: SUCCESS 1 in 1.84 seconds
2022-03-04 12:29:54.402279 (Thread-1): finished collecting timing info
2022-03-04 12:29:54.402835 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: Close
2022-03-04 12:29:54.863889 (Thread-1): 09:29:54 | 5 of 26 OK created view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG.... [SUCCESS 1 in 2.32s]
2022-03-04 12:29:54.864402 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-04 12:29:54.864844 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-04 12:29:54.865353 (Thread-1): 09:29:54 | 6 of 26 START view model DBT_SHOPIFY.V_ORDERS_HEADER_STG............. [RUN]
2022-03-04 12:29:54.866071 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-04 12:29:54.866898 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-04 12:29:54.886119 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-04 12:29:54.886629 (Thread-1): finished collecting timing info
2022-03-04 12:29:54.888229 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-04 12:29:54.897665 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-04 12:29:54.897901 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDERS" AS A
),
rename AS 
(
SELECT
    MD5(O.ID) AS K_ORDER_DLHK    
    ,MD5(O.CUSTOMER_ID) AS K_CUSTOMER_DLHK
    ,MD5(O.LOCATION_ID) AS K_LOCATION_DLHK    
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
    --BUSINESS_KEYS
    ,O.APP_ID AS K_APP_BK
    ,O.ID AS K_ORDER_BK
    ,O.CUSTOMER_ID AS K_CUSTOMER_BK
    ,O.DEVICE_ID AS K_DEVICE_BK  
    ,O.LOCATION_ID AS K_LOCATION_BK
    ,O.SOURCE_IDENTIFIER AS K_SOURCE_ENTIFIER_BK
    --ATTRIBUTES
    ,O.BROWSER_IP AS A_BROWSER_IP
    ,O.CANCELLED_AT AS A_CANCELLED_AT_DTS
    ,O.CANCEL_REASON AS A_CANCEL_REASON
    ,O.CART_TOKEN AS A_CART_TOKEN
    ,O.CHECKOUT_TOKEN AS A_CHECKOUT_TOKEN
    ,O.CLIENT_DETAILS AS A_CLIENT_DETAILS
    ,O.CLOSED_AT AS A_CLOSED_AT_DTS
    ,O.CREATED_AT AS A_CREATED_AT_DTS
    ,O.CURRENCY AS A_CURRENCY
    ,O.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
    ,O.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
    ,O.EMAIL AS A_EMAIL
    ,O.FINANCIAL_STATUS AS A_FINANCIAL_STATUS
    ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
    ,O.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
    ,O.LANDING_SITE_REF AS A_LANDING_SITE_REF
    ,O.NAME AS A_NAME
    ,O.NOTE AS A_NOTE
    ,O.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES    
    ,O.PAYMENT_GATEWAY_NAMES AS A_PAYMENT_GATEWAY_NAMES    
    ,O.PROCESSED_AT AS A_PROCESSED_AT_DTS
    ,O.PROCESSING_METHOD AS A_PROCESSING_METHOD
    ,O.REFERENCE AS A_REFERENCE
    ,O.REFERRING_SITE AS A_REFERRING_SITE    
    ,O.SOURCE_NAME AS A_SOURCE_NAME
    ,O.SOURCE_URL AS A_SOURCE_URL    
    ,O.ORDER_NUMBER AS A_ORDER_NUMBER
    ,O.POSION_NUMBER AS A_POSION_NUMBER  
    ,O.UPDATED_AT AS A_UPDATED_AT_DTS
    --BOOLEAN
    ,O.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
    ,O.CONFIRMED AS B_CONFIRMED
    ,O.TAXES_INCLUDED AS B_TAXES_INCLUDED
    --METRICS
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE_PRIMARY 
    ,O.TOTAL_TIP_RECEIVED::DECIMAL(15,2) AS M_TOTAL_TIP_RECEIVED   
    ,O.TOTAL_WEIGHT::DECIMAL(15,2) AS M_TOTAL_WEIGHT
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
FROM source O
)

SELECT * FROM rename
  );
2022-03-04 12:29:54.898052 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:29:56.712440 (Thread-1): SQL status: SUCCESS 1 in 1.81 seconds
2022-03-04 12:29:56.719784 (Thread-1): finished collecting timing info
2022-03-04 12:29:56.720399 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: Close
2022-03-04 12:29:57.175084 (Thread-1): 09:29:57 | 6 of 26 OK created view model DBT_SHOPIFY.V_ORDERS_HEADER_STG........ [SUCCESS 1 in 2.31s]
2022-03-04 12:29:57.175745 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-04 12:29:57.176629 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-04 12:29:57.177667 (Thread-1): 09:29:57 | 7 of 26 START view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG.. [RUN]
2022-03-04 12:29:57.179010 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-04 12:29:57.185648 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-04 12:29:57.190076 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-04 12:29:57.190482 (Thread-1): finished collecting timing info
2022-03-04 12:29:57.191980 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-04 12:29:57.193591 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-04 12:29:57.193688 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM_TAX_LINE" AS A
),
rename AS 
(
SELECT
  CONCAT(COALESCE(ORDER_ID,'0000000000'),'-',COALESCE(ORDER_LINE_ID,'0000000000')) AS K_ORDER_LINE_ITEM_TAX_DLHK
  ,ORDER_ID AS K_ORDER_BK
  ,ORDER_LINE_ID AS K_ORDER_LINE_ITEM_BK
  ,TITLE AS A_TITLE
  ,CHANNEL_LIABLE AS B_CHANNEL_LIABLE
  ,RATE AS M_RATE
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-04 12:29:57.193786 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:29:58.924801 (Thread-1): SQL status: SUCCESS 1 in 1.73 seconds
2022-03-04 12:29:58.928176 (Thread-1): finished collecting timing info
2022-03-04 12:29:58.928656 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: Close
2022-03-04 12:29:59.417084 (Thread-1): 09:29:59 | 7 of 26 OK created view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG [SUCCESS 1 in 2.24s]
2022-03-04 12:29:59.417726 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-04 12:29:59.418722 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-04 12:29:59.420001 (Thread-1): 09:29:59 | 8 of 26 START view model DBT_SHOPIFY.V_PRODUCT_STG................... [RUN]
2022-03-04 12:29:59.421032 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-04 12:29:59.421512 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_STG
2022-03-04 12:29:59.431032 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-04 12:29:59.431496 (Thread-1): finished collecting timing info
2022-03-04 12:29:59.432935 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-04 12:29:59.434466 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-04 12:29:59.434618 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_DLHK
  ,ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE
  ,HANDLE AS A_HANDLE
  ,PRODUCT_TYPE AS A_PRODUCT_TYPE
  ,VENDOR AS A_VENDOR
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE
  ,STATUS AS A_STATUS
  ,TEMPLATE_SUFFIX AS A_TEMPLATE_SUFFIX   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-04 12:29:59.434716 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:01.154265 (Thread-1): SQL status: SUCCESS 1 in 1.72 seconds
2022-03-04 12:30:01.157784 (Thread-1): finished collecting timing info
2022-03-04 12:30:01.158378 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: Close
2022-03-04 12:30:01.643750 (Thread-1): 09:30:01 | 8 of 26 OK created view model DBT_SHOPIFY.V_PRODUCT_STG.............. [SUCCESS 1 in 2.22s]
2022-03-04 12:30:01.644413 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-04 12:30:01.644950 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-04 12:30:01.645821 (Thread-1): 09:30:01 | 9 of 26 START view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG........... [RUN]
2022-03-04 12:30:01.646803 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-04 12:30:01.647480 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-04 12:30:01.657162 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-04 12:30:01.657557 (Thread-1): finished collecting timing info
2022-03-04 12:30:01.659262 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-04 12:30:01.661442 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-04 12:30:01.661546 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT_VARIANT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_VARIANT_DLHK
  ,MD5(PRODUCT_ID) AS K_PRODUCT_DLHK  
  --BUSINESS KEYS  
  ,ID AS K_PRODUCT_VARIANT_BK
  ,PRODUCT_ID AS K_PRODUCT_BK  
  ,INVENTORY_ITEM_ID AS K_INVENTORY_ITEM_BK
  ,IMAGE_ID AS K_IMAGE_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE  
  ,SKU AS A_SKU    
  ,FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,INVENTORY_MANAGEMENT AS A_INVENTORY_MANAGEMENT
  ,INVENTORY_POLICY AS A_INVENTORY_POLICY
  ,BARCODE AS A_BARCODE
  ,GRAMS AS A_GRAMS
  ,WEIGHT_UNIT AS A_WEIGHT_UNIT
  ,OPTION_1 AS A_OPTION_1
  ,OPTION_2 AS A_OPTION_2
  ,OPTION_3 AS A_OPTION_3
  ,TAX_CODE AS A_TAX_CODE  
  ,PRESENTMENT_PRICES AS A_PRESENTMENT_PRICES  
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  --BOOLEAN
  ,REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,TAXABLE AS B_TAXABLE
  --METRICS
  ,PRICE AS M_PRICE
  ,POSITION AS M_POSITION
  ,COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,INVENTORY_QUANTITY AS M_INVENTORY_QUANTITY
  ,INVENTORY_QUANTITY_ADJUSTMENT AS M_INVENTORY_QUANTITY_ADJUSTMENT
  ,WEIGHT AS M_WEIGHT
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-04 12:30:01.661645 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:03.487224 (Thread-1): SQL status: SUCCESS 1 in 1.83 seconds
2022-03-04 12:30:03.492052 (Thread-1): finished collecting timing info
2022-03-04 12:30:03.492595 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: Close
2022-03-04 12:30:03.927864 (Thread-1): 09:30:03 | 9 of 26 OK created view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG...... [SUCCESS 1 in 2.28s]
2022-03-04 12:30:03.928471 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-04 12:30:03.929702 (Thread-1): Began running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-04 12:30:03.931033 (Thread-1): 09:30:03 | 10 of 26 START view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG......... [RUN]
2022-03-04 12:30:03.934436 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-04 12:30:03.934950 (Thread-1): Compiling model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-04 12:30:03.946791 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-04 12:30:03.947310 (Thread-1): finished collecting timing info
2022-03-04 12:30:03.948819 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-04 12:30:03.951424 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-04 12:30:03.951572 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG  as (
    


WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND" AS A
),
refund_line as (
    SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND_LINE_ITEM" AS A
),
rename AS 
(
SELECT
  MD5(RL.ID) AS K_REFUND_LINE_DLHK
  ,MD5(R.ID) AS K_REFUND_DLHK
  ,R.ID AS K_REFUND_BK
  ,RL.ID AS K_REFUND_LINE_BK
  ,R.ORDER_ID AS K_ORDER_BK
  ,R.USER_ID AS K_USER_BK
  ,RL.LOCATION_ID AS K_LOCATION_BK
  ,RL.LINE_ITEM_ID AS K_ORDER_LINE_ITEM_BK
  ,R.NOTE AS A_NOTE
  ,R.RESTOCK AS B_RESTOCK
  ,RL.QUANTITY AS M_QUANTITY
  ,RL.RESTOCK_TYPE AS A_RESTOCK_TYPE
   
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL


  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
FROM source R
LEFT JOIN refund_line RL ON RL.REFUND_ID = R.ID
)

SELECT * FROM rename
  );
2022-03-04 12:30:03.951770 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:06.158961 (Thread-1): SQL status: SUCCESS 1 in 2.21 seconds
2022-03-04 12:30:06.164473 (Thread-1): finished collecting timing info
2022-03-04 12:30:06.165119 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: Close
2022-03-04 12:30:06.744584 (Thread-1): 09:30:06 | 10 of 26 OK created view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG.... [SUCCESS 1 in 2.81s]
2022-03-04 12:30:06.745341 (Thread-1): Finished running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-04 12:30:06.745895 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-04 12:30:06.746806 (Thread-1): 09:30:06 | 11 of 26 START table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D.......... [RUN]
2022-03-04 12:30:06.750981 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-04 12:30:06.753653 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-04 12:30:06.761927 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-04 12:30:06.763629 (Thread-1): finished collecting timing info
2022-03-04 12:30:06.779043 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-04 12:30:06.779802 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-04 12:30:06.779906 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG AS C
      );
2022-03-04 12:30:06.780008 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:12.175439 (Thread-1): SQL status: SUCCESS 1 in 5.40 seconds
2022-03-04 12:30:12.193274 (Thread-1): finished collecting timing info
2022-03-04 12:30:12.193614 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: Close
2022-03-04 12:30:12.660677 (Thread-1): 09:30:12 | 11 of 26 OK created table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D..... [SUCCESS 1 in 5.91s]
2022-03-04 12:30:12.661580 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-04 12:30:12.662714 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-04 12:30:12.663589 (Thread-1): 09:30:12 | 12 of 26 START table model DBT_SHOPIFY.W_CUSTOMERS_D................. [RUN]
2022-03-04 12:30:12.664932 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-04 12:30:12.665786 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-04 12:30:12.679024 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-04 12:30:12.679455 (Thread-1): finished collecting timing info
2022-03-04 12:30:12.681201 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-04 12:30:12.684028 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-04 12:30:12.684141 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG AS C
      );
2022-03-04 12:30:12.684242 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:15.980430 (Thread-1): SQL status: SUCCESS 1 in 3.30 seconds
2022-03-04 12:30:15.984659 (Thread-1): finished collecting timing info
2022-03-04 12:30:15.985155 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-04 12:30:16.426301 (Thread-1): 09:30:16 | 12 of 26 OK created table model DBT_SHOPIFY.W_CUSTOMERS_D............ [SUCCESS 1 in 3.76s]
2022-03-04 12:30:16.427353 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-04 12:30:16.428108 (Thread-1): Began running node model.snowflake_aicd.W_DATE_D
2022-03-04 12:30:16.429076 (Thread-1): 09:30:16 | 13 of 26 START table model DBT_SHOPIFY.W_DATE_D...................... [RUN]
2022-03-04 12:30:16.430103 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-04 12:30:16.430665 (Thread-1): Compiling model.snowflake_aicd.W_DATE_D
2022-03-04 12:30:16.440551 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-04 12:30:16.440961 (Thread-1): finished collecting timing info
2022-03-04 12:30:16.442411 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-04 12:30:16.445249 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-04 12:30:16.445343 (Thread-1): On model.snowflake_aicd.W_DATE_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_DATE_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_DATE_D  as
      (

SELECT 
	CAST(DATE_KEY AS NUMBER(9)) AS K_DATE_INTEGER_BK
	,CAST(DATE_COLUMN AS DATE) AS K_DATE_BK
	,CAST(FULL_DATE_DESC AS VARCHAR(64)) AS A_FULL_DATE_DESC
	,CAST(DAY_NUM_IN_WEEK AS NUMBER(1)) AS A_DAY_NUM_IN_WEEK
	,CAST(DAY_NUM_IN_MONTH AS NUMBER(2)) AS A_DAY_NUM_IN_MONTH
	,CAST(DAY_NUM_IN_YEAR AS NUMBER(3)) AS A_DAY_NUM_IN_YEAR
	,CAST(DAY_NAME AS VARCHAR(10)) AS A_DAY_NAME
	,CAST(DAY_ABBREV AS VARCHAR(3)) AS A_DAY_ABBREV
	,CAST(WEEKDAY_IND AS VARCHAR(64)) AS A_WEEKDAY_IND
	,CAST(US_HOLIDAY_IND AS VARCHAR(64)) AS A_US_HOLIDAY_IND
	,CAST(COMPANY_HOLIDAY_IND AS VARCHAR(64)) AS A_COMPANY_HOLIDAY_IND
	,CAST(MONTH_END_IND AS VARCHAR(64)) AS A_MONTH_END_IND
	,CAST(WEEK_BEGIN_DATE_NKEY AS NUMBER(9)) AS A_WEEK_BEGIN_DATE_NKEY
	,CAST(WEEK_BEGIN_DATE AS DATE) AS A_WEEK_BEGIN_DATE
	,CAST(WEEK_END_DATE_NKEY AS NUMBER(9)) AS A_WEEK_END_DATE_NKEY
	,CAST(WEEK_END_DATE AS DATE) AS A_WEEK_END_DATE
	,CAST(WEEK_NUM_IN_YEAR AS NUMBER(9)) AS A_WEEK_NUM_IN_YEAR
	,CAST(MONTH_NAME AS VARCHAR(10)) AS A_MONTH_NAME
	,CAST(MONTH_ABBREV AS VARCHAR(3)) AS A_MONTH_ABBREV
	,CAST(MONTH_NUM_IN_YEAR AS NUMBER(2)) AS A_MONTH_NUM_IN_YEAR
	,CAST(YEARMONTH AS VARCHAR(10)) AS A_YEARMONTH
	,CAST(CURRENT_QUARTER AS NUMBER(1)) AS A_QUARTER
	,CAST(YEARQUARTER AS VARCHAR(10)) AS A_YEARQUARTER
	,CAST(CURRENT_YEAR AS NUMBER(5)) AS A_YEAR
	,CAST(FISCAL_WEEK_NUM AS NUMBER(2)) AS A_FISCAL_WEEK_NUM
	,CAST(FISCAL_MONTH_NUM AS NUMBER(2)) AS A_FISCAL_MONTH_NUM
	,CAST(FISCAL_YEARMONTH AS VARCHAR(10)) AS A_FISCAL_YEARMONTH
	,CAST(FISCAL_QUARTER AS NUMBER(1)) AS A_FISCAL_QUARTER
	,CAST(FISCAL_YEARQUARTER AS VARCHAR(10)) AS A_FISCAL_YEARQUARTER
	,CAST(FISCAL_HALFYEAR AS NUMBER(1)) AS A_FISCAL_HALFYEAR
	,CAST(FISCAL_YEAR AS NUMBER(5)) AS A_FISCAL_YEAR
	,CAST(SQL_TIMESTAMP AS TIMESTAMP_NTZ) AS A_SQL_TIMESTAMP_DTS
	,CAST(CURRENT_ROW_IND AS CHAR(1)) AS A_CURRENT_ROW_IND
	,CAST(EFFECTIVE_DATE AS DATE) AS A_EFFECTIVE_DATE
	,CAST(EXPIRA_DATE AS DATE) AS A_EXPIRATION_DATE
FROM
DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG
      );
2022-03-04 12:30:16.445446 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:20.170810 (Thread-1): SQL status: SUCCESS 1 in 3.73 seconds
2022-03-04 12:30:20.176789 (Thread-1): finished collecting timing info
2022-03-04 12:30:20.177587 (Thread-1): On model.snowflake_aicd.W_DATE_D: Close
2022-03-04 12:30:20.639299 (Thread-1): 09:30:20 | 13 of 26 OK created table model DBT_SHOPIFY.W_DATE_D................. [SUCCESS 1 in 4.21s]
2022-03-04 12:30:20.639785 (Thread-1): Finished running node model.snowflake_aicd.W_DATE_D
2022-03-04 12:30:20.640152 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-04 12:30:20.640922 (Thread-1): 09:30:20 | 14 of 26 START table model DBT_SHOPIFY.W_LOCATION_D.................. [RUN]
2022-03-04 12:30:20.642107 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-04 12:30:20.642855 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-04 12:30:20.655799 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-04 12:30:20.662835 (Thread-1): finished collecting timing info
2022-03-04 12:30:20.668585 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-04 12:30:20.674605 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-04 12:30:20.674805 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-04 12:30:20.674916 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:23.179945 (Thread-1): SQL status: SUCCESS 1 in 2.50 seconds
2022-03-04 12:30:23.187106 (Thread-1): finished collecting timing info
2022-03-04 12:30:23.187836 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-04 12:30:23.659097 (Thread-1): 09:30:23 | 14 of 26 OK created table model DBT_SHOPIFY.W_LOCATION_D............. [SUCCESS 1 in 3.02s]
2022-03-04 12:30:23.659680 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-04 12:30:23.660494 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-04 12:30:23.661334 (Thread-1): 09:30:23 | 15 of 26 START view model DBT_SHOPIFY.V_PRODUCTS_D_STG............... [RUN]
2022-03-04 12:30:23.666707 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-04 12:30:23.668340 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-04 12:30:23.674936 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-04 12:30:23.675410 (Thread-1): finished collecting timing info
2022-03-04 12:30:23.676944 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-04 12:30:23.680093 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-04 12:30:23.680196 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCTS_D_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG  as (
    
 

WITH product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG
),
product_variant AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG
),

rename as (


SELECT
    MD5(CONCAT(P.K_PRODUCT_BK,'-',COALESCE(V.K_PRODUCT_VARIANT_BK,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
    ,P.K_PRODUCT_DLHK
    ,V.K_PRODUCT_VARIANT_DLHK AS K_PRODUCT_VARIANT_DLHK
    ,V.K_PRODUCT_VARIANT_BK AS K_PRODUCT_VARIANT_BK
    ,P.K_PRODUCT_BK AS K_PRODUCT_BK
    ,V.K_INVENTORY_ITEM_BK AS K_VARIANT_INVENTORY_ITEM_BK
    ,V.K_IMAGE_BK AS K_VARIANT_IMAGE_BK
    --ATTRIBUTES
    ,P.A_TITLE
    ,P.A_HANDLE
    ,P.A_PRODUCT_TYPE
    ,P.A_VENDOR
    ,P.A_CREATED_AT_DTS
    ,P.A_UPDATED_AT_DTS
    ,P.A_PUBLISHED_AT_DTS
    ,P.A_PUBLISHED_SCOPE
    ,P.A_STATUS
    ,P.A_TEMPLATE_SUFFIX       
    ,V.A_TITLE AS A_VARIANT_TITLE
    ,V.A_SKU AS A_VARIANT_SKU
    ,V.A_FULFILLMENT_SERVICE AS A_VARIANT_FULFILLMENT_SERVICE
    ,V.A_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
    ,V.A_BARCODE AS A_VARIANT_BARCODE
    ,V.A_INVENTORY_POLICY AS A_VARIANT_INVENTORY_POLICY
    ,V.A_GRAMS AS A_VARIANT_GRAMS
    ,V.A_WEIGHT_UNIT AS A_VARIANT_WEIGHT_UNIT
    ,V.A_OPTION_1 AS A_VARIANT_OPTION_1
    ,V.A_OPTION_2 AS A_VARIANT_OPTION_2
    ,V.A_OPTION_3 AS A_VARIANT_OPTION_3
    ,V.A_TAX_CODE AS A_VARIANT_TAX_CODE
    ,V.A_PRESENTMENT_PRICES AS A_VARIANT_PRESENTMENT_PRICES
    ,V.A_CREATED_AT_DTS AS A_VARIANT_CREATED_AT_DTS
    ,V.A_UPDATED_AT_DTS AS A_VARIANT_UPDATED_AT_DTS
    --BOOLEAN
    ,V.B_REQUIRES_SHIPPING AS B_VARIANT_REQUIRES_SHIPPING
    ,V.B_TAXABLE AS B_VARIANT_TAXABLE
    --METRICS
    ,V.M_PRICE AS M_VARIANT_PRICE
    ,V.M_POSITION AS M_VARIANT_POSITION
    ,V.M_COMPARE_AT_PRICE AS M_VARIANT_COMPARE_AT_PRICE
    ,V.M_INVENTORY_QUANTITY AS M_VARIANT_INVENTORY_QUANTITY
    ,V.M_INVENTORY_QUANTITY_ADJUSTMENT AS M_VARIANT_INVENTORY_QUANTITY_ADJUSTMENT
    ,V.M_WEIGHT AS M_VARIANT_WEIGHT
    --metadata (MD)
    ,P.MD_IS_DELETED AS MD_IS_DELETED_PRODUCT
    ,V.MD_IS_DELETED AS MD_IS_DELETED_VARIANT
    , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
    , '66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
FROM
    product P
    LEFT JOIN product_variant V ON V.K_PRODUCT_BK = P.K_PRODUCT_BK
)

SELECT * FROM rename
  );
2022-03-04 12:30:23.680295 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:25.777826 (Thread-1): SQL status: SUCCESS 1 in 2.10 seconds
2022-03-04 12:30:25.780699 (Thread-1): finished collecting timing info
2022-03-04 12:30:25.780900 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: Close
2022-03-04 12:30:26.219082 (Thread-1): 09:30:26 | 15 of 26 OK created view model DBT_SHOPIFY.V_PRODUCTS_D_STG.......... [SUCCESS 1 in 2.56s]
2022-03-04 12:30:26.219596 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-04 12:30:26.219965 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-04 12:30:26.220633 (Thread-1): 09:30:26 | 16 of 26 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG....... [RUN]
2022-03-04 12:30:26.223666 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-04 12:30:26.225177 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-04 12:30:26.233659 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-04 12:30:26.234554 (Thread-1): finished collecting timing info
2022-03-04 12:30:26.236191 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-04 12:30:26.241750 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-04 12:30:26.241901 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT"
),
customer AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 

  MD5(S.ID) AS K_ABANDONED_CHECKOUT_DLHK
  ,C.K_CUSTOMER_DLHK
  ,L.K_LOCATION_DLHK
  ,MD5(S.USER_ID) AS K_USER_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK  
  ,S.ID AS K_ABANDONED_CHECKOUT_BK
  ,S.CUSTOMER_ID AS K_CUSTOMER_BK
  ,S.DEVICE_ID AS K_DEVICE_BK
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.SOURCE_IDENTIFIER AS K_SOURCE_BKENTIFIER
  ,S.USER_ID AS K_USER_BK
  ,S.ABANDONED_CHECKOUT_URL AS A_ABANDONED_CHECKOUT_URL  
  ,S.CART_TOKEN AS A_CART_TOKEN
  ,S.CLOSED_AT AS A_CLOSED_AT
  ,S.COMPLETED_AT AS A_COMPLETED_AT
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
  ,S.EMAIL AS A_EMAIL
  ,S.GATEWAY AS A_GATEWAY
  ,S.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
  ,S.NAME AS A_NAME
  ,S.NOTE AS A_NOTE
  ,S.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES
  ,S.PHONE AS A_PHONE
  ,S.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
  ,S.REFERRING_SITE AS A_REFERRING_SITE    
  ,S.SOURCE AS A_SOURCE
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.SOURCE_URL AS A_SOURCE_URL
  ,S.TOKEN AS A_TOKEN
  ,S.UPDATED_AT AS A_UPDATED_AT  
  --BOOLEAN
  ,S.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
  ,S.TAXES_INCLUDED AS B_TAXES_INCLUDED
  --METRIC
  ,S.SUBTOTAL_PRICE::decimal(15,2) AS M_SUBTOTAL_PRICE
  ,S.TOTAL_DISCOUNTS::decimal(15,2) AS M_TOTAL_DISCOUNTS
  ,S.TOTAL_DUTIES::decimal(15,2) AS M_TOTAL_DUTIES
  ,S.TOTAL_LINE_ITEMS_PRICE::decimal(15,2) AS M_TOTAL_LINE_ITEMS_PRICE
  ,S.TOTAL_PRICE::decimal(15,2) AS M_TOTAL_PRICE
  ,S.TOTAL_TAX::decimal(15,2) AS M_TOTAL_TAX
  ,S.TOTAL_WEIGHT::decimal(15,2) AS M_TOTAL_WEIGHT
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
  FROM
      source S
      left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
      left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-04 12:30:26.242020 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:28.917502 (Thread-1): SQL status: SUCCESS 1 in 2.68 seconds
2022-03-04 12:30:28.923417 (Thread-1): finished collecting timing info
2022-03-04 12:30:28.924157 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: Close
2022-03-04 12:30:29.378254 (Thread-1): 09:30:29 | 16 of 26 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.. [SUCCESS 1 in 3.16s]
2022-03-04 12:30:29.379024 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-04 12:30:29.379738 (Thread-1): Began running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-04 12:30:29.380614 (Thread-1): 09:30:29 | 17 of 26 START view model DBT_SHOPIFY.V_TRANSACTIONS_STG............. [RUN]
2022-03-04 12:30:29.390933 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-04 12:30:29.391100 (Thread-1): Compiling model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-04 12:30:29.393888 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-04 12:30:29.394449 (Thread-1): finished collecting timing info
2022-03-04 12:30:29.396180 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-04 12:30:29.398238 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-04 12:30:29.398366 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_TRANSACTIONS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."TRANSACTION"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_TRANSACTION_DLHK
  ,L.K_LOCATION_DLHK  
  ,MD5(S.USER_ID) AS K_USER_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_TRANSACTION_BK
  ,S.DEVICE_ID AS K_DEVICE_BK  
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.ORDER_ID AS K_ORDER_BK
  ,S.PARENT_ID AS K_PARENT_BK
  ,S.REFUND_ID AS K_REFUND_BK
  ,S.USER_ID AS K_USER_BK  
  --ATTRIBUTES
  ,S.AUTHORIZATION AS A_AUTHORIZATION
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CURRENCY_EXCHANGE_ADJUSTMENT AS A_CURRENCY_EXCHANGE_ADJUSTMENT
  ,S.ERROR_CODE AS A_ERROR_CODE
  ,S.GATEWAY AS A_GATEWAY
  ,S.KIND AS A_KIND
  ,S.MESSAGE AS A_MESSAGE
  ,S.PAYMENT_DETAILS AS A_PAYMENT_DETAILS
  ,S.PROCESSED_AT AS A_PROCESSED_AT
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.STATUS AS A_STATUS
  --boolean
  ,S.TEST AS B_TEST
  --METRICS
  ,S.AMOUNT::decimal(15,2) AS M_AMOUNT   
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
  FROM
    source S  
  left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-04 12:30:29.398477 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:31.317820 (Thread-1): SQL status: SUCCESS 1 in 1.92 seconds
2022-03-04 12:30:31.321873 (Thread-1): finished collecting timing info
2022-03-04 12:30:31.322468 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: Close
2022-03-04 12:30:31.782194 (Thread-1): 09:30:31 | 17 of 26 OK created view model DBT_SHOPIFY.V_TRANSACTIONS_STG........ [SUCCESS 1 in 2.39s]
2022-03-04 12:30:31.784272 (Thread-1): Finished running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-04 12:30:31.784779 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-04 12:30:31.785623 (Thread-1): 09:30:31 | 18 of 26 START table model DBT_SHOPIFY.W_PRODUCTS_D.................. [RUN]
2022-03-04 12:30:31.787347 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-04 12:30:31.787799 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCTS_D
2022-03-04 12:30:31.803029 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-04 12:30:31.803858 (Thread-1): finished collecting timing info
2022-03-04 12:30:31.805643 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-04 12:30:31.806357 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-04 12:30:31.806478 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCTS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG AS C
      );
2022-03-04 12:30:31.806598 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:35.018914 (Thread-1): SQL status: SUCCESS 1 in 3.21 seconds
2022-03-04 12:30:35.025745 (Thread-1): finished collecting timing info
2022-03-04 12:30:35.026461 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: Close
2022-03-04 12:30:35.498229 (Thread-1): 09:30:35 | 18 of 26 OK created table model DBT_SHOPIFY.W_PRODUCTS_D............. [SUCCESS 1 in 3.71s]
2022-03-04 12:30:35.498923 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-04 12:30:35.499656 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-04 12:30:35.500762 (Thread-1): 09:30:35 | 19 of 26 START table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F........ [RUN]
2022-03-04 12:30:35.501929 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-04 12:30:35.502685 (Thread-1): Compiling model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-04 12:30:35.512085 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-04 12:30:35.513048 (Thread-1): finished collecting timing info
2022-03-04 12:30:35.514988 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-04 12:30:35.515792 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-04 12:30:35.515905 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG AS C
      );
2022-03-04 12:30:35.516006 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:38.224977 (Thread-1): SQL status: SUCCESS 1 in 2.71 seconds
2022-03-04 12:30:38.228357 (Thread-1): finished collecting timing info
2022-03-04 12:30:38.228680 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: Close
2022-03-04 12:30:38.671941 (Thread-1): 09:30:38 | 19 of 26 OK created table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F... [SUCCESS 1 in 3.17s]
2022-03-04 12:30:38.672665 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-04 12:30:38.676167 (Thread-1): Began running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-04 12:30:38.677265 (Thread-1): 09:30:38 | 20 of 26 START table model DBT_SHOPIFY.W_TRANSACTIONS_F.............. [RUN]
2022-03-04 12:30:38.678502 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-04 12:30:38.679221 (Thread-1): Compiling model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-04 12:30:38.687332 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-04 12:30:38.687817 (Thread-1): finished collecting timing info
2022-03-04 12:30:38.689608 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-04 12:30:38.690353 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-04 12:30:38.690459 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_TRANSACTIONS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_TRANSACTIONS_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG AS C
      );
2022-03-04 12:30:38.690559 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:41.356415 (Thread-1): SQL status: SUCCESS 1 in 2.67 seconds
2022-03-04 12:30:41.359917 (Thread-1): finished collecting timing info
2022-03-04 12:30:41.360429 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: Close
2022-03-04 12:30:41.833519 (Thread-1): 09:30:41 | 20 of 26 OK created table model DBT_SHOPIFY.W_TRANSACTIONS_F......... [SUCCESS 1 in 3.16s]
2022-03-04 12:30:41.846701 (Thread-1): Finished running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-04 12:30:41.847372 (Thread-1): Began running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-04 12:30:41.848599 (Thread-1): 09:30:41 | 21 of 26 START view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG........... [RUN]
2022-03-04 12:30:41.850028 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-04 12:30:41.850868 (Thread-1): Compiling model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-04 12:30:41.865360 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-04 12:30:41.866070 (Thread-1): finished collecting timing info
2022-03-04 12:30:41.867747 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-04 12:30:41.870187 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-04 12:30:41.870334 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_INVENTORY_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_ITEM"
),
inventory_level AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_LEVEL"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
products AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename AS 
(   
  SELECT   
  MD5(S.ID) AS K_INVENTORY_ITEM_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
  ,L.K_LOCATION_DLHK
  ,L.K_LOCATION_BK  
  ,S.ID AS K_INVENTORY_ITEM_BK
  ,S.COUNTRY_CODE_OF_ORIGIN AS A_COUNTRY_CODE_OF_ORIGIN
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.PROVINCE_CODE_OF_ORIGIN AS A_PROVINCE_CODE_OF_ORIGIN
  ,S.SKU AS A_SKU
  ,S.UPDATED_AT AS A_UPDATED_AT
  ,S.HARMONIZED_SYSTEM_CODE AS A_HARMONIZED_SYSTEM_CODE  
  --BOOLEAN
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TRACKED AS B_TRACKED
  --METRICS
  ,S.COST::decimal(15,2) AS M_COST 
  ,IL.AVAILABLE AS M_AVAIABLE  
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
  FROM
      source S
      left join inventory_level IL ON IL.INVENTORY_ITEM_ID = S.ID      
      left join locations L ON L.K_LOCATION_BK = IL.LOCATION_ID
      left join products P ON P.K_VARIANT_INVENTORY_ITEM_BK = S.ID 
)


SELECT * FROM rename
  );
2022-03-04 12:30:41.870442 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:43.598312 (Thread-1): SQL status: SUCCESS 1 in 1.73 seconds
2022-03-04 12:30:43.606543 (Thread-1): finished collecting timing info
2022-03-04 12:30:43.607049 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: Close
2022-03-04 12:30:44.077129 (Thread-1): 09:30:44 | 21 of 26 OK created view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG...... [SUCCESS 1 in 2.23s]
2022-03-04 12:30:44.078253 (Thread-1): Finished running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-04 12:30:44.079126 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-04 12:30:44.080030 (Thread-1): 09:30:44 | 22 of 26 START view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG......... [RUN]
2022-03-04 12:30:44.081020 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-04 12:30:44.081574 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-04 12:30:44.093748 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-04 12:30:44.094469 (Thread-1): finished collecting timing info
2022-03-04 12:30:44.096001 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-04 12:30:44.099964 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-04 12:30:44.100065 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM" AS A
),
products AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D AS A
),
taxes AS (
  SELECT 
      K_ORDER_LINE_ITEM_BK,
      AVG(M_RATE) AS M_RATE,
      SUM(M_TAX) AS M_TAX,
      SUM(M_TAX_PRIMARY) AS M_TAX_PRIMARY
    FROM 
      DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG AS A
    GROUP BY K_ORDER_LINE_ITEM_BK
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_LINE_ITEM_DLHK  
  ,MD5(ORDER_ID) AS K_ORDER_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
 --business keys
  ,O.PRODUCT_ID AS K_PRODUCT_BK
  ,O.VARIANT_ID AS K_VARIANT_BK
  
  ,O.ORDER_ID AS K_ORDER_BK
  ,O.ID AS K_ORDER_LINE_ITEM_BK
  --attribubtes
  ,O.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
  ,O.NAME AS A_NAME  
  ,O.PROPERTIES AS A_PROPERTIES
  ,O.SKU AS A_SKU
  ,O.TITLE AS A_TITLE  
  ,O.VARIANT_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
  ,O.VARIANT_TITLE AS A_VARIANT_TITLE
  ,O.VENDOR AS A_VENDOR
  --boolean
  ,O.GIFT_CARD AS B_GIFT_CARD
  ,O.PRODUCT_EXISTS AS B_PRODUCT_EXISTS
  ,O.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,O.TAXABLE AS B_TAXABLE
  --metrics
  ,O.FULFILLABLE_QUANTITY AS M_FULFILLABLE_QUANTITY
  ,O.GRAMS::DECIMAL(15,2) AS M_GRAMS
  ,O.QUANTITY::DECIMAL(15,2) AS M_QUANTITY
  ,M_RATE AS M_TAX_RATE
  ,COALESCE(T.M_TAX_PRIMARY,0)::DECIMAL(15,2) AS M_TAX_AMOUNT
  ,COALESCE(T.M_TAX,0)::DECIMAL(15,2) AS M_TAX_AMOUNT_PRIMARY

  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE_PRIMARY 
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT_PRIMARY 
  ,(O.QUANTITY * M_UNIT_PRICE)::DECIMAL(15,2) AS M_TOTAL_PRICE  
  ,(O.QUANTITY * M_UNIT_PRICE_PRIMARY)::DECIMAL(15,2) AS M_TOTAL_PRICE_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
FROM source O
  left join products P ON P.K_PRODUCT_BK = O.PRODUCT_ID AND CASE WHEN O.VARIANT_ID IS NOT NULL THEN O.VARIANT_ID = P.K_PRODUCT_VARIANT_BK ELSE 1=1 END
  left join taxes T ON T.K_ORDER_LINE_ITEM_BK = O.ID
)

SELECT * FROM rename
  );
2022-03-04 12:30:44.100169 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:45.981725 (Thread-1): SQL status: SUCCESS 1 in 1.88 seconds
2022-03-04 12:30:45.985904 (Thread-1): finished collecting timing info
2022-03-04 12:30:45.986106 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: Close
2022-03-04 12:30:46.436131 (Thread-1): 09:30:46 | 22 of 26 OK created view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG.... [SUCCESS 1 in 2.35s]
2022-03-04 12:30:46.448799 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-04 12:30:46.449387 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-04 12:30:46.450167 (Thread-1): 09:30:46 | 23 of 26 START view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG....... [RUN]
2022-03-04 12:30:46.451128 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-04 12:30:46.451629 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-04 12:30:46.461004 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-04 12:30:46.461588 (Thread-1): finished collecting timing info
2022-03-04 12:30:46.463169 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-04 12:30:46.465022 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-04 12:30:46.465118 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECT"
),
source_collection AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECTION"
),
product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename as (

SELECT
  MD5(S.ID) AS K_PRODUCT_COLLECT_DLHK
  ,MD5(CC.ID) AS K_COLLECTION_DLHK
  ,P.K_PRODUCT_DLHK  
  ,S.ID AS K_PRODUCT_COLLECT_BK
  ,CC.ID AS K_COLLECTION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,S.POSITION AS A_POSITION
  ,S.SORT_ORDER AS A_SORT_ORDER  
  ,S.CREATED_AT AS A_CREATED_AT_DTS
  ,S.UPDATED_AT AS A_UPDATED_AT_DTS
  ,CC.PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,CC.BODY_HTML AS A_BODY_HTML
  ,CC.TITLE AS A_TITLE
  ,CC.HANDLE AS A_HANDLE
  ,CC.PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE  
  ,CC.COLLECTION_TYPE AS A_COLLECTION_TYPE  
  --metrics
  ,CC.PRODUCTS_COUNT AS M_PRODUCTS_COUNT
  --metadata (MD)
  ,S.__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
FROM
    source S
    LEFT JOIN source_collection CC ON CC.ID = S.COLLECTION_ID
    LEFT JOIN product P ON P.K_PRODUCT_BK = S.PRODUCT_ID
)

SELECT * FROM rename
  );
2022-03-04 12:30:46.465215 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:48.151699 (Thread-1): SQL status: SUCCESS 1 in 1.69 seconds
2022-03-04 12:30:48.158977 (Thread-1): finished collecting timing info
2022-03-04 12:30:48.159811 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: Close
2022-03-04 12:30:48.655667 (Thread-1): 09:30:48 | 23 of 26 OK created view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG.. [SUCCESS 1 in 2.20s]
2022-03-04 12:30:48.656176 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-04 12:30:48.656866 (Thread-1): Began running node model.snowflake_aicd.W_INVENTORY_F
2022-03-04 12:30:48.657510 (Thread-1): 09:30:48 | 24 of 26 START table model DBT_SHOPIFY.W_INVENTORY_F................. [RUN]
2022-03-04 12:30:48.658513 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-04 12:30:48.658974 (Thread-1): Compiling model.snowflake_aicd.W_INVENTORY_F
2022-03-04 12:30:48.672139 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-04 12:30:48.673125 (Thread-1): finished collecting timing info
2022-03-04 12:30:48.674887 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-04 12:30:48.675569 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-04 12:30:48.675670 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_INVENTORY_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_INVENTORY_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG AS C
      );
2022-03-04 12:30:48.675769 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:51.681210 (Thread-1): SQL status: SUCCESS 1 in 3.01 seconds
2022-03-04 12:30:51.693469 (Thread-1): finished collecting timing info
2022-03-04 12:30:51.694087 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: Close
2022-03-04 12:30:52.195396 (Thread-1): 09:30:52 | 24 of 26 OK created table model DBT_SHOPIFY.W_INVENTORY_F............ [SUCCESS 1 in 3.54s]
2022-03-04 12:30:52.195934 (Thread-1): Finished running node model.snowflake_aicd.W_INVENTORY_F
2022-03-04 12:30:52.196347 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-04 12:30:52.196960 (Thread-1): 09:30:52 | 25 of 26 START table model DBT_SHOPIFY.W_ORDERS_F.................... [RUN]
2022-03-04 12:30:52.197716 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-04 12:30:52.198210 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-04 12:30:52.209664 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-04 12:30:52.211561 (Thread-1): finished collecting timing info
2022-03-04 12:30:52.213536 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-04 12:30:52.219721 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-04 12:30:52.219965 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ORDERS_F  as
      (

SELECT
  O.K_ORDER_DLHK AS K_ORDER_DLHK
  ,OLI.K_ORDER_LINE_ITEM_DLHK AS K_ORDER_LINE_ITEM_DLHK
  ,O.K_CUSTOMER_DLHK AS K_CUSTOMER_DLHK
  ,O.K_LOCATION_DLHK AS K_LOCATION_DLHK
  ,O.K_BILLING_ADDRESS_DLHK AS K_BILLING_ADDRESS_DLHK
  ,O.K_SHIPPING_ADDRESS_DLHK AS K_SHIPPING_ADDRESS_DLHK
  ,OLI.K_PRODUCT_VARIATION_DLHK AS K_ITEM_PRODUCT_VARIATION_DLHK
  ,OLI.K_PRODUCT_BK AS K_ITEM_PRODUCT_BK
  ,OLI.K_VARIANT_BK AS K_ITEM_VARIANT_BK
  ,OLI.K_ORDER_BK AS K_ITEM_ORDER_BK
  ,O.K_ORDER_BK AS K_ORDER_BK
  ,OLI.K_ORDER_LINE_ITEM_BK AS K_ITEM_ORDER_LINE_ITEM_BK
  ,O.K_APP_BK AS K_HEADER_APP_BK
  
  ,O.K_CUSTOMER_BK AS K_CUSTOMER_BK
  ,O.K_DEVICE_BK AS K_DEVICE_BK
  ,O.K_LOCATION_BK AS K_LOCATION_BK
  ,O.K_SOURCE_ENTIFIER_BK AS K_SOURCE_ENTIFIER_BK
  ,O.A_BROWSER_IP AS A_HEADER_BROWSER_IP
  ,O.A_CANCELLED_AT_DTS AS A_HEADER_CANCELLED_AT_DTS
  ,O.A_CANCEL_REASON AS A_HEADER_CANCEL_REASON
  ,O.A_CART_TOKEN AS A_HEADER_CART_TOKEN
  ,O.A_CHECKOUT_TOKEN AS A_HEADER_CHECKOUT_TOKEN
  ,O.A_CLIENT_DETAILS AS A_HEADER_CLIENT_DETAILS
  ,O.A_CLOSED_AT_DTS AS A_HEADER_CLOSED_AT_DTS
  ,O.A_CREATED_AT_DTS AS A_HEADER_CREATED_AT_DTS
  ,O.A_CURRENCY AS A_HEADER_CURRENCY
  ,O.A_PRESENTMENT_CURRENCY AS A_HEADER_PRESENTMENT_CURRENCY
  ,O.A_CUSTOMER_LOCALE AS A_HEADER_CUSTOMER_LOCALE
  ,O.A_EMAIL AS A_HEADER_EMAIL
  ,O.A_FINANCIAL_STATUS AS A_HEADER_FINANCIAL_STATUS
  ,O.A_FULFILLMENT_STATUS AS A_HEADER_FULFILLMENT_STATUS
  ,O.A_LANDING_SITE_BASE_URL AS A_HEADER_LANDING_SITE_BASE_URL
  ,O.A_LANDING_SITE_REF AS A_HEADER_LANDING_SITE_REF
  ,O.A_NAME AS A_HEADER_NAME
  ,O.A_NOTE AS A_HEADER_NOTE
  ,O.A_NOTE_ATTRIBUTES AS A_HEADER_NOTE_ATTRIBUTES
  ,O.A_PAYMENT_GATEWAY_NAMES AS A_HEADER_PAYMENT_GATEWAY_NAMES
  ,O.A_PROCESSED_AT_DTS AS A_HEADER_PROCESSED_AT_DTS
  ,O.A_PROCESSING_METHOD AS A_HEADER_PROCESSING_METHOD
  ,O.A_REFERENCE AS A_HEADER_REFERENCE
  ,O.A_REFERRING_SITE AS A_HEADER_REFERRING_SITE
  ,O.A_SOURCE_NAME AS A_HEADER_SOURCE_NAME
  ,O.A_SOURCE_URL AS A_HEADER_SOURCE_URL
  ,O.A_ORDER_NUMBER AS A_HEADER_ORDER_NUMBER
  ,O.A_POSION_NUMBER AS A_HEADER_POSION_NUMBER
  ,O.A_UPDATED_AT_DTS AS A_HEADER_UPDATED_AT_DTS
  ,O.B_BUYER_ACCEPTS_MARKETING AS B_HEADER_BUYER_ACCEPTS_MARKETING
  ,O.B_CONFIRMED AS B_HEADER_CONFIRMED
  ,O.B_TAXES_INCLUDED  AS B_HEADER_TAXES_INCLUDED   
  ,OLI.A_FULFILLMENT_SERVICE AS A_ITEM_FULFILLMENT_SERVICE
  ,OLI.A_FULFILLMENT_STATUS AS A_ITEM_FULFILLMENT_STATUS    
  ,OLI.A_VARIANT_INVENTORY_MANAGEMENT AS A_ITEM_VARIANT_INVENTORY_MANAGEMENT  
  
  ,OLI.B_GIFT_CARD AS B_ITEM_GIFT_CARD
  ,OLI.B_PRODUCT_EXISTS AS B_ITEM_PRODUCT_EXISTS
  ,OLI.B_REQUIRES_SHIPPING AS B_ITEM_REQUIRES_SHIPPING
  ,OLI.B_TAXABLE AS B_ITEM_TAXABLE
  ,OLI.M_FULFILLABLE_QUANTITY AS M_ITEM_FULFILLABLE_QUANTITY
  ,OLI.M_GRAMS AS M_ITEM_GRAMS
  ,OLI.M_QUANTITY AS M_ITEM_QUANTITY
  ,OLI.M_UNIT_PRICE AS M_ITEM_UNIT_PRICE
  ,OLI.M_UNIT_PRICE_PRIMARY AS M_ITEM_UNIT_PRICE_PRIMARY
  ,OLI.M_TOTAL_PRICE AS M_ITEM_TOTAL_PRICE
  ,OLI.M_TOTAL_PRICE_PRIMARY AS M_ITEM_TOTAL_PRICE_PRIMARY
  ,OLI.M_TOTAL_DISCOUNT AS M_ITEM_TOTAL_DISCOUNT
  ,OLI.M_TOTAL_DISCOUNT_PRIMARY AS M_ITEM_TOTAL_DISCOUNT_PRIMARY
  ,OLI.M_TAX_AMOUNT AS M_TAX_AMOUNT
  ,OLI.M_TAX_AMOUNT_PRIMARY AS M_TAX_AMOUNT_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_TIP_RECEIVED * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_TIP_AMOUNT_PRIMARY  
  --,ROUND(DIV0((O.M_TOTAL_DISCOUNTS_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_HEADER_DISCOUNT
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE * OLI.M_TOTAL_PRICE),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE



   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'66ec7315-501c-48f5-a3aa-9555192b7d94' AS MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG OLI ON OLI.K_ORDER_DLHK = O.K_ORDER_DLHK
      );
2022-03-04 12:30:52.220118 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:30:57.966552 (Thread-1): SQL status: SUCCESS 1 in 5.75 seconds
2022-03-04 12:30:57.976012 (Thread-1): finished collecting timing info
2022-03-04 12:30:57.976592 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-04 12:30:58.508243 (Thread-1): 09:30:58 | 25 of 26 OK created table model DBT_SHOPIFY.W_ORDERS_F............... [SUCCESS 1 in 6.31s]
2022-03-04 12:30:58.508768 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-04 12:30:58.509448 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-04 12:30:58.510281 (Thread-1): 09:30:58 | 26 of 26 START table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F........ [RUN]
2022-03-04 12:30:58.511146 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-04 12:30:58.511685 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-04 12:30:58.521468 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-04 12:30:58.521905 (Thread-1): finished collecting timing info
2022-03-04 12:30:58.523650 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-04 12:30:58.524357 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-04 12:30:58.524461 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCT_COLLECTION_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG AS C
      );
2022-03-04 12:30:58.524559 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:31:01.317049 (Thread-1): SQL status: SUCCESS 1 in 2.79 seconds
2022-03-04 12:31:01.322256 (Thread-1): finished collecting timing info
2022-03-04 12:31:01.322947 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: Close
2022-03-04 12:31:01.772299 (Thread-1): 09:31:01 | 26 of 26 OK created table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F... [SUCCESS 1 in 3.26s]
2022-03-04 12:31:01.773024 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-04 12:31:01.779625 (MainThread): Acquiring new snowflake connection "master".
2022-03-04 12:31:01.780932 (MainThread): 09:31:01 | 
2022-03-04 12:31:01.781164 (MainThread): 09:31:01 | Finished running 16 view models, 10 table models in 83.10s.
2022-03-04 12:31:01.781294 (MainThread): Connection 'master' was properly closed.
2022-03-04 12:31:01.781382 (MainThread): Connection 'model.snowflake_aicd.W_PRODUCT_COLLECTION_F' was properly closed.
2022-03-04 12:31:01.789187 (MainThread): 
2022-03-04 12:31:01.789374 (MainThread): Completed successfully
2022-03-04 12:31:01.789535 (MainThread): 
Done. PASS=26 WARN=0 ERROR=0 SKIP=0 TOTAL=26
2022-03-04 12:31:01.789813 (MainThread): Flushing usage events
2022-03-04 12:48:15.290968 (MainThread): Running with dbt=0.21.1
2022-03-04 12:48:15.861179 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=['+W_ORDERS_F'], selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-04 12:48:15.862565 (MainThread): Tracking: do not track
2022-03-04 12:48:15.873410 (MainThread): Partial parsing not enabled
2022-03-04 12:48:15.898111 (MainThread): Parsing macros/common.sql
2022-03-04 12:48:15.902043 (MainThread): Parsing macros/catalog.sql
2022-03-04 12:48:15.903927 (MainThread): Parsing macros/adapters.sql
2022-03-04 12:48:15.937473 (MainThread): Parsing macros/materializations/merge.sql
2022-03-04 12:48:15.941058 (MainThread): Parsing macros/materializations/seed.sql
2022-03-04 12:48:15.945052 (MainThread): Parsing macros/materializations/view.sql
2022-03-04 12:48:15.946190 (MainThread): Parsing macros/materializations/table.sql
2022-03-04 12:48:15.948627 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-04 12:48:15.955913 (MainThread): Parsing macros/core.sql
2022-03-04 12:48:15.959013 (MainThread): Parsing macros/materializations/test.sql
2022-03-04 12:48:15.964672 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-04 12:48:15.972787 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-04 12:48:15.974141 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-04 12:48:15.988696 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-04 12:48:16.019768 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-04 12:48:16.040302 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-04 12:48:16.041773 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-04 12:48:16.050031 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-04 12:48:16.067359 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-04 12:48:16.079253 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-04 12:48:16.086719 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-04 12:48:16.092943 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-04 12:48:16.095969 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-04 12:48:16.097086 (MainThread): Parsing macros/etc/query.sql
2022-03-04 12:48:16.097789 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-04 12:48:16.098922 (MainThread): Parsing macros/etc/datetime.sql
2022-03-04 12:48:16.106367 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-04 12:48:16.107746 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-04 12:48:16.109562 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-04 12:48:16.110719 (MainThread): Parsing macros/adapters/common.sql
2022-03-04 12:48:16.159385 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-04 12:48:16.160774 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-04 12:48:16.161643 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-04 12:48:16.162629 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-04 12:48:16.317399 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-04 12:48:16.325848 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.328778 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-04 12:48:16.331171 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.331899 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-04 12:48:16.334493 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.335243 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-04 12:48:16.339737 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.340541 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-04 12:48:16.343636 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.344386 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-04 12:48:16.347353 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.348064 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-04 12:48:16.350681 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.351383 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-04 12:48:16.353774 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.354478 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-04 12:48:16.356832 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.357542 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-04 12:48:16.363328 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.364240 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-04 12:48:16.367427 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.368173 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-04 12:48:16.373815 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.374657 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-04 12:48:16.380734 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.381559 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-04 12:48:16.384555 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.385293 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-04 12:48:16.388542 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.389314 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-04 12:48:16.392807 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.393525 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-04 12:48:16.396338 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.397046 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-04 12:48:16.400227 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.401279 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-04 12:48:16.439176 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.440035 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-04 12:48:16.442549 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.443295 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-04 12:48:16.445560 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.446294 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-04 12:48:16.448885 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.449722 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-04 12:48:16.452183 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.452923 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-04 12:48:16.455224 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.455951 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-04 12:48:16.458489 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.459366 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-04 12:48:16.461924 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.482432 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.483759 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.484917 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.486086 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.487375 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.488519 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.489639 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.490751 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 12:48:16.526824 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-04 12:48:16.527564 (MainThread): Found 26 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 23 sources, 0 exposures
2022-03-04 12:48:16.528405 (MainThread): context manager reversed is deprecated and to be removed in 3.0.Use G.reverse(copy=False) if G.is_directed() else G instead.
2022-03-04 12:48:16.529682 (MainThread): 
2022-03-04 12:48:16.529904 (MainThread): Acquiring new snowflake connection "master".
2022-03-04 12:48:16.530741 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-04 12:48:16.540281 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-04 12:48:16.540388 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-04 12:48:16.540480 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-04 12:48:18.694056 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 2.15 seconds
2022-03-04 12:48:18.703214 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-04 12:48:19.199807 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-04 12:48:19.218334 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-04 12:48:19.218826 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-04 12:48:19.219068 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-04 12:48:20.975742 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 27 in 1.76 seconds
2022-03-04 12:48:20.979344 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-04 12:48:21.438057 (MainThread): 09:48:21 | Concurrency: 1 threads (target='dev')
2022-03-04 12:48:21.438563 (MainThread): 09:48:21 | 
2022-03-04 12:48:21.440167 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-04 12:48:21.440605 (Thread-1): 09:48:21 | 1 of 8 START view model DBT_SHOPIFY.V_ORDERS_HEADER_STG.............. [RUN]
2022-03-04 12:48:21.441360 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-04 12:48:21.441509 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-04 12:48:21.449231 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-04 12:48:21.450535 (Thread-1): finished collecting timing info
2022-03-04 12:48:21.470188 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-04 12:48:21.480271 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-04 12:48:21.480549 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDERS" AS A
),
rename AS 
(
SELECT
    MD5(O.ID) AS K_ORDER_DLHK    
    ,MD5(O.CUSTOMER_ID) AS K_CUSTOMER_DLHK
    ,MD5(O.LOCATION_ID) AS K_LOCATION_DLHK    
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
    --BUSINESS_KEYS
    ,O.APP_ID AS K_APP_BK
    ,O.ID AS K_ORDER_BK
    ,O.CUSTOMER_ID AS K_CUSTOMER_BK
    ,O.DEVICE_ID AS K_DEVICE_BK  
    ,O.LOCATION_ID AS K_LOCATION_BK
    ,O.SOURCE_IDENTIFIER AS K_SOURCE_ENTIFIER_BK
    --ATTRIBUTES
    ,O.BROWSER_IP AS A_BROWSER_IP
    ,O.CANCELLED_AT AS A_CANCELLED_AT_DTS
    ,O.CANCEL_REASON AS A_CANCEL_REASON
    ,O.CART_TOKEN AS A_CART_TOKEN
    ,O.CHECKOUT_TOKEN AS A_CHECKOUT_TOKEN
    ,O.CLIENT_DETAILS AS A_CLIENT_DETAILS
    ,O.CLOSED_AT AS A_CLOSED_AT_DTS
    ,O.CREATED_AT AS A_CREATED_AT_DTS
    ,O.CURRENCY AS A_CURRENCY
    ,O.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
    ,O.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
    ,O.EMAIL AS A_EMAIL
    ,O.FINANCIAL_STATUS AS A_FINANCIAL_STATUS
    ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
    ,O.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
    ,O.LANDING_SITE_REF AS A_LANDING_SITE_REF
    ,O.NAME AS A_NAME
    ,O.NOTE AS A_NOTE
    ,O.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES    
    ,O.PAYMENT_GATEWAY_NAMES AS A_PAYMENT_GATEWAY_NAMES    
    ,O.PROCESSED_AT AS A_PROCESSED_AT_DTS
    ,O.PROCESSING_METHOD AS A_PROCESSING_METHOD
    ,O.REFERENCE AS A_REFERENCE
    ,O.REFERRING_SITE AS A_REFERRING_SITE    
    ,O.SOURCE_NAME AS A_SOURCE_NAME
    ,O.SOURCE_URL AS A_SOURCE_URL    
    ,O.ORDER_NUMBER AS A_ORDER_NUMBER
    ,O.POSION_NUMBER AS A_POSION_NUMBER  
    ,O.UPDATED_AT AS A_UPDATED_AT_DTS
    --BOOLEAN
    ,O.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
    ,O.CONFIRMED AS B_CONFIRMED
    ,O.TAXES_INCLUDED AS B_TAXES_INCLUDED
    --METRICS
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE_PRIMARY 
    ,O.TOTAL_TIP_RECEIVED::DECIMAL(15,2) AS M_TOTAL_TIP_RECEIVED   
    ,O.TOTAL_WEIGHT::DECIMAL(15,2) AS M_TOTAL_WEIGHT
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'8b4a4aa0-3b22-4c35-a59b-cd600759b4b4' AS MD_INTGR_ID
FROM source O
)

SELECT * FROM rename
  );
2022-03-04 12:48:21.480698 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:48:23.380080 (Thread-1): SQL status: SUCCESS 1 in 1.90 seconds
2022-03-04 12:48:23.387499 (Thread-1): finished collecting timing info
2022-03-04 12:48:23.387695 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: Close
2022-03-04 12:48:23.835194 (Thread-1): 09:48:23 | 1 of 8 OK created view model DBT_SHOPIFY.V_ORDERS_HEADER_STG......... [SUCCESS 1 in 2.39s]
2022-03-04 12:48:23.835637 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-04 12:48:23.835809 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-04 12:48:23.836003 (Thread-1): 09:48:23 | 2 of 8 START view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG... [RUN]
2022-03-04 12:48:23.836265 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-04 12:48:23.836371 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-04 12:48:23.840192 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-04 12:48:23.841326 (Thread-1): finished collecting timing info
2022-03-04 12:48:23.843068 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-04 12:48:23.844791 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-04 12:48:23.844914 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM_TAX_LINE" AS A
),
rename AS 
(
SELECT
  CONCAT(COALESCE(ORDER_ID,'0000000000'),'-',COALESCE(ORDER_LINE_ID,'0000000000')) AS K_ORDER_LINE_ITEM_TAX_DLHK
  ,ORDER_ID AS K_ORDER_BK
  ,ORDER_LINE_ID AS K_ORDER_LINE_ITEM_BK
  ,TITLE AS A_TITLE
  ,CHANNEL_LIABLE AS B_CHANNEL_LIABLE
  ,RATE AS M_RATE
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'8b4a4aa0-3b22-4c35-a59b-cd600759b4b4' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-04 12:48:23.845023 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:48:28.834144 (Thread-1): SQL status: SUCCESS 1 in 4.99 seconds
2022-03-04 12:48:28.837208 (Thread-1): finished collecting timing info
2022-03-04 12:48:28.837394 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: Close
2022-03-04 12:48:29.287493 (Thread-1): 09:48:29 | 2 of 8 OK created view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG [SUCCESS 1 in 5.45s]
2022-03-04 12:48:29.287761 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-04 12:48:29.287924 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-04 12:48:29.288106 (Thread-1): 09:48:29 | 3 of 8 START view model DBT_SHOPIFY.V_PRODUCT_STG.................... [RUN]
2022-03-04 12:48:29.288366 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-04 12:48:29.288503 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_STG
2022-03-04 12:48:29.291597 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-04 12:48:29.292026 (Thread-1): finished collecting timing info
2022-03-04 12:48:29.293562 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-04 12:48:29.295140 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-04 12:48:29.295244 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_DLHK
  ,ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE
  ,HANDLE AS A_HANDLE
  ,PRODUCT_TYPE AS A_PRODUCT_TYPE
  ,VENDOR AS A_VENDOR
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE
  ,STATUS AS A_STATUS
  ,TEMPLATE_SUFFIX AS A_TEMPLATE_SUFFIX   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '8b4a4aa0-3b22-4c35-a59b-cd600759b4b4' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-04 12:48:29.295343 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:48:31.060016 (Thread-1): SQL status: SUCCESS 1 in 1.76 seconds
2022-03-04 12:48:31.064100 (Thread-1): finished collecting timing info
2022-03-04 12:48:31.064650 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: Close
2022-03-04 12:48:31.523895 (Thread-1): 09:48:31 | 3 of 8 OK created view model DBT_SHOPIFY.V_PRODUCT_STG............... [SUCCESS 1 in 2.24s]
2022-03-04 12:48:31.524086 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-04 12:48:31.524405 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-04 12:48:31.524623 (Thread-1): 09:48:31 | 4 of 8 START view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG............ [RUN]
2022-03-04 12:48:31.524875 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-04 12:48:31.525082 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-04 12:48:31.527902 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-04 12:48:31.528259 (Thread-1): finished collecting timing info
2022-03-04 12:48:31.530203 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-04 12:48:31.532868 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-04 12:48:31.533024 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT_VARIANT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_VARIANT_DLHK
  ,MD5(PRODUCT_ID) AS K_PRODUCT_DLHK  
  --BUSINESS KEYS  
  ,ID AS K_PRODUCT_VARIANT_BK
  ,PRODUCT_ID AS K_PRODUCT_BK  
  ,INVENTORY_ITEM_ID AS K_INVENTORY_ITEM_BK
  ,IMAGE_ID AS K_IMAGE_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE  
  ,SKU AS A_SKU    
  ,FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,INVENTORY_MANAGEMENT AS A_INVENTORY_MANAGEMENT
  ,INVENTORY_POLICY AS A_INVENTORY_POLICY
  ,BARCODE AS A_BARCODE
  ,GRAMS AS A_GRAMS
  ,WEIGHT_UNIT AS A_WEIGHT_UNIT
  ,OPTION_1 AS A_OPTION_1
  ,OPTION_2 AS A_OPTION_2
  ,OPTION_3 AS A_OPTION_3
  ,TAX_CODE AS A_TAX_CODE  
  ,PRESENTMENT_PRICES AS A_PRESENTMENT_PRICES  
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  --BOOLEAN
  ,REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,TAXABLE AS B_TAXABLE
  --METRICS
  ,PRICE AS M_PRICE
  ,POSITION AS M_POSITION
  ,COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,INVENTORY_QUANTITY AS M_INVENTORY_QUANTITY
  ,INVENTORY_QUANTITY_ADJUSTMENT AS M_INVENTORY_QUANTITY_ADJUSTMENT
  ,WEIGHT AS M_WEIGHT
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '8b4a4aa0-3b22-4c35-a59b-cd600759b4b4' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-04 12:48:31.533139 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:48:33.384284 (Thread-1): SQL status: SUCCESS 1 in 1.85 seconds
2022-03-04 12:48:33.387587 (Thread-1): finished collecting timing info
2022-03-04 12:48:33.387789 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: Close
2022-03-04 12:48:33.824624 (Thread-1): 09:48:33 | 4 of 8 OK created view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG....... [SUCCESS 1 in 2.30s]
2022-03-04 12:48:33.824853 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-04 12:48:33.825424 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-04 12:48:33.825632 (Thread-1): 09:48:33 | 5 of 8 START view model DBT_SHOPIFY.V_PRODUCTS_D_STG................. [RUN]
2022-03-04 12:48:33.825890 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-04 12:48:33.826222 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-04 12:48:33.829414 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-04 12:48:33.830216 (Thread-1): finished collecting timing info
2022-03-04 12:48:33.831766 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-04 12:48:33.835662 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-04 12:48:33.835922 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCTS_D_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG  as (
    
 

WITH product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG
),
product_variant AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG
),

rename as (


SELECT
    MD5(CONCAT(P.K_PRODUCT_BK,'-',COALESCE(V.K_PRODUCT_VARIANT_BK,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
    ,P.K_PRODUCT_DLHK
    ,V.K_PRODUCT_VARIANT_DLHK AS K_PRODUCT_VARIANT_DLHK
    ,V.K_PRODUCT_VARIANT_BK AS K_PRODUCT_VARIANT_BK
    ,P.K_PRODUCT_BK AS K_PRODUCT_BK
    ,V.K_INVENTORY_ITEM_BK AS K_VARIANT_INVENTORY_ITEM_BK
    ,V.K_IMAGE_BK AS K_VARIANT_IMAGE_BK
    --ATTRIBUTES
    ,P.A_TITLE
    ,P.A_HANDLE
    ,P.A_PRODUCT_TYPE
    ,P.A_VENDOR
    ,P.A_CREATED_AT_DTS
    ,P.A_UPDATED_AT_DTS
    ,P.A_PUBLISHED_AT_DTS
    ,P.A_PUBLISHED_SCOPE
    ,P.A_STATUS
    ,P.A_TEMPLATE_SUFFIX       
    ,V.A_TITLE AS A_VARIANT_TITLE
    ,V.A_SKU AS A_VARIANT_SKU
    ,V.A_FULFILLMENT_SERVICE AS A_VARIANT_FULFILLMENT_SERVICE
    ,V.A_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
    ,V.A_BARCODE AS A_VARIANT_BARCODE
    ,V.A_INVENTORY_POLICY AS A_VARIANT_INVENTORY_POLICY
    ,V.A_GRAMS AS A_VARIANT_GRAMS
    ,V.A_WEIGHT_UNIT AS A_VARIANT_WEIGHT_UNIT
    ,V.A_OPTION_1 AS A_VARIANT_OPTION_1
    ,V.A_OPTION_2 AS A_VARIANT_OPTION_2
    ,V.A_OPTION_3 AS A_VARIANT_OPTION_3
    ,V.A_TAX_CODE AS A_VARIANT_TAX_CODE
    ,V.A_PRESENTMENT_PRICES AS A_VARIANT_PRESENTMENT_PRICES
    ,V.A_CREATED_AT_DTS AS A_VARIANT_CREATED_AT_DTS
    ,V.A_UPDATED_AT_DTS AS A_VARIANT_UPDATED_AT_DTS
    --BOOLEAN
    ,V.B_REQUIRES_SHIPPING AS B_VARIANT_REQUIRES_SHIPPING
    ,V.B_TAXABLE AS B_VARIANT_TAXABLE
    --METRICS
    ,V.M_PRICE AS M_VARIANT_PRICE
    ,V.M_POSITION AS M_VARIANT_POSITION
    ,V.M_COMPARE_AT_PRICE AS M_VARIANT_COMPARE_AT_PRICE
    ,V.M_INVENTORY_QUANTITY AS M_VARIANT_INVENTORY_QUANTITY
    ,V.M_INVENTORY_QUANTITY_ADJUSTMENT AS M_VARIANT_INVENTORY_QUANTITY_ADJUSTMENT
    ,V.M_WEIGHT AS M_VARIANT_WEIGHT
    --metadata (MD)
    ,P.MD_IS_DELETED AS MD_IS_DELETED_PRODUCT
    ,V.MD_IS_DELETED AS MD_IS_DELETED_VARIANT
    , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
    , '8b4a4aa0-3b22-4c35-a59b-cd600759b4b4' AS MD_INTGR_ID
FROM
    product P
    LEFT JOIN product_variant V ON V.K_PRODUCT_BK = P.K_PRODUCT_BK
)

SELECT * FROM rename
  );
2022-03-04 12:48:33.836043 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:48:35.888301 (Thread-1): SQL status: SUCCESS 1 in 2.05 seconds
2022-03-04 12:48:35.893221 (Thread-1): finished collecting timing info
2022-03-04 12:48:35.893473 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: Close
2022-03-04 12:48:36.341875 (Thread-1): 09:48:36 | 5 of 8 OK created view model DBT_SHOPIFY.V_PRODUCTS_D_STG............ [SUCCESS 1 in 2.52s]
2022-03-04 12:48:36.342386 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-04 12:48:36.343200 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-04 12:48:36.343556 (Thread-1): 09:48:36 | 6 of 8 START table model DBT_SHOPIFY.W_PRODUCTS_D.................... [RUN]
2022-03-04 12:48:36.343934 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-04 12:48:36.344131 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCTS_D
2022-03-04 12:48:36.347955 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-04 12:48:36.348683 (Thread-1): finished collecting timing info
2022-03-04 12:48:36.364935 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-04 12:48:36.365792 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-04 12:48:36.365984 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCTS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG AS C
      );
2022-03-04 12:48:36.366096 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:48:39.925580 (Thread-1): SQL status: SUCCESS 1 in 3.56 seconds
2022-03-04 12:48:39.930808 (Thread-1): finished collecting timing info
2022-03-04 12:48:39.931119 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: Close
2022-03-04 12:48:40.381609 (Thread-1): 09:48:40 | 6 of 8 OK created table model DBT_SHOPIFY.W_PRODUCTS_D............... [SUCCESS 1 in 4.04s]
2022-03-04 12:48:40.382220 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-04 12:48:40.385770 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-04 12:48:40.386502 (Thread-1): 09:48:40 | 7 of 8 START view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG........... [RUN]
2022-03-04 12:48:40.390645 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-04 12:48:40.391807 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-04 12:48:40.401728 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-04 12:48:40.402371 (Thread-1): finished collecting timing info
2022-03-04 12:48:40.404062 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-04 12:48:40.408302 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-04 12:48:40.408449 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM" AS A
),
products AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D AS A
),
taxes AS (
  SELECT 
      K_ORDER_LINE_ITEM_BK,
      AVG(M_RATE) AS M_RATE,
      SUM(M_TAX) AS M_TAX,
      SUM(M_TAX_PRIMARY) AS M_TAX_PRIMARY
    FROM 
      DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG AS A
    GROUP BY K_ORDER_LINE_ITEM_BK
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_LINE_ITEM_DLHK  
  ,MD5(ORDER_ID) AS K_ORDER_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
 --business keys
  ,O.PRODUCT_ID AS K_PRODUCT_BK
  ,O.VARIANT_ID AS K_VARIANT_BK
  
  ,O.ORDER_ID AS K_ORDER_BK
  ,O.ID AS K_ORDER_LINE_ITEM_BK
  --attribubtes
  ,O.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
  ,O.NAME AS A_NAME  
  ,O.PROPERTIES AS A_PROPERTIES
  ,O.SKU AS A_SKU
  ,O.TITLE AS A_TITLE  
  ,O.VARIANT_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
  ,O.VARIANT_TITLE AS A_VARIANT_TITLE
  ,O.VENDOR AS A_VENDOR
  --boolean
  ,O.GIFT_CARD AS B_GIFT_CARD
  ,O.PRODUCT_EXISTS AS B_PRODUCT_EXISTS
  ,O.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,O.TAXABLE AS B_TAXABLE
  --metrics
  ,O.FULFILLABLE_QUANTITY AS M_FULFILLABLE_QUANTITY
  ,O.GRAMS::DECIMAL(15,2) AS M_GRAMS
  ,O.QUANTITY::DECIMAL(15,2) AS M_QUANTITY
  ,M_RATE AS M_TAX_RATE
  ,COALESCE(T.M_TAX_PRIMARY,0)::DECIMAL(15,2) AS M_TAX_AMOUNT
  ,COALESCE(T.M_TAX,0)::DECIMAL(15,2) AS M_TAX_AMOUNT_PRIMARY

  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE_PRIMARY 
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT_PRIMARY 
  ,(O.QUANTITY * M_UNIT_PRICE)::DECIMAL(15,2) AS M_TOTAL_PRICE  
  ,(O.QUANTITY * M_UNIT_PRICE_PRIMARY)::DECIMAL(15,2) AS M_TOTAL_PRICE_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'8b4a4aa0-3b22-4c35-a59b-cd600759b4b4' AS MD_INTGR_ID
FROM source O
  left join products P ON P.K_PRODUCT_BK = O.PRODUCT_ID AND CASE WHEN O.VARIANT_ID IS NOT NULL THEN O.VARIANT_ID = P.K_PRODUCT_VARIANT_BK ELSE 1=1 END
  left join taxes T ON T.K_ORDER_LINE_ITEM_BK = O.ID
)

SELECT * FROM rename
  );
2022-03-04 12:48:40.408582 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:48:42.188261 (Thread-1): SQL status: SUCCESS 1 in 1.78 seconds
2022-03-04 12:48:42.191863 (Thread-1): finished collecting timing info
2022-03-04 12:48:42.192512 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: Close
2022-03-04 12:48:42.647963 (Thread-1): 09:48:42 | 7 of 8 OK created view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG...... [SUCCESS 1 in 2.26s]
2022-03-04 12:48:42.648836 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-04 12:48:42.652451 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-04 12:48:42.653569 (Thread-1): 09:48:42 | 8 of 8 START table model DBT_SHOPIFY.W_ORDERS_F...................... [RUN]
2022-03-04 12:48:42.654867 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-04 12:48:42.655561 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-04 12:48:42.671139 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-04 12:48:42.671861 (Thread-1): finished collecting timing info
2022-03-04 12:48:42.673455 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-04 12:48:42.679634 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-04 12:48:42.692940 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ORDERS_F  as
      (

SELECT
  O.K_ORDER_DLHK AS K_ORDER_DLHK
  ,OLI.K_ORDER_LINE_ITEM_DLHK AS K_ORDER_LINE_ITEM_DLHK
  ,O.K_CUSTOMER_DLHK AS K_CUSTOMER_DLHK
  ,O.K_LOCATION_DLHK AS K_LOCATION_DLHK
  ,O.K_BILLING_ADDRESS_DLHK AS K_BILLING_ADDRESS_DLHK
  ,O.K_SHIPPING_ADDRESS_DLHK AS K_SHIPPING_ADDRESS_DLHK
  ,OLI.K_PRODUCT_VARIATION_DLHK AS K_ITEM_PRODUCT_VARIATION_DLHK
  ,OLI.K_PRODUCT_BK AS K_ITEM_PRODUCT_BK
  ,OLI.K_VARIANT_BK AS K_ITEM_VARIANT_BK
  ,OLI.K_ORDER_BK AS K_ITEM_ORDER_BK
  ,O.K_ORDER_BK AS K_ORDER_BK
  ,OLI.K_ORDER_LINE_ITEM_BK AS K_ITEM_ORDER_LINE_ITEM_BK
  ,O.K_APP_BK AS K_HEADER_APP_BK
  
  ,O.K_CUSTOMER_BK AS K_CUSTOMER_BK
  ,O.K_DEVICE_BK AS K_DEVICE_BK
  ,O.K_LOCATION_BK AS K_LOCATION_BK
  ,O.K_SOURCE_ENTIFIER_BK AS K_SOURCE_ENTIFIER_BK
  ,O.A_BROWSER_IP AS A_HEADER_BROWSER_IP
  ,O.A_CANCELLED_AT_DTS AS A_HEADER_CANCELLED_AT_DTS
  ,O.A_CANCEL_REASON AS A_HEADER_CANCEL_REASON
  ,O.A_CART_TOKEN AS A_HEADER_CART_TOKEN
  ,O.A_CHECKOUT_TOKEN AS A_HEADER_CHECKOUT_TOKEN
  ,O.A_CLIENT_DETAILS AS A_HEADER_CLIENT_DETAILS
  ,O.A_CLOSED_AT_DTS AS A_HEADER_CLOSED_AT_DTS
  ,O.A_CREATED_AT_DTS AS A_HEADER_CREATED_AT_DTS
  ,O.A_CURRENCY AS A_HEADER_CURRENCY
  ,O.A_PRESENTMENT_CURRENCY AS A_HEADER_PRESENTMENT_CURRENCY
  ,O.A_CUSTOMER_LOCALE AS A_HEADER_CUSTOMER_LOCALE
  ,O.A_EMAIL AS A_HEADER_EMAIL
  ,O.A_FINANCIAL_STATUS AS A_HEADER_FINANCIAL_STATUS
  ,O.A_FULFILLMENT_STATUS AS A_HEADER_FULFILLMENT_STATUS
  ,O.A_LANDING_SITE_BASE_URL AS A_HEADER_LANDING_SITE_BASE_URL
  ,O.A_LANDING_SITE_REF AS A_HEADER_LANDING_SITE_REF
  ,O.A_NAME AS A_HEADER_NAME
  ,O.A_NOTE AS A_HEADER_NOTE
  ,O.A_NOTE_ATTRIBUTES AS A_HEADER_NOTE_ATTRIBUTES
  ,O.A_PAYMENT_GATEWAY_NAMES AS A_HEADER_PAYMENT_GATEWAY_NAMES
  ,O.A_PROCESSED_AT_DTS AS A_HEADER_PROCESSED_AT_DTS
  ,O.A_PROCESSING_METHOD AS A_HEADER_PROCESSING_METHOD
  ,O.A_REFERENCE AS A_HEADER_REFERENCE
  ,O.A_REFERRING_SITE AS A_HEADER_REFERRING_SITE
  ,O.A_SOURCE_NAME AS A_HEADER_SOURCE_NAME
  ,O.A_SOURCE_URL AS A_HEADER_SOURCE_URL
  ,O.A_ORDER_NUMBER AS A_HEADER_ORDER_NUMBER
  ,O.A_POSION_NUMBER AS A_HEADER_POSION_NUMBER
  ,O.A_UPDATED_AT_DTS AS A_HEADER_UPDATED_AT_DTS
  ,O.B_BUYER_ACCEPTS_MARKETING AS B_HEADER_BUYER_ACCEPTS_MARKETING
  ,O.B_CONFIRMED AS B_HEADER_CONFIRMED
  ,O.B_TAXES_INCLUDED  AS B_HEADER_TAXES_INCLUDED   
  ,OLI.A_FULFILLMENT_SERVICE AS A_ITEM_FULFILLMENT_SERVICE
  ,OLI.A_FULFILLMENT_STATUS AS A_ITEM_FULFILLMENT_STATUS    
  ,OLI.A_VARIANT_INVENTORY_MANAGEMENT AS A_ITEM_VARIANT_INVENTORY_MANAGEMENT  
  
  ,OLI.B_GIFT_CARD AS B_ITEM_GIFT_CARD
  ,OLI.B_PRODUCT_EXISTS AS B_ITEM_PRODUCT_EXISTS
  ,OLI.B_REQUIRES_SHIPPING AS B_ITEM_REQUIRES_SHIPPING
  ,OLI.B_TAXABLE AS B_ITEM_TAXABLE
  ,OLI.M_FULFILLABLE_QUANTITY AS M_ITEM_FULFILLABLE_QUANTITY
  ,OLI.M_GRAMS AS M_ITEM_GRAMS
  ,OLI.M_QUANTITY AS M_ITEM_QUANTITY
  ,OLI.M_UNIT_PRICE AS M_ITEM_UNIT_PRICE
  ,OLI.M_UNIT_PRICE_PRIMARY AS M_ITEM_UNIT_PRICE_PRIMARY
  ,OLI.M_TOTAL_PRICE AS M_ITEM_TOTAL_PRICE
  ,OLI.M_TOTAL_PRICE_PRIMARY AS M_ITEM_TOTAL_PRICE_PRIMARY
  ,OLI.M_TOTAL_DISCOUNT AS M_ITEM_TOTAL_DISCOUNT
  ,OLI.M_TOTAL_DISCOUNT_PRIMARY AS M_ITEM_TOTAL_DISCOUNT_PRIMARY
  ,OLI.M_TAX_AMOUNT AS M_TAX_AMOUNT
  ,OLI.M_TAX_AMOUNT_PRIMARY AS M_TAX_AMOUNT_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_TIP_RECEIVED * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_TIP_AMOUNT_PRIMARY  
  --,ROUND(DIV0((O.M_TOTAL_DISCOUNTS_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_HEADER_DISCOUNT
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE * OLI.M_TOTAL_PRICE),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE



   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'8b4a4aa0-3b22-4c35-a59b-cd600759b4b4' AS MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG OLI ON OLI.K_ORDER_DLHK = O.K_ORDER_DLHK
      );
2022-03-04 12:48:42.695511 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 12:48:47.706920 (Thread-1): SQL status: SUCCESS 1 in 5.01 seconds
2022-03-04 12:48:47.715435 (Thread-1): finished collecting timing info
2022-03-04 12:48:47.716111 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-04 12:48:48.216468 (Thread-1): 09:48:48 | 8 of 8 OK created table model DBT_SHOPIFY.W_ORDERS_F................. [SUCCESS 1 in 5.56s]
2022-03-04 12:48:48.217644 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-04 12:48:48.226131 (MainThread): Acquiring new snowflake connection "master".
2022-03-04 12:48:48.227533 (MainThread): 09:48:48 | 
2022-03-04 12:48:48.228077 (MainThread): 09:48:48 | Finished running 6 view models, 2 table models in 31.70s.
2022-03-04 12:48:48.228470 (MainThread): Connection 'master' was properly closed.
2022-03-04 12:48:48.228838 (MainThread): Connection 'model.snowflake_aicd.W_ORDERS_F' was properly closed.
2022-03-04 12:48:48.239125 (MainThread): 
2022-03-04 12:48:48.239329 (MainThread): Completed successfully
2022-03-04 12:48:48.239455 (MainThread): 
Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
2022-03-04 12:48:48.239735 (MainThread): Flushing usage events
2022-03-04 13:12:07.354597 (MainThread): Running with dbt=0.21.1
2022-03-04 13:12:07.992329 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=['+W_ORDERS_F'], selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-04 13:12:07.997845 (MainThread): Tracking: do not track
2022-03-04 13:12:08.010001 (MainThread): Partial parsing not enabled
2022-03-04 13:12:08.036488 (MainThread): Parsing macros/common.sql
2022-03-04 13:12:08.039462 (MainThread): Parsing macros/catalog.sql
2022-03-04 13:12:08.041055 (MainThread): Parsing macros/adapters.sql
2022-03-04 13:12:08.072262 (MainThread): Parsing macros/materializations/merge.sql
2022-03-04 13:12:08.075296 (MainThread): Parsing macros/materializations/seed.sql
2022-03-04 13:12:08.079096 (MainThread): Parsing macros/materializations/view.sql
2022-03-04 13:12:08.080240 (MainThread): Parsing macros/materializations/table.sql
2022-03-04 13:12:08.082689 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-04 13:12:08.089908 (MainThread): Parsing macros/core.sql
2022-03-04 13:12:08.092824 (MainThread): Parsing macros/materializations/test.sql
2022-03-04 13:12:08.098048 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-04 13:12:08.105883 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-04 13:12:08.107187 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-04 13:12:08.121569 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-04 13:12:08.149573 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-04 13:12:08.168340 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-04 13:12:08.169773 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-04 13:12:08.178126 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-04 13:12:08.194842 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-04 13:12:08.206094 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-04 13:12:08.212647 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-04 13:12:08.218467 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-04 13:12:08.221310 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-04 13:12:08.222372 (MainThread): Parsing macros/etc/query.sql
2022-03-04 13:12:08.223045 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-04 13:12:08.224151 (MainThread): Parsing macros/etc/datetime.sql
2022-03-04 13:12:08.230728 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-04 13:12:08.232076 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-04 13:12:08.233959 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-04 13:12:08.235195 (MainThread): Parsing macros/adapters/common.sql
2022-03-04 13:12:08.280544 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-04 13:12:08.281978 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-04 13:12:08.282869 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-04 13:12:08.283903 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-04 13:12:08.428322 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-04 13:12:08.437178 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.440303 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-04 13:12:08.442821 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.443543 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-04 13:12:08.446091 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.446829 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-04 13:12:08.451117 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.451933 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-04 13:12:08.455192 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.455960 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-04 13:12:08.459040 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.459765 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-04 13:12:08.462385 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.463098 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-04 13:12:08.465519 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.466247 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-04 13:12:08.468746 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.469545 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-04 13:12:08.473339 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.474062 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-04 13:12:08.476919 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.477624 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-04 13:12:08.482245 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.483158 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-04 13:12:08.488638 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.489347 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-04 13:12:08.492224 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.492966 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-04 13:12:08.496146 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.496849 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-04 13:12:08.500236 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.500931 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-04 13:12:08.503665 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.504363 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-04 13:12:08.507588 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.508383 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-04 13:12:08.545477 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.546339 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-04 13:12:08.548889 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.549613 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-04 13:12:08.551848 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.556246 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-04 13:12:08.558610 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.559337 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-04 13:12:08.561535 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.562264 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-04 13:12:08.564552 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.565270 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-04 13:12:08.567680 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.568457 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-04 13:12:08.570718 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.590397 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.591685 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.592812 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.593927 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.595182 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.596298 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.597410 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.598512 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-04 13:12:08.633183 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-04 13:12:08.633945 (MainThread): Found 26 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 23 sources, 0 exposures
2022-03-04 13:12:08.634450 (MainThread): context manager reversed is deprecated and to be removed in 3.0.Use G.reverse(copy=False) if G.is_directed() else G instead.
2022-03-04 13:12:08.635691 (MainThread): 
2022-03-04 13:12:08.635917 (MainThread): Acquiring new snowflake connection "master".
2022-03-04 13:12:08.636730 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-04 13:12:08.646235 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-04 13:12:08.646384 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-04 13:12:08.646476 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-04 13:12:10.694739 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 2.05 seconds
2022-03-04 13:12:10.710617 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-04 13:12:11.195699 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-04 13:12:11.205983 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-04 13:12:11.206358 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-04 13:12:11.206486 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-04 13:12:13.023100 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 27 in 1.82 seconds
2022-03-04 13:12:13.033756 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-04 13:12:13.522015 (MainThread): 10:12:13 | Concurrency: 1 threads (target='dev')
2022-03-04 13:12:13.522684 (MainThread): 10:12:13 | 
2022-03-04 13:12:13.526536 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-04 13:12:13.527675 (Thread-1): 10:12:13 | 1 of 8 START view model DBT_SHOPIFY.V_ORDERS_HEADER_STG.............. [RUN]
2022-03-04 13:12:13.529772 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-04 13:12:13.530469 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-04 13:12:13.542638 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-04 13:12:13.543842 (Thread-1): finished collecting timing info
2022-03-04 13:12:13.563105 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-04 13:12:13.572659 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-04 13:12:13.572845 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDERS" AS A
),
rename AS 
(
SELECT
    MD5(O.ID) AS K_ORDER_DLHK    
    ,MD5(O.CUSTOMER_ID) AS K_CUSTOMER_DLHK
    ,MD5(O.LOCATION_ID) AS K_LOCATION_DLHK    
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
    --BUSINESS_KEYS
    ,O.APP_ID AS K_APP_BK
    ,O.ID AS K_ORDER_BK
    ,O.CUSTOMER_ID AS K_CUSTOMER_BK
    ,O.DEVICE_ID AS K_DEVICE_BK  
    ,O.LOCATION_ID AS K_LOCATION_BK
    ,O.SOURCE_IDENTIFIER AS K_SOURCE_ENTIFIER_BK
    --ATTRIBUTES
    ,O.BROWSER_IP AS A_BROWSER_IP
    ,O.CANCELLED_AT AS A_CANCELLED_AT_DTS
    ,O.CANCEL_REASON AS A_CANCEL_REASON
    ,O.CART_TOKEN AS A_CART_TOKEN
    ,O.CHECKOUT_TOKEN AS A_CHECKOUT_TOKEN
    ,O.CLIENT_DETAILS AS A_CLIENT_DETAILS
    ,O.CLOSED_AT AS A_CLOSED_AT_DTS
    ,O.CREATED_AT AS A_CREATED_AT_DTS
    ,O.CURRENCY AS A_CURRENCY
    ,O.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
    ,O.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
    ,O.EMAIL AS A_EMAIL
    ,O.FINANCIAL_STATUS AS A_FINANCIAL_STATUS
    ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
    ,O.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
    ,O.LANDING_SITE_REF AS A_LANDING_SITE_REF
    ,O.NAME AS A_NAME
    ,O.NOTE AS A_NOTE
    ,O.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES    
    ,O.PAYMENT_GATEWAY_NAMES AS A_PAYMENT_GATEWAY_NAMES    
    ,O.PROCESSED_AT AS A_PROCESSED_AT_DTS
    ,O.PROCESSING_METHOD AS A_PROCESSING_METHOD
    ,O.REFERENCE AS A_REFERENCE
    ,O.REFERRING_SITE AS A_REFERRING_SITE    
    ,O.SOURCE_NAME AS A_SOURCE_NAME
    ,O.SOURCE_URL AS A_SOURCE_URL    
    ,O.ORDER_NUMBER AS A_ORDER_NUMBER
    ,O.POSION_NUMBER AS A_POSION_NUMBER  
    ,O.UPDATED_AT AS A_UPDATED_AT_DTS
    --BOOLEAN
    ,O.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
    ,O.CONFIRMED AS B_CONFIRMED
    ,O.TAXES_INCLUDED AS B_TAXES_INCLUDED
    --METRICS
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE_PRIMARY 
    ,O.TOTAL_TIP_RECEIVED::DECIMAL(15,2) AS M_TOTAL_TIP_RECEIVED   
    ,O.TOTAL_WEIGHT::DECIMAL(15,2) AS M_TOTAL_WEIGHT
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'a46f0c8c-bc7a-4d2d-ab48-77553a9b1382' AS MD_INTGR_ID
FROM source O
)

SELECT * FROM rename
  );
2022-03-04 13:12:13.572972 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 13:12:15.241246 (Thread-1): SQL status: SUCCESS 1 in 1.67 seconds
2022-03-04 13:12:15.258657 (Thread-1): finished collecting timing info
2022-03-04 13:12:15.258853 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: Close
2022-03-04 13:12:15.702032 (Thread-1): 10:12:15 | 1 of 8 OK created view model DBT_SHOPIFY.V_ORDERS_HEADER_STG......... [SUCCESS 1 in 2.17s]
2022-03-04 13:12:15.702777 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-04 13:12:15.703440 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-04 13:12:15.704392 (Thread-1): 10:12:15 | 2 of 8 START view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG... [RUN]
2022-03-04 13:12:15.705706 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-04 13:12:15.706408 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-04 13:12:15.716074 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-04 13:12:15.716817 (Thread-1): finished collecting timing info
2022-03-04 13:12:15.718728 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-04 13:12:15.720593 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-04 13:12:15.720699 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM_TAX_LINE" AS A
),
rename AS 
(
SELECT
  CONCAT(COALESCE(ORDER_ID,'0000000000'),'-',COALESCE(ORDER_LINE_ID,'0000000000')) AS K_ORDER_LINE_ITEM_TAX_DLHK
  ,ORDER_ID AS K_ORDER_BK
  ,ORDER_LINE_ID AS K_ORDER_LINE_ITEM_BK
  ,TITLE AS A_TITLE
  ,CHANNEL_LIABLE AS B_CHANNEL_LIABLE
  ,RATE AS M_RATE
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'a46f0c8c-bc7a-4d2d-ab48-77553a9b1382' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-04 13:12:15.720799 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 13:12:17.586089 (Thread-1): SQL status: SUCCESS 1 in 1.87 seconds
2022-03-04 13:12:17.591745 (Thread-1): finished collecting timing info
2022-03-04 13:12:17.592508 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: Close
2022-03-04 13:12:18.049446 (Thread-1): 10:12:18 | 2 of 8 OK created view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG [SUCCESS 1 in 2.34s]
2022-03-04 13:12:18.050109 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-04 13:12:18.050681 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-04 13:12:18.051815 (Thread-1): 10:12:18 | 3 of 8 START view model DBT_SHOPIFY.V_PRODUCT_STG.................... [RUN]
2022-03-04 13:12:18.054232 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-04 13:12:18.054919 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_STG
2022-03-04 13:12:18.065243 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-04 13:12:18.065677 (Thread-1): finished collecting timing info
2022-03-04 13:12:18.067217 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-04 13:12:18.068923 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-04 13:12:18.069083 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_DLHK
  ,ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE
  ,HANDLE AS A_HANDLE
  ,PRODUCT_TYPE AS A_PRODUCT_TYPE
  ,VENDOR AS A_VENDOR
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE
  ,STATUS AS A_STATUS
  ,TEMPLATE_SUFFIX AS A_TEMPLATE_SUFFIX   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'a46f0c8c-bc7a-4d2d-ab48-77553a9b1382' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-04 13:12:18.069195 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 13:12:19.689675 (Thread-1): SQL status: SUCCESS 1 in 1.62 seconds
2022-03-04 13:12:19.692677 (Thread-1): finished collecting timing info
2022-03-04 13:12:19.693097 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: Close
2022-03-04 13:12:20.147905 (Thread-1): 10:12:20 | 3 of 8 OK created view model DBT_SHOPIFY.V_PRODUCT_STG............... [SUCCESS 1 in 2.09s]
2022-03-04 13:12:20.148713 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-04 13:12:20.149645 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-04 13:12:20.150723 (Thread-1): 10:12:20 | 4 of 8 START view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG............ [RUN]
2022-03-04 13:12:20.161265 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-04 13:12:20.161793 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-04 13:12:20.164813 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-04 13:12:20.165253 (Thread-1): finished collecting timing info
2022-03-04 13:12:20.166675 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-04 13:12:20.168705 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-04 13:12:20.168807 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT_VARIANT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_VARIANT_DLHK
  ,MD5(PRODUCT_ID) AS K_PRODUCT_DLHK  
  --BUSINESS KEYS  
  ,ID AS K_PRODUCT_VARIANT_BK
  ,PRODUCT_ID AS K_PRODUCT_BK  
  ,INVENTORY_ITEM_ID AS K_INVENTORY_ITEM_BK
  ,IMAGE_ID AS K_IMAGE_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE  
  ,SKU AS A_SKU    
  ,FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,INVENTORY_MANAGEMENT AS A_INVENTORY_MANAGEMENT
  ,INVENTORY_POLICY AS A_INVENTORY_POLICY
  ,BARCODE AS A_BARCODE
  ,GRAMS AS A_GRAMS
  ,WEIGHT_UNIT AS A_WEIGHT_UNIT
  ,OPTION_1 AS A_OPTION_1
  ,OPTION_2 AS A_OPTION_2
  ,OPTION_3 AS A_OPTION_3
  ,TAX_CODE AS A_TAX_CODE  
  ,PRESENTMENT_PRICES AS A_PRESENTMENT_PRICES  
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  --BOOLEAN
  ,REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,TAXABLE AS B_TAXABLE
  --METRICS
  ,PRICE AS M_PRICE
  ,POSITION AS M_POSITION
  ,COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,INVENTORY_QUANTITY AS M_INVENTORY_QUANTITY
  ,INVENTORY_QUANTITY_ADJUSTMENT AS M_INVENTORY_QUANTITY_ADJUSTMENT
  ,WEIGHT AS M_WEIGHT
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'a46f0c8c-bc7a-4d2d-ab48-77553a9b1382' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-04 13:12:20.168905 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 13:12:21.840860 (Thread-1): SQL status: SUCCESS 1 in 1.67 seconds
2022-03-04 13:12:21.847390 (Thread-1): finished collecting timing info
2022-03-04 13:12:21.848543 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: Close
2022-03-04 13:12:22.310100 (Thread-1): 10:12:22 | 4 of 8 OK created view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG....... [SUCCESS 1 in 2.16s]
2022-03-04 13:12:22.310776 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-04 13:12:22.313852 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-04 13:12:22.314845 (Thread-1): 10:12:22 | 5 of 8 START view model DBT_SHOPIFY.V_PRODUCTS_D_STG................. [RUN]
2022-03-04 13:12:22.315905 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-04 13:12:22.316835 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-04 13:12:22.325496 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-04 13:12:22.326001 (Thread-1): finished collecting timing info
2022-03-04 13:12:22.327574 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-04 13:12:22.330696 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-04 13:12:22.330791 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCTS_D_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG  as (
    
 

WITH product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG
),
product_variant AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG
),

rename as (


SELECT
    MD5(CONCAT(P.K_PRODUCT_BK,'-',COALESCE(V.K_PRODUCT_VARIANT_BK,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
    ,P.K_PRODUCT_DLHK
    ,V.K_PRODUCT_VARIANT_DLHK AS K_PRODUCT_VARIANT_DLHK
    ,V.K_PRODUCT_VARIANT_BK AS K_PRODUCT_VARIANT_BK
    ,P.K_PRODUCT_BK AS K_PRODUCT_BK
    ,V.K_INVENTORY_ITEM_BK AS K_VARIANT_INVENTORY_ITEM_BK
    ,V.K_IMAGE_BK AS K_VARIANT_IMAGE_BK
    --ATTRIBUTES
    ,P.A_TITLE
    ,P.A_HANDLE
    ,P.A_PRODUCT_TYPE
    ,P.A_VENDOR
    ,P.A_CREATED_AT_DTS
    ,P.A_UPDATED_AT_DTS
    ,P.A_PUBLISHED_AT_DTS
    ,P.A_PUBLISHED_SCOPE
    ,P.A_STATUS
    ,P.A_TEMPLATE_SUFFIX       
    ,V.A_TITLE AS A_VARIANT_TITLE
    ,V.A_SKU AS A_VARIANT_SKU
    ,V.A_FULFILLMENT_SERVICE AS A_VARIANT_FULFILLMENT_SERVICE
    ,V.A_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
    ,V.A_BARCODE AS A_VARIANT_BARCODE
    ,V.A_INVENTORY_POLICY AS A_VARIANT_INVENTORY_POLICY
    ,V.A_GRAMS AS A_VARIANT_GRAMS
    ,V.A_WEIGHT_UNIT AS A_VARIANT_WEIGHT_UNIT
    ,V.A_OPTION_1 AS A_VARIANT_OPTION_1
    ,V.A_OPTION_2 AS A_VARIANT_OPTION_2
    ,V.A_OPTION_3 AS A_VARIANT_OPTION_3
    ,V.A_TAX_CODE AS A_VARIANT_TAX_CODE
    ,V.A_PRESENTMENT_PRICES AS A_VARIANT_PRESENTMENT_PRICES
    ,V.A_CREATED_AT_DTS AS A_VARIANT_CREATED_AT_DTS
    ,V.A_UPDATED_AT_DTS AS A_VARIANT_UPDATED_AT_DTS
    --BOOLEAN
    ,V.B_REQUIRES_SHIPPING AS B_VARIANT_REQUIRES_SHIPPING
    ,V.B_TAXABLE AS B_VARIANT_TAXABLE
    --METRICS
    ,V.M_PRICE AS M_VARIANT_PRICE
    ,V.M_POSITION AS M_VARIANT_POSITION
    ,V.M_COMPARE_AT_PRICE AS M_VARIANT_COMPARE_AT_PRICE
    ,V.M_INVENTORY_QUANTITY AS M_VARIANT_INVENTORY_QUANTITY
    ,V.M_INVENTORY_QUANTITY_ADJUSTMENT AS M_VARIANT_INVENTORY_QUANTITY_ADJUSTMENT
    ,V.M_WEIGHT AS M_VARIANT_WEIGHT
    --metadata (MD)
    ,P.MD_IS_DELETED AS MD_IS_DELETED_PRODUCT
    ,V.MD_IS_DELETED AS MD_IS_DELETED_VARIANT
    , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
    , 'a46f0c8c-bc7a-4d2d-ab48-77553a9b1382' AS MD_INTGR_ID
FROM
    product P
    LEFT JOIN product_variant V ON V.K_PRODUCT_BK = P.K_PRODUCT_BK
)

SELECT * FROM rename
  );
2022-03-04 13:12:22.330892 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 13:12:24.048350 (Thread-1): SQL status: SUCCESS 1 in 1.72 seconds
2022-03-04 13:12:24.053030 (Thread-1): finished collecting timing info
2022-03-04 13:12:24.053742 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: Close
2022-03-04 13:12:24.499535 (Thread-1): 10:12:24 | 5 of 8 OK created view model DBT_SHOPIFY.V_PRODUCTS_D_STG............ [SUCCESS 1 in 2.18s]
2022-03-04 13:12:24.500390 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-04 13:12:24.502587 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-04 13:12:24.503940 (Thread-1): 10:12:24 | 6 of 8 START table model DBT_SHOPIFY.W_PRODUCTS_D.................... [RUN]
2022-03-04 13:12:24.505490 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-04 13:12:24.506281 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCTS_D
2022-03-04 13:12:24.516350 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-04 13:12:24.516771 (Thread-1): finished collecting timing info
2022-03-04 13:12:24.531218 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-04 13:12:24.531970 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-04 13:12:24.532083 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCTS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG AS C
      );
2022-03-04 13:12:24.532185 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 13:12:27.530300 (Thread-1): SQL status: SUCCESS 1 in 3.00 seconds
2022-03-04 13:12:27.547775 (Thread-1): finished collecting timing info
2022-03-04 13:12:27.548376 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: Close
2022-03-04 13:12:28.015598 (Thread-1): 10:12:28 | 6 of 8 OK created table model DBT_SHOPIFY.W_PRODUCTS_D............... [SUCCESS 1 in 3.51s]
2022-03-04 13:12:28.017611 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-04 13:12:28.021154 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-04 13:12:28.022739 (Thread-1): 10:12:28 | 7 of 8 START view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG........... [RUN]
2022-03-04 13:12:28.024029 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-04 13:12:28.024766 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-04 13:12:28.032970 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-04 13:12:28.033967 (Thread-1): finished collecting timing info
2022-03-04 13:12:28.035540 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-04 13:12:28.039759 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-04 13:12:28.039895 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM" AS A
),
products AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D AS A
),
taxes AS (
  SELECT 
      K_ORDER_LINE_ITEM_BK,
      AVG(M_RATE) AS M_RATE,
      SUM(M_TAX) AS M_TAX,
      SUM(M_TAX_PRIMARY) AS M_TAX_PRIMARY
    FROM 
      DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG AS A
    GROUP BY K_ORDER_LINE_ITEM_BK
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_LINE_ITEM_DLHK  
  ,MD5(ORDER_ID) AS K_ORDER_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
 --business keys
  ,O.PRODUCT_ID AS K_PRODUCT_BK
  ,O.VARIANT_ID AS K_VARIANT_BK
  
  ,O.ORDER_ID AS K_ORDER_BK
  ,O.ID AS K_ORDER_LINE_ITEM_BK
  --attribubtes
  ,O.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
  ,O.NAME AS A_NAME  
  ,O.PROPERTIES AS A_PROPERTIES
  ,O.SKU AS A_SKU
  ,O.TITLE AS A_TITLE  
  ,O.VARIANT_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
  ,O.VARIANT_TITLE AS A_VARIANT_TITLE
  ,O.VENDOR AS A_VENDOR
  --boolean
  ,O.GIFT_CARD AS B_GIFT_CARD
  ,O.PRODUCT_EXISTS AS B_PRODUCT_EXISTS
  ,O.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,O.TAXABLE AS B_TAXABLE
  --metrics
  ,O.FULFILLABLE_QUANTITY AS M_FULFILLABLE_QUANTITY
  ,O.GRAMS::DECIMAL(15,2) AS M_GRAMS
  ,O.QUANTITY::DECIMAL(15,2) AS M_QUANTITY
  ,M_RATE AS M_TAX_RATE
  ,COALESCE(T.M_TAX_PRIMARY,0)::DECIMAL(15,2) AS M_TAX_AMOUNT
  ,COALESCE(T.M_TAX,0)::DECIMAL(15,2) AS M_TAX_AMOUNT_PRIMARY

  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE_PRIMARY 
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT_PRIMARY 
  ,(O.QUANTITY * M_UNIT_PRICE)::DECIMAL(15,2) AS M_TOTAL_PRICE  
  ,(O.QUANTITY * M_UNIT_PRICE_PRIMARY)::DECIMAL(15,2) AS M_TOTAL_PRICE_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'a46f0c8c-bc7a-4d2d-ab48-77553a9b1382' AS MD_INTGR_ID
FROM source O
  left join products P ON P.K_PRODUCT_BK = O.PRODUCT_ID AND CASE WHEN O.VARIANT_ID IS NOT NULL THEN O.VARIANT_ID = P.K_PRODUCT_VARIANT_BK ELSE 1=1 END
  left join taxes T ON T.K_ORDER_LINE_ITEM_BK = O.ID
)

SELECT * FROM rename
  );
2022-03-04 13:12:28.040000 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 13:12:29.907354 (Thread-1): SQL status: SUCCESS 1 in 1.87 seconds
2022-03-04 13:12:29.910671 (Thread-1): finished collecting timing info
2022-03-04 13:12:29.911135 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: Close
2022-03-04 13:12:30.375559 (Thread-1): 10:12:30 | 7 of 8 OK created view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG...... [SUCCESS 1 in 2.35s]
2022-03-04 13:12:30.375756 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-04 13:12:30.376255 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-04 13:12:30.376453 (Thread-1): 10:12:30 | 8 of 8 START table model DBT_SHOPIFY.W_ORDERS_F...................... [RUN]
2022-03-04 13:12:30.376664 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-04 13:12:30.376771 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-04 13:12:30.380474 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-04 13:12:30.381134 (Thread-1): finished collecting timing info
2022-03-04 13:12:30.382863 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-04 13:12:30.388453 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-04 13:12:30.388607 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ORDERS_F  as
      (

SELECT
  O.K_ORDER_DLHK AS K_ORDER_DLHK
  ,OLI.K_ORDER_LINE_ITEM_DLHK AS K_ORDER_LINE_ITEM_DLHK
  ,O.K_CUSTOMER_DLHK AS K_CUSTOMER_DLHK
  ,O.K_LOCATION_DLHK AS K_LOCATION_DLHK
  ,O.K_BILLING_ADDRESS_DLHK AS K_BILLING_ADDRESS_DLHK
  ,O.K_SHIPPING_ADDRESS_DLHK AS K_SHIPPING_ADDRESS_DLHK
  ,OLI.K_PRODUCT_VARIATION_DLHK AS K_ITEM_PRODUCT_VARIATION_DLHK
  ,OLI.K_PRODUCT_BK AS K_ITEM_PRODUCT_BK
  ,OLI.K_VARIANT_BK AS K_ITEM_VARIANT_BK
  ,OLI.K_ORDER_BK AS K_ITEM_ORDER_BK
  ,O.K_ORDER_BK AS K_ORDER_BK
  ,OLI.K_ORDER_LINE_ITEM_BK AS K_ITEM_ORDER_LINE_ITEM_BK
  ,O.K_APP_BK AS K_HEADER_APP_BK
  
  ,O.K_CUSTOMER_BK AS K_CUSTOMER_BK
  ,O.K_DEVICE_BK AS K_DEVICE_BK
  ,O.K_LOCATION_BK AS K_LOCATION_BK
  ,O.K_SOURCE_ENTIFIER_BK AS K_SOURCE_ENTIFIER_BK
  ,O.A_BROWSER_IP AS A_HEADER_BROWSER_IP
  ,O.A_CANCELLED_AT_DTS AS A_HEADER_CANCELLED_AT_DTS
  ,O.A_CANCEL_REASON AS A_HEADER_CANCEL_REASON
  ,O.A_CART_TOKEN AS A_HEADER_CART_TOKEN
  ,O.A_CHECKOUT_TOKEN AS A_HEADER_CHECKOUT_TOKEN
  ,O.A_CLIENT_DETAILS AS A_HEADER_CLIENT_DETAILS
  ,O.A_CLOSED_AT_DTS AS A_HEADER_CLOSED_AT_DTS
  ,O.A_CREATED_AT_DTS AS A_HEADER_CREATED_AT_DTS
  ,O.A_CURRENCY AS A_HEADER_CURRENCY
  ,O.A_PRESENTMENT_CURRENCY AS A_HEADER_PRESENTMENT_CURRENCY
  ,O.A_CUSTOMER_LOCALE AS A_HEADER_CUSTOMER_LOCALE
  ,O.A_EMAIL AS A_HEADER_EMAIL
  ,O.A_FINANCIAL_STATUS AS A_HEADER_FINANCIAL_STATUS
  ,O.A_FULFILLMENT_STATUS AS A_HEADER_FULFILLMENT_STATUS
  ,O.A_LANDING_SITE_BASE_URL AS A_HEADER_LANDING_SITE_BASE_URL
  ,O.A_LANDING_SITE_REF AS A_HEADER_LANDING_SITE_REF
  ,O.A_NAME AS A_HEADER_NAME
  ,O.A_NOTE AS A_HEADER_NOTE
  ,O.A_NOTE_ATTRIBUTES AS A_HEADER_NOTE_ATTRIBUTES
  ,O.A_PAYMENT_GATEWAY_NAMES AS A_HEADER_PAYMENT_GATEWAY_NAMES
  ,O.A_PROCESSED_AT_DTS AS A_HEADER_PROCESSED_AT_DTS
  ,O.A_PROCESSING_METHOD AS A_HEADER_PROCESSING_METHOD
  ,O.A_REFERENCE AS A_HEADER_REFERENCE
  ,O.A_REFERRING_SITE AS A_HEADER_REFERRING_SITE
  ,O.A_SOURCE_NAME AS A_HEADER_SOURCE_NAME
  ,O.A_SOURCE_URL AS A_HEADER_SOURCE_URL
  ,O.A_ORDER_NUMBER AS A_HEADER_ORDER_NUMBER
  ,O.A_POSION_NUMBER AS A_HEADER_POSION_NUMBER
  ,O.A_UPDATED_AT_DTS AS A_HEADER_UPDATED_AT_DTS
  ,O.B_BUYER_ACCEPTS_MARKETING AS B_HEADER_BUYER_ACCEPTS_MARKETING
  ,O.B_CONFIRMED AS B_HEADER_CONFIRMED
  ,O.B_TAXES_INCLUDED  AS B_HEADER_TAXES_INCLUDED   
  ,OLI.A_FULFILLMENT_SERVICE AS A_ITEM_FULFILLMENT_SERVICE
  ,OLI.A_FULFILLMENT_STATUS AS A_ITEM_FULFILLMENT_STATUS    
  ,OLI.A_VARIANT_INVENTORY_MANAGEMENT AS A_ITEM_VARIANT_INVENTORY_MANAGEMENT  
  
  ,OLI.B_GIFT_CARD AS B_ITEM_GIFT_CARD
  ,OLI.B_PRODUCT_EXISTS AS B_ITEM_PRODUCT_EXISTS
  ,OLI.B_REQUIRES_SHIPPING AS B_ITEM_REQUIRES_SHIPPING
  ,OLI.B_TAXABLE AS B_ITEM_TAXABLE
  ,OLI.M_FULFILLABLE_QUANTITY AS M_ITEM_FULFILLABLE_QUANTITY
  ,OLI.M_GRAMS AS M_ITEM_GRAMS
  ,OLI.M_QUANTITY AS M_ITEM_QUANTITY
  ,OLI.M_UNIT_PRICE AS M_ITEM_UNIT_PRICE
  ,OLI.M_UNIT_PRICE_PRIMARY AS M_ITEM_UNIT_PRICE_PRIMARY
  ,OLI.M_TOTAL_PRICE AS M_ITEM_TOTAL_PRICE
  ,OLI.M_TOTAL_PRICE_PRIMARY AS M_ITEM_TOTAL_PRICE_PRIMARY
  ,OLI.M_TOTAL_DISCOUNT AS M_ITEM_TOTAL_DISCOUNT
  ,OLI.M_TOTAL_DISCOUNT_PRIMARY AS M_ITEM_TOTAL_DISCOUNT_PRIMARY
  ,OLI.M_TAX_AMOUNT AS M_TAX_AMOUNT
  ,OLI.M_TAX_AMOUNT_PRIMARY AS M_TAX_AMOUNT_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_TIP_RECEIVED * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_TIP_AMOUNT_PRIMARY  
  --,ROUND(DIV0((O.M_TOTAL_DISCOUNTS_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_HEADER_DISCOUNT
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE * OLI.M_TOTAL_PRICE),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE



   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'a46f0c8c-bc7a-4d2d-ab48-77553a9b1382' AS MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG OLI ON OLI.K_ORDER_DLHK = O.K_ORDER_DLHK
      );
2022-03-04 13:12:30.388725 (Thread-1): Opening a new connection, currently in state closed
2022-03-04 13:12:36.245859 (Thread-1): SQL status: SUCCESS 1 in 5.86 seconds
2022-03-04 13:12:36.247583 (Thread-1): finished collecting timing info
2022-03-04 13:12:36.247808 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-04 13:12:36.716219 (Thread-1): 10:12:36 | 8 of 8 OK created table model DBT_SHOPIFY.W_ORDERS_F................. [SUCCESS 1 in 6.34s]
2022-03-04 13:12:36.727802 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-04 13:12:36.730777 (MainThread): Acquiring new snowflake connection "master".
2022-03-04 13:12:36.734418 (MainThread): 10:12:36 | 
2022-03-04 13:12:36.734984 (MainThread): 10:12:36 | Finished running 6 view models, 2 table models in 28.10s.
2022-03-04 13:12:36.735451 (MainThread): Connection 'master' was properly closed.
2022-03-04 13:12:36.735754 (MainThread): Connection 'model.snowflake_aicd.W_ORDERS_F' was properly closed.
2022-03-04 13:12:36.752147 (MainThread): 
2022-03-04 13:12:36.752339 (MainThread): Completed successfully
2022-03-04 13:12:36.752490 (MainThread): 
Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
2022-03-04 13:12:36.752989 (MainThread): Flushing usage events
2022-03-07 13:11:46.306359 (MainThread): Running with dbt=0.21.1
2022-03-07 13:11:47.033407 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-07 13:11:47.035290 (MainThread): Tracking: do not track
2022-03-07 13:11:47.046343 (MainThread): Partial parsing not enabled
2022-03-07 13:11:47.070190 (MainThread): Parsing macros/common.sql
2022-03-07 13:11:47.073321 (MainThread): Parsing macros/catalog.sql
2022-03-07 13:11:47.075204 (MainThread): Parsing macros/adapters.sql
2022-03-07 13:11:47.107519 (MainThread): Parsing macros/materializations/merge.sql
2022-03-07 13:11:47.110842 (MainThread): Parsing macros/materializations/seed.sql
2022-03-07 13:11:47.114925 (MainThread): Parsing macros/materializations/view.sql
2022-03-07 13:11:47.116124 (MainThread): Parsing macros/materializations/table.sql
2022-03-07 13:11:47.118657 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-07 13:11:47.126170 (MainThread): Parsing macros/core.sql
2022-03-07 13:11:47.129074 (MainThread): Parsing macros/materializations/test.sql
2022-03-07 13:11:47.134296 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-07 13:11:47.142737 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-07 13:11:47.144084 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-07 13:11:47.158916 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-07 13:11:47.188820 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-07 13:11:47.208842 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-07 13:11:47.210349 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-07 13:11:47.219080 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-07 13:11:47.236818 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-07 13:11:47.249298 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-07 13:11:47.256654 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-07 13:11:47.262936 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-07 13:11:47.266050 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-07 13:11:47.267669 (MainThread): Parsing macros/etc/query.sql
2022-03-07 13:11:47.268465 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-07 13:11:47.269812 (MainThread): Parsing macros/etc/datetime.sql
2022-03-07 13:11:47.277064 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-07 13:11:47.278563 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-07 13:11:47.280586 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-07 13:11:47.281842 (MainThread): Parsing macros/adapters/common.sql
2022-03-07 13:11:47.330635 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-07 13:11:47.332078 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-07 13:11:47.332946 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-07 13:11:47.333919 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-07 13:11:47.488223 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:11:47.498101 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.501666 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-07 13:11:47.504598 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.505377 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-07 13:11:47.508139 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.508977 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:11:47.512246 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.513112 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:11:47.517740 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.518481 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:11:47.522321 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.523114 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-07 13:11:47.526107 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.526885 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-07 13:11:47.529735 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.530693 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-07 13:11:47.533609 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.534338 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-07 13:11:47.536850 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.537580 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:11:47.540216 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.541211 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-07 13:11:47.545786 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.546596 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-07 13:11:47.549624 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.550649 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-07 13:11:47.555939 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.556720 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-07 13:11:47.562647 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.563467 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-07 13:11:47.566380 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.567087 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-07 13:11:47.570652 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.571628 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-07 13:11:47.576652 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.577588 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-07 13:11:47.617980 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.618849 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-07 13:11:47.621161 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.622269 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-07 13:11:47.625084 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.625869 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-07 13:11:47.628267 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.628975 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-07 13:11:47.631309 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.632583 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:11:47.635532 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.636300 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-07 13:11:47.638664 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.639409 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:11:47.641786 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.642723 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-07 13:11:47.645357 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.646122 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-07 13:11:47.648346 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.670238 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.671589 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.673291 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.674644 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.675898 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.677483 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.679150 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.680339 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:11:47.696427 (MainThread): Flushing usage events
2022-03-07 13:11:47.696602 (MainThread): Connection 'model.snowflake_aicd.W_CUSTOMER_ADDRESS_D' was properly closed.
2022-03-07 13:11:47.696702 (MainThread): Encountered an error:
2022-03-07 13:11:47.696815 (MainThread): Compilation Error in model V_ABANDONED_CHECKOUT_F_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql)
  Model 'model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG' (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql) depends on a node named 'V_ABANDONED_CHECKOUT_LINE_ITEM' which was not found
2022-03-07 13:11:47.707292 (MainThread): Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/main.py", line 127, in main
    results, succeeded = handle_and_check(args)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/main.py", line 205, in handle_and_check
    task, res = run_from_args(parsed)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/main.py", line 258, in run_from_args
    results = task.run()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 438, in run
    self._runtime_initialize()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 154, in _runtime_initialize
    super()._runtime_initialize()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 92, in _runtime_initialize
    self.load_manifest()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 79, in load_manifest
    self.manifest = ManifestLoader.get_full_manifest(self.config)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 182, in get_full_manifest
    manifest = loader.load()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 361, in load
    self.process_refs(self.root_project.project_name)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 721, in process_refs
    _process_refs_for_node(self.manifest, current_project, node)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 1032, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 805, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/exceptions.py", line 587, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/exceptions.py", line 447, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model V_ABANDONED_CHECKOUT_F_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql)
  Model 'model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG' (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql) depends on a node named 'V_ABANDONED_CHECKOUT_LINE_ITEM' which was not found

2022-03-07 13:12:32.023656 (MainThread): Running with dbt=0.21.1
2022-03-07 13:12:32.526085 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-07 13:12:32.527770 (MainThread): Tracking: do not track
2022-03-07 13:12:32.538123 (MainThread): Partial parsing not enabled
2022-03-07 13:12:32.557192 (MainThread): Parsing macros/common.sql
2022-03-07 13:12:32.560359 (MainThread): Parsing macros/catalog.sql
2022-03-07 13:12:32.562185 (MainThread): Parsing macros/adapters.sql
2022-03-07 13:12:32.595952 (MainThread): Parsing macros/materializations/merge.sql
2022-03-07 13:12:32.599643 (MainThread): Parsing macros/materializations/seed.sql
2022-03-07 13:12:32.603682 (MainThread): Parsing macros/materializations/view.sql
2022-03-07 13:12:32.605028 (MainThread): Parsing macros/materializations/table.sql
2022-03-07 13:12:32.607700 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-07 13:12:32.614951 (MainThread): Parsing macros/core.sql
2022-03-07 13:12:32.618242 (MainThread): Parsing macros/materializations/test.sql
2022-03-07 13:12:32.623898 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-07 13:12:32.632557 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-07 13:12:32.634186 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-07 13:12:32.649018 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-07 13:12:32.680570 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-07 13:12:32.701148 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-07 13:12:32.702598 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-07 13:12:32.711415 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-07 13:12:32.729588 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-07 13:12:32.742232 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-07 13:12:32.750178 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-07 13:12:32.757068 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-07 13:12:32.760284 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-07 13:12:32.761603 (MainThread): Parsing macros/etc/query.sql
2022-03-07 13:12:32.762503 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-07 13:12:32.763697 (MainThread): Parsing macros/etc/datetime.sql
2022-03-07 13:12:32.770896 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-07 13:12:32.772558 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-07 13:12:32.774800 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-07 13:12:32.776055 (MainThread): Parsing macros/adapters/common.sql
2022-03-07 13:12:32.826540 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-07 13:12:32.827977 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-07 13:12:32.828870 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-07 13:12:32.829906 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-07 13:12:32.982547 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:12:32.991549 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:32.994856 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-07 13:12:32.997977 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:32.998747 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-07 13:12:33.001533 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.002248 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:12:33.005181 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.006130 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:12:33.011068 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.011783 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:12:33.015486 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.016330 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-07 13:12:33.019405 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.020118 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-07 13:12:33.022504 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.023201 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-07 13:12:33.026587 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.027443 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-07 13:12:33.030335 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.031290 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:12:33.034192 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.035227 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-07 13:12:33.039728 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.040501 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-07 13:12:33.043569 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.044305 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-07 13:12:33.049238 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.050038 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-07 13:12:33.056060 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.057051 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-07 13:12:33.060248 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.060990 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-07 13:12:33.064450 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.065309 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-07 13:12:33.070197 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.071045 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-07 13:12:33.111308 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.112165 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-07 13:12:33.115034 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.116032 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-07 13:12:33.119114 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.119952 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-07 13:12:33.122861 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.123706 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-07 13:12:33.126204 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.127112 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:12:33.129723 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.130706 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-07 13:12:33.134597 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.135374 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:12:33.138285 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.139181 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-07 13:12:33.141849 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.142642 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-07 13:12:33.144945 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.167015 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.168478 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.169803 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.170955 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.172087 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.173252 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.174579 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.175702 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:12:33.191603 (MainThread): Flushing usage events
2022-03-07 13:12:33.191835 (MainThread): Connection 'model.snowflake_aicd.W_CUSTOMER_ADDRESS_D' was properly closed.
2022-03-07 13:12:33.191953 (MainThread): Encountered an error:
2022-03-07 13:12:33.192082 (MainThread): Compilation Error in model V_ABANDONED_CHECKOUT_F_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql)
  Model 'model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG' (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql) depends on a node named 'V_ABANDONED_CHECKOUT_LINE_ITEM' which was not found
2022-03-07 13:12:33.204406 (MainThread): Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/main.py", line 127, in main
    results, succeeded = handle_and_check(args)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/main.py", line 205, in handle_and_check
    task, res = run_from_args(parsed)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/main.py", line 258, in run_from_args
    results = task.run()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 438, in run
    self._runtime_initialize()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 154, in _runtime_initialize
    super()._runtime_initialize()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 92, in _runtime_initialize
    self.load_manifest()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 79, in load_manifest
    self.manifest = ManifestLoader.get_full_manifest(self.config)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 182, in get_full_manifest
    manifest = loader.load()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 361, in load
    self.process_refs(self.root_project.project_name)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 721, in process_refs
    _process_refs_for_node(self.manifest, current_project, node)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 1032, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 805, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/exceptions.py", line 587, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/exceptions.py", line 447, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model V_ABANDONED_CHECKOUT_F_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql)
  Model 'model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG' (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql) depends on a node named 'V_ABANDONED_CHECKOUT_LINE_ITEM' which was not found

2022-03-07 13:13:13.024601 (MainThread): Running with dbt=0.21.1
2022-03-07 13:13:13.582962 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-07 13:13:13.587455 (MainThread): Tracking: do not track
2022-03-07 13:13:13.598391 (MainThread): Partial parsing not enabled
2022-03-07 13:13:13.619044 (MainThread): Parsing macros/common.sql
2022-03-07 13:13:13.622158 (MainThread): Parsing macros/catalog.sql
2022-03-07 13:13:13.623962 (MainThread): Parsing macros/adapters.sql
2022-03-07 13:13:13.655599 (MainThread): Parsing macros/materializations/merge.sql
2022-03-07 13:13:13.658734 (MainThread): Parsing macros/materializations/seed.sql
2022-03-07 13:13:13.662299 (MainThread): Parsing macros/materializations/view.sql
2022-03-07 13:13:13.663296 (MainThread): Parsing macros/materializations/table.sql
2022-03-07 13:13:13.665675 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-07 13:13:13.672699 (MainThread): Parsing macros/core.sql
2022-03-07 13:13:13.675614 (MainThread): Parsing macros/materializations/test.sql
2022-03-07 13:13:13.681361 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-07 13:13:13.689672 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-07 13:13:13.691218 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-07 13:13:13.705591 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-07 13:13:13.734919 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-07 13:13:13.754359 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-07 13:13:13.755726 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-07 13:13:13.764691 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-07 13:13:13.783162 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-07 13:13:13.795504 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-07 13:13:13.802763 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-07 13:13:13.808732 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-07 13:13:13.812286 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-07 13:13:13.813508 (MainThread): Parsing macros/etc/query.sql
2022-03-07 13:13:13.814212 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-07 13:13:13.815334 (MainThread): Parsing macros/etc/datetime.sql
2022-03-07 13:13:13.822861 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-07 13:13:13.824541 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-07 13:13:13.826473 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-07 13:13:13.827719 (MainThread): Parsing macros/adapters/common.sql
2022-03-07 13:13:13.875723 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-07 13:13:13.877081 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-07 13:13:13.877965 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-07 13:13:13.878966 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-07 13:13:14.036027 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:13:14.045890 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.049458 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-07 13:13:14.052194 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.053039 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-07 13:13:14.055660 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.056370 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:13:14.059525 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.060568 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:13:14.065500 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.066332 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:13:14.070497 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.071388 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-07 13:13:14.074764 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.075593 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-07 13:13:14.078351 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.079224 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-07 13:13:14.082608 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.083397 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-07 13:13:14.086176 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.086920 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:13:14.090062 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.091010 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-07 13:13:14.095246 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.096041 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-07 13:13:14.099740 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.100603 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-07 13:13:14.105522 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.106274 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-07 13:13:14.112570 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.113337 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-07 13:13:14.116228 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.116930 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-07 13:13:14.120903 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.121963 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-07 13:13:14.126589 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.127335 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-07 13:13:14.167618 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.168516 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-07 13:13:14.170902 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.171629 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-07 13:13:14.173844 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.177133 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-07 13:13:14.180288 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.181164 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-07 13:13:14.183987 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.184760 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:13:14.187326 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.188337 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-07 13:13:14.191141 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.192155 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:13:14.194664 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.195417 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-07 13:13:14.197879 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.198693 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-07 13:13:14.201715 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.223920 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.225263 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.226574 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.227717 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.228858 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.230394 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.232139 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.233420 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:13:14.274710 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-07 13:13:14.275577 (MainThread): Found 28 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 24 sources, 0 exposures
2022-03-07 13:13:14.277913 (MainThread): 
2022-03-07 13:13:14.278203 (MainThread): Acquiring new snowflake connection "master".
2022-03-07 13:13:14.279821 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-07 13:13:14.289743 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-07 13:13:14.289939 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-07 13:13:14.290099 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-07 13:13:16.620549 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 2.33 seconds
2022-03-07 13:13:16.624081 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-07 13:13:17.084018 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-07 13:13:17.091334 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-07 13:13:17.091559 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-07 13:13:17.091735 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-07 13:13:18.676336 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 27 in 1.58 seconds
2022-03-07 13:13:18.689628 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-07 13:13:19.170050 (MainThread): 10:13:19 | Concurrency: 1 threads (target='dev')
2022-03-07 13:13:19.171089 (MainThread): 10:13:19 | 
2022-03-07 13:13:19.183151 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:13:19.183744 (Thread-1): 10:13:19 | 1 of 28 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG [RUN]
2022-03-07 13:13:19.184274 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:13:19.184520 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:13:19.188200 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"
2022-03-07 13:13:19.190694 (Thread-1): finished collecting timing info
2022-03-07 13:13:19.220213 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"
2022-03-07 13:13:19.223869 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:13:19.224077 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT_LINE_ITEM"
),
rename AS 
(   
  SELECT 
  --DLHK
  ,MD5(S.ID) AS K_ABANDONED_CHECKOUT_ITEM_DLHK
  ,MD5(S.CHECKOUT_ID) AS K_ABANDONED_CHECKOUT_DLHK
  
  ,MD5(CONCAT(S.PRODUCT_ID,'-',COALESCE(S.VARIANT_ID,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_ABANDONED_CHECKOUT_ITEM_BK
  ,S.CHECKOUT_ID AS K_ABANDONED_CHECKOUT_BK
  ,S.DESTINATION_LOCATION_ID AS K_DESTINATION_LOCATION_BK    
  ,S.ORIGIN_LOCATION_ID AS K_ORIGIN_LOCATION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  ,S.VARIANT_ID AS K_VARIANT_BK
  --ATTRIBUTES
  ,S.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,S.KEY AS A_KEY
  ,S.PRESENTMENT_TITLE AS A_PRESENTMENT_TITLE
  ,S.PRESENTMENT_VARIANT_TITLE AS A_PRESENTMENT_VARIANT_TITLE
  ,S.SKU AS A_SKU
  ,S.TITLE AS A_TITLE
  ,S.VARIANT_TITLE AS A_VARIANT_TITLE
  ,S.VENDOR AS A_VENDOR
  --BOOLEAN
  ,S.GIFT_CARD AS B_GIFT_CARD
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TAXABLE AS B_TAXABLE
  --METRICS
  ,S.COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,S.GRAMS AS M_GRAMS
  ,S.LINE_PRICE AS M_LINE_PRICE
  ,S.PRICE AS M_PRICE
  ,S.QUANTITY AS M_QUANTITY
  ,S.VARIANT_PRICE AS M_VARIANT_PRICE
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
  FROM
      source S
)


SELECT * FROM rename
  );
2022-03-07 13:13:19.224228 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:21.134963 (Thread-1): Snowflake query id: 01a2c459-0601-418f-000b-358300f4f21e
2022-03-07 13:13:21.135177 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 14 at position 2 unexpected ','.
2022-03-07 13:13:21.135404 (Thread-1): finished collecting timing info
2022-03-07 13:13:21.135564 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG: Close
2022-03-07 13:13:21.579590 (Thread-1): Database Error in model V_ABANDONED_CHECKOUT_LINE_ITEM_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_LINE_ITEM_STG.sql)
  001003 (42000): SQL compilation error:
  syntax error line 14 at position 2 unexpected ','.
  compiled SQL at target/run/snowflake_aicd/models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_LINE_ITEM_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 14 at position 2 unexpected ','.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_ABANDONED_CHECKOUT_LINE_ITEM_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_LINE_ITEM_STG.sql)
  001003 (42000): SQL compilation error:
  syntax error line 14 at position 2 unexpected ','.
  compiled SQL at target/run/snowflake_aicd/models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_LINE_ITEM_STG.sql
2022-03-07 13:13:21.598515 (Thread-1): 10:13:21 | 1 of 28 ERROR creating view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG [ERROR in 2.41s]
2022-03-07 13:13:21.598802 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:13:21.599034 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-07 13:13:21.599342 (Thread-1): 10:13:21 | 2 of 28 START view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG.......... [RUN]
2022-03-07 13:13:21.599664 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-07 13:13:21.600303 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-07 13:13:21.603925 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-07 13:13:21.604965 (Thread-1): finished collecting timing info
2022-03-07 13:13:21.607756 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-07 13:13:21.611037 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-07 13:13:21.611200 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER_ADDRESS"
),
rename AS 
(   
SELECT 
    MD5(ID) AS K_CUSTOMER_ADDRESS_DLHK
    ,ID AS K_CUSTOMER_ADDRESS_BK
    ,MD5(CONCAT(
        COALESCE(ADDRESS1,'00'),
        COALESCE(ADDRESS2,'00'),
        COALESCE(CITY,'00'),
        COALESCE(COUNTRY,'00'),
        COALESCE(COUNTRY_CODE,'00'),
        COALESCE(FIRST_NAME,'00'),
        COALESCE(LAST_NAME,'00'),
        COALESCE(PROVINCE,'00'),
        COALESCE(PROVINCE_CODE,'00'),
        COALESCE(ZIP,'00')
    )) AS K_ADDRESS_DLHK
    ,CUSTOMER_ID AS K_CUSTOMER_BK
    ,ADDRESS1 AS A_ADDRESS1
    ,ADDRESS2 AS A_ADDRESS2
    ,CITY AS A_CITY
    ,COMPANY AS A_COMPANY
    ,COUNTRY AS A_COUNTRY
    ,COUNTRY_CODE AS A_COUNTRY_CODE
    ,COUNTRY_NAME AS A_COUNTRY_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,PHONE AS A_PHONE
    ,PROVINCE AS A_PROVINCE
    ,PROVINCE_CODE AS A_PROVINCE_CODE
    ,ZIP AS A_ZIP
    ,IS_DEFAULT AS B_IS_DEFAULT  
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-07 13:13:21.611355 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:23.645580 (Thread-1): SQL status: SUCCESS 1 in 2.03 seconds
2022-03-07 13:13:23.654860 (Thread-1): finished collecting timing info
2022-03-07 13:13:23.655157 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: Close
2022-03-07 13:13:24.108256 (Thread-1): 10:13:24 | 2 of 28 OK created view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG..... [SUCCESS 1 in 2.51s]
2022-03-07 13:13:24.108547 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-07 13:13:24.108708 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:13:24.108895 (Thread-1): 10:13:24 | 3 of 28 START view model DBT_SHOPIFY.V_CUSTOMER_STG.................. [RUN]
2022-03-07 13:13:24.109187 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:13:24.109355 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:13:24.114861 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-07 13:13:24.115878 (Thread-1): finished collecting timing info
2022-03-07 13:13:24.118259 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-07 13:13:24.122113 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:13:24.122381 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER"
),
rename AS 
(   
SELECT 
    --KEYS
    MD5(ID) AS K_CUSTOMER_DLHK    
    --BUSINESS KEYS
    ,ID AS K_CUSTOMER_BK
    ,LAST_ORDER_ID AS K_LAST_ORDER_BK
    ,MULTIPASS_IDENTIFIER AS K_MULTIPASS_BKENTIFIER
    --ATTRIBUTES
    ,ACCEPTS_MARKETING_UPDATED_AT AS A_ACCEPTS_MARKETING_UPDATED_AT_DTS
    ,CREATED_AT AS A_CREATED_AT_DTS
    ,CURRENCY AS A_CURRENCY
    ,EMAIL AS A_EMAIL
    ,
    (COALESCE(FIRST_NAME,'') || ' ' || COALESCE(LAST_NAME,''))
 AS A_FULL_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,LAST_ORDER_NAME AS A_LAST_ORDER_NAME
    ,MARKETING_OPT_IN_LEVEL AS A_MARKETING_OPT_IN_LEVEL
    ,NOTE AS A_NOTE
    ,PHONE AS A_PHONE
    ,SMS_MARKETING_CONSENT AS A_SMS_MARKETING_CONSENT
    ,STATE AS A_STATE
    ,TAGS AS A_TAGS
    ,TAX_EXEMPTIONS AS A_TAX_EXEMPTIONS
    ,TOTAL_SPENT AS A_TOTAL_SPENT
    ,UPDATED_AT AS A_UPDATED_AT
    --BOOLEAN
    ,ACCEPTS_MARKETING AS B_ACCEPTS_MARKETING
    ,TAX_EXEMPT AS B_TAX_EXEMPT
    ,VERIFIED_EMAIL AS B_VERIFIED_EMAIL
    --METRICS
    ,ORDERS_COUNT AS M_ORDERS_COUNT
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-07 13:13:24.122587 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:26.030367 (Thread-1): SQL status: SUCCESS 1 in 1.91 seconds
2022-03-07 13:13:26.033398 (Thread-1): finished collecting timing info
2022-03-07 13:13:26.033710 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-07 13:13:26.478862 (Thread-1): 10:13:26 | 3 of 28 OK created view model DBT_SHOPIFY.V_CUSTOMER_STG............. [SUCCESS 1 in 2.37s]
2022-03-07 13:13:26.479303 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:13:26.479663 (Thread-1): Began running node model.snowflake_aicd.V_DATE_STG
2022-03-07 13:13:26.480145 (Thread-1): 10:13:26 | 4 of 28 START view model DBT_SHOPIFY.V_DATE_STG...................... [RUN]
2022-03-07 13:13:26.480695 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-07 13:13:26.480903 (Thread-1): Compiling model.snowflake_aicd.V_DATE_STG
2022-03-07 13:13:26.486729 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-07 13:13:26.487352 (Thread-1): finished collecting timing info
2022-03-07 13:13:26.489280 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-07 13:13:26.520378 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-07 13:13:26.520684 (Thread-1): On model.snowflake_aicd.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-07 13:13:26.520939 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:28.387459 (Thread-1): SQL status: SUCCESS 1 in 1.87 seconds
2022-03-07 13:13:28.389689 (Thread-1): finished collecting timing info
2022-03-07 13:13:28.389965 (Thread-1): On model.snowflake_aicd.V_DATE_STG: Close
2022-03-07 13:13:28.840080 (Thread-1): 10:13:28 | 4 of 28 OK created view model DBT_SHOPIFY.V_DATE_STG................. [SUCCESS 1 in 2.36s]
2022-03-07 13:13:28.840386 (Thread-1): Finished running node model.snowflake_aicd.V_DATE_STG
2022-03-07 13:13:28.840573 (Thread-1): Began running node model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:13:28.840803 (Thread-1): 10:13:28 | 5 of 28 START view model DBT_SHOPIFY.V_LOCATION_STG.................. [RUN]
2022-03-07 13:13:28.841077 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:13:28.841232 (Thread-1): Compiling model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:13:28.845258 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-07 13:13:28.846199 (Thread-1): finished collecting timing info
2022-03-07 13:13:28.848228 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-07 13:13:28.850824 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:13:28.851068 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-07 13:13:28.851219 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:30.522743 (Thread-1): SQL status: SUCCESS 1 in 1.67 seconds
2022-03-07 13:13:30.525765 (Thread-1): finished collecting timing info
2022-03-07 13:13:30.526165 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-07 13:13:30.980822 (Thread-1): 10:13:30 | 5 of 28 OK created view model DBT_SHOPIFY.V_LOCATION_STG............. [SUCCESS 1 in 2.14s]
2022-03-07 13:13:30.981173 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:13:30.981394 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-07 13:13:30.981920 (Thread-1): 10:13:30 | 6 of 28 START view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG......... [RUN]
2022-03-07 13:13:30.982442 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-07 13:13:30.982642 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-07 13:13:30.987561 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-07 13:13:30.988245 (Thread-1): finished collecting timing info
2022-03-07 13:13:30.990212 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-07 13:13:30.993089 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-07 13:13:30.993230 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_ADJUSTMENT" AS A
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_ADJUSTMENT_DLHK
  --BK
  ,ID AS K_ORDER_ADJUSTMENT_BK
  ,ORDER_ID AS K_ORDER_BK
  ,REFUND_ID AS K_REFUND_BK
  --ATTRIBUTE
  ,KIND AS A_KIND
  ,REASON AS A_REASON
  --METRIC
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT_PRIMARY
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-07 13:13:30.993376 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:32.625298 (Thread-1): SQL status: SUCCESS 1 in 1.63 seconds
2022-03-07 13:13:32.628533 (Thread-1): finished collecting timing info
2022-03-07 13:13:32.628859 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: Close
2022-03-07 13:13:33.073012 (Thread-1): 10:13:33 | 6 of 28 OK created view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG.... [SUCCESS 1 in 2.09s]
2022-03-07 13:13:33.073462 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-07 13:13:33.073667 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-07 13:13:33.074349 (Thread-1): 10:13:33 | 7 of 28 START view model DBT_SHOPIFY.V_ORDERS_HEADER_STG............. [RUN]
2022-03-07 13:13:33.074912 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-07 13:13:33.075111 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-07 13:13:33.085112 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-07 13:13:33.087336 (Thread-1): finished collecting timing info
2022-03-07 13:13:33.089833 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-07 13:13:33.103914 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-07 13:13:33.104154 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDERS" AS A
),
rename AS 
(
SELECT
    MD5(O.ID) AS K_ORDER_DLHK    
    ,MD5(O.CUSTOMER_ID) AS K_CUSTOMER_DLHK
    ,MD5(O.LOCATION_ID) AS K_LOCATION_DLHK    
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
    --BUSINESS_KEYS
    ,O.APP_ID AS K_APP_BK
    ,O.ID AS K_ORDER_BK
    ,O.CUSTOMER_ID AS K_CUSTOMER_BK
    ,O.DEVICE_ID AS K_DEVICE_BK  
    ,O.LOCATION_ID AS K_LOCATION_BK
    ,O.SOURCE_IDENTIFIER AS K_SOURCE_ENTIFIER_BK
    --ATTRIBUTES
    ,O.BROWSER_IP AS A_BROWSER_IP
    ,O.CANCELLED_AT AS A_CANCELLED_AT_DTS
    ,O.CANCEL_REASON AS A_CANCEL_REASON
    ,O.CART_TOKEN AS A_CART_TOKEN
    ,O.CHECKOUT_TOKEN AS A_CHECKOUT_TOKEN
    ,O.CLIENT_DETAILS AS A_CLIENT_DETAILS
    ,O.CLOSED_AT AS A_CLOSED_AT_DTS
    ,O.CREATED_AT AS A_CREATED_AT_DTS
    ,O.CURRENCY AS A_CURRENCY
    ,O.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
    ,O.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
    ,O.EMAIL AS A_EMAIL
    ,O.FINANCIAL_STATUS AS A_FINANCIAL_STATUS
    ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
    ,O.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
    ,O.LANDING_SITE_REF AS A_LANDING_SITE_REF
    ,O.NAME AS A_NAME
    ,O.NOTE AS A_NOTE
    ,O.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES    
    ,O.PAYMENT_GATEWAY_NAMES AS A_PAYMENT_GATEWAY_NAMES    
    ,O.PROCESSED_AT AS A_PROCESSED_AT_DTS
    ,O.PROCESSING_METHOD AS A_PROCESSING_METHOD
    ,O.REFERENCE AS A_REFERENCE
    ,O.REFERRING_SITE AS A_REFERRING_SITE    
    ,O.SOURCE_NAME AS A_SOURCE_NAME
    ,O.SOURCE_URL AS A_SOURCE_URL    
    ,O.ORDER_NUMBER AS A_ORDER_NUMBER
    ,O.POSION_NUMBER AS A_POSION_NUMBER  
    ,O.UPDATED_AT AS A_UPDATED_AT_DTS
    --BOOLEAN
    ,O.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
    ,O.CONFIRMED AS B_CONFIRMED
    ,O.TAXES_INCLUDED AS B_TAXES_INCLUDED
    --METRICS
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE_PRIMARY 
    ,O.TOTAL_TIP_RECEIVED::DECIMAL(15,2) AS M_TOTAL_TIP_RECEIVED   
    ,O.TOTAL_WEIGHT::DECIMAL(15,2) AS M_TOTAL_WEIGHT
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
FROM source O
)

SELECT * FROM rename
  );
2022-03-07 13:13:33.104353 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:34.761722 (Thread-1): SQL status: SUCCESS 1 in 1.66 seconds
2022-03-07 13:13:34.764464 (Thread-1): finished collecting timing info
2022-03-07 13:13:34.764790 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: Close
2022-03-07 13:13:35.206857 (Thread-1): 10:13:35 | 7 of 28 OK created view model DBT_SHOPIFY.V_ORDERS_HEADER_STG........ [SUCCESS 1 in 2.13s]
2022-03-07 13:13:35.207198 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-07 13:13:35.207405 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-07 13:13:35.207618 (Thread-1): 10:13:35 | 8 of 28 START view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG.. [RUN]
2022-03-07 13:13:35.207899 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-07 13:13:35.208042 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-07 13:13:35.212751 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-07 13:13:35.214679 (Thread-1): finished collecting timing info
2022-03-07 13:13:35.217201 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-07 13:13:35.219647 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-07 13:13:35.219833 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM_TAX_LINE" AS A
),
rename AS 
(
SELECT
  CONCAT(COALESCE(ORDER_ID,'0000000000'),'-',COALESCE(ORDER_LINE_ID,'0000000000')) AS K_ORDER_LINE_ITEM_TAX_DLHK
  ,ORDER_ID AS K_ORDER_BK
  ,ORDER_LINE_ID AS K_ORDER_LINE_ITEM_BK
  ,TITLE AS A_TITLE
  ,CHANNEL_LIABLE AS B_CHANNEL_LIABLE
  ,RATE AS M_RATE
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-07 13:13:35.219995 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:37.113604 (Thread-1): SQL status: SUCCESS 1 in 1.89 seconds
2022-03-07 13:13:37.116818 (Thread-1): finished collecting timing info
2022-03-07 13:13:37.117247 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: Close
2022-03-07 13:13:37.557496 (Thread-1): 10:13:37 | 8 of 28 OK created view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG [SUCCESS 1 in 2.35s]
2022-03-07 13:13:37.557985 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-07 13:13:37.558218 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-07 13:13:37.558751 (Thread-1): 10:13:37 | 9 of 28 START view model DBT_SHOPIFY.V_PRODUCT_STG................... [RUN]
2022-03-07 13:13:37.559189 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-07 13:13:37.559396 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_STG
2022-03-07 13:13:37.563775 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-07 13:13:37.564456 (Thread-1): finished collecting timing info
2022-03-07 13:13:37.566997 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-07 13:13:37.569677 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-07 13:13:37.569842 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_DLHK
  ,ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE
  ,HANDLE AS A_HANDLE
  ,PRODUCT_TYPE AS A_PRODUCT_TYPE
  ,VENDOR AS A_VENDOR
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE
  ,STATUS AS A_STATUS
  ,TEMPLATE_SUFFIX AS A_TEMPLATE_SUFFIX   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-07 13:13:37.570000 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:39.155962 (Thread-1): SQL status: SUCCESS 1 in 1.59 seconds
2022-03-07 13:13:39.158642 (Thread-1): finished collecting timing info
2022-03-07 13:13:39.158927 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: Close
2022-03-07 13:13:39.609063 (Thread-1): 10:13:39 | 9 of 28 OK created view model DBT_SHOPIFY.V_PRODUCT_STG.............. [SUCCESS 1 in 2.05s]
2022-03-07 13:13:39.609665 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-07 13:13:39.609960 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-07 13:13:39.610511 (Thread-1): 10:13:39 | 10 of 28 START view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG.......... [RUN]
2022-03-07 13:13:39.611397 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-07 13:13:39.611722 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-07 13:13:39.618419 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-07 13:13:39.619514 (Thread-1): finished collecting timing info
2022-03-07 13:13:39.623032 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-07 13:13:39.626027 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-07 13:13:39.626236 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT_VARIANT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_VARIANT_DLHK
  ,MD5(PRODUCT_ID) AS K_PRODUCT_DLHK  
  --BUSINESS KEYS  
  ,ID AS K_PRODUCT_VARIANT_BK
  ,PRODUCT_ID AS K_PRODUCT_BK  
  ,INVENTORY_ITEM_ID AS K_INVENTORY_ITEM_BK
  ,IMAGE_ID AS K_IMAGE_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE  
  ,SKU AS A_SKU    
  ,FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,INVENTORY_MANAGEMENT AS A_INVENTORY_MANAGEMENT
  ,INVENTORY_POLICY AS A_INVENTORY_POLICY
  ,BARCODE AS A_BARCODE
  ,GRAMS AS A_GRAMS
  ,WEIGHT_UNIT AS A_WEIGHT_UNIT
  ,OPTION_1 AS A_OPTION_1
  ,OPTION_2 AS A_OPTION_2
  ,OPTION_3 AS A_OPTION_3
  ,TAX_CODE AS A_TAX_CODE  
  ,PRESENTMENT_PRICES AS A_PRESENTMENT_PRICES  
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  --BOOLEAN
  ,REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,TAXABLE AS B_TAXABLE
  --METRICS
  ,PRICE AS M_PRICE
  ,POSITION AS M_POSITION
  ,COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,INVENTORY_QUANTITY AS M_INVENTORY_QUANTITY
  ,INVENTORY_QUANTITY_ADJUSTMENT AS M_INVENTORY_QUANTITY_ADJUSTMENT
  ,WEIGHT AS M_WEIGHT
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-07 13:13:39.626415 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:41.456150 (Thread-1): SQL status: SUCCESS 1 in 1.83 seconds
2022-03-07 13:13:41.458779 (Thread-1): finished collecting timing info
2022-03-07 13:13:41.459069 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: Close
2022-03-07 13:13:41.903171 (Thread-1): 10:13:41 | 10 of 28 OK created view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG..... [SUCCESS 1 in 2.29s]
2022-03-07 13:13:41.903491 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-07 13:13:41.903700 (Thread-1): Began running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-07 13:13:41.903956 (Thread-1): 10:13:41 | 11 of 28 START view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG......... [RUN]
2022-03-07 13:13:41.904526 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-07 13:13:41.904915 (Thread-1): Compiling model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-07 13:13:41.910920 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-07 13:13:41.913097 (Thread-1): finished collecting timing info
2022-03-07 13:13:41.915697 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-07 13:13:41.920382 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-07 13:13:41.920667 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG  as (
    


WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND" AS A
),
refund_line as (
    SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND_LINE_ITEM" AS A
),
rename AS 
(
SELECT
  MD5(RL.ID) AS K_REFUND_LINE_DLHK
  ,MD5(R.ID) AS K_REFUND_DLHK
  ,R.ID AS K_REFUND_BK
  ,RL.ID AS K_REFUND_LINE_BK
  ,R.ORDER_ID AS K_ORDER_BK
  ,R.USER_ID AS K_USER_BK
  ,RL.LOCATION_ID AS K_LOCATION_BK
  ,RL.LINE_ITEM_ID AS K_ORDER_LINE_ITEM_BK
  ,R.NOTE AS A_NOTE
  ,R.RESTOCK AS B_RESTOCK
  ,RL.QUANTITY AS M_QUANTITY
  ,RL.RESTOCK_TYPE AS A_RESTOCK_TYPE
   
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL


  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
FROM source R
LEFT JOIN refund_line RL ON RL.REFUND_ID = R.ID
)

SELECT * FROM rename
  );
2022-03-07 13:13:41.920845 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:43.567115 (Thread-1): SQL status: SUCCESS 1 in 1.65 seconds
2022-03-07 13:13:43.569916 (Thread-1): finished collecting timing info
2022-03-07 13:13:43.570241 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: Close
2022-03-07 13:13:44.035383 (Thread-1): 10:13:44 | 11 of 28 OK created view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG.... [SUCCESS 1 in 2.13s]
2022-03-07 13:13:44.035912 (Thread-1): Finished running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-07 13:13:44.036166 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-07 13:13:44.036772 (Thread-1): 10:13:44 | 12 of 28 START table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D.......... [RUN]
2022-03-07 13:13:44.037310 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-07 13:13:44.037545 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-07 13:13:44.041281 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-07 13:13:44.044028 (Thread-1): finished collecting timing info
2022-03-07 13:13:44.068160 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-07 13:13:44.069780 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-07 13:13:44.070008 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG AS C
      );
2022-03-07 13:13:44.070156 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:47.027475 (Thread-1): SQL status: SUCCESS 1 in 2.96 seconds
2022-03-07 13:13:47.037262 (Thread-1): finished collecting timing info
2022-03-07 13:13:47.037668 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: Close
2022-03-07 13:13:47.481372 (Thread-1): 10:13:47 | 12 of 28 OK created table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D..... [SUCCESS 1 in 3.44s]
2022-03-07 13:13:47.481909 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-07 13:13:47.482166 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:13:47.482657 (Thread-1): 10:13:47 | 13 of 28 START table model DBT_SHOPIFY.W_CUSTOMERS_D................. [RUN]
2022-03-07 13:13:47.483217 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:13:47.483428 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:13:47.488047 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-07 13:13:47.490098 (Thread-1): finished collecting timing info
2022-03-07 13:13:47.493253 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-07 13:13:47.494450 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:13:47.494624 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG AS C
      );
2022-03-07 13:13:47.494799 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:50.177628 (Thread-1): SQL status: SUCCESS 1 in 2.68 seconds
2022-03-07 13:13:50.180016 (Thread-1): finished collecting timing info
2022-03-07 13:13:50.180261 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-07 13:13:50.630158 (Thread-1): 10:13:50 | 13 of 28 OK created table model DBT_SHOPIFY.W_CUSTOMERS_D............ [SUCCESS 1 in 3.15s]
2022-03-07 13:13:50.630495 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:13:50.630727 (Thread-1): Began running node model.snowflake_aicd.W_DATE_D
2022-03-07 13:13:50.630975 (Thread-1): 10:13:50 | 14 of 28 START table model DBT_SHOPIFY.W_DATE_D...................... [RUN]
2022-03-07 13:13:50.631386 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-07 13:13:50.631867 (Thread-1): Compiling model.snowflake_aicd.W_DATE_D
2022-03-07 13:13:50.636053 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-07 13:13:50.636750 (Thread-1): finished collecting timing info
2022-03-07 13:13:50.638847 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-07 13:13:50.643500 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-07 13:13:50.643664 (Thread-1): On model.snowflake_aicd.W_DATE_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_DATE_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_DATE_D  as
      (

SELECT 
	CAST(DATE_KEY AS NUMBER(9)) AS K_DATE_INTEGER_BK
	,CAST(DATE_COLUMN AS DATE) AS K_DATE_BK
	,CAST(FULL_DATE_DESC AS VARCHAR(64)) AS A_FULL_DATE_DESC
	,CAST(DAY_NUM_IN_WEEK AS NUMBER(1)) AS A_DAY_NUM_IN_WEEK
	,CAST(DAY_NUM_IN_MONTH AS NUMBER(2)) AS A_DAY_NUM_IN_MONTH
	,CAST(DAY_NUM_IN_YEAR AS NUMBER(3)) AS A_DAY_NUM_IN_YEAR
	,CAST(DAY_NAME AS VARCHAR(10)) AS A_DAY_NAME
	,CAST(DAY_ABBREV AS VARCHAR(3)) AS A_DAY_ABBREV
	,CAST(WEEKDAY_IND AS VARCHAR(64)) AS A_WEEKDAY_IND
	,CAST(US_HOLIDAY_IND AS VARCHAR(64)) AS A_US_HOLIDAY_IND
	,CAST(COMPANY_HOLIDAY_IND AS VARCHAR(64)) AS A_COMPANY_HOLIDAY_IND
	,CAST(MONTH_END_IND AS VARCHAR(64)) AS A_MONTH_END_IND
	,CAST(WEEK_BEGIN_DATE_NKEY AS NUMBER(9)) AS A_WEEK_BEGIN_DATE_NKEY
	,CAST(WEEK_BEGIN_DATE AS DATE) AS A_WEEK_BEGIN_DATE
	,CAST(WEEK_END_DATE_NKEY AS NUMBER(9)) AS A_WEEK_END_DATE_NKEY
	,CAST(WEEK_END_DATE AS DATE) AS A_WEEK_END_DATE
	,CAST(WEEK_NUM_IN_YEAR AS NUMBER(9)) AS A_WEEK_NUM_IN_YEAR
	,CAST(MONTH_NAME AS VARCHAR(10)) AS A_MONTH_NAME
	,CAST(MONTH_ABBREV AS VARCHAR(3)) AS A_MONTH_ABBREV
	,CAST(MONTH_NUM_IN_YEAR AS NUMBER(2)) AS A_MONTH_NUM_IN_YEAR
	,CAST(YEARMONTH AS VARCHAR(10)) AS A_YEARMONTH
	,CAST(CURRENT_QUARTER AS NUMBER(1)) AS A_QUARTER
	,CAST(YEARQUARTER AS VARCHAR(10)) AS A_YEARQUARTER
	,CAST(CURRENT_YEAR AS NUMBER(5)) AS A_YEAR
	,CAST(FISCAL_WEEK_NUM AS NUMBER(2)) AS A_FISCAL_WEEK_NUM
	,CAST(FISCAL_MONTH_NUM AS NUMBER(2)) AS A_FISCAL_MONTH_NUM
	,CAST(FISCAL_YEARMONTH AS VARCHAR(10)) AS A_FISCAL_YEARMONTH
	,CAST(FISCAL_QUARTER AS NUMBER(1)) AS A_FISCAL_QUARTER
	,CAST(FISCAL_YEARQUARTER AS VARCHAR(10)) AS A_FISCAL_YEARQUARTER
	,CAST(FISCAL_HALFYEAR AS NUMBER(1)) AS A_FISCAL_HALFYEAR
	,CAST(FISCAL_YEAR AS NUMBER(5)) AS A_FISCAL_YEAR
	,CAST(SQL_TIMESTAMP AS TIMESTAMP_NTZ) AS A_SQL_TIMESTAMP_DTS
	,CAST(CURRENT_ROW_IND AS CHAR(1)) AS A_CURRENT_ROW_IND
	,CAST(EFFECTIVE_DATE AS DATE) AS A_EFFECTIVE_DATE
	,CAST(EXPIRA_DATE AS DATE) AS A_EXPIRATION_DATE
FROM
DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG
      );
2022-03-07 13:13:50.643823 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:54.156474 (Thread-1): SQL status: SUCCESS 1 in 3.51 seconds
2022-03-07 13:13:54.159000 (Thread-1): finished collecting timing info
2022-03-07 13:13:54.159261 (Thread-1): On model.snowflake_aicd.W_DATE_D: Close
2022-03-07 13:13:54.621229 (Thread-1): 10:13:54 | 14 of 28 OK created table model DBT_SHOPIFY.W_DATE_D................. [SUCCESS 1 in 3.99s]
2022-03-07 13:13:54.621801 (Thread-1): Finished running node model.snowflake_aicd.W_DATE_D
2022-03-07 13:13:54.622121 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:13:54.622778 (Thread-1): 10:13:54 | 15 of 28 START table model DBT_SHOPIFY.W_LOCATION_D.................. [RUN]
2022-03-07 13:13:54.623421 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:13:54.623757 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:13:54.629233 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-07 13:13:54.630208 (Thread-1): finished collecting timing info
2022-03-07 13:13:54.632702 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-07 13:13:54.633816 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:13:54.634005 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-07 13:13:54.634184 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:56.812557 (Thread-1): SQL status: SUCCESS 1 in 2.18 seconds
2022-03-07 13:13:56.816450 (Thread-1): finished collecting timing info
2022-03-07 13:13:56.817028 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-07 13:13:57.470799 (Thread-1): 10:13:57 | 15 of 28 OK created table model DBT_SHOPIFY.W_LOCATION_D............. [SUCCESS 1 in 2.85s]
2022-03-07 13:13:57.471360 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:13:57.471633 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-07 13:13:57.472142 (Thread-1): 10:13:57 | 16 of 28 START view model DBT_SHOPIFY.V_PRODUCTS_D_STG............... [RUN]
2022-03-07 13:13:57.472772 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-07 13:13:57.473226 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-07 13:13:57.477864 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-07 13:13:57.478814 (Thread-1): finished collecting timing info
2022-03-07 13:13:57.481637 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-07 13:13:57.487870 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-07 13:13:57.488123 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCTS_D_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG  as (
    
 

WITH product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG
),
product_variant AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG
),

rename as (


SELECT
    MD5(CONCAT(P.K_PRODUCT_BK,'-',COALESCE(V.K_PRODUCT_VARIANT_BK,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
    ,P.K_PRODUCT_DLHK
    ,V.K_PRODUCT_VARIANT_DLHK AS K_PRODUCT_VARIANT_DLHK
    ,V.K_PRODUCT_VARIANT_BK AS K_PRODUCT_VARIANT_BK
    ,P.K_PRODUCT_BK AS K_PRODUCT_BK
    ,V.K_INVENTORY_ITEM_BK AS K_VARIANT_INVENTORY_ITEM_BK
    ,V.K_IMAGE_BK AS K_VARIANT_IMAGE_BK
    --ATTRIBUTES
    ,P.A_TITLE
    ,P.A_HANDLE
    ,P.A_PRODUCT_TYPE
    ,P.A_VENDOR
    ,P.A_CREATED_AT_DTS
    ,P.A_UPDATED_AT_DTS
    ,P.A_PUBLISHED_AT_DTS
    ,P.A_PUBLISHED_SCOPE
    ,P.A_STATUS
    ,P.A_TEMPLATE_SUFFIX       
    ,V.A_TITLE AS A_VARIANT_TITLE
    ,V.A_SKU AS A_VARIANT_SKU
    ,V.A_FULFILLMENT_SERVICE AS A_VARIANT_FULFILLMENT_SERVICE
    ,V.A_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
    ,V.A_BARCODE AS A_VARIANT_BARCODE
    ,V.A_INVENTORY_POLICY AS A_VARIANT_INVENTORY_POLICY
    ,V.A_GRAMS AS A_VARIANT_GRAMS
    ,V.A_WEIGHT_UNIT AS A_VARIANT_WEIGHT_UNIT
    ,V.A_OPTION_1 AS A_VARIANT_OPTION_1
    ,V.A_OPTION_2 AS A_VARIANT_OPTION_2
    ,V.A_OPTION_3 AS A_VARIANT_OPTION_3
    ,V.A_TAX_CODE AS A_VARIANT_TAX_CODE
    ,V.A_PRESENTMENT_PRICES AS A_VARIANT_PRESENTMENT_PRICES
    ,V.A_CREATED_AT_DTS AS A_VARIANT_CREATED_AT_DTS
    ,V.A_UPDATED_AT_DTS AS A_VARIANT_UPDATED_AT_DTS
    --BOOLEAN
    ,V.B_REQUIRES_SHIPPING AS B_VARIANT_REQUIRES_SHIPPING
    ,V.B_TAXABLE AS B_VARIANT_TAXABLE
    --METRICS
    ,V.M_PRICE AS M_VARIANT_PRICE
    ,V.M_POSITION AS M_VARIANT_POSITION
    ,V.M_COMPARE_AT_PRICE AS M_VARIANT_COMPARE_AT_PRICE
    ,V.M_INVENTORY_QUANTITY AS M_VARIANT_INVENTORY_QUANTITY
    ,V.M_INVENTORY_QUANTITY_ADJUSTMENT AS M_VARIANT_INVENTORY_QUANTITY_ADJUSTMENT
    ,V.M_WEIGHT AS M_VARIANT_WEIGHT
    --metadata (MD)
    ,P.MD_IS_DELETED AS MD_IS_DELETED_PRODUCT
    ,V.MD_IS_DELETED AS MD_IS_DELETED_VARIANT
    , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
    , 'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
FROM
    product P
    LEFT JOIN product_variant V ON V.K_PRODUCT_BK = P.K_PRODUCT_BK
)

SELECT * FROM rename
  );
2022-03-07 13:13:57.488307 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:13:59.403998 (Thread-1): SQL status: SUCCESS 1 in 1.92 seconds
2022-03-07 13:13:59.405638 (Thread-1): finished collecting timing info
2022-03-07 13:13:59.405874 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: Close
2022-03-07 13:13:59.847697 (Thread-1): 10:13:59 | 16 of 28 OK created view model DBT_SHOPIFY.V_PRODUCTS_D_STG.......... [SUCCESS 1 in 2.37s]
2022-03-07 13:13:59.848054 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-07 13:13:59.848295 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:13:59.848841 (Thread-1): 10:13:59 | 17 of 28 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG....... [RUN]
2022-03-07 13:13:59.849470 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:13:59.849714 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:13:59.855968 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-07 13:13:59.856783 (Thread-1): finished collecting timing info
2022-03-07 13:13:59.859888 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-07 13:13:59.869984 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:13:59.870286 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT"
),
customer AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 

  MD5(S.ID) AS K_ABANDONED_CHECKOUT_DLHK
  ,C.K_CUSTOMER_DLHK
  ,L.K_LOCATION_DLHK
  ,MD5(S.USER_ID) AS K_USER_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK  
  ,S.ID AS K_ABANDONED_CHECKOUT_BK
  ,S.CUSTOMER_ID AS K_CUSTOMER_BK
  ,S.DEVICE_ID AS K_DEVICE_BK
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.SOURCE_IDENTIFIER AS K_SOURCE_BKENTIFIER
  ,S.USER_ID AS K_USER_BK
  ,S.ABANDONED_CHECKOUT_URL AS A_ABANDONED_CHECKOUT_URL  
  ,S.CART_TOKEN AS A_CART_TOKEN
  ,S.CLOSED_AT AS A_CLOSED_AT
  ,S.COMPLETED_AT AS A_COMPLETED_AT
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
  ,S.EMAIL AS A_EMAIL
  ,S.GATEWAY AS A_GATEWAY
  ,S.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
  ,S.NAME AS A_NAME
  ,S.NOTE AS A_NOTE
  ,S.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES
  ,S.PHONE AS A_PHONE
  ,S.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
  ,S.REFERRING_SITE AS A_REFERRING_SITE    
  ,S.SOURCE AS A_SOURCE
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.SOURCE_URL AS A_SOURCE_URL
  ,S.TOKEN AS A_TOKEN
  ,S.UPDATED_AT AS A_UPDATED_AT  
  --BOOLEAN
  ,S.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
  ,S.TAXES_INCLUDED AS B_TAXES_INCLUDED
  --METRIC
  ,S.SUBTOTAL_PRICE::decimal(15,2) AS M_SUBTOTAL_PRICE
  ,S.TOTAL_DISCOUNTS::decimal(15,2) AS M_TOTAL_DISCOUNTS
  ,S.TOTAL_DUTIES::decimal(15,2) AS M_TOTAL_DUTIES
  ,S.TOTAL_LINE_ITEMS_PRICE::decimal(15,2) AS M_TOTAL_LINE_ITEMS_PRICE
  ,S.TOTAL_PRICE::decimal(15,2) AS M_TOTAL_PRICE
  ,S.TOTAL_TAX::decimal(15,2) AS M_TOTAL_TAX
  ,S.TOTAL_WEIGHT::decimal(15,2) AS M_TOTAL_WEIGHT
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
  FROM
      source S
      left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
      left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-07 13:13:59.870496 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:14:01.723688 (Thread-1): SQL status: SUCCESS 1 in 1.85 seconds
2022-03-07 13:14:01.725457 (Thread-1): finished collecting timing info
2022-03-07 13:14:01.725632 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: Close
2022-03-07 13:14:02.223489 (Thread-1): 10:14:02 | 17 of 28 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.. [SUCCESS 1 in 2.37s]
2022-03-07 13:14:02.223879 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:14:02.224129 (Thread-1): Began running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-07 13:14:02.224456 (Thread-1): 10:14:02 | 18 of 28 START view model DBT_SHOPIFY.V_TRANSACTIONS_STG............. [RUN]
2022-03-07 13:14:02.224862 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-07 13:14:02.225225 (Thread-1): Compiling model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-07 13:14:02.229958 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-07 13:14:02.231661 (Thread-1): finished collecting timing info
2022-03-07 13:14:02.234110 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-07 13:14:02.238081 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-07 13:14:02.238381 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_TRANSACTIONS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."TRANSACTION"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_TRANSACTION_DLHK
  ,L.K_LOCATION_DLHK  
  ,MD5(S.USER_ID) AS K_USER_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_TRANSACTION_BK
  ,S.DEVICE_ID AS K_DEVICE_BK  
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.ORDER_ID AS K_ORDER_BK
  ,S.PARENT_ID AS K_PARENT_BK
  ,S.REFUND_ID AS K_REFUND_BK
  ,S.USER_ID AS K_USER_BK  
  --ATTRIBUTES
  ,S.AUTHORIZATION AS A_AUTHORIZATION
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CURRENCY_EXCHANGE_ADJUSTMENT AS A_CURRENCY_EXCHANGE_ADJUSTMENT
  ,S.ERROR_CODE AS A_ERROR_CODE
  ,S.GATEWAY AS A_GATEWAY
  ,S.KIND AS A_KIND
  ,S.MESSAGE AS A_MESSAGE
  ,S.PAYMENT_DETAILS AS A_PAYMENT_DETAILS
  ,S.PROCESSED_AT AS A_PROCESSED_AT
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.STATUS AS A_STATUS
  --boolean
  ,S.TEST AS B_TEST
  --METRICS
  ,S.AMOUNT::decimal(15,2) AS M_AMOUNT   
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
  FROM
    source S  
  left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-07 13:14:02.238578 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:14:04.127547 (Thread-1): SQL status: SUCCESS 1 in 1.89 seconds
2022-03-07 13:14:04.130127 (Thread-1): finished collecting timing info
2022-03-07 13:14:04.130383 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: Close
2022-03-07 13:14:04.590739 (Thread-1): 10:14:04 | 18 of 28 OK created view model DBT_SHOPIFY.V_TRANSACTIONS_STG........ [SUCCESS 1 in 2.37s]
2022-03-07 13:14:04.591080 (Thread-1): Finished running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-07 13:14:04.591286 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-07 13:14:04.591801 (Thread-1): 10:14:04 | 19 of 28 START table model DBT_SHOPIFY.W_PRODUCTS_D.................. [RUN]
2022-03-07 13:14:04.592375 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-07 13:14:04.592598 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCTS_D
2022-03-07 13:14:04.596925 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-07 13:14:04.598948 (Thread-1): finished collecting timing info
2022-03-07 13:14:04.601865 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-07 13:14:04.602995 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-07 13:14:04.603156 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCTS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG AS C
      );
2022-03-07 13:14:04.603305 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:14:08.025621 (Thread-1): SQL status: SUCCESS 1 in 3.42 seconds
2022-03-07 13:14:08.028237 (Thread-1): finished collecting timing info
2022-03-07 13:14:08.028542 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: Close
2022-03-07 13:14:08.467407 (Thread-1): 10:14:08 | 19 of 28 OK created table model DBT_SHOPIFY.W_PRODUCTS_D............. [SUCCESS 1 in 3.87s]
2022-03-07 13:14:08.467761 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-07 13:14:08.467971 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:14:08.468168 (Thread-1): 10:14:08 | 20 of 28 SKIP relation DBT_SHOPIFY.V_ABANDONED_CHECKOUT_F_STG........ [SKIP]
2022-03-07 13:14:08.468485 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:14:08.468958 (Thread-1): Began running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-07 13:14:08.469452 (Thread-1): 10:14:08 | 21 of 28 START table model DBT_SHOPIFY.W_TRANSACTIONS_F.............. [RUN]
2022-03-07 13:14:08.469926 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-07 13:14:08.470121 (Thread-1): Compiling model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-07 13:14:08.473405 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-07 13:14:08.475517 (Thread-1): finished collecting timing info
2022-03-07 13:14:08.477677 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-07 13:14:08.478755 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-07 13:14:08.478898 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_TRANSACTIONS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_TRANSACTIONS_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG AS C
      );
2022-03-07 13:14:08.479048 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:14:10.819337 (Thread-1): SQL status: SUCCESS 1 in 2.34 seconds
2022-03-07 13:14:10.821309 (Thread-1): finished collecting timing info
2022-03-07 13:14:10.821573 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: Close
2022-03-07 13:14:11.276843 (Thread-1): 10:14:11 | 21 of 28 OK created table model DBT_SHOPIFY.W_TRANSACTIONS_F......... [SUCCESS 1 in 2.81s]
2022-03-07 13:14:11.277137 (Thread-1): Finished running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-07 13:14:11.277534 (Thread-1): Began running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-07 13:14:11.277867 (Thread-1): 10:14:11 | 22 of 28 START view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG........... [RUN]
2022-03-07 13:14:11.278209 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-07 13:14:11.278364 (Thread-1): Compiling model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-07 13:14:11.283392 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-07 13:14:11.283994 (Thread-1): finished collecting timing info
2022-03-07 13:14:11.285921 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-07 13:14:11.288673 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-07 13:14:11.288901 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_INVENTORY_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_ITEM"
),
inventory_level AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_LEVEL"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
products AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename AS 
(   
  SELECT   
  MD5(S.ID) AS K_INVENTORY_ITEM_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
  ,L.K_LOCATION_DLHK
  ,L.K_LOCATION_BK  
  ,S.ID AS K_INVENTORY_ITEM_BK
  ,S.COUNTRY_CODE_OF_ORIGIN AS A_COUNTRY_CODE_OF_ORIGIN
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.PROVINCE_CODE_OF_ORIGIN AS A_PROVINCE_CODE_OF_ORIGIN
  ,S.SKU AS A_SKU
  ,S.UPDATED_AT AS A_UPDATED_AT
  ,S.HARMONIZED_SYSTEM_CODE AS A_HARMONIZED_SYSTEM_CODE  
  --BOOLEAN
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TRACKED AS B_TRACKED
  --METRICS
  ,S.COST::decimal(15,2) AS M_COST 
  ,IL.AVAILABLE AS M_AVAIABLE  
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
  FROM
      source S
      left join inventory_level IL ON IL.INVENTORY_ITEM_ID = S.ID      
      left join locations L ON L.K_LOCATION_BK = IL.LOCATION_ID
      left join products P ON P.K_VARIANT_INVENTORY_ITEM_BK = S.ID 
)


SELECT * FROM rename
  );
2022-03-07 13:14:11.289048 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:14:13.062935 (Thread-1): SQL status: SUCCESS 1 in 1.77 seconds
2022-03-07 13:14:13.065671 (Thread-1): finished collecting timing info
2022-03-07 13:14:13.065962 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: Close
2022-03-07 13:14:13.526846 (Thread-1): 10:14:13 | 22 of 28 OK created view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG...... [SUCCESS 1 in 2.25s]
2022-03-07 13:14:13.527253 (Thread-1): Finished running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-07 13:14:13.527499 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-07 13:14:13.527782 (Thread-1): 10:14:13 | 23 of 28 START view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG......... [RUN]
2022-03-07 13:14:13.528149 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-07 13:14:13.528349 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-07 13:14:13.535956 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-07 13:14:13.536905 (Thread-1): finished collecting timing info
2022-03-07 13:14:13.539753 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-07 13:14:13.547604 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-07 13:14:13.547855 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM" AS A
),
products AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D AS A
),
taxes AS (
  SELECT 
      K_ORDER_LINE_ITEM_BK,
      AVG(M_RATE) AS M_RATE,
      SUM(M_TAX) AS M_TAX,
      SUM(M_TAX_PRIMARY) AS M_TAX_PRIMARY
    FROM 
      DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG AS A
    GROUP BY K_ORDER_LINE_ITEM_BK
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_LINE_ITEM_DLHK  
  ,MD5(ORDER_ID) AS K_ORDER_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
 --business keys
  ,O.PRODUCT_ID AS K_PRODUCT_BK
  ,O.VARIANT_ID AS K_VARIANT_BK
  
  ,O.ORDER_ID AS K_ORDER_BK
  ,O.ID AS K_ORDER_LINE_ITEM_BK
  --attribubtes
  ,O.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
  ,O.NAME AS A_NAME  
  ,O.PROPERTIES AS A_PROPERTIES
  ,O.SKU AS A_SKU
  ,O.TITLE AS A_TITLE  
  ,O.VARIANT_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
  ,O.VARIANT_TITLE AS A_VARIANT_TITLE
  ,O.VENDOR AS A_VENDOR
  --boolean
  ,O.GIFT_CARD AS B_GIFT_CARD
  ,O.PRODUCT_EXISTS AS B_PRODUCT_EXISTS
  ,O.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,O.TAXABLE AS B_TAXABLE
  --metrics
  ,O.FULFILLABLE_QUANTITY AS M_FULFILLABLE_QUANTITY
  ,O.GRAMS::DECIMAL(15,2) AS M_GRAMS
  ,O.QUANTITY::DECIMAL(15,2) AS M_QUANTITY
  ,M_RATE AS M_TAX_RATE
  ,COALESCE(T.M_TAX_PRIMARY,0)::DECIMAL(15,2) AS M_TAX_AMOUNT
  ,COALESCE(T.M_TAX,0)::DECIMAL(15,2) AS M_TAX_AMOUNT_PRIMARY

  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE_PRIMARY 
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT_PRIMARY 
  ,(O.QUANTITY * M_UNIT_PRICE)::DECIMAL(15,2) AS M_TOTAL_PRICE  
  ,(O.QUANTITY * M_UNIT_PRICE_PRIMARY)::DECIMAL(15,2) AS M_TOTAL_PRICE_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
FROM source O
  left join products P ON P.K_PRODUCT_BK = O.PRODUCT_ID AND CASE WHEN O.VARIANT_ID IS NOT NULL THEN O.VARIANT_ID = P.K_PRODUCT_VARIANT_BK ELSE 1=1 END
  left join taxes T ON T.K_ORDER_LINE_ITEM_BK = O.ID
)

SELECT * FROM rename
  );
2022-03-07 13:14:13.548056 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:14:15.221634 (Thread-1): SQL status: SUCCESS 1 in 1.67 seconds
2022-03-07 13:14:15.224374 (Thread-1): finished collecting timing info
2022-03-07 13:14:15.224757 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: Close
2022-03-07 13:14:15.665183 (Thread-1): 10:14:15 | 23 of 28 OK created view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG.... [SUCCESS 1 in 2.14s]
2022-03-07 13:14:15.665744 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-07 13:14:15.665981 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-07 13:14:15.666244 (Thread-1): 10:14:15 | 24 of 28 START view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG....... [RUN]
2022-03-07 13:14:15.667224 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-07 13:14:15.668023 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-07 13:14:15.675728 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-07 13:14:15.678192 (Thread-1): finished collecting timing info
2022-03-07 13:14:15.681182 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-07 13:14:15.684910 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-07 13:14:15.685160 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECT"
),
source_collection AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECTION"
),
product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename as (

SELECT
  MD5(S.ID) AS K_PRODUCT_COLLECT_DLHK
  ,MD5(CC.ID) AS K_COLLECTION_DLHK
  ,P.K_PRODUCT_DLHK  
  ,S.ID AS K_PRODUCT_COLLECT_BK
  ,CC.ID AS K_COLLECTION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,S.POSITION AS A_POSITION
  ,S.SORT_ORDER AS A_SORT_ORDER  
  ,S.CREATED_AT AS A_CREATED_AT_DTS
  ,S.UPDATED_AT AS A_UPDATED_AT_DTS
  ,CC.PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,CC.BODY_HTML AS A_BODY_HTML
  ,CC.TITLE AS A_TITLE
  ,CC.HANDLE AS A_HANDLE
  ,CC.PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE  
  ,CC.COLLECTION_TYPE AS A_COLLECTION_TYPE  
  --metrics
  ,CC.PRODUCTS_COUNT AS M_PRODUCTS_COUNT
  --metadata (MD)
  ,S.__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
FROM
    source S
    LEFT JOIN source_collection CC ON CC.ID = S.COLLECTION_ID
    LEFT JOIN product P ON P.K_PRODUCT_BK = S.PRODUCT_ID
)

SELECT * FROM rename
  );
2022-03-07 13:14:15.685350 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:14:17.586487 (Thread-1): SQL status: SUCCESS 1 in 1.90 seconds
2022-03-07 13:14:17.589877 (Thread-1): finished collecting timing info
2022-03-07 13:14:17.590260 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: Close
2022-03-07 13:14:18.039300 (Thread-1): 10:14:18 | 24 of 28 OK created view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG.. [SUCCESS 1 in 2.37s]
2022-03-07 13:14:18.040008 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-07 13:14:18.040562 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-07 13:14:18.041245 (Thread-1): 10:14:18 | 25 of 28 SKIP relation DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F............ [SKIP]
2022-03-07 13:14:18.041876 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-07 13:14:18.042437 (Thread-1): Began running node model.snowflake_aicd.W_INVENTORY_F
2022-03-07 13:14:18.043144 (Thread-1): 10:14:18 | 26 of 28 START table model DBT_SHOPIFY.W_INVENTORY_F................. [RUN]
2022-03-07 13:14:18.043743 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-07 13:14:18.044031 (Thread-1): Compiling model.snowflake_aicd.W_INVENTORY_F
2022-03-07 13:14:18.049439 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-07 13:14:18.051584 (Thread-1): finished collecting timing info
2022-03-07 13:14:18.054686 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-07 13:14:18.055753 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-07 13:14:18.055931 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_INVENTORY_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_INVENTORY_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG AS C
      );
2022-03-07 13:14:18.056084 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:14:21.290012 (Thread-1): SQL status: SUCCESS 1 in 3.23 seconds
2022-03-07 13:14:21.292632 (Thread-1): finished collecting timing info
2022-03-07 13:14:21.292916 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: Close
2022-03-07 13:14:21.745866 (Thread-1): 10:14:21 | 26 of 28 OK created table model DBT_SHOPIFY.W_INVENTORY_F............ [SUCCESS 1 in 3.70s]
2022-03-07 13:14:21.746503 (Thread-1): Finished running node model.snowflake_aicd.W_INVENTORY_F
2022-03-07 13:14:21.746806 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-07 13:14:21.747150 (Thread-1): 10:14:21 | 27 of 28 START table model DBT_SHOPIFY.W_ORDERS_F.................... [RUN]
2022-03-07 13:14:21.747585 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-07 13:14:21.747835 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-07 13:14:21.755049 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-07 13:14:21.755840 (Thread-1): finished collecting timing info
2022-03-07 13:14:21.758264 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-07 13:14:21.768265 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-07 13:14:21.768538 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ORDERS_F  as
      (

SELECT
  O.K_ORDER_DLHK AS K_ORDER_DLHK
  ,OLI.K_ORDER_LINE_ITEM_DLHK AS K_ORDER_LINE_ITEM_DLHK
  ,O.K_CUSTOMER_DLHK AS K_CUSTOMER_DLHK
  ,O.K_LOCATION_DLHK AS K_LOCATION_DLHK
  ,O.K_BILLING_ADDRESS_DLHK AS K_BILLING_ADDRESS_DLHK
  ,O.K_SHIPPING_ADDRESS_DLHK AS K_SHIPPING_ADDRESS_DLHK
  ,OLI.K_PRODUCT_VARIATION_DLHK AS K_ITEM_PRODUCT_VARIATION_DLHK
  ,OLI.K_PRODUCT_BK AS K_ITEM_PRODUCT_BK
  ,OLI.K_VARIANT_BK AS K_ITEM_VARIANT_BK
  ,OLI.K_ORDER_BK AS K_ITEM_ORDER_BK
  ,O.K_ORDER_BK AS K_ORDER_BK
  ,OLI.K_ORDER_LINE_ITEM_BK AS K_ITEM_ORDER_LINE_ITEM_BK
  ,O.K_APP_BK AS K_HEADER_APP_BK
  
  ,O.K_CUSTOMER_BK AS K_CUSTOMER_BK
  ,O.K_DEVICE_BK AS K_DEVICE_BK
  ,O.K_LOCATION_BK AS K_LOCATION_BK
  ,O.K_SOURCE_ENTIFIER_BK AS K_SOURCE_ENTIFIER_BK
  ,O.A_BROWSER_IP AS A_HEADER_BROWSER_IP
  ,O.A_CANCELLED_AT_DTS AS A_HEADER_CANCELLED_AT_DTS
  ,O.A_CANCEL_REASON AS A_HEADER_CANCEL_REASON
  ,O.A_CART_TOKEN AS A_HEADER_CART_TOKEN
  ,O.A_CHECKOUT_TOKEN AS A_HEADER_CHECKOUT_TOKEN
  ,O.A_CLIENT_DETAILS AS A_HEADER_CLIENT_DETAILS
  ,O.A_CLOSED_AT_DTS AS A_HEADER_CLOSED_AT_DTS
  ,O.A_CREATED_AT_DTS AS A_HEADER_CREATED_AT_DTS
  ,O.A_CURRENCY AS A_HEADER_CURRENCY
  ,O.A_PRESENTMENT_CURRENCY AS A_HEADER_PRESENTMENT_CURRENCY
  ,O.A_CUSTOMER_LOCALE AS A_HEADER_CUSTOMER_LOCALE
  ,O.A_EMAIL AS A_HEADER_EMAIL
  ,O.A_FINANCIAL_STATUS AS A_HEADER_FINANCIAL_STATUS
  ,O.A_FULFILLMENT_STATUS AS A_HEADER_FULFILLMENT_STATUS
  ,O.A_LANDING_SITE_BASE_URL AS A_HEADER_LANDING_SITE_BASE_URL
  ,O.A_LANDING_SITE_REF AS A_HEADER_LANDING_SITE_REF
  ,O.A_NAME AS A_HEADER_NAME
  ,O.A_NOTE AS A_HEADER_NOTE
  ,O.A_NOTE_ATTRIBUTES AS A_HEADER_NOTE_ATTRIBUTES
  ,O.A_PAYMENT_GATEWAY_NAMES AS A_HEADER_PAYMENT_GATEWAY_NAMES
  ,O.A_PROCESSED_AT_DTS AS A_HEADER_PROCESSED_AT_DTS
  ,O.A_PROCESSING_METHOD AS A_HEADER_PROCESSING_METHOD
  ,O.A_REFERENCE AS A_HEADER_REFERENCE
  ,O.A_REFERRING_SITE AS A_HEADER_REFERRING_SITE
  ,O.A_SOURCE_NAME AS A_HEADER_SOURCE_NAME
  ,O.A_SOURCE_URL AS A_HEADER_SOURCE_URL
  ,O.A_ORDER_NUMBER AS A_HEADER_ORDER_NUMBER
  ,O.A_POSION_NUMBER AS A_HEADER_POSION_NUMBER
  ,O.A_UPDATED_AT_DTS AS A_HEADER_UPDATED_AT_DTS
  ,O.B_BUYER_ACCEPTS_MARKETING AS B_HEADER_BUYER_ACCEPTS_MARKETING
  ,O.B_CONFIRMED AS B_HEADER_CONFIRMED
  ,O.B_TAXES_INCLUDED  AS B_HEADER_TAXES_INCLUDED   
  ,OLI.A_FULFILLMENT_SERVICE AS A_ITEM_FULFILLMENT_SERVICE
  ,OLI.A_FULFILLMENT_STATUS AS A_ITEM_FULFILLMENT_STATUS    
  ,OLI.A_VARIANT_INVENTORY_MANAGEMENT AS A_ITEM_VARIANT_INVENTORY_MANAGEMENT  
  
  ,OLI.B_GIFT_CARD AS B_ITEM_GIFT_CARD
  ,OLI.B_PRODUCT_EXISTS AS B_ITEM_PRODUCT_EXISTS
  ,OLI.B_REQUIRES_SHIPPING AS B_ITEM_REQUIRES_SHIPPING
  ,OLI.B_TAXABLE AS B_ITEM_TAXABLE
  ,OLI.M_FULFILLABLE_QUANTITY AS M_ITEM_FULFILLABLE_QUANTITY
  ,OLI.M_GRAMS AS M_ITEM_GRAMS
  ,OLI.M_QUANTITY AS M_ITEM_QUANTITY
  ,OLI.M_UNIT_PRICE AS M_ITEM_UNIT_PRICE
  ,OLI.M_UNIT_PRICE_PRIMARY AS M_ITEM_UNIT_PRICE_PRIMARY
  ,OLI.M_TOTAL_PRICE AS M_ITEM_TOTAL_PRICE
  ,OLI.M_TOTAL_PRICE_PRIMARY AS M_ITEM_TOTAL_PRICE_PRIMARY
  ,OLI.M_TOTAL_DISCOUNT AS M_ITEM_TOTAL_DISCOUNT
  ,OLI.M_TOTAL_DISCOUNT_PRIMARY AS M_ITEM_TOTAL_DISCOUNT_PRIMARY
  ,OLI.M_TAX_AMOUNT AS M_TAX_AMOUNT
  ,OLI.M_TAX_AMOUNT_PRIMARY AS M_TAX_AMOUNT_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_TIP_RECEIVED * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_TIP_AMOUNT_PRIMARY  
  --,ROUND(DIV0((O.M_TOTAL_DISCOUNTS_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_HEADER_DISCOUNT
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE * OLI.M_TOTAL_PRICE),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE



   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'fb42205c-8a97-4bf8-9b21-5630de629cdc' AS MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG OLI ON OLI.K_ORDER_DLHK = O.K_ORDER_DLHK
      );
2022-03-07 13:14:21.768741 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:14:24.842990 (Thread-1): SQL status: SUCCESS 1 in 3.07 seconds
2022-03-07 13:14:24.846087 (Thread-1): finished collecting timing info
2022-03-07 13:14:24.846422 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-07 13:14:25.307178 (Thread-1): 10:14:25 | 27 of 28 OK created table model DBT_SHOPIFY.W_ORDERS_F............... [SUCCESS 1 in 3.56s]
2022-03-07 13:14:25.307615 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-07 13:14:25.307825 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-07 13:14:25.308072 (Thread-1): 10:14:25 | 28 of 28 START table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F........ [RUN]
2022-03-07 13:14:25.308516 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-07 13:14:25.308763 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-07 13:14:25.312624 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-07 13:14:25.314561 (Thread-1): finished collecting timing info
2022-03-07 13:14:25.316557 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-07 13:14:25.317645 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-07 13:14:25.317834 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCT_COLLECTION_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG AS C
      );
2022-03-07 13:14:25.317963 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:14:28.191820 (Thread-1): SQL status: SUCCESS 1 in 2.87 seconds
2022-03-07 13:14:28.194388 (Thread-1): finished collecting timing info
2022-03-07 13:14:28.194686 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: Close
2022-03-07 13:14:28.644896 (Thread-1): 10:14:28 | 28 of 28 OK created table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F... [SUCCESS 1 in 3.34s]
2022-03-07 13:14:28.645320 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-07 13:14:28.647470 (MainThread): Acquiring new snowflake connection "master".
2022-03-07 13:14:28.648283 (MainThread): 10:14:28 | 
2022-03-07 13:14:28.648586 (MainThread): 10:14:28 | Finished running 18 view models, 10 table models in 74.37s.
2022-03-07 13:14:28.648842 (MainThread): Connection 'master' was properly closed.
2022-03-07 13:14:28.648998 (MainThread): Connection 'model.snowflake_aicd.W_PRODUCT_COLLECTION_F' was properly closed.
2022-03-07 13:14:28.660615 (MainThread): 
2022-03-07 13:14:28.660917 (MainThread): Completed with 1 error and 0 warnings:
2022-03-07 13:14:28.661325 (MainThread): 
2022-03-07 13:14:28.661617 (MainThread): Database Error in model V_ABANDONED_CHECKOUT_LINE_ITEM_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_LINE_ITEM_STG.sql)
2022-03-07 13:14:28.661805 (MainThread):   001003 (42000): SQL compilation error:
2022-03-07 13:14:28.661951 (MainThread):   syntax error line 14 at position 2 unexpected ','.
2022-03-07 13:14:28.662094 (MainThread):   compiled SQL at target/run/snowflake_aicd/models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_LINE_ITEM_STG.sql
2022-03-07 13:14:28.662306 (MainThread): 
Done. PASS=25 WARN=0 ERROR=1 SKIP=2 TOTAL=28
2022-03-07 13:14:28.662532 (MainThread): Flushing usage events
2022-03-07 13:15:22.136514 (MainThread): Running with dbt=0.21.1
2022-03-07 13:15:22.652514 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-07 13:15:22.654091 (MainThread): Tracking: do not track
2022-03-07 13:15:22.664283 (MainThread): Partial parsing not enabled
2022-03-07 13:15:22.683553 (MainThread): Parsing macros/common.sql
2022-03-07 13:15:22.686524 (MainThread): Parsing macros/catalog.sql
2022-03-07 13:15:22.688243 (MainThread): Parsing macros/adapters.sql
2022-03-07 13:15:22.719256 (MainThread): Parsing macros/materializations/merge.sql
2022-03-07 13:15:22.722287 (MainThread): Parsing macros/materializations/seed.sql
2022-03-07 13:15:22.726152 (MainThread): Parsing macros/materializations/view.sql
2022-03-07 13:15:22.727262 (MainThread): Parsing macros/materializations/table.sql
2022-03-07 13:15:22.729720 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-07 13:15:22.736814 (MainThread): Parsing macros/core.sql
2022-03-07 13:15:22.739828 (MainThread): Parsing macros/materializations/test.sql
2022-03-07 13:15:22.745205 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-07 13:15:22.752841 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-07 13:15:22.754077 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-07 13:15:22.768397 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-07 13:15:22.796982 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-07 13:15:22.816023 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-07 13:15:22.817463 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-07 13:15:22.826045 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-07 13:15:22.843173 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-07 13:15:22.854885 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-07 13:15:22.861685 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-07 13:15:22.868125 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-07 13:15:22.871263 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-07 13:15:22.872389 (MainThread): Parsing macros/etc/query.sql
2022-03-07 13:15:22.873098 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-07 13:15:22.874251 (MainThread): Parsing macros/etc/datetime.sql
2022-03-07 13:15:22.880990 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-07 13:15:22.882515 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-07 13:15:22.884373 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-07 13:15:22.885542 (MainThread): Parsing macros/adapters/common.sql
2022-03-07 13:15:22.931455 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-07 13:15:22.932742 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-07 13:15:22.933622 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-07 13:15:22.934773 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-07 13:15:23.084574 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:15:23.093108 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.096562 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-07 13:15:23.099445 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.100190 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-07 13:15:23.102764 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.103469 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:15:23.106056 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.106991 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:15:23.111918 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.112741 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:15:23.116437 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.117298 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-07 13:15:23.120411 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.121122 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-07 13:15:23.123822 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.124606 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-07 13:15:23.127722 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.128492 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-07 13:15:23.131239 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.131973 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:15:23.134452 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.135176 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-07 13:15:23.139664 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.140655 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-07 13:15:23.143936 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.144669 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-07 13:15:23.149337 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.150086 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-07 13:15:23.155435 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.156470 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-07 13:15:23.159870 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.160734 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-07 13:15:23.164135 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.164871 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-07 13:15:23.169687 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.170577 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-07 13:15:23.209949 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.210875 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-07 13:15:23.213610 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.214467 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-07 13:15:23.216746 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.217477 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-07 13:15:23.219876 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.220588 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-07 13:15:23.222772 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.223466 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:15:23.225926 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.226834 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-07 13:15:23.229824 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.230764 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:15:23.233299 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.234030 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-07 13:15:23.236260 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.236964 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-07 13:15:23.239612 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.261548 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.263105 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.264490 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.265656 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.266812 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.268009 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.269412 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.270624 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:15:23.309789 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-07 13:15:23.310866 (MainThread): Found 28 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 24 sources, 0 exposures
2022-03-07 13:15:23.313302 (MainThread): 
2022-03-07 13:15:23.313609 (MainThread): Acquiring new snowflake connection "master".
2022-03-07 13:15:23.315216 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-07 13:15:23.325291 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-07 13:15:23.325616 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-07 13:15:23.325731 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-07 13:15:25.238591 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 1.91 seconds
2022-03-07 13:15:25.250347 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-07 13:15:25.729539 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-07 13:15:25.743117 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-07 13:15:25.743539 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-07 13:15:25.743918 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-07 13:15:27.308024 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 27 in 1.56 seconds
2022-03-07 13:15:27.317133 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-07 13:15:27.777949 (MainThread): 10:15:27 | Concurrency: 1 threads (target='dev')
2022-03-07 13:15:27.778678 (MainThread): 10:15:27 | 
2022-03-07 13:15:27.784085 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:15:27.785258 (Thread-1): 10:15:27 | 1 of 28 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG [RUN]
2022-03-07 13:15:27.786556 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:15:27.787088 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:15:27.794386 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"
2022-03-07 13:15:27.795035 (Thread-1): finished collecting timing info
2022-03-07 13:15:27.823212 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"
2022-03-07 13:15:27.826561 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:15:27.826722 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT_LINE_ITEM"
),
rename AS 
(   
  SELECT 
  --DLHK
  ,MD5(S.ID) AS K_ABANDONED_CHECKOUT_ITEM_DLHK
  ,MD5(S.CHECKOUT_ID) AS K_ABANDONED_CHECKOUT_DLHK
  
  ,MD5(CONCAT(S.PRODUCT_ID,'-',COALESCE(S.VARIANT_ID,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_ABANDONED_CHECKOUT_ITEM_BK
  ,S.CHECKOUT_ID AS K_ABANDONED_CHECKOUT_BK
  ,S.DESTINATION_LOCATION_ID AS K_DESTINATION_LOCATION_BK    
  ,S.ORIGIN_LOCATION_ID AS K_ORIGIN_LOCATION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  ,S.VARIANT_ID AS K_VARIANT_BK
  --ATTRIBUTES
  ,S.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,S.KEY AS A_KEY
  ,S.PRESENTMENT_TITLE AS A_PRESENTMENT_TITLE
  ,S.PRESENTMENT_VARIANT_TITLE AS A_PRESENTMENT_VARIANT_TITLE
  ,S.SKU AS A_SKU
  ,S.TITLE AS A_TITLE
  ,S.VARIANT_TITLE AS A_VARIANT_TITLE
  ,S.VENDOR AS A_VENDOR
  --BOOLEAN
  ,S.GIFT_CARD AS B_GIFT_CARD
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TAXABLE AS B_TAXABLE
  --METRICS
  ,S.COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,S.GRAMS AS M_GRAMS
  ,S.LINE_PRICE AS M_LINE_PRICE
  ,S.PRICE AS M_PRICE
  ,S.QUANTITY AS M_QUANTITY
  ,S.VARIANT_PRICE AS M_VARIANT_PRICE
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
  FROM
      source S
)


SELECT * FROM rename
  );
2022-03-07 13:15:27.826878 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:15:29.734751 (Thread-1): Snowflake query id: 01a2c45b-0601-418f-000b-358300f4f262
2022-03-07 13:15:29.734977 (Thread-1): Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 14 at position 2 unexpected ','.
2022-03-07 13:15:29.735224 (Thread-1): finished collecting timing info
2022-03-07 13:15:29.735409 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG: Close
2022-03-07 13:15:30.210344 (Thread-1): Database Error in model V_ABANDONED_CHECKOUT_LINE_ITEM_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_LINE_ITEM_STG.sql)
  001003 (42000): SQL compilation error:
  syntax error line 14 at position 2 unexpected ','.
  compiled SQL at target/run/snowflake_aicd/models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_LINE_ITEM_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001003 (42000): SQL compilation error:
syntax error line 14 at position 2 unexpected ','.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_ABANDONED_CHECKOUT_LINE_ITEM_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_LINE_ITEM_STG.sql)
  001003 (42000): SQL compilation error:
  syntax error line 14 at position 2 unexpected ','.
  compiled SQL at target/run/snowflake_aicd/models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_LINE_ITEM_STG.sql
2022-03-07 13:15:30.241127 (Thread-1): 10:15:30 | 1 of 28 ERROR creating view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG [ERROR in 2.45s]
2022-03-07 13:15:30.241493 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:15:30.241792 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-07 13:15:30.242125 (Thread-1): 10:15:30 | 2 of 28 START view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG.......... [RUN]
2022-03-07 13:15:30.242723 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-07 13:15:30.242970 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-07 13:15:30.247701 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-07 13:15:30.248721 (Thread-1): finished collecting timing info
2022-03-07 13:15:30.251572 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-07 13:15:30.254434 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-07 13:15:30.254659 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER_ADDRESS"
),
rename AS 
(   
SELECT 
    MD5(ID) AS K_CUSTOMER_ADDRESS_DLHK
    ,ID AS K_CUSTOMER_ADDRESS_BK
    ,MD5(CONCAT(
        COALESCE(ADDRESS1,'00'),
        COALESCE(ADDRESS2,'00'),
        COALESCE(CITY,'00'),
        COALESCE(COUNTRY,'00'),
        COALESCE(COUNTRY_CODE,'00'),
        COALESCE(FIRST_NAME,'00'),
        COALESCE(LAST_NAME,'00'),
        COALESCE(PROVINCE,'00'),
        COALESCE(PROVINCE_CODE,'00'),
        COALESCE(ZIP,'00')
    )) AS K_ADDRESS_DLHK
    ,CUSTOMER_ID AS K_CUSTOMER_BK
    ,ADDRESS1 AS A_ADDRESS1
    ,ADDRESS2 AS A_ADDRESS2
    ,CITY AS A_CITY
    ,COMPANY AS A_COMPANY
    ,COUNTRY AS A_COUNTRY
    ,COUNTRY_CODE AS A_COUNTRY_CODE
    ,COUNTRY_NAME AS A_COUNTRY_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,PHONE AS A_PHONE
    ,PROVINCE AS A_PROVINCE
    ,PROVINCE_CODE AS A_PROVINCE_CODE
    ,ZIP AS A_ZIP
    ,IS_DEFAULT AS B_IS_DEFAULT  
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-07 13:15:30.254824 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:15:31.937577 (Thread-1): SQL status: SUCCESS 1 in 1.68 seconds
2022-03-07 13:15:31.959459 (Thread-1): finished collecting timing info
2022-03-07 13:15:31.959710 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: Close
2022-03-07 13:15:32.431847 (Thread-1): 10:15:32 | 2 of 28 OK created view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG..... [SUCCESS 1 in 2.19s]
2022-03-07 13:15:32.432889 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-07 13:15:32.433545 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:15:32.437443 (Thread-1): 10:15:32 | 3 of 28 START view model DBT_SHOPIFY.V_CUSTOMER_STG.................. [RUN]
2022-03-07 13:15:32.440810 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:15:32.441459 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:15:32.447935 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-07 13:15:32.448770 (Thread-1): finished collecting timing info
2022-03-07 13:15:32.451098 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-07 13:15:32.454904 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:15:32.455106 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER"
),
rename AS 
(   
SELECT 
    --KEYS
    MD5(ID) AS K_CUSTOMER_DLHK    
    --BUSINESS KEYS
    ,ID AS K_CUSTOMER_BK
    ,LAST_ORDER_ID AS K_LAST_ORDER_BK
    ,MULTIPASS_IDENTIFIER AS K_MULTIPASS_BKENTIFIER
    --ATTRIBUTES
    ,ACCEPTS_MARKETING_UPDATED_AT AS A_ACCEPTS_MARKETING_UPDATED_AT_DTS
    ,CREATED_AT AS A_CREATED_AT_DTS
    ,CURRENCY AS A_CURRENCY
    ,EMAIL AS A_EMAIL
    ,
    (COALESCE(FIRST_NAME,'') || ' ' || COALESCE(LAST_NAME,''))
 AS A_FULL_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,LAST_ORDER_NAME AS A_LAST_ORDER_NAME
    ,MARKETING_OPT_IN_LEVEL AS A_MARKETING_OPT_IN_LEVEL
    ,NOTE AS A_NOTE
    ,PHONE AS A_PHONE
    ,SMS_MARKETING_CONSENT AS A_SMS_MARKETING_CONSENT
    ,STATE AS A_STATE
    ,TAGS AS A_TAGS
    ,TAX_EXEMPTIONS AS A_TAX_EXEMPTIONS
    ,TOTAL_SPENT AS A_TOTAL_SPENT
    ,UPDATED_AT AS A_UPDATED_AT
    --BOOLEAN
    ,ACCEPTS_MARKETING AS B_ACCEPTS_MARKETING
    ,TAX_EXEMPT AS B_TAX_EXEMPT
    ,VERIFIED_EMAIL AS B_VERIFIED_EMAIL
    --METRICS
    ,ORDERS_COUNT AS M_ORDERS_COUNT
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-07 13:15:32.455307 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:15:34.388811 (Thread-1): SQL status: SUCCESS 1 in 1.93 seconds
2022-03-07 13:15:34.395501 (Thread-1): finished collecting timing info
2022-03-07 13:15:34.396396 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-07 13:15:34.870846 (Thread-1): 10:15:34 | 3 of 28 OK created view model DBT_SHOPIFY.V_CUSTOMER_STG............. [SUCCESS 1 in 2.43s]
2022-03-07 13:15:34.871862 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:15:34.872888 (Thread-1): Began running node model.snowflake_aicd.V_DATE_STG
2022-03-07 13:15:34.877633 (Thread-1): 10:15:34 | 4 of 28 START view model DBT_SHOPIFY.V_DATE_STG...................... [RUN]
2022-03-07 13:15:34.880165 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-07 13:15:34.882276 (Thread-1): Compiling model.snowflake_aicd.V_DATE_STG
2022-03-07 13:15:34.890496 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-07 13:15:34.891698 (Thread-1): finished collecting timing info
2022-03-07 13:15:34.894862 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-07 13:15:34.928065 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-07 13:15:34.928329 (Thread-1): On model.snowflake_aicd.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-07 13:15:34.928567 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:15:36.804210 (Thread-1): SQL status: SUCCESS 1 in 1.88 seconds
2022-03-07 13:15:36.814885 (Thread-1): finished collecting timing info
2022-03-07 13:15:36.816269 (Thread-1): On model.snowflake_aicd.V_DATE_STG: Close
2022-03-07 13:15:37.272803 (Thread-1): 10:15:37 | 4 of 28 OK created view model DBT_SHOPIFY.V_DATE_STG................. [SUCCESS 1 in 2.39s]
2022-03-07 13:15:37.275323 (Thread-1): Finished running node model.snowflake_aicd.V_DATE_STG
2022-03-07 13:15:37.278512 (Thread-1): Began running node model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:15:37.283135 (Thread-1): 10:15:37 | 5 of 28 START view model DBT_SHOPIFY.V_LOCATION_STG.................. [RUN]
2022-03-07 13:15:37.285372 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:15:37.287065 (Thread-1): Compiling model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:15:37.293085 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-07 13:15:37.294410 (Thread-1): finished collecting timing info
2022-03-07 13:15:37.297024 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-07 13:15:37.299902 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:15:37.300097 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-07 13:15:37.300278 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:15:38.972659 (Thread-1): SQL status: SUCCESS 1 in 1.67 seconds
2022-03-07 13:15:38.982697 (Thread-1): finished collecting timing info
2022-03-07 13:15:38.984246 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-07 13:15:39.453260 (Thread-1): 10:15:39 | 5 of 28 OK created view model DBT_SHOPIFY.V_LOCATION_STG............. [SUCCESS 1 in 2.17s]
2022-03-07 13:15:39.454470 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:15:39.455380 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-07 13:15:39.458699 (Thread-1): 10:15:39 | 6 of 28 START view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG......... [RUN]
2022-03-07 13:15:39.459341 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-07 13:15:39.459550 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-07 13:15:39.466561 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-07 13:15:39.467431 (Thread-1): finished collecting timing info
2022-03-07 13:15:39.471174 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-07 13:15:39.476256 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-07 13:15:39.476506 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_ADJUSTMENT" AS A
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_ADJUSTMENT_DLHK
  --BK
  ,ID AS K_ORDER_ADJUSTMENT_BK
  ,ORDER_ID AS K_ORDER_BK
  ,REFUND_ID AS K_REFUND_BK
  --ATTRIBUTE
  ,KIND AS A_KIND
  ,REASON AS A_REASON
  --METRIC
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT_PRIMARY
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-07 13:15:39.476751 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:15:41.321630 (Thread-1): SQL status: SUCCESS 1 in 1.84 seconds
2022-03-07 13:15:41.327233 (Thread-1): finished collecting timing info
2022-03-07 13:15:41.327981 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: Close
2022-03-07 13:15:41.786811 (Thread-1): 10:15:41 | 6 of 28 OK created view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG.... [SUCCESS 1 in 2.33s]
2022-03-07 13:15:41.788021 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-07 13:15:41.788810 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-07 13:15:41.790708 (Thread-1): 10:15:41 | 7 of 28 START view model DBT_SHOPIFY.V_ORDERS_HEADER_STG............. [RUN]
2022-03-07 13:15:41.792718 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-07 13:15:41.793642 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-07 13:15:41.809992 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-07 13:15:41.811204 (Thread-1): finished collecting timing info
2022-03-07 13:15:41.814372 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-07 13:15:41.830668 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-07 13:15:41.831085 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDERS" AS A
),
rename AS 
(
SELECT
    MD5(O.ID) AS K_ORDER_DLHK    
    ,MD5(O.CUSTOMER_ID) AS K_CUSTOMER_DLHK
    ,MD5(O.LOCATION_ID) AS K_LOCATION_DLHK    
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
    --BUSINESS_KEYS
    ,O.APP_ID AS K_APP_BK
    ,O.ID AS K_ORDER_BK
    ,O.CUSTOMER_ID AS K_CUSTOMER_BK
    ,O.DEVICE_ID AS K_DEVICE_BK  
    ,O.LOCATION_ID AS K_LOCATION_BK
    ,O.SOURCE_IDENTIFIER AS K_SOURCE_ENTIFIER_BK
    --ATTRIBUTES
    ,O.BROWSER_IP AS A_BROWSER_IP
    ,O.CANCELLED_AT AS A_CANCELLED_AT_DTS
    ,O.CANCEL_REASON AS A_CANCEL_REASON
    ,O.CART_TOKEN AS A_CART_TOKEN
    ,O.CHECKOUT_TOKEN AS A_CHECKOUT_TOKEN
    ,O.CLIENT_DETAILS AS A_CLIENT_DETAILS
    ,O.CLOSED_AT AS A_CLOSED_AT_DTS
    ,O.CREATED_AT AS A_CREATED_AT_DTS
    ,O.CURRENCY AS A_CURRENCY
    ,O.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
    ,O.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
    ,O.EMAIL AS A_EMAIL
    ,O.FINANCIAL_STATUS AS A_FINANCIAL_STATUS
    ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
    ,O.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
    ,O.LANDING_SITE_REF AS A_LANDING_SITE_REF
    ,O.NAME AS A_NAME
    ,O.NOTE AS A_NOTE
    ,O.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES    
    ,O.PAYMENT_GATEWAY_NAMES AS A_PAYMENT_GATEWAY_NAMES    
    ,O.PROCESSED_AT AS A_PROCESSED_AT_DTS
    ,O.PROCESSING_METHOD AS A_PROCESSING_METHOD
    ,O.REFERENCE AS A_REFERENCE
    ,O.REFERRING_SITE AS A_REFERRING_SITE    
    ,O.SOURCE_NAME AS A_SOURCE_NAME
    ,O.SOURCE_URL AS A_SOURCE_URL    
    ,O.ORDER_NUMBER AS A_ORDER_NUMBER
    ,O.POSION_NUMBER AS A_POSION_NUMBER  
    ,O.UPDATED_AT AS A_UPDATED_AT_DTS
    --BOOLEAN
    ,O.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
    ,O.CONFIRMED AS B_CONFIRMED
    ,O.TAXES_INCLUDED AS B_TAXES_INCLUDED
    --METRICS
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE_PRIMARY 
    ,O.TOTAL_TIP_RECEIVED::DECIMAL(15,2) AS M_TOTAL_TIP_RECEIVED   
    ,O.TOTAL_WEIGHT::DECIMAL(15,2) AS M_TOTAL_WEIGHT
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
FROM source O
)

SELECT * FROM rename
  );
2022-03-07 13:15:41.831308 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:15:43.562695 (Thread-1): SQL status: SUCCESS 1 in 1.73 seconds
2022-03-07 13:15:43.570432 (Thread-1): finished collecting timing info
2022-03-07 13:15:43.571534 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: Close
2022-03-07 13:15:44.031574 (Thread-1): 10:15:44 | 7 of 28 OK created view model DBT_SHOPIFY.V_ORDERS_HEADER_STG........ [SUCCESS 1 in 2.24s]
2022-03-07 13:15:44.032604 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-07 13:15:44.033088 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-07 13:15:44.034390 (Thread-1): 10:15:44 | 8 of 28 START view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG.. [RUN]
2022-03-07 13:15:44.038766 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-07 13:15:44.040126 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-07 13:15:44.054733 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-07 13:15:44.056074 (Thread-1): finished collecting timing info
2022-03-07 13:15:44.059756 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-07 13:15:44.063308 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-07 13:15:44.063575 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM_TAX_LINE" AS A
),
rename AS 
(
SELECT
  CONCAT(COALESCE(ORDER_ID,'0000000000'),'-',COALESCE(ORDER_LINE_ID,'0000000000')) AS K_ORDER_LINE_ITEM_TAX_DLHK
  ,ORDER_ID AS K_ORDER_BK
  ,ORDER_LINE_ID AS K_ORDER_LINE_ITEM_BK
  ,TITLE AS A_TITLE
  ,CHANNEL_LIABLE AS B_CHANNEL_LIABLE
  ,RATE AS M_RATE
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-07 13:15:44.063807 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:15:45.931317 (Thread-1): SQL status: SUCCESS 1 in 1.87 seconds
2022-03-07 13:15:45.936441 (Thread-1): finished collecting timing info
2022-03-07 13:15:45.937271 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: Close
2022-03-07 13:15:46.387841 (Thread-1): 10:15:46 | 8 of 28 OK created view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG [SUCCESS 1 in 2.35s]
2022-03-07 13:15:46.388645 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-07 13:15:46.389577 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-07 13:15:46.390501 (Thread-1): 10:15:46 | 9 of 28 START view model DBT_SHOPIFY.V_PRODUCT_STG................... [RUN]
2022-03-07 13:15:46.391596 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-07 13:15:46.392206 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_STG
2022-03-07 13:15:46.403413 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-07 13:15:46.404694 (Thread-1): finished collecting timing info
2022-03-07 13:15:46.407153 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-07 13:15:46.409008 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-07 13:15:46.409163 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_DLHK
  ,ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE
  ,HANDLE AS A_HANDLE
  ,PRODUCT_TYPE AS A_PRODUCT_TYPE
  ,VENDOR AS A_VENDOR
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE
  ,STATUS AS A_STATUS
  ,TEMPLATE_SUFFIX AS A_TEMPLATE_SUFFIX   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-07 13:15:46.409304 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:15:48.090879 (Thread-1): SQL status: SUCCESS 1 in 1.68 seconds
2022-03-07 13:15:48.095424 (Thread-1): finished collecting timing info
2022-03-07 13:15:48.096225 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: Close
2022-03-07 13:15:48.561632 (Thread-1): 10:15:48 | 9 of 28 OK created view model DBT_SHOPIFY.V_PRODUCT_STG.............. [SUCCESS 1 in 2.17s]
2022-03-07 13:15:48.562531 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-07 13:15:48.564741 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-07 13:15:48.567531 (Thread-1): 10:15:48 | 10 of 28 START view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG.......... [RUN]
2022-03-07 13:15:48.568612 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-07 13:15:48.569285 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-07 13:15:48.579212 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-07 13:15:48.579886 (Thread-1): finished collecting timing info
2022-03-07 13:15:48.581476 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-07 13:15:48.584433 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-07 13:15:48.584595 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT_VARIANT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_VARIANT_DLHK
  ,MD5(PRODUCT_ID) AS K_PRODUCT_DLHK  
  --BUSINESS KEYS  
  ,ID AS K_PRODUCT_VARIANT_BK
  ,PRODUCT_ID AS K_PRODUCT_BK  
  ,INVENTORY_ITEM_ID AS K_INVENTORY_ITEM_BK
  ,IMAGE_ID AS K_IMAGE_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE  
  ,SKU AS A_SKU    
  ,FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,INVENTORY_MANAGEMENT AS A_INVENTORY_MANAGEMENT
  ,INVENTORY_POLICY AS A_INVENTORY_POLICY
  ,BARCODE AS A_BARCODE
  ,GRAMS AS A_GRAMS
  ,WEIGHT_UNIT AS A_WEIGHT_UNIT
  ,OPTION_1 AS A_OPTION_1
  ,OPTION_2 AS A_OPTION_2
  ,OPTION_3 AS A_OPTION_3
  ,TAX_CODE AS A_TAX_CODE  
  ,PRESENTMENT_PRICES AS A_PRESENTMENT_PRICES  
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  --BOOLEAN
  ,REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,TAXABLE AS B_TAXABLE
  --METRICS
  ,PRICE AS M_PRICE
  ,POSITION AS M_POSITION
  ,COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,INVENTORY_QUANTITY AS M_INVENTORY_QUANTITY
  ,INVENTORY_QUANTITY_ADJUSTMENT AS M_INVENTORY_QUANTITY_ADJUSTMENT
  ,WEIGHT AS M_WEIGHT
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-07 13:15:48.584751 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:15:50.399005 (Thread-1): SQL status: SUCCESS 1 in 1.81 seconds
2022-03-07 13:15:50.401813 (Thread-1): finished collecting timing info
2022-03-07 13:15:50.402139 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: Close
2022-03-07 13:15:50.857833 (Thread-1): 10:15:50 | 10 of 28 OK created view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG..... [SUCCESS 1 in 2.29s]
2022-03-07 13:15:50.858311 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-07 13:15:50.858798 (Thread-1): Began running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-07 13:15:50.859323 (Thread-1): 10:15:50 | 11 of 28 START view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG......... [RUN]
2022-03-07 13:15:50.859870 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-07 13:15:50.860199 (Thread-1): Compiling model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-07 13:15:50.867197 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-07 13:15:50.867731 (Thread-1): finished collecting timing info
2022-03-07 13:15:50.869619 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-07 13:15:50.873551 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-07 13:15:50.873788 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG  as (
    


WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND" AS A
),
refund_line as (
    SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND_LINE_ITEM" AS A
),
rename AS 
(
SELECT
  MD5(RL.ID) AS K_REFUND_LINE_DLHK
  ,MD5(R.ID) AS K_REFUND_DLHK
  ,R.ID AS K_REFUND_BK
  ,RL.ID AS K_REFUND_LINE_BK
  ,R.ORDER_ID AS K_ORDER_BK
  ,R.USER_ID AS K_USER_BK
  ,RL.LOCATION_ID AS K_LOCATION_BK
  ,RL.LINE_ITEM_ID AS K_ORDER_LINE_ITEM_BK
  ,R.NOTE AS A_NOTE
  ,R.RESTOCK AS B_RESTOCK
  ,RL.QUANTITY AS M_QUANTITY
  ,RL.RESTOCK_TYPE AS A_RESTOCK_TYPE
   
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL


  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
FROM source R
LEFT JOIN refund_line RL ON RL.REFUND_ID = R.ID
)

SELECT * FROM rename
  );
2022-03-07 13:15:50.873962 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:15:52.774859 (Thread-1): SQL status: SUCCESS 1 in 1.90 seconds
2022-03-07 13:15:52.778104 (Thread-1): finished collecting timing info
2022-03-07 13:15:52.778595 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: Close
2022-03-07 13:15:53.219136 (Thread-1): 10:15:53 | 11 of 28 OK created view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG.... [SUCCESS 1 in 2.36s]
2022-03-07 13:15:53.219374 (Thread-1): Finished running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-07 13:15:53.219519 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-07 13:15:53.219683 (Thread-1): 10:15:53 | 12 of 28 START table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D.......... [RUN]
2022-03-07 13:15:53.219893 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-07 13:15:53.220000 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-07 13:15:53.222406 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-07 13:15:53.223073 (Thread-1): finished collecting timing info
2022-03-07 13:15:53.239190 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-07 13:15:53.240234 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-07 13:15:53.240385 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG AS C
      );
2022-03-07 13:15:53.240518 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:15:55.787113 (Thread-1): SQL status: SUCCESS 1 in 2.55 seconds
2022-03-07 13:15:55.806091 (Thread-1): finished collecting timing info
2022-03-07 13:15:55.807424 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: Close
2022-03-07 13:15:56.259201 (Thread-1): 10:15:56 | 12 of 28 OK created table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D..... [SUCCESS 1 in 3.04s]
2022-03-07 13:15:56.260160 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-07 13:15:56.261087 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:15:56.262640 (Thread-1): 10:15:56 | 13 of 28 START table model DBT_SHOPIFY.W_CUSTOMERS_D................. [RUN]
2022-03-07 13:15:56.265170 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:15:56.265970 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:15:56.272618 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-07 13:15:56.273363 (Thread-1): finished collecting timing info
2022-03-07 13:15:56.275635 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-07 13:15:56.276728 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:15:56.276881 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG AS C
      );
2022-03-07 13:15:56.277022 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:15:59.201735 (Thread-1): SQL status: SUCCESS 1 in 2.92 seconds
2022-03-07 13:15:59.208740 (Thread-1): finished collecting timing info
2022-03-07 13:15:59.209446 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-07 13:15:59.675228 (Thread-1): 10:15:59 | 13 of 28 OK created table model DBT_SHOPIFY.W_CUSTOMERS_D............ [SUCCESS 1 in 3.41s]
2022-03-07 13:15:59.676217 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:15:59.679140 (Thread-1): Began running node model.snowflake_aicd.W_DATE_D
2022-03-07 13:15:59.681237 (Thread-1): 10:15:59 | 14 of 28 START table model DBT_SHOPIFY.W_DATE_D...................... [RUN]
2022-03-07 13:15:59.683721 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-07 13:15:59.684743 (Thread-1): Compiling model.snowflake_aicd.W_DATE_D
2022-03-07 13:15:59.693890 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-07 13:15:59.694591 (Thread-1): finished collecting timing info
2022-03-07 13:15:59.696706 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-07 13:15:59.700836 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-07 13:15:59.701001 (Thread-1): On model.snowflake_aicd.W_DATE_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_DATE_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_DATE_D  as
      (

SELECT 
	CAST(DATE_KEY AS NUMBER(9)) AS K_DATE_INTEGER_BK
	,CAST(DATE_COLUMN AS DATE) AS K_DATE_BK
	,CAST(FULL_DATE_DESC AS VARCHAR(64)) AS A_FULL_DATE_DESC
	,CAST(DAY_NUM_IN_WEEK AS NUMBER(1)) AS A_DAY_NUM_IN_WEEK
	,CAST(DAY_NUM_IN_MONTH AS NUMBER(2)) AS A_DAY_NUM_IN_MONTH
	,CAST(DAY_NUM_IN_YEAR AS NUMBER(3)) AS A_DAY_NUM_IN_YEAR
	,CAST(DAY_NAME AS VARCHAR(10)) AS A_DAY_NAME
	,CAST(DAY_ABBREV AS VARCHAR(3)) AS A_DAY_ABBREV
	,CAST(WEEKDAY_IND AS VARCHAR(64)) AS A_WEEKDAY_IND
	,CAST(US_HOLIDAY_IND AS VARCHAR(64)) AS A_US_HOLIDAY_IND
	,CAST(COMPANY_HOLIDAY_IND AS VARCHAR(64)) AS A_COMPANY_HOLIDAY_IND
	,CAST(MONTH_END_IND AS VARCHAR(64)) AS A_MONTH_END_IND
	,CAST(WEEK_BEGIN_DATE_NKEY AS NUMBER(9)) AS A_WEEK_BEGIN_DATE_NKEY
	,CAST(WEEK_BEGIN_DATE AS DATE) AS A_WEEK_BEGIN_DATE
	,CAST(WEEK_END_DATE_NKEY AS NUMBER(9)) AS A_WEEK_END_DATE_NKEY
	,CAST(WEEK_END_DATE AS DATE) AS A_WEEK_END_DATE
	,CAST(WEEK_NUM_IN_YEAR AS NUMBER(9)) AS A_WEEK_NUM_IN_YEAR
	,CAST(MONTH_NAME AS VARCHAR(10)) AS A_MONTH_NAME
	,CAST(MONTH_ABBREV AS VARCHAR(3)) AS A_MONTH_ABBREV
	,CAST(MONTH_NUM_IN_YEAR AS NUMBER(2)) AS A_MONTH_NUM_IN_YEAR
	,CAST(YEARMONTH AS VARCHAR(10)) AS A_YEARMONTH
	,CAST(CURRENT_QUARTER AS NUMBER(1)) AS A_QUARTER
	,CAST(YEARQUARTER AS VARCHAR(10)) AS A_YEARQUARTER
	,CAST(CURRENT_YEAR AS NUMBER(5)) AS A_YEAR
	,CAST(FISCAL_WEEK_NUM AS NUMBER(2)) AS A_FISCAL_WEEK_NUM
	,CAST(FISCAL_MONTH_NUM AS NUMBER(2)) AS A_FISCAL_MONTH_NUM
	,CAST(FISCAL_YEARMONTH AS VARCHAR(10)) AS A_FISCAL_YEARMONTH
	,CAST(FISCAL_QUARTER AS NUMBER(1)) AS A_FISCAL_QUARTER
	,CAST(FISCAL_YEARQUARTER AS VARCHAR(10)) AS A_FISCAL_YEARQUARTER
	,CAST(FISCAL_HALFYEAR AS NUMBER(1)) AS A_FISCAL_HALFYEAR
	,CAST(FISCAL_YEAR AS NUMBER(5)) AS A_FISCAL_YEAR
	,CAST(SQL_TIMESTAMP AS TIMESTAMP_NTZ) AS A_SQL_TIMESTAMP_DTS
	,CAST(CURRENT_ROW_IND AS CHAR(1)) AS A_CURRENT_ROW_IND
	,CAST(EFFECTIVE_DATE AS DATE) AS A_EFFECTIVE_DATE
	,CAST(EXPIRA_DATE AS DATE) AS A_EXPIRATION_DATE
FROM
DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG
      );
2022-03-07 13:15:59.701145 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:16:02.840246 (Thread-1): SQL status: SUCCESS 1 in 3.14 seconds
2022-03-07 13:16:02.847421 (Thread-1): finished collecting timing info
2022-03-07 13:16:02.848034 (Thread-1): On model.snowflake_aicd.W_DATE_D: Close
2022-03-07 13:16:03.317933 (Thread-1): 10:16:03 | 14 of 28 OK created table model DBT_SHOPIFY.W_DATE_D................. [SUCCESS 1 in 3.63s]
2022-03-07 13:16:03.319011 (Thread-1): Finished running node model.snowflake_aicd.W_DATE_D
2022-03-07 13:16:03.319924 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:16:03.322019 (Thread-1): 10:16:03 | 15 of 28 START table model DBT_SHOPIFY.W_LOCATION_D.................. [RUN]
2022-03-07 13:16:03.324000 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:16:03.324954 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:16:03.341136 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-07 13:16:03.342497 (Thread-1): finished collecting timing info
2022-03-07 13:16:03.345771 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-07 13:16:03.347152 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:16:03.347461 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-07 13:16:03.347657 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:16:06.195139 (Thread-1): SQL status: SUCCESS 1 in 2.85 seconds
2022-03-07 13:16:06.201651 (Thread-1): finished collecting timing info
2022-03-07 13:16:06.202415 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-07 13:16:06.663040 (Thread-1): 10:16:06 | 15 of 28 OK created table model DBT_SHOPIFY.W_LOCATION_D............. [SUCCESS 1 in 3.34s]
2022-03-07 13:16:06.664901 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:16:06.666442 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-07 13:16:06.668018 (Thread-1): 10:16:06 | 16 of 28 START view model DBT_SHOPIFY.V_PRODUCTS_D_STG............... [RUN]
2022-03-07 13:16:06.669162 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-07 13:16:06.669756 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-07 13:16:06.679786 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-07 13:16:06.680731 (Thread-1): finished collecting timing info
2022-03-07 13:16:06.683068 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-07 13:16:06.688089 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-07 13:16:06.688250 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCTS_D_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG  as (
    
 

WITH product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG
),
product_variant AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG
),

rename as (


SELECT
    MD5(CONCAT(P.K_PRODUCT_BK,'-',COALESCE(V.K_PRODUCT_VARIANT_BK,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
    ,P.K_PRODUCT_DLHK
    ,V.K_PRODUCT_VARIANT_DLHK AS K_PRODUCT_VARIANT_DLHK
    ,V.K_PRODUCT_VARIANT_BK AS K_PRODUCT_VARIANT_BK
    ,P.K_PRODUCT_BK AS K_PRODUCT_BK
    ,V.K_INVENTORY_ITEM_BK AS K_VARIANT_INVENTORY_ITEM_BK
    ,V.K_IMAGE_BK AS K_VARIANT_IMAGE_BK
    --ATTRIBUTES
    ,P.A_TITLE
    ,P.A_HANDLE
    ,P.A_PRODUCT_TYPE
    ,P.A_VENDOR
    ,P.A_CREATED_AT_DTS
    ,P.A_UPDATED_AT_DTS
    ,P.A_PUBLISHED_AT_DTS
    ,P.A_PUBLISHED_SCOPE
    ,P.A_STATUS
    ,P.A_TEMPLATE_SUFFIX       
    ,V.A_TITLE AS A_VARIANT_TITLE
    ,V.A_SKU AS A_VARIANT_SKU
    ,V.A_FULFILLMENT_SERVICE AS A_VARIANT_FULFILLMENT_SERVICE
    ,V.A_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
    ,V.A_BARCODE AS A_VARIANT_BARCODE
    ,V.A_INVENTORY_POLICY AS A_VARIANT_INVENTORY_POLICY
    ,V.A_GRAMS AS A_VARIANT_GRAMS
    ,V.A_WEIGHT_UNIT AS A_VARIANT_WEIGHT_UNIT
    ,V.A_OPTION_1 AS A_VARIANT_OPTION_1
    ,V.A_OPTION_2 AS A_VARIANT_OPTION_2
    ,V.A_OPTION_3 AS A_VARIANT_OPTION_3
    ,V.A_TAX_CODE AS A_VARIANT_TAX_CODE
    ,V.A_PRESENTMENT_PRICES AS A_VARIANT_PRESENTMENT_PRICES
    ,V.A_CREATED_AT_DTS AS A_VARIANT_CREATED_AT_DTS
    ,V.A_UPDATED_AT_DTS AS A_VARIANT_UPDATED_AT_DTS
    --BOOLEAN
    ,V.B_REQUIRES_SHIPPING AS B_VARIANT_REQUIRES_SHIPPING
    ,V.B_TAXABLE AS B_VARIANT_TAXABLE
    --METRICS
    ,V.M_PRICE AS M_VARIANT_PRICE
    ,V.M_POSITION AS M_VARIANT_POSITION
    ,V.M_COMPARE_AT_PRICE AS M_VARIANT_COMPARE_AT_PRICE
    ,V.M_INVENTORY_QUANTITY AS M_VARIANT_INVENTORY_QUANTITY
    ,V.M_INVENTORY_QUANTITY_ADJUSTMENT AS M_VARIANT_INVENTORY_QUANTITY_ADJUSTMENT
    ,V.M_WEIGHT AS M_VARIANT_WEIGHT
    --metadata (MD)
    ,P.MD_IS_DELETED AS MD_IS_DELETED_PRODUCT
    ,V.MD_IS_DELETED AS MD_IS_DELETED_VARIANT
    , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
    , 'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
FROM
    product P
    LEFT JOIN product_variant V ON V.K_PRODUCT_BK = P.K_PRODUCT_BK
)

SELECT * FROM rename
  );
2022-03-07 13:16:06.688412 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:16:08.545695 (Thread-1): SQL status: SUCCESS 1 in 1.86 seconds
2022-03-07 13:16:08.548492 (Thread-1): finished collecting timing info
2022-03-07 13:16:08.548839 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: Close
2022-03-07 13:16:08.985066 (Thread-1): 10:16:08 | 16 of 28 OK created view model DBT_SHOPIFY.V_PRODUCTS_D_STG.......... [SUCCESS 1 in 2.32s]
2022-03-07 13:16:08.985450 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-07 13:16:08.985897 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:16:08.986169 (Thread-1): 10:16:08 | 17 of 28 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG....... [RUN]
2022-03-07 13:16:08.986857 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:16:08.987118 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:16:08.994013 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-07 13:16:08.994507 (Thread-1): finished collecting timing info
2022-03-07 13:16:08.996498 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-07 13:16:09.004457 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:16:09.004706 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT"
),
customer AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 

  MD5(S.ID) AS K_ABANDONED_CHECKOUT_DLHK
  ,C.K_CUSTOMER_DLHK
  ,L.K_LOCATION_DLHK
  ,MD5(S.USER_ID) AS K_USER_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK  
  ,S.ID AS K_ABANDONED_CHECKOUT_BK
  ,S.CUSTOMER_ID AS K_CUSTOMER_BK
  ,S.DEVICE_ID AS K_DEVICE_BK
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.SOURCE_IDENTIFIER AS K_SOURCE_BKENTIFIER
  ,S.USER_ID AS K_USER_BK
  ,S.ABANDONED_CHECKOUT_URL AS A_ABANDONED_CHECKOUT_URL  
  ,S.CART_TOKEN AS A_CART_TOKEN
  ,S.CLOSED_AT AS A_CLOSED_AT
  ,S.COMPLETED_AT AS A_COMPLETED_AT
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
  ,S.EMAIL AS A_EMAIL
  ,S.GATEWAY AS A_GATEWAY
  ,S.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
  ,S.NAME AS A_NAME
  ,S.NOTE AS A_NOTE
  ,S.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES
  ,S.PHONE AS A_PHONE
  ,S.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
  ,S.REFERRING_SITE AS A_REFERRING_SITE    
  ,S.SOURCE AS A_SOURCE
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.SOURCE_URL AS A_SOURCE_URL
  ,S.TOKEN AS A_TOKEN
  ,S.UPDATED_AT AS A_UPDATED_AT  
  --BOOLEAN
  ,S.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
  ,S.TAXES_INCLUDED AS B_TAXES_INCLUDED
  --METRIC
  ,S.SUBTOTAL_PRICE::decimal(15,2) AS M_SUBTOTAL_PRICE
  ,S.TOTAL_DISCOUNTS::decimal(15,2) AS M_TOTAL_DISCOUNTS
  ,S.TOTAL_DUTIES::decimal(15,2) AS M_TOTAL_DUTIES
  ,S.TOTAL_LINE_ITEMS_PRICE::decimal(15,2) AS M_TOTAL_LINE_ITEMS_PRICE
  ,S.TOTAL_PRICE::decimal(15,2) AS M_TOTAL_PRICE
  ,S.TOTAL_TAX::decimal(15,2) AS M_TOTAL_TAX
  ,S.TOTAL_WEIGHT::decimal(15,2) AS M_TOTAL_WEIGHT
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
  FROM
      source S
      left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
      left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-07 13:16:09.004871 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:16:10.649352 (Thread-1): SQL status: SUCCESS 1 in 1.64 seconds
2022-03-07 13:16:10.653436 (Thread-1): finished collecting timing info
2022-03-07 13:16:10.653889 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: Close
2022-03-07 13:16:11.116641 (Thread-1): 10:16:11 | 17 of 28 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.. [SUCCESS 1 in 2.13s]
2022-03-07 13:16:11.117369 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:16:11.117820 (Thread-1): Began running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-07 13:16:11.118566 (Thread-1): 10:16:11 | 18 of 28 START view model DBT_SHOPIFY.V_TRANSACTIONS_STG............. [RUN]
2022-03-07 13:16:11.119356 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-07 13:16:11.119678 (Thread-1): Compiling model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-07 13:16:11.126834 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-07 13:16:11.127984 (Thread-1): finished collecting timing info
2022-03-07 13:16:11.131341 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-07 13:16:11.134664 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-07 13:16:11.134963 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_TRANSACTIONS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."TRANSACTION"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_TRANSACTION_DLHK
  ,L.K_LOCATION_DLHK  
  ,MD5(S.USER_ID) AS K_USER_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_TRANSACTION_BK
  ,S.DEVICE_ID AS K_DEVICE_BK  
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.ORDER_ID AS K_ORDER_BK
  ,S.PARENT_ID AS K_PARENT_BK
  ,S.REFUND_ID AS K_REFUND_BK
  ,S.USER_ID AS K_USER_BK  
  --ATTRIBUTES
  ,S.AUTHORIZATION AS A_AUTHORIZATION
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CURRENCY_EXCHANGE_ADJUSTMENT AS A_CURRENCY_EXCHANGE_ADJUSTMENT
  ,S.ERROR_CODE AS A_ERROR_CODE
  ,S.GATEWAY AS A_GATEWAY
  ,S.KIND AS A_KIND
  ,S.MESSAGE AS A_MESSAGE
  ,S.PAYMENT_DETAILS AS A_PAYMENT_DETAILS
  ,S.PROCESSED_AT AS A_PROCESSED_AT
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.STATUS AS A_STATUS
  --boolean
  ,S.TEST AS B_TEST
  --METRICS
  ,S.AMOUNT::decimal(15,2) AS M_AMOUNT   
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
  FROM
    source S  
  left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-07 13:16:11.135105 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:16:13.032692 (Thread-1): SQL status: SUCCESS 1 in 1.90 seconds
2022-03-07 13:16:13.039095 (Thread-1): finished collecting timing info
2022-03-07 13:16:13.039956 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: Close
2022-03-07 13:16:13.498999 (Thread-1): 10:16:13 | 18 of 28 OK created view model DBT_SHOPIFY.V_TRANSACTIONS_STG........ [SUCCESS 1 in 2.38s]
2022-03-07 13:16:13.500291 (Thread-1): Finished running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-07 13:16:13.501177 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-07 13:16:13.502599 (Thread-1): 10:16:13 | 19 of 28 START table model DBT_SHOPIFY.W_PRODUCTS_D.................. [RUN]
2022-03-07 13:16:13.504462 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-07 13:16:13.506323 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCTS_D
2022-03-07 13:16:13.516885 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-07 13:16:13.517834 (Thread-1): finished collecting timing info
2022-03-07 13:16:13.520581 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-07 13:16:13.521682 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-07 13:16:13.521852 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCTS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG AS C
      );
2022-03-07 13:16:13.522024 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:16:16.903596 (Thread-1): SQL status: SUCCESS 1 in 3.38 seconds
2022-03-07 13:16:16.908994 (Thread-1): finished collecting timing info
2022-03-07 13:16:16.909688 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: Close
2022-03-07 13:16:17.383150 (Thread-1): 10:16:17 | 19 of 28 OK created table model DBT_SHOPIFY.W_PRODUCTS_D............. [SUCCESS 1 in 3.88s]
2022-03-07 13:16:17.385125 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-07 13:16:17.386235 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:16:17.387990 (Thread-1): 10:16:17 | 20 of 28 SKIP relation DBT_SHOPIFY.V_ABANDONED_CHECKOUT_F_STG........ [SKIP]
2022-03-07 13:16:17.389498 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:16:17.390968 (Thread-1): Began running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-07 13:16:17.392668 (Thread-1): 10:16:17 | 21 of 28 START table model DBT_SHOPIFY.W_TRANSACTIONS_F.............. [RUN]
2022-03-07 13:16:17.394432 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-07 13:16:17.394756 (Thread-1): Compiling model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-07 13:16:17.400182 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-07 13:16:17.400981 (Thread-1): finished collecting timing info
2022-03-07 13:16:17.403741 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-07 13:16:17.404681 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-07 13:16:17.404907 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_TRANSACTIONS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_TRANSACTIONS_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG AS C
      );
2022-03-07 13:16:17.405059 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:16:20.137650 (Thread-1): SQL status: SUCCESS 1 in 2.73 seconds
2022-03-07 13:16:20.145109 (Thread-1): finished collecting timing info
2022-03-07 13:16:20.145623 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: Close
2022-03-07 13:16:20.621278 (Thread-1): 10:16:20 | 21 of 28 OK created table model DBT_SHOPIFY.W_TRANSACTIONS_F......... [SUCCESS 1 in 3.23s]
2022-03-07 13:16:20.622444 (Thread-1): Finished running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-07 13:16:20.623366 (Thread-1): Began running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-07 13:16:20.629494 (Thread-1): 10:16:20 | 22 of 28 START view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG........... [RUN]
2022-03-07 13:16:20.631197 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-07 13:16:20.631570 (Thread-1): Compiling model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-07 13:16:20.638383 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-07 13:16:20.639293 (Thread-1): finished collecting timing info
2022-03-07 13:16:20.642408 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-07 13:16:20.645261 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-07 13:16:20.645447 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_INVENTORY_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_ITEM"
),
inventory_level AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_LEVEL"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
products AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename AS 
(   
  SELECT   
  MD5(S.ID) AS K_INVENTORY_ITEM_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
  ,L.K_LOCATION_DLHK
  ,L.K_LOCATION_BK  
  ,S.ID AS K_INVENTORY_ITEM_BK
  ,S.COUNTRY_CODE_OF_ORIGIN AS A_COUNTRY_CODE_OF_ORIGIN
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.PROVINCE_CODE_OF_ORIGIN AS A_PROVINCE_CODE_OF_ORIGIN
  ,S.SKU AS A_SKU
  ,S.UPDATED_AT AS A_UPDATED_AT
  ,S.HARMONIZED_SYSTEM_CODE AS A_HARMONIZED_SYSTEM_CODE  
  --BOOLEAN
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TRACKED AS B_TRACKED
  --METRICS
  ,S.COST::decimal(15,2) AS M_COST 
  ,IL.AVAILABLE AS M_AVAIABLE  
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
  FROM
      source S
      left join inventory_level IL ON IL.INVENTORY_ITEM_ID = S.ID      
      left join locations L ON L.K_LOCATION_BK = IL.LOCATION_ID
      left join products P ON P.K_VARIANT_INVENTORY_ITEM_BK = S.ID 
)


SELECT * FROM rename
  );
2022-03-07 13:16:20.645581 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:16:22.380777 (Thread-1): SQL status: SUCCESS 1 in 1.73 seconds
2022-03-07 13:16:22.387258 (Thread-1): finished collecting timing info
2022-03-07 13:16:22.388277 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: Close
2022-03-07 13:16:22.874288 (Thread-1): 10:16:22 | 22 of 28 OK created view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG...... [SUCCESS 1 in 2.24s]
2022-03-07 13:16:22.875049 (Thread-1): Finished running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-07 13:16:22.876426 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-07 13:16:22.877810 (Thread-1): 10:16:22 | 23 of 28 START view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG......... [RUN]
2022-03-07 13:16:22.878698 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-07 13:16:22.879194 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-07 13:16:22.900101 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-07 13:16:22.900842 (Thread-1): finished collecting timing info
2022-03-07 13:16:22.903015 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-07 13:16:22.908983 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-07 13:16:22.909212 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM" AS A
),
products AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D AS A
),
taxes AS (
  SELECT 
      K_ORDER_LINE_ITEM_BK,
      AVG(M_RATE) AS M_RATE,
      SUM(M_TAX) AS M_TAX,
      SUM(M_TAX_PRIMARY) AS M_TAX_PRIMARY
    FROM 
      DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG AS A
    GROUP BY K_ORDER_LINE_ITEM_BK
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_LINE_ITEM_DLHK  
  ,MD5(ORDER_ID) AS K_ORDER_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
 --business keys
  ,O.PRODUCT_ID AS K_PRODUCT_BK
  ,O.VARIANT_ID AS K_VARIANT_BK
  
  ,O.ORDER_ID AS K_ORDER_BK
  ,O.ID AS K_ORDER_LINE_ITEM_BK
  --attribubtes
  ,O.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
  ,O.NAME AS A_NAME  
  ,O.PROPERTIES AS A_PROPERTIES
  ,O.SKU AS A_SKU
  ,O.TITLE AS A_TITLE  
  ,O.VARIANT_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
  ,O.VARIANT_TITLE AS A_VARIANT_TITLE
  ,O.VENDOR AS A_VENDOR
  --boolean
  ,O.GIFT_CARD AS B_GIFT_CARD
  ,O.PRODUCT_EXISTS AS B_PRODUCT_EXISTS
  ,O.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,O.TAXABLE AS B_TAXABLE
  --metrics
  ,O.FULFILLABLE_QUANTITY AS M_FULFILLABLE_QUANTITY
  ,O.GRAMS::DECIMAL(15,2) AS M_GRAMS
  ,O.QUANTITY::DECIMAL(15,2) AS M_QUANTITY
  ,M_RATE AS M_TAX_RATE
  ,COALESCE(T.M_TAX_PRIMARY,0)::DECIMAL(15,2) AS M_TAX_AMOUNT
  ,COALESCE(T.M_TAX,0)::DECIMAL(15,2) AS M_TAX_AMOUNT_PRIMARY

  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE_PRIMARY 
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT_PRIMARY 
  ,(O.QUANTITY * M_UNIT_PRICE)::DECIMAL(15,2) AS M_TOTAL_PRICE  
  ,(O.QUANTITY * M_UNIT_PRICE_PRIMARY)::DECIMAL(15,2) AS M_TOTAL_PRICE_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
FROM source O
  left join products P ON P.K_PRODUCT_BK = O.PRODUCT_ID AND CASE WHEN O.VARIANT_ID IS NOT NULL THEN O.VARIANT_ID = P.K_PRODUCT_VARIANT_BK ELSE 1=1 END
  left join taxes T ON T.K_ORDER_LINE_ITEM_BK = O.ID
)

SELECT * FROM rename
  );
2022-03-07 13:16:22.909358 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:16:24.832360 (Thread-1): SQL status: SUCCESS 1 in 1.92 seconds
2022-03-07 13:16:24.838644 (Thread-1): finished collecting timing info
2022-03-07 13:16:24.839286 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: Close
2022-03-07 13:16:25.296773 (Thread-1): 10:16:25 | 23 of 28 OK created view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG.... [SUCCESS 1 in 2.42s]
2022-03-07 13:16:25.297930 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-07 13:16:25.299344 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-07 13:16:25.303093 (Thread-1): 10:16:25 | 24 of 28 START view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG....... [RUN]
2022-03-07 13:16:25.304540 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-07 13:16:25.305234 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-07 13:16:25.317844 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-07 13:16:25.318634 (Thread-1): finished collecting timing info
2022-03-07 13:16:25.320448 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-07 13:16:25.323033 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-07 13:16:25.323199 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECT"
),
source_collection AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECTION"
),
product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename as (

SELECT
  MD5(S.ID) AS K_PRODUCT_COLLECT_DLHK
  ,MD5(CC.ID) AS K_COLLECTION_DLHK
  ,P.K_PRODUCT_DLHK  
  ,S.ID AS K_PRODUCT_COLLECT_BK
  ,CC.ID AS K_COLLECTION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,S.POSITION AS A_POSITION
  ,S.SORT_ORDER AS A_SORT_ORDER  
  ,S.CREATED_AT AS A_CREATED_AT_DTS
  ,S.UPDATED_AT AS A_UPDATED_AT_DTS
  ,CC.PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,CC.BODY_HTML AS A_BODY_HTML
  ,CC.TITLE AS A_TITLE
  ,CC.HANDLE AS A_HANDLE
  ,CC.PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE  
  ,CC.COLLECTION_TYPE AS A_COLLECTION_TYPE  
  --metrics
  ,CC.PRODUCTS_COUNT AS M_PRODUCTS_COUNT
  --metadata (MD)
  ,S.__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
FROM
    source S
    LEFT JOIN source_collection CC ON CC.ID = S.COLLECTION_ID
    LEFT JOIN product P ON P.K_PRODUCT_BK = S.PRODUCT_ID
)

SELECT * FROM rename
  );
2022-03-07 13:16:25.323362 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:16:27.222463 (Thread-1): SQL status: SUCCESS 1 in 1.90 seconds
2022-03-07 13:16:27.227749 (Thread-1): finished collecting timing info
2022-03-07 13:16:27.228684 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: Close
2022-03-07 13:16:27.690052 (Thread-1): 10:16:27 | 24 of 28 OK created view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG.. [SUCCESS 1 in 2.39s]
2022-03-07 13:16:27.691260 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-07 13:16:27.691953 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-07 13:16:27.693523 (Thread-1): 10:16:27 | 25 of 28 SKIP relation DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F............ [SKIP]
2022-03-07 13:16:27.696343 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-07 13:16:27.697793 (Thread-1): Began running node model.snowflake_aicd.W_INVENTORY_F
2022-03-07 13:16:27.699128 (Thread-1): 10:16:27 | 26 of 28 START table model DBT_SHOPIFY.W_INVENTORY_F................. [RUN]
2022-03-07 13:16:27.699762 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-07 13:16:27.699973 (Thread-1): Compiling model.snowflake_aicd.W_INVENTORY_F
2022-03-07 13:16:27.704509 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-07 13:16:27.705210 (Thread-1): finished collecting timing info
2022-03-07 13:16:27.707321 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-07 13:16:27.708455 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-07 13:16:27.708797 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_INVENTORY_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_INVENTORY_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG AS C
      );
2022-03-07 13:16:27.708959 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:16:30.766404 (Thread-1): SQL status: SUCCESS 1 in 3.06 seconds
2022-03-07 13:16:30.768996 (Thread-1): finished collecting timing info
2022-03-07 13:16:30.769331 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: Close
2022-03-07 13:16:31.243878 (Thread-1): 10:16:31 | 26 of 28 OK created table model DBT_SHOPIFY.W_INVENTORY_F............ [SUCCESS 1 in 3.54s]
2022-03-07 13:16:31.244351 (Thread-1): Finished running node model.snowflake_aicd.W_INVENTORY_F
2022-03-07 13:16:31.244629 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-07 13:16:31.244948 (Thread-1): 10:16:31 | 27 of 28 START table model DBT_SHOPIFY.W_ORDERS_F.................... [RUN]
2022-03-07 13:16:31.245628 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-07 13:16:31.245953 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-07 13:16:31.252940 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-07 13:16:31.253831 (Thread-1): finished collecting timing info
2022-03-07 13:16:31.256937 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-07 13:16:31.266803 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-07 13:16:31.267060 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ORDERS_F  as
      (

SELECT
  O.K_ORDER_DLHK AS K_ORDER_DLHK
  ,OLI.K_ORDER_LINE_ITEM_DLHK AS K_ORDER_LINE_ITEM_DLHK
  ,O.K_CUSTOMER_DLHK AS K_CUSTOMER_DLHK
  ,O.K_LOCATION_DLHK AS K_LOCATION_DLHK
  ,O.K_BILLING_ADDRESS_DLHK AS K_BILLING_ADDRESS_DLHK
  ,O.K_SHIPPING_ADDRESS_DLHK AS K_SHIPPING_ADDRESS_DLHK
  ,OLI.K_PRODUCT_VARIATION_DLHK AS K_ITEM_PRODUCT_VARIATION_DLHK
  ,OLI.K_PRODUCT_BK AS K_ITEM_PRODUCT_BK
  ,OLI.K_VARIANT_BK AS K_ITEM_VARIANT_BK
  ,OLI.K_ORDER_BK AS K_ITEM_ORDER_BK
  ,O.K_ORDER_BK AS K_ORDER_BK
  ,OLI.K_ORDER_LINE_ITEM_BK AS K_ITEM_ORDER_LINE_ITEM_BK
  ,O.K_APP_BK AS K_HEADER_APP_BK
  
  ,O.K_CUSTOMER_BK AS K_CUSTOMER_BK
  ,O.K_DEVICE_BK AS K_DEVICE_BK
  ,O.K_LOCATION_BK AS K_LOCATION_BK
  ,O.K_SOURCE_ENTIFIER_BK AS K_SOURCE_ENTIFIER_BK
  ,O.A_BROWSER_IP AS A_HEADER_BROWSER_IP
  ,O.A_CANCELLED_AT_DTS AS A_HEADER_CANCELLED_AT_DTS
  ,O.A_CANCEL_REASON AS A_HEADER_CANCEL_REASON
  ,O.A_CART_TOKEN AS A_HEADER_CART_TOKEN
  ,O.A_CHECKOUT_TOKEN AS A_HEADER_CHECKOUT_TOKEN
  ,O.A_CLIENT_DETAILS AS A_HEADER_CLIENT_DETAILS
  ,O.A_CLOSED_AT_DTS AS A_HEADER_CLOSED_AT_DTS
  ,O.A_CREATED_AT_DTS AS A_HEADER_CREATED_AT_DTS
  ,O.A_CURRENCY AS A_HEADER_CURRENCY
  ,O.A_PRESENTMENT_CURRENCY AS A_HEADER_PRESENTMENT_CURRENCY
  ,O.A_CUSTOMER_LOCALE AS A_HEADER_CUSTOMER_LOCALE
  ,O.A_EMAIL AS A_HEADER_EMAIL
  ,O.A_FINANCIAL_STATUS AS A_HEADER_FINANCIAL_STATUS
  ,O.A_FULFILLMENT_STATUS AS A_HEADER_FULFILLMENT_STATUS
  ,O.A_LANDING_SITE_BASE_URL AS A_HEADER_LANDING_SITE_BASE_URL
  ,O.A_LANDING_SITE_REF AS A_HEADER_LANDING_SITE_REF
  ,O.A_NAME AS A_HEADER_NAME
  ,O.A_NOTE AS A_HEADER_NOTE
  ,O.A_NOTE_ATTRIBUTES AS A_HEADER_NOTE_ATTRIBUTES
  ,O.A_PAYMENT_GATEWAY_NAMES AS A_HEADER_PAYMENT_GATEWAY_NAMES
  ,O.A_PROCESSED_AT_DTS AS A_HEADER_PROCESSED_AT_DTS
  ,O.A_PROCESSING_METHOD AS A_HEADER_PROCESSING_METHOD
  ,O.A_REFERENCE AS A_HEADER_REFERENCE
  ,O.A_REFERRING_SITE AS A_HEADER_REFERRING_SITE
  ,O.A_SOURCE_NAME AS A_HEADER_SOURCE_NAME
  ,O.A_SOURCE_URL AS A_HEADER_SOURCE_URL
  ,O.A_ORDER_NUMBER AS A_HEADER_ORDER_NUMBER
  ,O.A_POSION_NUMBER AS A_HEADER_POSION_NUMBER
  ,O.A_UPDATED_AT_DTS AS A_HEADER_UPDATED_AT_DTS
  ,O.B_BUYER_ACCEPTS_MARKETING AS B_HEADER_BUYER_ACCEPTS_MARKETING
  ,O.B_CONFIRMED AS B_HEADER_CONFIRMED
  ,O.B_TAXES_INCLUDED  AS B_HEADER_TAXES_INCLUDED   
  ,OLI.A_FULFILLMENT_SERVICE AS A_ITEM_FULFILLMENT_SERVICE
  ,OLI.A_FULFILLMENT_STATUS AS A_ITEM_FULFILLMENT_STATUS    
  ,OLI.A_VARIANT_INVENTORY_MANAGEMENT AS A_ITEM_VARIANT_INVENTORY_MANAGEMENT  
  
  ,OLI.B_GIFT_CARD AS B_ITEM_GIFT_CARD
  ,OLI.B_PRODUCT_EXISTS AS B_ITEM_PRODUCT_EXISTS
  ,OLI.B_REQUIRES_SHIPPING AS B_ITEM_REQUIRES_SHIPPING
  ,OLI.B_TAXABLE AS B_ITEM_TAXABLE
  ,OLI.M_FULFILLABLE_QUANTITY AS M_ITEM_FULFILLABLE_QUANTITY
  ,OLI.M_GRAMS AS M_ITEM_GRAMS
  ,OLI.M_QUANTITY AS M_ITEM_QUANTITY
  ,OLI.M_UNIT_PRICE AS M_ITEM_UNIT_PRICE
  ,OLI.M_UNIT_PRICE_PRIMARY AS M_ITEM_UNIT_PRICE_PRIMARY
  ,OLI.M_TOTAL_PRICE AS M_ITEM_TOTAL_PRICE
  ,OLI.M_TOTAL_PRICE_PRIMARY AS M_ITEM_TOTAL_PRICE_PRIMARY
  ,OLI.M_TOTAL_DISCOUNT AS M_ITEM_TOTAL_DISCOUNT
  ,OLI.M_TOTAL_DISCOUNT_PRIMARY AS M_ITEM_TOTAL_DISCOUNT_PRIMARY
  ,OLI.M_TAX_AMOUNT AS M_TAX_AMOUNT
  ,OLI.M_TAX_AMOUNT_PRIMARY AS M_TAX_AMOUNT_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_TIP_RECEIVED * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_TIP_AMOUNT_PRIMARY  
  --,ROUND(DIV0((O.M_TOTAL_DISCOUNTS_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_HEADER_DISCOUNT
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE * OLI.M_TOTAL_PRICE),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE



   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'bb6a4c87-b606-4dc6-940b-559bb578767b' AS MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG OLI ON OLI.K_ORDER_DLHK = O.K_ORDER_DLHK
      );
2022-03-07 13:16:31.267258 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:16:34.623930 (Thread-1): SQL status: SUCCESS 1 in 3.36 seconds
2022-03-07 13:16:34.631178 (Thread-1): finished collecting timing info
2022-03-07 13:16:34.632324 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-07 13:16:35.084712 (Thread-1): 10:16:35 | 27 of 28 OK created table model DBT_SHOPIFY.W_ORDERS_F............... [SUCCESS 1 in 3.84s]
2022-03-07 13:16:35.085817 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-07 13:16:35.087143 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-07 13:16:35.090973 (Thread-1): 10:16:35 | 28 of 28 START table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F........ [RUN]
2022-03-07 13:16:35.094557 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-07 13:16:35.095024 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-07 13:16:35.100601 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-07 13:16:35.101260 (Thread-1): finished collecting timing info
2022-03-07 13:16:35.103392 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-07 13:16:35.104386 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-07 13:16:35.104575 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCT_COLLECTION_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG AS C
      );
2022-03-07 13:16:35.104726 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:16:37.647746 (Thread-1): SQL status: SUCCESS 1 in 2.54 seconds
2022-03-07 13:16:37.654831 (Thread-1): finished collecting timing info
2022-03-07 13:16:37.655701 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: Close
2022-03-07 13:16:38.122880 (Thread-1): 10:16:38 | 28 of 28 OK created table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F... [SUCCESS 1 in 3.03s]
2022-03-07 13:16:38.123599 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-07 13:16:38.129236 (MainThread): Acquiring new snowflake connection "master".
2022-03-07 13:16:38.130678 (MainThread): 10:16:38 | 
2022-03-07 13:16:38.131221 (MainThread): 10:16:38 | Finished running 18 view models, 10 table models in 74.82s.
2022-03-07 13:16:38.131583 (MainThread): Connection 'master' was properly closed.
2022-03-07 13:16:38.131878 (MainThread): Connection 'model.snowflake_aicd.W_PRODUCT_COLLECTION_F' was properly closed.
2022-03-07 13:16:38.145065 (MainThread): 
2022-03-07 13:16:38.145327 (MainThread): Completed with 1 error and 0 warnings:
2022-03-07 13:16:38.145496 (MainThread): 
2022-03-07 13:16:38.145657 (MainThread): Database Error in model V_ABANDONED_CHECKOUT_LINE_ITEM_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_LINE_ITEM_STG.sql)
2022-03-07 13:16:38.145808 (MainThread):   001003 (42000): SQL compilation error:
2022-03-07 13:16:38.145947 (MainThread):   syntax error line 14 at position 2 unexpected ','.
2022-03-07 13:16:38.146085 (MainThread):   compiled SQL at target/run/snowflake_aicd/models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_LINE_ITEM_STG.sql
2022-03-07 13:16:38.146328 (MainThread): 
Done. PASS=25 WARN=0 ERROR=1 SKIP=2 TOTAL=28
2022-03-07 13:16:38.146600 (MainThread): Flushing usage events
2022-03-07 13:41:07.420566 (MainThread): Running with dbt=0.21.1
2022-03-07 13:41:07.907126 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-07 13:41:07.908437 (MainThread): Tracking: do not track
2022-03-07 13:41:07.918443 (MainThread): Partial parsing not enabled
2022-03-07 13:41:07.936556 (MainThread): Parsing macros/common.sql
2022-03-07 13:41:07.939654 (MainThread): Parsing macros/catalog.sql
2022-03-07 13:41:07.941466 (MainThread): Parsing macros/adapters.sql
2022-03-07 13:41:07.973153 (MainThread): Parsing macros/materializations/merge.sql
2022-03-07 13:41:07.976289 (MainThread): Parsing macros/materializations/seed.sql
2022-03-07 13:41:07.979961 (MainThread): Parsing macros/materializations/view.sql
2022-03-07 13:41:07.980973 (MainThread): Parsing macros/materializations/table.sql
2022-03-07 13:41:07.983437 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-07 13:41:07.990167 (MainThread): Parsing macros/core.sql
2022-03-07 13:41:07.992937 (MainThread): Parsing macros/materializations/test.sql
2022-03-07 13:41:07.998199 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-07 13:41:08.005836 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-07 13:41:08.007087 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-07 13:41:08.020677 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-07 13:41:08.051767 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-07 13:41:08.070956 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-07 13:41:08.072318 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-07 13:41:08.080723 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-07 13:41:08.097870 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-07 13:41:08.109582 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-07 13:41:08.116779 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-07 13:41:08.123048 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-07 13:41:08.125949 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-07 13:41:08.127039 (MainThread): Parsing macros/etc/query.sql
2022-03-07 13:41:08.127744 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-07 13:41:08.128884 (MainThread): Parsing macros/etc/datetime.sql
2022-03-07 13:41:08.135770 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-07 13:41:08.137115 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-07 13:41:08.138971 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-07 13:41:08.140118 (MainThread): Parsing macros/adapters/common.sql
2022-03-07 13:41:08.186000 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-07 13:41:08.187265 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-07 13:41:08.188105 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-07 13:41:08.189085 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-07 13:41:08.332329 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:41:08.340745 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.343695 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-07 13:41:08.346098 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.346812 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-07 13:41:08.349364 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.350078 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:41:08.352471 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.353163 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:41:08.357424 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.358302 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:41:08.361896 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.362632 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-07 13:41:08.365517 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.366236 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-07 13:41:08.369123 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.370036 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-07 13:41:08.373100 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.373838 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-07 13:41:08.376344 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.377048 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:41:08.379441 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.380160 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-07 13:41:08.384367 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.385259 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-07 13:41:08.388308 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.389019 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-07 13:41:08.393938 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.394808 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-07 13:41:08.400445 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.401181 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-07 13:41:08.403979 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.404707 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-07 13:41:08.407848 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.408571 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-07 13:41:08.412655 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.413373 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-07 13:41:08.450990 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.451817 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-07 13:41:08.454092 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.454809 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-07 13:41:08.457033 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.457797 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-07 13:41:08.460258 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.460956 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-07 13:41:08.463114 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.463801 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:41:08.466240 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.466982 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-07 13:41:08.469234 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.469952 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:41:08.472155 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.472859 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-07 13:41:08.475321 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.476238 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-07 13:41:08.478868 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.498907 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.500126 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.501406 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.502535 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.503665 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.504792 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.506069 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.507182 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:41:08.543751 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-07 13:41:08.544720 (MainThread): Found 28 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 24 sources, 0 exposures
2022-03-07 13:41:08.546924 (MainThread): 
2022-03-07 13:41:08.547188 (MainThread): Acquiring new snowflake connection "master".
2022-03-07 13:41:08.548769 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-07 13:41:08.558352 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-07 13:41:08.558527 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-07 13:41:08.558624 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-07 13:41:10.379435 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 1.82 seconds
2022-03-07 13:41:10.386687 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-07 13:41:10.836091 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-07 13:41:10.842252 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-07 13:41:10.842431 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-07 13:41:10.842532 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-07 13:41:12.396003 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 27 in 1.55 seconds
2022-03-07 13:41:12.400329 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-07 13:41:12.843720 (MainThread): 10:41:12 | Concurrency: 1 threads (target='dev')
2022-03-07 13:41:12.844097 (MainThread): 10:41:12 | 
2022-03-07 13:41:12.847843 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:41:12.848860 (Thread-1): 10:41:12 | 1 of 28 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG [RUN]
2022-03-07 13:41:12.849178 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:41:12.849313 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:41:12.852648 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"
2022-03-07 13:41:12.853502 (Thread-1): finished collecting timing info
2022-03-07 13:41:12.878826 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"
2022-03-07 13:41:12.881365 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:41:12.881505 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT_LINE_ITEM"
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_ABANDONED_CHECKOUT_ITEM_DLHK
  ,MD5(S.CHECKOUT_ID) AS K_ABANDONED_CHECKOUT_DLHK
  
  ,MD5(CONCAT(S.PRODUCT_ID,'-',COALESCE(S.VARIANT_ID,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_ABANDONED_CHECKOUT_ITEM_BK
  ,S.CHECKOUT_ID AS K_ABANDONED_CHECKOUT_BK
  ,S.DESTINATION_LOCATION_ID AS K_DESTINATION_LOCATION_BK    
  ,S.ORIGIN_LOCATION_ID AS K_ORIGIN_LOCATION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  ,S.VARIANT_ID AS K_VARIANT_BK
  --ATTRIBUTES
  ,S.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,S.KEY AS A_KEY
  ,S.PRESENTMENT_TITLE AS A_PRESENTMENT_TITLE
  ,S.PRESENTMENT_VARIANT_TITLE AS A_PRESENTMENT_VARIANT_TITLE
  ,S.SKU AS A_SKU
  ,S.TITLE AS A_TITLE
  ,S.VARIANT_TITLE AS A_VARIANT_TITLE
  ,S.VENDOR AS A_VENDOR
  --BOOLEAN
  ,S.GIFT_CARD AS B_GIFT_CARD
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TAXABLE AS B_TAXABLE
  --METRICS
  ,S.COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,S.GRAMS AS M_GRAMS
  ,S.LINE_PRICE AS M_LINE_PRICE
  ,S.PRICE AS M_PRICE
  ,S.QUANTITY AS M_QUANTITY
  ,S.VARIANT_PRICE AS M_VARIANT_PRICE
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
  FROM
      source S
)


SELECT * FROM rename
  );
2022-03-07 13:41:12.881623 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:14.668963 (Thread-1): SQL status: SUCCESS 1 in 1.79 seconds
2022-03-07 13:41:14.682429 (Thread-1): finished collecting timing info
2022-03-07 13:41:14.682755 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG: Close
2022-03-07 13:41:15.126892 (Thread-1): 10:41:15 | 1 of 28 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG [SUCCESS 1 in 2.28s]
2022-03-07 13:41:15.127253 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:41:15.127400 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-07 13:41:15.127565 (Thread-1): 10:41:15 | 2 of 28 START view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG.......... [RUN]
2022-03-07 13:41:15.127804 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-07 13:41:15.127916 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-07 13:41:15.130939 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-07 13:41:15.131406 (Thread-1): finished collecting timing info
2022-03-07 13:41:15.132847 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"
2022-03-07 13:41:15.136221 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-07 13:41:15.136488 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER_ADDRESS"
),
rename AS 
(   
SELECT 
    MD5(ID) AS K_CUSTOMER_ADDRESS_DLHK
    ,ID AS K_CUSTOMER_ADDRESS_BK
    ,MD5(CONCAT(
        COALESCE(ADDRESS1,'00'),
        COALESCE(ADDRESS2,'00'),
        COALESCE(CITY,'00'),
        COALESCE(COUNTRY,'00'),
        COALESCE(COUNTRY_CODE,'00'),
        COALESCE(FIRST_NAME,'00'),
        COALESCE(LAST_NAME,'00'),
        COALESCE(PROVINCE,'00'),
        COALESCE(PROVINCE_CODE,'00'),
        COALESCE(ZIP,'00')
    )) AS K_ADDRESS_DLHK
    ,CUSTOMER_ID AS K_CUSTOMER_BK
    ,ADDRESS1 AS A_ADDRESS1
    ,ADDRESS2 AS A_ADDRESS2
    ,CITY AS A_CITY
    ,COMPANY AS A_COMPANY
    ,COUNTRY AS A_COUNTRY
    ,COUNTRY_CODE AS A_COUNTRY_CODE
    ,COUNTRY_NAME AS A_COUNTRY_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,PHONE AS A_PHONE
    ,PROVINCE AS A_PROVINCE
    ,PROVINCE_CODE AS A_PROVINCE_CODE
    ,ZIP AS A_ZIP
    ,IS_DEFAULT AS B_IS_DEFAULT  
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-07 13:41:15.136732 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:16.780069 (Thread-1): SQL status: SUCCESS 1 in 1.64 seconds
2022-03-07 13:41:16.781798 (Thread-1): finished collecting timing info
2022-03-07 13:41:16.782121 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG: Close
2022-03-07 13:41:17.226008 (Thread-1): 10:41:17 | 2 of 28 OK created view model DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG..... [SUCCESS 1 in 2.10s]
2022-03-07 13:41:17.226537 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG
2022-03-07 13:41:17.227043 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:41:17.227859 (Thread-1): 10:41:17 | 3 of 28 START view model DBT_SHOPIFY.V_CUSTOMER_STG.................. [RUN]
2022-03-07 13:41:17.230991 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:41:17.231730 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:41:17.239973 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-07 13:41:17.241478 (Thread-1): finished collecting timing info
2022-03-07 13:41:17.243647 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-07 13:41:17.247609 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:41:17.247919 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER"
),
rename AS 
(   
SELECT 
    --KEYS
    MD5(ID) AS K_CUSTOMER_DLHK    
    --BUSINESS KEYS
    ,ID AS K_CUSTOMER_BK
    ,LAST_ORDER_ID AS K_LAST_ORDER_BK
    ,MULTIPASS_IDENTIFIER AS K_MULTIPASS_BKENTIFIER
    --ATTRIBUTES
    ,ACCEPTS_MARKETING_UPDATED_AT AS A_ACCEPTS_MARKETING_UPDATED_AT_DTS
    ,CREATED_AT AS A_CREATED_AT_DTS
    ,CURRENCY AS A_CURRENCY
    ,EMAIL AS A_EMAIL
    ,
    (COALESCE(FIRST_NAME,'') || ' ' || COALESCE(LAST_NAME,''))
 AS A_FULL_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,LAST_ORDER_NAME AS A_LAST_ORDER_NAME
    ,MARKETING_OPT_IN_LEVEL AS A_MARKETING_OPT_IN_LEVEL
    ,NOTE AS A_NOTE
    ,PHONE AS A_PHONE
    ,SMS_MARKETING_CONSENT AS A_SMS_MARKETING_CONSENT
    ,STATE AS A_STATE
    ,TAGS AS A_TAGS
    ,TAX_EXEMPTIONS AS A_TAX_EXEMPTIONS
    ,TOTAL_SPENT AS A_TOTAL_SPENT
    ,UPDATED_AT AS A_UPDATED_AT
    --BOOLEAN
    ,ACCEPTS_MARKETING AS B_ACCEPTS_MARKETING
    ,TAX_EXEMPT AS B_TAX_EXEMPT
    ,VERIFIED_EMAIL AS B_VERIFIED_EMAIL
    --METRICS
    ,ORDERS_COUNT AS M_ORDERS_COUNT
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-07 13:41:17.248145 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:18.899479 (Thread-1): SQL status: SUCCESS 1 in 1.65 seconds
2022-03-07 13:41:18.902858 (Thread-1): finished collecting timing info
2022-03-07 13:41:18.903332 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-07 13:41:19.348343 (Thread-1): 10:41:19 | 3 of 28 OK created view model DBT_SHOPIFY.V_CUSTOMER_STG............. [SUCCESS 1 in 2.12s]
2022-03-07 13:41:19.348579 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:41:19.348719 (Thread-1): Began running node model.snowflake_aicd.V_DATE_STG
2022-03-07 13:41:19.348882 (Thread-1): 10:41:19 | 4 of 28 START view model DBT_SHOPIFY.V_DATE_STG...................... [RUN]
2022-03-07 13:41:19.349088 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-07 13:41:19.349461 (Thread-1): Compiling model.snowflake_aicd.V_DATE_STG
2022-03-07 13:41:19.353460 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-07 13:41:19.353842 (Thread-1): finished collecting timing info
2022-03-07 13:41:19.355109 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-07 13:41:19.379483 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-07 13:41:19.379720 (Thread-1): On model.snowflake_aicd.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-07 13:41:19.379906 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:21.311104 (Thread-1): SQL status: SUCCESS 1 in 1.93 seconds
2022-03-07 13:41:21.314952 (Thread-1): finished collecting timing info
2022-03-07 13:41:21.315388 (Thread-1): On model.snowflake_aicd.V_DATE_STG: Close
2022-03-07 13:41:21.767503 (Thread-1): 10:41:21 | 4 of 28 OK created view model DBT_SHOPIFY.V_DATE_STG................. [SUCCESS 1 in 2.42s]
2022-03-07 13:41:21.768198 (Thread-1): Finished running node model.snowflake_aicd.V_DATE_STG
2022-03-07 13:41:21.768622 (Thread-1): Began running node model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:41:21.769400 (Thread-1): 10:41:21 | 5 of 28 START view model DBT_SHOPIFY.V_LOCATION_STG.................. [RUN]
2022-03-07 13:41:21.770473 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:41:21.770824 (Thread-1): Compiling model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:41:21.777457 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-07 13:41:21.778401 (Thread-1): finished collecting timing info
2022-03-07 13:41:21.781264 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-07 13:41:21.784035 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:41:21.784296 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-07 13:41:21.784479 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:23.522181 (Thread-1): SQL status: SUCCESS 1 in 1.74 seconds
2022-03-07 13:41:23.534211 (Thread-1): finished collecting timing info
2022-03-07 13:41:23.534591 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-07 13:41:23.999159 (Thread-1): 10:41:23 | 5 of 28 OK created view model DBT_SHOPIFY.V_LOCATION_STG............. [SUCCESS 1 in 2.23s]
2022-03-07 13:41:24.000289 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:41:24.004467 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-07 13:41:24.007904 (Thread-1): 10:41:24 | 6 of 28 START view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG......... [RUN]
2022-03-07 13:41:24.008456 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-07 13:41:24.008747 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-07 13:41:24.012267 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-07 13:41:24.013617 (Thread-1): finished collecting timing info
2022-03-07 13:41:24.015194 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"
2022-03-07 13:41:24.017413 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-07 13:41:24.017547 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_ADJUSTMENT" AS A
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_ADJUSTMENT_DLHK
  --BK
  ,ID AS K_ORDER_ADJUSTMENT_BK
  ,ORDER_ID AS K_ORDER_BK
  ,REFUND_ID AS K_REFUND_BK
  --ATTRIBUTE
  ,KIND AS A_KIND
  ,REASON AS A_REASON
  --METRIC
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TAX_AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_AMOUNT_PRIMARY
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.AMOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_AMOUNT_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-07 13:41:24.017702 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:25.670356 (Thread-1): SQL status: SUCCESS 1 in 1.65 seconds
2022-03-07 13:41:25.675269 (Thread-1): finished collecting timing info
2022-03-07 13:41:25.675914 (Thread-1): On model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG: Close
2022-03-07 13:41:26.134374 (Thread-1): 10:41:26 | 6 of 28 OK created view model DBT_SHOPIFY.V_ORDERS_ADJUSTMENT_STG.... [SUCCESS 1 in 2.13s]
2022-03-07 13:41:26.135697 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG
2022-03-07 13:41:26.136604 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-07 13:41:26.140975 (Thread-1): 10:41:26 | 7 of 28 START view model DBT_SHOPIFY.V_ORDERS_HEADER_STG............. [RUN]
2022-03-07 13:41:26.143055 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-07 13:41:26.144162 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-07 13:41:26.154662 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-07 13:41:26.155261 (Thread-1): finished collecting timing info
2022-03-07 13:41:26.157145 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_HEADER_STG"
2022-03-07 13:41:26.169402 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-07 13:41:26.169634 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDERS" AS A
),
rename AS 
(
SELECT
    MD5(O.ID) AS K_ORDER_DLHK    
    ,MD5(O.CUSTOMER_ID) AS K_CUSTOMER_DLHK
    ,MD5(O.LOCATION_ID) AS K_LOCATION_DLHK    
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK
    ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(O.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
    --BUSINESS_KEYS
    ,O.APP_ID AS K_APP_BK
    ,O.ID AS K_ORDER_BK
    ,O.CUSTOMER_ID AS K_CUSTOMER_BK
    ,O.DEVICE_ID AS K_DEVICE_BK  
    ,O.LOCATION_ID AS K_LOCATION_BK
    ,O.SOURCE_IDENTIFIER AS K_SOURCE_ENTIFIER_BK
    --ATTRIBUTES
    ,O.BROWSER_IP AS A_BROWSER_IP
    ,O.CANCELLED_AT AS A_CANCELLED_AT_DTS
    ,O.CANCEL_REASON AS A_CANCEL_REASON
    ,O.CART_TOKEN AS A_CART_TOKEN
    ,O.CHECKOUT_TOKEN AS A_CHECKOUT_TOKEN
    ,O.CLIENT_DETAILS AS A_CLIENT_DETAILS
    ,O.CLOSED_AT AS A_CLOSED_AT_DTS
    ,O.CREATED_AT AS A_CREATED_AT_DTS
    ,O.CURRENCY AS A_CURRENCY
    ,O.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
    ,O.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
    ,O.EMAIL AS A_EMAIL
    ,O.FINANCIAL_STATUS AS A_FINANCIAL_STATUS
    ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
    ,O.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
    ,O.LANDING_SITE_REF AS A_LANDING_SITE_REF
    ,O.NAME AS A_NAME
    ,O.NOTE AS A_NOTE
    ,O.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES    
    ,O.PAYMENT_GATEWAY_NAMES AS A_PAYMENT_GATEWAY_NAMES    
    ,O.PROCESSED_AT AS A_PROCESSED_AT_DTS
    ,O.PROCESSING_METHOD AS A_PROCESSING_METHOD
    ,O.REFERENCE AS A_REFERENCE
    ,O.REFERRING_SITE AS A_REFERRING_SITE    
    ,O.SOURCE_NAME AS A_SOURCE_NAME
    ,O.SOURCE_URL AS A_SOURCE_URL    
    ,O.ORDER_NUMBER AS A_ORDER_NUMBER
    ,O.POSION_NUMBER AS A_POSION_NUMBER  
    ,O.UPDATED_AT AS A_UPDATED_AT_DTS
    --BOOLEAN
    ,O.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
    ,O.CONFIRMED AS B_CONFIRMED
    ,O.TAXES_INCLUDED AS B_TAXES_INCLUDED
    --METRICS
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.SUBTOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNTS_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNTS_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_LINE_ITEMS_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_LINE_ITENS_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_PRICE_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
    ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE
    ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_SHIPPING_PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_SHIPPING_PRICE_PRIMARY 
    ,O.TOTAL_TIP_RECEIVED::DECIMAL(15,2) AS M_TOTAL_TIP_RECEIVED   
    ,O.TOTAL_WEIGHT::DECIMAL(15,2) AS M_TOTAL_WEIGHT
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
FROM source O
)

SELECT * FROM rename
  );
2022-03-07 13:41:26.169951 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:28.021292 (Thread-1): SQL status: SUCCESS 1 in 1.85 seconds
2022-03-07 13:41:28.028709 (Thread-1): finished collecting timing info
2022-03-07 13:41:28.031324 (Thread-1): On model.snowflake_aicd.V_ORDERS_HEADER_STG: Close
2022-03-07 13:41:28.506480 (Thread-1): 10:41:28 | 7 of 28 OK created view model DBT_SHOPIFY.V_ORDERS_HEADER_STG........ [SUCCESS 1 in 2.36s]
2022-03-07 13:41:28.507449 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_HEADER_STG
2022-03-07 13:41:28.509275 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-07 13:41:28.510833 (Thread-1): 10:41:28 | 8 of 28 START view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG.. [RUN]
2022-03-07 13:41:28.514541 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-07 13:41:28.515474 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-07 13:41:28.521835 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-07 13:41:28.522343 (Thread-1): finished collecting timing info
2022-03-07 13:41:28.523951 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"
2022-03-07 13:41:28.525683 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-07 13:41:28.525804 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM_TAX_LINE" AS A
),
rename AS 
(
SELECT
  CONCAT(COALESCE(ORDER_ID,'0000000000'),'-',COALESCE(ORDER_LINE_ID,'0000000000')) AS K_ORDER_LINE_ITEM_TAX_DLHK
  ,ORDER_ID AS K_ORDER_BK
  ,ORDER_LINE_ID AS K_ORDER_LINE_ITEM_BK
  ,TITLE AS A_TITLE
  ,CHANNEL_LIABLE AS B_CHANNEL_LIABLE
  ,RATE AS M_RATE
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TAX_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
FROM source O  
)

SELECT * FROM rename
  );
2022-03-07 13:41:28.525910 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:30.168925 (Thread-1): SQL status: SUCCESS 1 in 1.64 seconds
2022-03-07 13:41:30.171694 (Thread-1): finished collecting timing info
2022-03-07 13:41:30.171982 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG: Close
2022-03-07 13:41:30.612507 (Thread-1): 10:41:30 | 8 of 28 OK created view model DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG [SUCCESS 1 in 2.10s]
2022-03-07 13:41:30.612759 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG
2022-03-07 13:41:30.612898 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-07 13:41:30.613063 (Thread-1): 10:41:30 | 9 of 28 START view model DBT_SHOPIFY.V_PRODUCT_STG................... [RUN]
2022-03-07 13:41:30.613370 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-07 13:41:30.613489 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_STG
2022-03-07 13:41:30.617504 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-07 13:41:30.618260 (Thread-1): finished collecting timing info
2022-03-07 13:41:30.621613 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_STG"
2022-03-07 13:41:30.623176 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-07 13:41:30.623485 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_DLHK
  ,ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE
  ,HANDLE AS A_HANDLE
  ,PRODUCT_TYPE AS A_PRODUCT_TYPE
  ,VENDOR AS A_VENDOR
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE
  ,STATUS AS A_STATUS
  ,TEMPLATE_SUFFIX AS A_TEMPLATE_SUFFIX   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-07 13:41:30.623700 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:32.410197 (Thread-1): SQL status: SUCCESS 1 in 1.79 seconds
2022-03-07 13:41:32.412972 (Thread-1): finished collecting timing info
2022-03-07 13:41:32.413237 (Thread-1): On model.snowflake_aicd.V_PRODUCT_STG: Close
2022-03-07 13:41:32.861669 (Thread-1): 10:41:32 | 9 of 28 OK created view model DBT_SHOPIFY.V_PRODUCT_STG.............. [SUCCESS 1 in 2.25s]
2022-03-07 13:41:32.861947 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_STG
2022-03-07 13:41:32.862094 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-07 13:41:32.862640 (Thread-1): 10:41:32 | 10 of 28 START view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG.......... [RUN]
2022-03-07 13:41:32.863273 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-07 13:41:32.863541 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-07 13:41:32.868959 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-07 13:41:32.869373 (Thread-1): finished collecting timing info
2022-03-07 13:41:32.870726 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"
2022-03-07 13:41:32.872970 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-07 13:41:32.873164 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_VARIANT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."PRODUCT_VARIANT"
),

rename as (


SELECT
  MD5(ID) AS K_PRODUCT_VARIANT_DLHK
  ,MD5(PRODUCT_ID) AS K_PRODUCT_DLHK  
  --BUSINESS KEYS  
  ,ID AS K_PRODUCT_VARIANT_BK
  ,PRODUCT_ID AS K_PRODUCT_BK  
  ,INVENTORY_ITEM_ID AS K_INVENTORY_ITEM_BK
  ,IMAGE_ID AS K_IMAGE_BK
  --ATTRIBUTES
  ,TITLE AS A_TITLE  
  ,SKU AS A_SKU    
  ,FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,INVENTORY_MANAGEMENT AS A_INVENTORY_MANAGEMENT
  ,INVENTORY_POLICY AS A_INVENTORY_POLICY
  ,BARCODE AS A_BARCODE
  ,GRAMS AS A_GRAMS
  ,WEIGHT_UNIT AS A_WEIGHT_UNIT
  ,OPTION_1 AS A_OPTION_1
  ,OPTION_2 AS A_OPTION_2
  ,OPTION_3 AS A_OPTION_3
  ,TAX_CODE AS A_TAX_CODE  
  ,PRESENTMENT_PRICES AS A_PRESENTMENT_PRICES  
  ,CREATED_AT AS A_CREATED_AT_DTS
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  --BOOLEAN
  ,REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,TAXABLE AS B_TAXABLE
  --METRICS
  ,PRICE AS M_PRICE
  ,POSITION AS M_POSITION
  ,COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,INVENTORY_QUANTITY AS M_INVENTORY_QUANTITY
  ,INVENTORY_QUANTITY_ADJUSTMENT AS M_INVENTORY_QUANTITY_ADJUSTMENT
  ,WEIGHT AS M_WEIGHT
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-07 13:41:32.873272 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:34.635617 (Thread-1): SQL status: SUCCESS 1 in 1.76 seconds
2022-03-07 13:41:34.637039 (Thread-1): finished collecting timing info
2022-03-07 13:41:34.637237 (Thread-1): On model.snowflake_aicd.V_PRODUCT_VARIANT_STG: Close
2022-03-07 13:41:35.095663 (Thread-1): 10:41:35 | 10 of 28 OK created view model DBT_SHOPIFY.V_PRODUCT_VARIANT_STG..... [SUCCESS 1 in 2.23s]
2022-03-07 13:41:35.096282 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_VARIANT_STG
2022-03-07 13:41:35.097015 (Thread-1): Began running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-07 13:41:35.099221 (Thread-1): 10:41:35 | 11 of 28 START view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG......... [RUN]
2022-03-07 13:41:35.103288 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-07 13:41:35.103883 (Thread-1): Compiling model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-07 13:41:35.112417 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-07 13:41:35.113109 (Thread-1): finished collecting timing info
2022-03-07 13:41:35.115709 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"
2022-03-07 13:41:35.118540 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-07 13:41:35.118734 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG  as (
    


WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND" AS A
),
refund_line as (
    SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."REFUND_LINE_ITEM" AS A
),
rename AS 
(
SELECT
  MD5(RL.ID) AS K_REFUND_LINE_DLHK
  ,MD5(R.ID) AS K_REFUND_DLHK
  ,R.ID AS K_REFUND_BK
  ,RL.ID AS K_REFUND_LINE_BK
  ,R.ORDER_ID AS K_ORDER_BK
  ,R.USER_ID AS K_USER_BK
  ,RL.LOCATION_ID AS K_LOCATION_BK
  ,RL.LINE_ITEM_ID AS K_ORDER_LINE_ITEM_BK
  ,R.NOTE AS A_NOTE
  ,R.RESTOCK AS B_RESTOCK
  ,RL.QUANTITY AS M_QUANTITY
  ,RL.RESTOCK_TYPE AS A_RESTOCK_TYPE
   
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.SUBTOTAL_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_SUBTOTAL


  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX_PRIMARY
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(RL.TOTAL_TAX_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_TAX
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
FROM source R
LEFT JOIN refund_line RL ON RL.REFUND_ID = R.ID
)

SELECT * FROM rename
  );
2022-03-07 13:41:35.118858 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:37.080278 (Thread-1): SQL status: SUCCESS 1 in 1.96 seconds
2022-03-07 13:41:37.095865 (Thread-1): finished collecting timing info
2022-03-07 13:41:37.097448 (Thread-1): On model.snowflake_aicd.V_REFUND_LINE_ITEM_STG: Close
2022-03-07 13:41:37.558336 (Thread-1): 10:41:37 | 11 of 28 OK created view model DBT_SHOPIFY.V_REFUND_LINE_ITEM_STG.... [SUCCESS 1 in 2.45s]
2022-03-07 13:41:37.558891 (Thread-1): Finished running node model.snowflake_aicd.V_REFUND_LINE_ITEM_STG
2022-03-07 13:41:37.559298 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-07 13:41:37.561422 (Thread-1): 10:41:37 | 12 of 28 START table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D.......... [RUN]
2022-03-07 13:41:37.562627 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-07 13:41:37.564311 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-07 13:41:37.576699 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-07 13:41:37.577643 (Thread-1): finished collecting timing info
2022-03-07 13:41:37.599076 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"
2022-03-07 13:41:37.600113 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-07 13:41:37.600254 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_ADDRESS_STG AS C
      );
2022-03-07 13:41:37.600391 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:40.573570 (Thread-1): SQL status: SUCCESS 1 in 2.97 seconds
2022-03-07 13:41:40.594700 (Thread-1): finished collecting timing info
2022-03-07 13:41:40.595235 (Thread-1): On model.snowflake_aicd.W_CUSTOMER_ADDRESS_D: Close
2022-03-07 13:41:41.056610 (Thread-1): 10:41:41 | 12 of 28 OK created table model DBT_SHOPIFY.W_CUSTOMER_ADDRESS_D..... [SUCCESS 1 in 3.49s]
2022-03-07 13:41:41.057597 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMER_ADDRESS_D
2022-03-07 13:41:41.058862 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:41:41.060046 (Thread-1): 10:41:41 | 13 of 28 START table model DBT_SHOPIFY.W_CUSTOMERS_D................. [RUN]
2022-03-07 13:41:41.060953 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:41:41.061455 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:41:41.066597 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-07 13:41:41.067667 (Thread-1): finished collecting timing info
2022-03-07 13:41:41.070961 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-07 13:41:41.072372 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:41:41.072610 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG AS C
      );
2022-03-07 13:41:41.072843 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:43.585221 (Thread-1): SQL status: SUCCESS 1 in 2.51 seconds
2022-03-07 13:41:43.589301 (Thread-1): finished collecting timing info
2022-03-07 13:41:43.589873 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-07 13:41:44.049403 (Thread-1): 10:41:44 | 13 of 28 OK created table model DBT_SHOPIFY.W_CUSTOMERS_D............ [SUCCESS 1 in 2.99s]
2022-03-07 13:41:44.050545 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:41:44.051015 (Thread-1): Began running node model.snowflake_aicd.W_DATE_D
2022-03-07 13:41:44.052916 (Thread-1): 10:41:44 | 14 of 28 START table model DBT_SHOPIFY.W_DATE_D...................... [RUN]
2022-03-07 13:41:44.053964 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-07 13:41:44.054303 (Thread-1): Compiling model.snowflake_aicd.W_DATE_D
2022-03-07 13:41:44.059406 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-07 13:41:44.060235 (Thread-1): finished collecting timing info
2022-03-07 13:41:44.062638 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-07 13:41:44.067944 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-07 13:41:44.068154 (Thread-1): On model.snowflake_aicd.W_DATE_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_DATE_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_DATE_D  as
      (

SELECT 
	CAST(DATE_KEY AS NUMBER(9)) AS K_DATE_INTEGER_BK
	,CAST(DATE_COLUMN AS DATE) AS K_DATE_BK
	,CAST(FULL_DATE_DESC AS VARCHAR(64)) AS A_FULL_DATE_DESC
	,CAST(DAY_NUM_IN_WEEK AS NUMBER(1)) AS A_DAY_NUM_IN_WEEK
	,CAST(DAY_NUM_IN_MONTH AS NUMBER(2)) AS A_DAY_NUM_IN_MONTH
	,CAST(DAY_NUM_IN_YEAR AS NUMBER(3)) AS A_DAY_NUM_IN_YEAR
	,CAST(DAY_NAME AS VARCHAR(10)) AS A_DAY_NAME
	,CAST(DAY_ABBREV AS VARCHAR(3)) AS A_DAY_ABBREV
	,CAST(WEEKDAY_IND AS VARCHAR(64)) AS A_WEEKDAY_IND
	,CAST(US_HOLIDAY_IND AS VARCHAR(64)) AS A_US_HOLIDAY_IND
	,CAST(COMPANY_HOLIDAY_IND AS VARCHAR(64)) AS A_COMPANY_HOLIDAY_IND
	,CAST(MONTH_END_IND AS VARCHAR(64)) AS A_MONTH_END_IND
	,CAST(WEEK_BEGIN_DATE_NKEY AS NUMBER(9)) AS A_WEEK_BEGIN_DATE_NKEY
	,CAST(WEEK_BEGIN_DATE AS DATE) AS A_WEEK_BEGIN_DATE
	,CAST(WEEK_END_DATE_NKEY AS NUMBER(9)) AS A_WEEK_END_DATE_NKEY
	,CAST(WEEK_END_DATE AS DATE) AS A_WEEK_END_DATE
	,CAST(WEEK_NUM_IN_YEAR AS NUMBER(9)) AS A_WEEK_NUM_IN_YEAR
	,CAST(MONTH_NAME AS VARCHAR(10)) AS A_MONTH_NAME
	,CAST(MONTH_ABBREV AS VARCHAR(3)) AS A_MONTH_ABBREV
	,CAST(MONTH_NUM_IN_YEAR AS NUMBER(2)) AS A_MONTH_NUM_IN_YEAR
	,CAST(YEARMONTH AS VARCHAR(10)) AS A_YEARMONTH
	,CAST(CURRENT_QUARTER AS NUMBER(1)) AS A_QUARTER
	,CAST(YEARQUARTER AS VARCHAR(10)) AS A_YEARQUARTER
	,CAST(CURRENT_YEAR AS NUMBER(5)) AS A_YEAR
	,CAST(FISCAL_WEEK_NUM AS NUMBER(2)) AS A_FISCAL_WEEK_NUM
	,CAST(FISCAL_MONTH_NUM AS NUMBER(2)) AS A_FISCAL_MONTH_NUM
	,CAST(FISCAL_YEARMONTH AS VARCHAR(10)) AS A_FISCAL_YEARMONTH
	,CAST(FISCAL_QUARTER AS NUMBER(1)) AS A_FISCAL_QUARTER
	,CAST(FISCAL_YEARQUARTER AS VARCHAR(10)) AS A_FISCAL_YEARQUARTER
	,CAST(FISCAL_HALFYEAR AS NUMBER(1)) AS A_FISCAL_HALFYEAR
	,CAST(FISCAL_YEAR AS NUMBER(5)) AS A_FISCAL_YEAR
	,CAST(SQL_TIMESTAMP AS TIMESTAMP_NTZ) AS A_SQL_TIMESTAMP_DTS
	,CAST(CURRENT_ROW_IND AS CHAR(1)) AS A_CURRENT_ROW_IND
	,CAST(EFFECTIVE_DATE AS DATE) AS A_EFFECTIVE_DATE
	,CAST(EXPIRA_DATE AS DATE) AS A_EXPIRATION_DATE
FROM
DEVELOPER_SANDBOX.DBT_SHOPIFY.V_DATE_STG
      );
2022-03-07 13:41:44.068335 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:47.592657 (Thread-1): SQL status: SUCCESS 1 in 3.52 seconds
2022-03-07 13:41:47.598048 (Thread-1): finished collecting timing info
2022-03-07 13:41:47.599035 (Thread-1): On model.snowflake_aicd.W_DATE_D: Close
2022-03-07 13:41:48.044167 (Thread-1): 10:41:48 | 14 of 28 OK created table model DBT_SHOPIFY.W_DATE_D................. [SUCCESS 1 in 3.99s]
2022-03-07 13:41:48.045012 (Thread-1): Finished running node model.snowflake_aicd.W_DATE_D
2022-03-07 13:41:48.046682 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:41:48.047605 (Thread-1): 10:41:48 | 15 of 28 START table model DBT_SHOPIFY.W_LOCATION_D.................. [RUN]
2022-03-07 13:41:48.048279 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:41:48.048461 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:41:48.051139 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-07 13:41:48.051587 (Thread-1): finished collecting timing info
2022-03-07 13:41:48.053097 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-07 13:41:48.053781 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:41:48.053895 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-07 13:41:48.054000 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:50.431760 (Thread-1): SQL status: SUCCESS 1 in 2.38 seconds
2022-03-07 13:41:50.434795 (Thread-1): finished collecting timing info
2022-03-07 13:41:50.435188 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-07 13:41:50.904880 (Thread-1): 10:41:50 | 15 of 28 OK created table model DBT_SHOPIFY.W_LOCATION_D............. [SUCCESS 1 in 2.86s]
2022-03-07 13:41:50.908902 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:41:50.910857 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-07 13:41:50.911766 (Thread-1): 10:41:50 | 16 of 28 START view model DBT_SHOPIFY.V_PRODUCTS_D_STG............... [RUN]
2022-03-07 13:41:50.912847 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-07 13:41:50.914115 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-07 13:41:50.918185 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-07 13:41:50.918722 (Thread-1): finished collecting timing info
2022-03-07 13:41:50.920572 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCTS_D_STG"
2022-03-07 13:41:50.924403 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-07 13:41:50.924559 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCTS_D_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG  as (
    
 

WITH product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_STG
),
product_variant AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_VARIANT_STG
),

rename as (


SELECT
    MD5(CONCAT(P.K_PRODUCT_BK,'-',COALESCE(V.K_PRODUCT_VARIANT_BK,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
    ,P.K_PRODUCT_DLHK
    ,V.K_PRODUCT_VARIANT_DLHK AS K_PRODUCT_VARIANT_DLHK
    ,V.K_PRODUCT_VARIANT_BK AS K_PRODUCT_VARIANT_BK
    ,P.K_PRODUCT_BK AS K_PRODUCT_BK
    ,V.K_INVENTORY_ITEM_BK AS K_VARIANT_INVENTORY_ITEM_BK
    ,V.K_IMAGE_BK AS K_VARIANT_IMAGE_BK
    --ATTRIBUTES
    ,P.A_TITLE
    ,P.A_HANDLE
    ,P.A_PRODUCT_TYPE
    ,P.A_VENDOR
    ,P.A_CREATED_AT_DTS
    ,P.A_UPDATED_AT_DTS
    ,P.A_PUBLISHED_AT_DTS
    ,P.A_PUBLISHED_SCOPE
    ,P.A_STATUS
    ,P.A_TEMPLATE_SUFFIX       
    ,V.A_TITLE AS A_VARIANT_TITLE
    ,V.A_SKU AS A_VARIANT_SKU
    ,V.A_FULFILLMENT_SERVICE AS A_VARIANT_FULFILLMENT_SERVICE
    ,V.A_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
    ,V.A_BARCODE AS A_VARIANT_BARCODE
    ,V.A_INVENTORY_POLICY AS A_VARIANT_INVENTORY_POLICY
    ,V.A_GRAMS AS A_VARIANT_GRAMS
    ,V.A_WEIGHT_UNIT AS A_VARIANT_WEIGHT_UNIT
    ,V.A_OPTION_1 AS A_VARIANT_OPTION_1
    ,V.A_OPTION_2 AS A_VARIANT_OPTION_2
    ,V.A_OPTION_3 AS A_VARIANT_OPTION_3
    ,V.A_TAX_CODE AS A_VARIANT_TAX_CODE
    ,V.A_PRESENTMENT_PRICES AS A_VARIANT_PRESENTMENT_PRICES
    ,V.A_CREATED_AT_DTS AS A_VARIANT_CREATED_AT_DTS
    ,V.A_UPDATED_AT_DTS AS A_VARIANT_UPDATED_AT_DTS
    --BOOLEAN
    ,V.B_REQUIRES_SHIPPING AS B_VARIANT_REQUIRES_SHIPPING
    ,V.B_TAXABLE AS B_VARIANT_TAXABLE
    --METRICS
    ,V.M_PRICE AS M_VARIANT_PRICE
    ,V.M_POSITION AS M_VARIANT_POSITION
    ,V.M_COMPARE_AT_PRICE AS M_VARIANT_COMPARE_AT_PRICE
    ,V.M_INVENTORY_QUANTITY AS M_VARIANT_INVENTORY_QUANTITY
    ,V.M_INVENTORY_QUANTITY_ADJUSTMENT AS M_VARIANT_INVENTORY_QUANTITY_ADJUSTMENT
    ,V.M_WEIGHT AS M_VARIANT_WEIGHT
    --metadata (MD)
    ,P.MD_IS_DELETED AS MD_IS_DELETED_PRODUCT
    ,V.MD_IS_DELETED AS MD_IS_DELETED_VARIANT
    , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
    , 'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
FROM
    product P
    LEFT JOIN product_variant V ON V.K_PRODUCT_BK = P.K_PRODUCT_BK
)

SELECT * FROM rename
  );
2022-03-07 13:41:50.924772 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:52.929424 (Thread-1): SQL status: SUCCESS 1 in 2.00 seconds
2022-03-07 13:41:52.948248 (Thread-1): finished collecting timing info
2022-03-07 13:41:52.949779 (Thread-1): On model.snowflake_aicd.V_PRODUCTS_D_STG: Close
2022-03-07 13:41:53.439154 (Thread-1): 10:41:53 | 16 of 28 OK created view model DBT_SHOPIFY.V_PRODUCTS_D_STG.......... [SUCCESS 1 in 2.53s]
2022-03-07 13:41:53.440628 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCTS_D_STG
2022-03-07 13:41:53.441439 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:41:53.444160 (Thread-1): 10:41:53 | 17 of 28 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG....... [RUN]
2022-03-07 13:41:53.445781 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:41:53.446759 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:41:53.457070 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-07 13:41:53.457773 (Thread-1): finished collecting timing info
2022-03-07 13:41:53.459702 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-07 13:41:53.465832 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:41:53.466068 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT"
),
customer AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 

  MD5(S.ID) AS K_ABANDONED_CHECKOUT_DLHK
  ,C.K_CUSTOMER_DLHK
  ,L.K_LOCATION_DLHK
  ,MD5(S.USER_ID) AS K_USER_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK  
  ,S.ID AS K_ABANDONED_CHECKOUT_BK
  ,S.CUSTOMER_ID AS K_CUSTOMER_BK
  ,S.DEVICE_ID AS K_DEVICE_BK
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.SOURCE_IDENTIFIER AS K_SOURCE_BKENTIFIER
  ,S.USER_ID AS K_USER_BK
  ,S.ABANDONED_CHECKOUT_URL AS A_ABANDONED_CHECKOUT_URL  
  ,S.CART_TOKEN AS A_CART_TOKEN
  ,S.CLOSED_AT AS A_CLOSED_AT
  ,S.COMPLETED_AT AS A_COMPLETED_AT
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
  ,S.EMAIL AS A_EMAIL
  ,S.GATEWAY AS A_GATEWAY
  ,S.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
  ,S.NAME AS A_NAME
  ,S.NOTE AS A_NOTE
  ,S.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES
  ,S.PHONE AS A_PHONE
  ,S.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
  ,S.REFERRING_SITE AS A_REFERRING_SITE    
  ,S.SOURCE AS A_SOURCE
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.SOURCE_URL AS A_SOURCE_URL
  ,S.TOKEN AS A_TOKEN
  ,S.UPDATED_AT AS A_UPDATED_AT  
  --BOOLEAN
  ,S.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
  ,S.TAXES_INCLUDED AS B_TAXES_INCLUDED
  --METRIC
  ,S.SUBTOTAL_PRICE::decimal(15,2) AS M_SUBTOTAL_PRICE
  ,S.TOTAL_DISCOUNTS::decimal(15,2) AS M_TOTAL_DISCOUNTS
  ,S.TOTAL_DUTIES::decimal(15,2) AS M_TOTAL_DUTIES
  ,S.TOTAL_LINE_ITEMS_PRICE::decimal(15,2) AS M_TOTAL_LINE_ITEMS_PRICE
  ,S.TOTAL_PRICE::decimal(15,2) AS M_TOTAL_PRICE
  ,S.TOTAL_TAX::decimal(15,2) AS M_TOTAL_TAX
  ,S.TOTAL_WEIGHT::decimal(15,2) AS M_TOTAL_WEIGHT
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
  FROM
      source S
      left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
      left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-07 13:41:53.466203 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:55.424328 (Thread-1): SQL status: SUCCESS 1 in 1.96 seconds
2022-03-07 13:41:55.428000 (Thread-1): finished collecting timing info
2022-03-07 13:41:55.428493 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: Close
2022-03-07 13:41:55.904441 (Thread-1): 10:41:55 | 17 of 28 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.. [SUCCESS 1 in 2.46s]
2022-03-07 13:41:55.905471 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:41:55.907683 (Thread-1): Began running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-07 13:41:55.913456 (Thread-1): 10:41:55 | 18 of 28 START view model DBT_SHOPIFY.V_TRANSACTIONS_STG............. [RUN]
2022-03-07 13:41:55.914838 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-07 13:41:55.915482 (Thread-1): Compiling model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-07 13:41:55.923751 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-07 13:41:55.925149 (Thread-1): finished collecting timing info
2022-03-07 13:41:55.928977 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_TRANSACTIONS_STG"
2022-03-07 13:41:55.933689 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-07 13:41:55.933901 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_TRANSACTIONS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."TRANSACTION"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_TRANSACTION_DLHK
  ,L.K_LOCATION_DLHK  
  ,MD5(S.USER_ID) AS K_USER_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_TRANSACTION_BK
  ,S.DEVICE_ID AS K_DEVICE_BK  
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.ORDER_ID AS K_ORDER_BK
  ,S.PARENT_ID AS K_PARENT_BK
  ,S.REFUND_ID AS K_REFUND_BK
  ,S.USER_ID AS K_USER_BK  
  --ATTRIBUTES
  ,S.AUTHORIZATION AS A_AUTHORIZATION
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CURRENCY_EXCHANGE_ADJUSTMENT AS A_CURRENCY_EXCHANGE_ADJUSTMENT
  ,S.ERROR_CODE AS A_ERROR_CODE
  ,S.GATEWAY AS A_GATEWAY
  ,S.KIND AS A_KIND
  ,S.MESSAGE AS A_MESSAGE
  ,S.PAYMENT_DETAILS AS A_PAYMENT_DETAILS
  ,S.PROCESSED_AT AS A_PROCESSED_AT
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.STATUS AS A_STATUS
  --boolean
  ,S.TEST AS B_TEST
  --METRICS
  ,S.AMOUNT::decimal(15,2) AS M_AMOUNT   
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
  FROM
    source S  
  left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-07 13:41:55.934115 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:41:57.676217 (Thread-1): SQL status: SUCCESS 1 in 1.74 seconds
2022-03-07 13:41:57.680447 (Thread-1): finished collecting timing info
2022-03-07 13:41:57.680977 (Thread-1): On model.snowflake_aicd.V_TRANSACTIONS_STG: Close
2022-03-07 13:41:58.138138 (Thread-1): 10:41:58 | 18 of 28 OK created view model DBT_SHOPIFY.V_TRANSACTIONS_STG........ [SUCCESS 1 in 2.22s]
2022-03-07 13:41:58.138845 (Thread-1): Finished running node model.snowflake_aicd.V_TRANSACTIONS_STG
2022-03-07 13:41:58.139450 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-07 13:41:58.145935 (Thread-1): 10:41:58 | 19 of 28 START table model DBT_SHOPIFY.W_PRODUCTS_D.................. [RUN]
2022-03-07 13:41:58.147299 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-07 13:41:58.148917 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCTS_D
2022-03-07 13:41:58.157994 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-07 13:41:58.158950 (Thread-1): finished collecting timing info
2022-03-07 13:41:58.162451 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCTS_D"
2022-03-07 13:41:58.163770 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-07 13:41:58.164000 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCTS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCTS_D_STG AS C
      );
2022-03-07 13:41:58.164225 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:42:01.074748 (Thread-1): SQL status: SUCCESS 1 in 2.91 seconds
2022-03-07 13:42:01.079953 (Thread-1): finished collecting timing info
2022-03-07 13:42:01.080636 (Thread-1): On model.snowflake_aicd.W_PRODUCTS_D: Close
2022-03-07 13:42:01.542137 (Thread-1): 10:42:01 | 19 of 28 OK created table model DBT_SHOPIFY.W_PRODUCTS_D............. [SUCCESS 1 in 3.39s]
2022-03-07 13:42:01.542854 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCTS_D
2022-03-07 13:42:01.543623 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:42:01.546376 (Thread-1): 10:42:01 | 20 of 28 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_F_STG..... [RUN]
2022-03-07 13:42:01.548092 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:42:01.548579 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:42:01.554937 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG"
2022-03-07 13:42:01.555814 (Thread-1): finished collecting timing info
2022-03-07 13:42:01.559425 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG"
2022-03-07 13:42:01.566857 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:42:01.567201 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_F_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG
),
abandoned_checkout_item AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
),
rename AS 
(   
  SELECT 
  I.K_ABANDONED_CHECKOUT_ITEM_DLHK
  ,S.K_ABANDONED_CHECKOUT_DLHK
  ,I.K_PRODUCT_VARIATION_DLHK
  ,I.K_ITEM_DESTINATION_LOCATION_BK
  ,I.K_ITEM_ORIGIN_LOCATION_BK
  ,S.K_CUSTOMER_DLHK
  ,S.K_LOCATION_DLHK
  ,S.K_USER_DLHK
  ,S.K_SHIPPING_ADDRESS_DLHK
  ,S.K_BILLING_ADDRESS_DLHK  
  ,S.K_ABANDONED_CHECKOUT_BK
  ,S.K_CUSTOMER_BK
  ,S.K_DEVICE_BK
  ,S.K_LOCATION_BK
  ,S.K_SOURCE_BKENTIFIER
  ,S.K_USER_BK
  ,S.A_ABANDONED_CHECKOUT_URL  
  ,S.A_CART_TOKEN
  ,S.A_CLOSED_AT
  ,S.A_COMPLETED_AT
  ,S.A_CREATED_AT
  ,S.A_CURRENCY
  ,S.A_CUSTOMER_LOCALE
  ,S.A_EMAIL
  ,S.A_GATEWAY
  ,S.A_LANDING_SITE_BASE_URL
  ,S.A_NAME
  ,S.A_NOTE
  ,S.A_NOTE_ATTRIBUTES
  ,S.A_PHONE
  ,S.A_PRESENTMENT_CURRENCY
  ,S.A_REFERRING_SITE    
  ,S.A_SOURCE
  ,S.A_SOURCE_NAME
  ,S.A_SOURCE_URL
  ,S.A_TOKEN
  ,S.A_UPDATED_AT    
  ,S.B_BUYER_ACCEPTS_MARKETING
  ,S.B_TAXES_INCLUDED  
  ,I.B_GIFT_CARD
  ,I.B_REQUIRES_SHIPPING
  ,I.B_TAXABLE
  --,S.M_SUBTOTAL_PRICE
  ,S.M_TOTAL_DISCOUNTS
  --,S.M_TOTAL_DUTIES
  --,S.M_TOTAL_LINE_ITEMS_PRICE
  --,S.M_TOTAL_PRICE
  --,S.M_TOTAL_TAX
  
  ,ROUND(DIV0((O.M_TOTAL_DUTIES * I.PRICE),S.M_TOTAL_LINE_ITEMS_PRICE),4)::decimal(15,4) as M_ALLOCATED_DUTIES
  ,ROUND(DIV0((O.M_TOTAL_TAX * I.PRICE),S.M_TOTAL_LINE_ITEMS_PRICE),4)::decimal(15,4) as M_ALLOCATED_TAXES
  ,ROUND(DIV0((O.M_TOTAL_DISCOUNTS * I.PRICE),S.M_TOTAL_LINE_ITEMS_PRICE),4)::decimal(15,4) as M_ALLOCATED_DISCOUNTS
  
  ,I.COMPARE_AT_PRICE::decimal(15,2)  AS M_COMPARE_AT_PRICE
  ,I.GRAMS::decimal(15,2)  AS M_GRAMS
  ,I.LINE_PRICE::decimal(15,2)  AS M_LINE_PRICE
  ,I.PRICE::decimal(15,2)  AS M_PRICE
  ,I.QUANTITY::decimal(15,2)  AS M_QUANTITY
  ,I.VARIANT_PRICE::decimal(15,2)  AS M_VARIANT_PRICE
  ,(I.PRICE + M_ALLOCATED_DUTIES - M_ALLOCATED_TAXES - M_ALLOCATED_DISCOUNTS)::decimal(15,4) AS M_TOTAL_PRICE

  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
  FROM
      source S
      left join abandoned_checkout_item I ON I.K_ABANDONED_CHECKOUT_BK = S.K_ABANDONED_CHECKOUT_BK
)


SELECT * FROM rename
  );
2022-03-07 13:42:01.567430 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:42:03.338964 (Thread-1): Snowflake query id: 01a2c476-0601-4118-000b-358300f4db6e
2022-03-07 13:42:03.339177 (Thread-1): Snowflake error: 000904 (42000): SQL compilation error: error line 22 at position 3
invalid identifier 'I.K_ITEM_DESTINATION_LOCATION_BK'
2022-03-07 13:42:03.339371 (Thread-1): finished collecting timing info
2022-03-07 13:42:03.339535 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG: Close
2022-03-07 13:42:03.782918 (Thread-1): Database Error in model V_ABANDONED_CHECKOUT_F_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql)
  000904 (42000): SQL compilation error: error line 22 at position 3
  invalid identifier 'I.K_ITEM_DESTINATION_LOCATION_BK'
  compiled SQL at target/run/snowflake_aicd/models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 22 at position 3
invalid identifier 'I.K_ITEM_DESTINATION_LOCATION_BK'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_ABANDONED_CHECKOUT_F_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql)
  000904 (42000): SQL compilation error: error line 22 at position 3
  invalid identifier 'I.K_ITEM_DESTINATION_LOCATION_BK'
  compiled SQL at target/run/snowflake_aicd/models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql
2022-03-07 13:42:03.815161 (Thread-1): 10:42:03 | 20 of 28 ERROR creating view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_F_STG [ERROR in 2.27s]
2022-03-07 13:42:03.815486 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:42:03.815778 (Thread-1): Began running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-07 13:42:03.816125 (Thread-1): 10:42:03 | 21 of 28 START table model DBT_SHOPIFY.W_TRANSACTIONS_F.............. [RUN]
2022-03-07 13:42:03.816791 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-07 13:42:03.817028 (Thread-1): Compiling model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-07 13:42:03.820901 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-07 13:42:03.821664 (Thread-1): finished collecting timing info
2022-03-07 13:42:03.825011 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_TRANSACTIONS_F"
2022-03-07 13:42:03.826032 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-07 13:42:03.826203 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_TRANSACTIONS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_TRANSACTIONS_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_TRANSACTIONS_STG AS C
      );
2022-03-07 13:42:03.826366 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:42:06.844940 (Thread-1): SQL status: SUCCESS 1 in 3.02 seconds
2022-03-07 13:42:06.852068 (Thread-1): finished collecting timing info
2022-03-07 13:42:06.852905 (Thread-1): On model.snowflake_aicd.W_TRANSACTIONS_F: Close
2022-03-07 13:42:07.307422 (Thread-1): 10:42:07 | 21 of 28 OK created table model DBT_SHOPIFY.W_TRANSACTIONS_F......... [SUCCESS 1 in 3.49s]
2022-03-07 13:42:07.309057 (Thread-1): Finished running node model.snowflake_aicd.W_TRANSACTIONS_F
2022-03-07 13:42:07.309531 (Thread-1): Began running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-07 13:42:07.310043 (Thread-1): 10:42:07 | 22 of 28 START view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG........... [RUN]
2022-03-07 13:42:07.311338 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-07 13:42:07.313029 (Thread-1): Compiling model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-07 13:42:07.331378 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-07 13:42:07.332572 (Thread-1): finished collecting timing info
2022-03-07 13:42:07.336032 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_INVENTORY_ITEM_STG"
2022-03-07 13:42:07.340820 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-07 13:42:07.341216 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_INVENTORY_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_ITEM"
),
inventory_level AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."INVENTORY_LEVEL"
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
products AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename AS 
(   
  SELECT   
  MD5(S.ID) AS K_INVENTORY_ITEM_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
  ,L.K_LOCATION_DLHK
  ,L.K_LOCATION_BK  
  ,S.ID AS K_INVENTORY_ITEM_BK
  ,S.COUNTRY_CODE_OF_ORIGIN AS A_COUNTRY_CODE_OF_ORIGIN
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.PROVINCE_CODE_OF_ORIGIN AS A_PROVINCE_CODE_OF_ORIGIN
  ,S.SKU AS A_SKU
  ,S.UPDATED_AT AS A_UPDATED_AT
  ,S.HARMONIZED_SYSTEM_CODE AS A_HARMONIZED_SYSTEM_CODE  
  --BOOLEAN
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TRACKED AS B_TRACKED
  --METRICS
  ,S.COST::decimal(15,2) AS M_COST 
  ,IL.AVAILABLE AS M_AVAIABLE  
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
  FROM
      source S
      left join inventory_level IL ON IL.INVENTORY_ITEM_ID = S.ID      
      left join locations L ON L.K_LOCATION_BK = IL.LOCATION_ID
      left join products P ON P.K_VARIANT_INVENTORY_ITEM_BK = S.ID 
)


SELECT * FROM rename
  );
2022-03-07 13:42:07.341455 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:42:09.187276 (Thread-1): SQL status: SUCCESS 1 in 1.85 seconds
2022-03-07 13:42:09.192712 (Thread-1): finished collecting timing info
2022-03-07 13:42:09.193513 (Thread-1): On model.snowflake_aicd.V_INVENTORY_ITEM_STG: Close
2022-03-07 13:42:09.652250 (Thread-1): 10:42:09 | 22 of 28 OK created view model DBT_SHOPIFY.V_INVENTORY_ITEM_STG...... [SUCCESS 1 in 2.34s]
2022-03-07 13:42:09.653240 (Thread-1): Finished running node model.snowflake_aicd.V_INVENTORY_ITEM_STG
2022-03-07 13:42:09.653797 (Thread-1): Began running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-07 13:42:09.654919 (Thread-1): 10:42:09 | 23 of 28 START view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG......... [RUN]
2022-03-07 13:42:09.658891 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-07 13:42:09.660000 (Thread-1): Compiling model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-07 13:42:09.675760 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-07 13:42:09.677148 (Thread-1): finished collecting timing info
2022-03-07 13:42:09.681116 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"
2022-03-07 13:42:09.689538 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-07 13:42:09.689731 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."ORDER_LINE_ITEM" AS A
),
products AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D AS A
),
taxes AS (
  SELECT 
      K_ORDER_LINE_ITEM_BK,
      AVG(M_RATE) AS M_RATE,
      SUM(M_TAX) AS M_TAX,
      SUM(M_TAX_PRIMARY) AS M_TAX_PRIMARY
    FROM 
      DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDER_LINE_ITEM_TAX_LINE_STG AS A
    GROUP BY K_ORDER_LINE_ITEM_BK
),
rename AS 
(
SELECT
  --dlhk 
  MD5(ID) AS K_ORDER_LINE_ITEM_DLHK  
  ,MD5(ORDER_ID) AS K_ORDER_DLHK
  ,P.K_PRODUCT_VARIATION_DLHK
 --business keys
  ,O.PRODUCT_ID AS K_PRODUCT_BK
  ,O.VARIANT_ID AS K_VARIANT_BK
  
  ,O.ORDER_ID AS K_ORDER_BK
  ,O.ID AS K_ORDER_LINE_ITEM_BK
  --attribubtes
  ,O.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,O.FULFILLMENT_STATUS AS A_FULFILLMENT_STATUS
  ,O.NAME AS A_NAME  
  ,O.PROPERTIES AS A_PROPERTIES
  ,O.SKU AS A_SKU
  ,O.TITLE AS A_TITLE  
  ,O.VARIANT_INVENTORY_MANAGEMENT AS A_VARIANT_INVENTORY_MANAGEMENT
  ,O.VARIANT_TITLE AS A_VARIANT_TITLE
  ,O.VENDOR AS A_VENDOR
  --boolean
  ,O.GIFT_CARD AS B_GIFT_CARD
  ,O.PRODUCT_EXISTS AS B_PRODUCT_EXISTS
  ,O.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,O.TAXABLE AS B_TAXABLE
  --metrics
  ,O.FULFILLABLE_QUANTITY AS M_FULFILLABLE_QUANTITY
  ,O.GRAMS::DECIMAL(15,2) AS M_GRAMS
  ,O.QUANTITY::DECIMAL(15,2) AS M_QUANTITY
  ,M_RATE AS M_TAX_RATE
  ,COALESCE(T.M_TAX_PRIMARY,0)::DECIMAL(15,2) AS M_TAX_AMOUNT
  ,COALESCE(T.M_TAX,0)::DECIMAL(15,2) AS M_TAX_AMOUNT_PRIMARY

  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.PRICE_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_UNIT_PRICE_PRIMARY 
  ,

CASE WHEN  'original' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'original' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT
  ,

CASE WHEN  'primary' = 'original' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'presentment_money.amount'),'0')::decimal(15,2)
WHEN 'primary' = 'primary' THEN
    coalesce(get_path(parse_json(O.TOTAL_DISCOUNT_SET), 'shop_money.amount'),'0')::decimal(15,2)
END

 AS M_TOTAL_DISCOUNT_PRIMARY 
  ,(O.QUANTITY * M_UNIT_PRICE)::DECIMAL(15,2) AS M_TOTAL_PRICE  
  ,(O.QUANTITY * M_UNIT_PRICE_PRIMARY)::DECIMAL(15,2) AS M_TOTAL_PRICE_PRIMARY
   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
FROM source O
  left join products P ON P.K_PRODUCT_BK = O.PRODUCT_ID AND CASE WHEN O.VARIANT_ID IS NOT NULL THEN O.VARIANT_ID = P.K_PRODUCT_VARIANT_BK ELSE 1=1 END
  left join taxes T ON T.K_ORDER_LINE_ITEM_BK = O.ID
)

SELECT * FROM rename
  );
2022-03-07 13:42:09.689928 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:42:11.549022 (Thread-1): SQL status: SUCCESS 1 in 1.86 seconds
2022-03-07 13:42:11.553985 (Thread-1): finished collecting timing info
2022-03-07 13:42:11.554497 (Thread-1): On model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG: Close
2022-03-07 13:42:12.017713 (Thread-1): 10:42:12 | 23 of 28 OK created view model DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG.... [SUCCESS 1 in 2.36s]
2022-03-07 13:42:12.018712 (Thread-1): Finished running node model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG
2022-03-07 13:42:12.019378 (Thread-1): Began running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-07 13:42:12.021734 (Thread-1): 10:42:12 | 24 of 28 START view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG....... [RUN]
2022-03-07 13:42:12.023240 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-07 13:42:12.024559 (Thread-1): Compiling model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-07 13:42:12.033641 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-07 13:42:12.034584 (Thread-1): finished collecting timing info
2022-03-07 13:42:12.037038 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"
2022-03-07 13:42:12.041614 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-07 13:42:12.041883 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECT"
),
source_collection AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."COLLECTION"
),
product AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCTS_D
),
rename as (

SELECT
  MD5(S.ID) AS K_PRODUCT_COLLECT_DLHK
  ,MD5(CC.ID) AS K_COLLECTION_DLHK
  ,P.K_PRODUCT_DLHK  
  ,S.ID AS K_PRODUCT_COLLECT_BK
  ,CC.ID AS K_COLLECTION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  --ATTRIBUTES
  ,S.POSITION AS A_POSITION
  ,S.SORT_ORDER AS A_SORT_ORDER  
  ,S.CREATED_AT AS A_CREATED_AT_DTS
  ,S.UPDATED_AT AS A_UPDATED_AT_DTS
  ,CC.PUBLISHED_AT AS A_PUBLISHED_AT_DTS
  ,CC.BODY_HTML AS A_BODY_HTML
  ,CC.TITLE AS A_TITLE
  ,CC.HANDLE AS A_HANDLE
  ,CC.PUBLISHED_SCOPE AS A_PUBLISHED_SCOPE  
  ,CC.COLLECTION_TYPE AS A_COLLECTION_TYPE  
  --metrics
  ,CC.PRODUCTS_COUNT AS M_PRODUCTS_COUNT
  --metadata (MD)
  ,S.__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
FROM
    source S
    LEFT JOIN source_collection CC ON CC.ID = S.COLLECTION_ID
    LEFT JOIN product P ON P.K_PRODUCT_BK = S.PRODUCT_ID
)

SELECT * FROM rename
  );
2022-03-07 13:42:12.042127 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:42:14.450193 (Thread-1): SQL status: SUCCESS 1 in 2.41 seconds
2022-03-07 13:42:14.456738 (Thread-1): finished collecting timing info
2022-03-07 13:42:14.457517 (Thread-1): On model.snowflake_aicd.V_PRODUCT_COLLECTION_STG: Close
2022-03-07 13:42:14.930439 (Thread-1): 10:42:14 | 24 of 28 OK created view model DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG.. [SUCCESS 1 in 2.91s]
2022-03-07 13:42:14.931515 (Thread-1): Finished running node model.snowflake_aicd.V_PRODUCT_COLLECTION_STG
2022-03-07 13:42:14.932128 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-07 13:42:14.933282 (Thread-1): 10:42:14 | 25 of 28 SKIP relation DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F............ [SKIP]
2022-03-07 13:42:14.935447 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-07 13:42:14.936535 (Thread-1): Began running node model.snowflake_aicd.W_INVENTORY_F
2022-03-07 13:42:14.938014 (Thread-1): 10:42:14 | 26 of 28 START table model DBT_SHOPIFY.W_INVENTORY_F................. [RUN]
2022-03-07 13:42:14.939639 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-07 13:42:14.940525 (Thread-1): Compiling model.snowflake_aicd.W_INVENTORY_F
2022-03-07 13:42:14.947541 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-07 13:42:14.948280 (Thread-1): finished collecting timing info
2022-03-07 13:42:14.951350 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_INVENTORY_F"
2022-03-07 13:42:14.952937 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-07 13:42:14.953162 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_INVENTORY_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_INVENTORY_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_INVENTORY_ITEM_STG AS C
      );
2022-03-07 13:42:14.953384 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:42:17.887081 (Thread-1): SQL status: SUCCESS 1 in 2.93 seconds
2022-03-07 13:42:17.892949 (Thread-1): finished collecting timing info
2022-03-07 13:42:17.893811 (Thread-1): On model.snowflake_aicd.W_INVENTORY_F: Close
2022-03-07 13:42:18.365018 (Thread-1): 10:42:18 | 26 of 28 OK created table model DBT_SHOPIFY.W_INVENTORY_F............ [SUCCESS 1 in 3.43s]
2022-03-07 13:42:18.366127 (Thread-1): Finished running node model.snowflake_aicd.W_INVENTORY_F
2022-03-07 13:42:18.366692 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-07 13:42:18.367591 (Thread-1): 10:42:18 | 27 of 28 START table model DBT_SHOPIFY.W_ORDERS_F.................... [RUN]
2022-03-07 13:42:18.368889 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-07 13:42:18.372821 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-07 13:42:18.383859 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-07 13:42:18.385415 (Thread-1): finished collecting timing info
2022-03-07 13:42:18.388996 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-07 13:42:18.400410 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-07 13:42:18.400771 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ORDERS_F  as
      (

SELECT
  O.K_ORDER_DLHK AS K_ORDER_DLHK
  ,OLI.K_ORDER_LINE_ITEM_DLHK AS K_ORDER_LINE_ITEM_DLHK
  ,O.K_CUSTOMER_DLHK AS K_CUSTOMER_DLHK
  ,O.K_LOCATION_DLHK AS K_LOCATION_DLHK
  ,O.K_BILLING_ADDRESS_DLHK AS K_BILLING_ADDRESS_DLHK
  ,O.K_SHIPPING_ADDRESS_DLHK AS K_SHIPPING_ADDRESS_DLHK
  ,OLI.K_PRODUCT_VARIATION_DLHK AS K_ITEM_PRODUCT_VARIATION_DLHK
  ,OLI.K_PRODUCT_BK AS K_ITEM_PRODUCT_BK
  ,OLI.K_VARIANT_BK AS K_ITEM_VARIANT_BK
  ,OLI.K_ORDER_BK AS K_ITEM_ORDER_BK
  ,O.K_ORDER_BK AS K_ORDER_BK
  ,OLI.K_ORDER_LINE_ITEM_BK AS K_ITEM_ORDER_LINE_ITEM_BK
  ,O.K_APP_BK AS K_HEADER_APP_BK
  
  ,O.K_CUSTOMER_BK AS K_CUSTOMER_BK
  ,O.K_DEVICE_BK AS K_DEVICE_BK
  ,O.K_LOCATION_BK AS K_LOCATION_BK
  ,O.K_SOURCE_ENTIFIER_BK AS K_SOURCE_ENTIFIER_BK
  ,O.A_BROWSER_IP AS A_HEADER_BROWSER_IP
  ,O.A_CANCELLED_AT_DTS AS A_HEADER_CANCELLED_AT_DTS
  ,O.A_CANCEL_REASON AS A_HEADER_CANCEL_REASON
  ,O.A_CART_TOKEN AS A_HEADER_CART_TOKEN
  ,O.A_CHECKOUT_TOKEN AS A_HEADER_CHECKOUT_TOKEN
  ,O.A_CLIENT_DETAILS AS A_HEADER_CLIENT_DETAILS
  ,O.A_CLOSED_AT_DTS AS A_HEADER_CLOSED_AT_DTS
  ,O.A_CREATED_AT_DTS AS A_HEADER_CREATED_AT_DTS
  ,O.A_CURRENCY AS A_HEADER_CURRENCY
  ,O.A_PRESENTMENT_CURRENCY AS A_HEADER_PRESENTMENT_CURRENCY
  ,O.A_CUSTOMER_LOCALE AS A_HEADER_CUSTOMER_LOCALE
  ,O.A_EMAIL AS A_HEADER_EMAIL
  ,O.A_FINANCIAL_STATUS AS A_HEADER_FINANCIAL_STATUS
  ,O.A_FULFILLMENT_STATUS AS A_HEADER_FULFILLMENT_STATUS
  ,O.A_LANDING_SITE_BASE_URL AS A_HEADER_LANDING_SITE_BASE_URL
  ,O.A_LANDING_SITE_REF AS A_HEADER_LANDING_SITE_REF
  ,O.A_NAME AS A_HEADER_NAME
  ,O.A_NOTE AS A_HEADER_NOTE
  ,O.A_NOTE_ATTRIBUTES AS A_HEADER_NOTE_ATTRIBUTES
  ,O.A_PAYMENT_GATEWAY_NAMES AS A_HEADER_PAYMENT_GATEWAY_NAMES
  ,O.A_PROCESSED_AT_DTS AS A_HEADER_PROCESSED_AT_DTS
  ,O.A_PROCESSING_METHOD AS A_HEADER_PROCESSING_METHOD
  ,O.A_REFERENCE AS A_HEADER_REFERENCE
  ,O.A_REFERRING_SITE AS A_HEADER_REFERRING_SITE
  ,O.A_SOURCE_NAME AS A_HEADER_SOURCE_NAME
  ,O.A_SOURCE_URL AS A_HEADER_SOURCE_URL
  ,O.A_ORDER_NUMBER AS A_HEADER_ORDER_NUMBER
  ,O.A_POSION_NUMBER AS A_HEADER_POSION_NUMBER
  ,O.A_UPDATED_AT_DTS AS A_HEADER_UPDATED_AT_DTS
  ,O.B_BUYER_ACCEPTS_MARKETING AS B_HEADER_BUYER_ACCEPTS_MARKETING
  ,O.B_CONFIRMED AS B_HEADER_CONFIRMED
  ,O.B_TAXES_INCLUDED  AS B_HEADER_TAXES_INCLUDED   
  ,OLI.A_FULFILLMENT_SERVICE AS A_ITEM_FULFILLMENT_SERVICE
  ,OLI.A_FULFILLMENT_STATUS AS A_ITEM_FULFILLMENT_STATUS    
  ,OLI.A_VARIANT_INVENTORY_MANAGEMENT AS A_ITEM_VARIANT_INVENTORY_MANAGEMENT  
  
  ,OLI.B_GIFT_CARD AS B_ITEM_GIFT_CARD
  ,OLI.B_PRODUCT_EXISTS AS B_ITEM_PRODUCT_EXISTS
  ,OLI.B_REQUIRES_SHIPPING AS B_ITEM_REQUIRES_SHIPPING
  ,OLI.B_TAXABLE AS B_ITEM_TAXABLE
  ,OLI.M_FULFILLABLE_QUANTITY AS M_ITEM_FULFILLABLE_QUANTITY
  ,OLI.M_GRAMS AS M_ITEM_GRAMS
  ,OLI.M_QUANTITY AS M_ITEM_QUANTITY
  ,OLI.M_UNIT_PRICE AS M_ITEM_UNIT_PRICE
  ,OLI.M_UNIT_PRICE_PRIMARY AS M_ITEM_UNIT_PRICE_PRIMARY
  ,OLI.M_TOTAL_PRICE AS M_ITEM_TOTAL_PRICE
  ,OLI.M_TOTAL_PRICE_PRIMARY AS M_ITEM_TOTAL_PRICE_PRIMARY
  ,OLI.M_TOTAL_DISCOUNT AS M_ITEM_TOTAL_DISCOUNT
  ,OLI.M_TOTAL_DISCOUNT_PRIMARY AS M_ITEM_TOTAL_DISCOUNT_PRIMARY
  ,OLI.M_TAX_AMOUNT AS M_TAX_AMOUNT
  ,OLI.M_TAX_AMOUNT_PRIMARY AS M_TAX_AMOUNT_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_TIP_RECEIVED * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_TIP_AMOUNT_PRIMARY  
  --,ROUND(DIV0((O.M_TOTAL_DISCOUNTS_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_HEADER_DISCOUNT
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE_PRIMARY * OLI.M_TOTAL_PRICE_PRIMARY),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE_PRIMARY
  ,ROUND(DIV0((O.M_TOTAL_SHIPPING_PRICE * OLI.M_TOTAL_PRICE),O.M_TOTAL_LINE_ITENS_PRICE_PRIMARY),4)::decimal(15,4) as M_ALLOCATED_SHIPPING_PRICE



   --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'cc5603df-43e1-42fa-bf2e-6c12e9f40242' AS MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ORDERS_LINE_ITEM_STG OLI ON OLI.K_ORDER_DLHK = O.K_ORDER_DLHK
      );
2022-03-07 13:42:18.401006 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:42:21.349259 (Thread-1): SQL status: SUCCESS 1 in 2.95 seconds
2022-03-07 13:42:21.354856 (Thread-1): finished collecting timing info
2022-03-07 13:42:21.355786 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-07 13:42:21.824197 (Thread-1): 10:42:21 | 27 of 28 OK created table model DBT_SHOPIFY.W_ORDERS_F............... [SUCCESS 1 in 3.45s]
2022-03-07 13:42:21.826904 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-07 13:42:21.828843 (Thread-1): Began running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-07 13:42:21.829706 (Thread-1): 10:42:21 | 28 of 28 START table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F........ [RUN]
2022-03-07 13:42:21.831352 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-07 13:42:21.832180 (Thread-1): Compiling model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-07 13:42:21.846643 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-07 13:42:21.847475 (Thread-1): finished collecting timing info
2022-03-07 13:42:21.849809 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"
2022-03-07 13:42:21.850795 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-07 13:42:21.850986 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PRODUCT_COLLECTION_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_PRODUCT_COLLECTION_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_PRODUCT_COLLECTION_STG AS C
      );
2022-03-07 13:42:21.851195 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:42:24.426355 (Thread-1): SQL status: SUCCESS 1 in 2.57 seconds
2022-03-07 13:42:24.433756 (Thread-1): finished collecting timing info
2022-03-07 13:42:24.434539 (Thread-1): On model.snowflake_aicd.W_PRODUCT_COLLECTION_F: Close
2022-03-07 13:42:24.900333 (Thread-1): 10:42:24 | 28 of 28 OK created table model DBT_SHOPIFY.W_PRODUCT_COLLECTION_F... [SUCCESS 1 in 3.07s]
2022-03-07 13:42:24.901849 (Thread-1): Finished running node model.snowflake_aicd.W_PRODUCT_COLLECTION_F
2022-03-07 13:42:24.907427 (MainThread): Acquiring new snowflake connection "master".
2022-03-07 13:42:24.911626 (MainThread): 10:42:24 | 
2022-03-07 13:42:24.912301 (MainThread): 10:42:24 | Finished running 18 view models, 10 table models in 76.36s.
2022-03-07 13:42:24.913181 (MainThread): Connection 'master' was properly closed.
2022-03-07 13:42:24.913469 (MainThread): Connection 'model.snowflake_aicd.W_PRODUCT_COLLECTION_F' was properly closed.
2022-03-07 13:42:24.931511 (MainThread): 
2022-03-07 13:42:24.931932 (MainThread): Completed with 1 error and 0 warnings:
2022-03-07 13:42:24.932199 (MainThread): 
2022-03-07 13:42:24.932443 (MainThread): Database Error in model V_ABANDONED_CHECKOUT_F_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql)
2022-03-07 13:42:24.932662 (MainThread):   000904 (42000): SQL compilation error: error line 22 at position 3
2022-03-07 13:42:24.932875 (MainThread):   invalid identifier 'I.K_ITEM_DESTINATION_LOCATION_BK'
2022-03-07 13:42:24.933088 (MainThread):   compiled SQL at target/run/snowflake_aicd/models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql
2022-03-07 13:42:24.933392 (MainThread): 
Done. PASS=26 WARN=0 ERROR=1 SKIP=1 TOTAL=28
2022-03-07 13:42:24.933755 (MainThread): Flushing usage events
2022-03-07 13:44:08.085102 (MainThread): Running with dbt=0.21.1
2022-03-07 13:44:08.499255 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=['+W_ABANDONED_CHECKOUT_F'], selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-07 13:44:08.500266 (MainThread): Tracking: do not track
2022-03-07 13:44:08.509263 (MainThread): Partial parsing not enabled
2022-03-07 13:44:08.527752 (MainThread): Parsing macros/common.sql
2022-03-07 13:44:08.530718 (MainThread): Parsing macros/catalog.sql
2022-03-07 13:44:08.532451 (MainThread): Parsing macros/adapters.sql
2022-03-07 13:44:08.563194 (MainThread): Parsing macros/materializations/merge.sql
2022-03-07 13:44:08.566215 (MainThread): Parsing macros/materializations/seed.sql
2022-03-07 13:44:08.569731 (MainThread): Parsing macros/materializations/view.sql
2022-03-07 13:44:08.570709 (MainThread): Parsing macros/materializations/table.sql
2022-03-07 13:44:08.573053 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-07 13:44:08.579609 (MainThread): Parsing macros/core.sql
2022-03-07 13:44:08.582338 (MainThread): Parsing macros/materializations/test.sql
2022-03-07 13:44:08.587471 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-07 13:44:08.594866 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-07 13:44:08.596095 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-07 13:44:08.609341 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-07 13:44:08.638514 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-07 13:44:08.656768 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-07 13:44:08.658041 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-07 13:44:08.666106 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-07 13:44:08.682736 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-07 13:44:08.694049 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-07 13:44:08.700804 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-07 13:44:08.706797 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-07 13:44:08.709630 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-07 13:44:08.710689 (MainThread): Parsing macros/etc/query.sql
2022-03-07 13:44:08.711355 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-07 13:44:08.712454 (MainThread): Parsing macros/etc/datetime.sql
2022-03-07 13:44:08.719028 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-07 13:44:08.720336 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-07 13:44:08.722085 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-07 13:44:08.723207 (MainThread): Parsing macros/adapters/common.sql
2022-03-07 13:44:08.768038 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-07 13:44:08.769251 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-07 13:44:08.770070 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-07 13:44:08.771009 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-07 13:44:08.908575 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:44:08.916592 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.919407 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-07 13:44:08.921733 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.922433 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-07 13:44:08.924928 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.925625 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:44:08.927928 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.928617 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:44:08.932875 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.933583 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:44:08.936607 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.937299 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-07 13:44:08.939979 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.940667 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-07 13:44:08.942941 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.943634 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-07 13:44:08.946178 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.950030 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-07 13:44:08.952437 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.953132 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:44:08.955460 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.956150 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-07 13:44:08.959715 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.960413 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-07 13:44:08.963243 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.964044 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-07 13:44:08.968371 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.969065 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-07 13:44:08.974328 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.975022 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-07 13:44:08.977683 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.978374 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-07 13:44:08.981435 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.982120 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-07 13:44:08.986068 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:08.986753 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-07 13:44:09.021115 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.021915 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-07 13:44:09.024120 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.024909 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-07 13:44:09.027423 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.028264 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-07 13:44:09.030701 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.031407 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-07 13:44:09.033584 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.034297 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:44:09.036641 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.037397 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-07 13:44:09.039659 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.040362 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:44:09.042511 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.043213 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-07 13:44:09.045367 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.046063 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-07 13:44:09.048194 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.067423 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.068596 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.069840 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.070958 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.072073 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.073169 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.074421 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.075519 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:44:09.111439 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-07 13:44:09.112076 (MainThread): Found 28 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 24 sources, 0 exposures
2022-03-07 13:44:09.112640 (MainThread): context manager reversed is deprecated and to be removed in 3.0.Use G.reverse(copy=False) if G.is_directed() else G instead.
2022-03-07 13:44:09.113981 (MainThread): 
2022-03-07 13:44:09.114233 (MainThread): Acquiring new snowflake connection "master".
2022-03-07 13:44:09.115101 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-07 13:44:09.124362 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-07 13:44:09.124511 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-07 13:44:09.124605 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-07 13:44:10.994322 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 1.87 seconds
2022-03-07 13:44:11.002388 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-07 13:44:11.464786 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-07 13:44:11.473649 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-07 13:44:11.473827 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-07 13:44:11.473980 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-07 13:44:13.341352 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 28 in 1.87 seconds
2022-03-07 13:44:13.352205 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-07 13:44:13.807765 (MainThread): 10:44:13 | Concurrency: 1 threads (target='dev')
2022-03-07 13:44:13.808384 (MainThread): 10:44:13 | 
2022-03-07 13:44:13.810820 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:44:13.811408 (Thread-1): 10:44:13 | 1 of 8 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG [RUN]
2022-03-07 13:44:13.814652 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:44:13.814959 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:44:13.820185 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"
2022-03-07 13:44:13.820827 (Thread-1): finished collecting timing info
2022-03-07 13:44:13.847508 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"
2022-03-07 13:44:13.850336 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:44:13.850468 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT_LINE_ITEM"
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_ABANDONED_CHECKOUT_ITEM_DLHK
  ,MD5(S.CHECKOUT_ID) AS K_ABANDONED_CHECKOUT_DLHK
  
  ,MD5(CONCAT(S.PRODUCT_ID,'-',COALESCE(S.VARIANT_ID,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_ABANDONED_CHECKOUT_ITEM_BK
  ,S.CHECKOUT_ID AS K_ABANDONED_CHECKOUT_BK
  ,S.DESTINATION_LOCATION_ID AS K_DESTINATION_LOCATION_BK    
  ,S.ORIGIN_LOCATION_ID AS K_ORIGIN_LOCATION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  ,S.VARIANT_ID AS K_VARIANT_BK
  --ATTRIBUTES
  ,S.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,S.KEY AS A_KEY
  ,S.PRESENTMENT_TITLE AS A_PRESENTMENT_TITLE
  ,S.PRESENTMENT_VARIANT_TITLE AS A_PRESENTMENT_VARIANT_TITLE
  ,S.SKU AS A_SKU
  ,S.TITLE AS A_TITLE
  ,S.VARIANT_TITLE AS A_VARIANT_TITLE
  ,S.VENDOR AS A_VENDOR
  --BOOLEAN
  ,S.GIFT_CARD AS B_GIFT_CARD
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TAXABLE AS B_TAXABLE
  --METRICS
  ,S.COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,S.GRAMS AS M_GRAMS
  ,S.LINE_PRICE AS M_LINE_PRICE
  ,S.PRICE AS M_PRICE
  ,S.QUANTITY AS M_QUANTITY
  ,S.VARIANT_PRICE AS M_VARIANT_PRICE
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'dd79289c-7366-4ac0-b082-da7378a56679' AS MD_INTGR_ID
  FROM
      source S
)


SELECT * FROM rename
  );
2022-03-07 13:44:13.850605 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:44:15.516870 (Thread-1): SQL status: SUCCESS 1 in 1.67 seconds
2022-03-07 13:44:15.531244 (Thread-1): finished collecting timing info
2022-03-07 13:44:15.531745 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG: Close
2022-03-07 13:44:15.998240 (Thread-1): 10:44:15 | 1 of 8 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG [SUCCESS 1 in 2.18s]
2022-03-07 13:44:15.998694 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:44:15.998983 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:44:15.999310 (Thread-1): 10:44:15 | 2 of 8 START view model DBT_SHOPIFY.V_CUSTOMER_STG................... [RUN]
2022-03-07 13:44:15.999736 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:44:15.999972 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:44:16.005910 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-07 13:44:16.006602 (Thread-1): finished collecting timing info
2022-03-07 13:44:16.008659 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-07 13:44:16.011914 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:44:16.012225 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER"
),
rename AS 
(   
SELECT 
    --KEYS
    MD5(ID) AS K_CUSTOMER_DLHK    
    --BUSINESS KEYS
    ,ID AS K_CUSTOMER_BK
    ,LAST_ORDER_ID AS K_LAST_ORDER_BK
    ,MULTIPASS_IDENTIFIER AS K_MULTIPASS_BKENTIFIER
    --ATTRIBUTES
    ,ACCEPTS_MARKETING_UPDATED_AT AS A_ACCEPTS_MARKETING_UPDATED_AT_DTS
    ,CREATED_AT AS A_CREATED_AT_DTS
    ,CURRENCY AS A_CURRENCY
    ,EMAIL AS A_EMAIL
    ,
    (COALESCE(FIRST_NAME,'') || ' ' || COALESCE(LAST_NAME,''))
 AS A_FULL_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,LAST_ORDER_NAME AS A_LAST_ORDER_NAME
    ,MARKETING_OPT_IN_LEVEL AS A_MARKETING_OPT_IN_LEVEL
    ,NOTE AS A_NOTE
    ,PHONE AS A_PHONE
    ,SMS_MARKETING_CONSENT AS A_SMS_MARKETING_CONSENT
    ,STATE AS A_STATE
    ,TAGS AS A_TAGS
    ,TAX_EXEMPTIONS AS A_TAX_EXEMPTIONS
    ,TOTAL_SPENT AS A_TOTAL_SPENT
    ,UPDATED_AT AS A_UPDATED_AT
    --BOOLEAN
    ,ACCEPTS_MARKETING AS B_ACCEPTS_MARKETING
    ,TAX_EXEMPT AS B_TAX_EXEMPT
    ,VERIFIED_EMAIL AS B_VERIFIED_EMAIL
    --METRICS
    ,ORDERS_COUNT AS M_ORDERS_COUNT
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'dd79289c-7366-4ac0-b082-da7378a56679' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-07 13:44:16.012482 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:44:17.826216 (Thread-1): SQL status: SUCCESS 1 in 1.81 seconds
2022-03-07 13:44:17.831111 (Thread-1): finished collecting timing info
2022-03-07 13:44:17.831633 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-07 13:44:18.287086 (Thread-1): 10:44:18 | 2 of 8 OK created view model DBT_SHOPIFY.V_CUSTOMER_STG.............. [SUCCESS 1 in 2.29s]
2022-03-07 13:44:18.287611 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:44:18.288006 (Thread-1): Began running node model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:44:18.288765 (Thread-1): 10:44:18 | 3 of 8 START view model DBT_SHOPIFY.V_LOCATION_STG................... [RUN]
2022-03-07 13:44:18.289844 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:44:18.290204 (Thread-1): Compiling model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:44:18.297209 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-07 13:44:18.298308 (Thread-1): finished collecting timing info
2022-03-07 13:44:18.301175 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-07 13:44:18.304234 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:44:18.304473 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'dd79289c-7366-4ac0-b082-da7378a56679' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-07 13:44:18.304651 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:44:20.774736 (Thread-1): SQL status: SUCCESS 1 in 2.47 seconds
2022-03-07 13:44:20.781001 (Thread-1): finished collecting timing info
2022-03-07 13:44:20.781478 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-07 13:44:21.255062 (Thread-1): 10:44:21 | 3 of 8 OK created view model DBT_SHOPIFY.V_LOCATION_STG.............. [SUCCESS 1 in 2.96s]
2022-03-07 13:44:21.255593 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:44:21.256002 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:44:21.256727 (Thread-1): 10:44:21 | 4 of 8 START table model DBT_SHOPIFY.W_CUSTOMERS_D................... [RUN]
2022-03-07 13:44:21.257527 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:44:21.257827 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:44:21.263858 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-07 13:44:21.264716 (Thread-1): finished collecting timing info
2022-03-07 13:44:21.287699 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-07 13:44:21.288750 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:44:21.288914 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG AS C
      );
2022-03-07 13:44:21.289051 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:44:24.153578 (Thread-1): SQL status: SUCCESS 1 in 2.86 seconds
2022-03-07 13:44:24.164849 (Thread-1): finished collecting timing info
2022-03-07 13:44:24.165307 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-07 13:44:24.707814 (Thread-1): 10:44:24 | 4 of 8 OK created table model DBT_SHOPIFY.W_CUSTOMERS_D.............. [SUCCESS 1 in 3.45s]
2022-03-07 13:44:24.708938 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:44:24.709715 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:44:24.710510 (Thread-1): 10:44:24 | 5 of 8 START table model DBT_SHOPIFY.W_LOCATION_D.................... [RUN]
2022-03-07 13:44:24.711135 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:44:24.711389 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:44:24.716823 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-07 13:44:24.717733 (Thread-1): finished collecting timing info
2022-03-07 13:44:24.720312 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-07 13:44:24.721306 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:44:24.721483 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-07 13:44:24.721651 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:44:27.220267 (Thread-1): SQL status: SUCCESS 1 in 2.50 seconds
2022-03-07 13:44:27.226052 (Thread-1): finished collecting timing info
2022-03-07 13:44:27.226479 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-07 13:44:27.665161 (Thread-1): 10:44:27 | 5 of 8 OK created table model DBT_SHOPIFY.W_LOCATION_D............... [SUCCESS 1 in 2.95s]
2022-03-07 13:44:27.665878 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:44:27.667267 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:44:27.668338 (Thread-1): 10:44:27 | 6 of 8 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG......... [RUN]
2022-03-07 13:44:27.668928 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:44:27.669343 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:44:27.677465 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-07 13:44:27.678226 (Thread-1): finished collecting timing info
2022-03-07 13:44:27.680952 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-07 13:44:27.689831 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:44:27.690010 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT"
),
customer AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 

  MD5(S.ID) AS K_ABANDONED_CHECKOUT_DLHK
  ,C.K_CUSTOMER_DLHK
  ,L.K_LOCATION_DLHK
  ,MD5(S.USER_ID) AS K_USER_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK  
  ,S.ID AS K_ABANDONED_CHECKOUT_BK
  ,S.CUSTOMER_ID AS K_CUSTOMER_BK
  ,S.DEVICE_ID AS K_DEVICE_BK
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.SOURCE_IDENTIFIER AS K_SOURCE_BKENTIFIER
  ,S.USER_ID AS K_USER_BK
  ,S.ABANDONED_CHECKOUT_URL AS A_ABANDONED_CHECKOUT_URL  
  ,S.CART_TOKEN AS A_CART_TOKEN
  ,S.CLOSED_AT AS A_CLOSED_AT
  ,S.COMPLETED_AT AS A_COMPLETED_AT
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
  ,S.EMAIL AS A_EMAIL
  ,S.GATEWAY AS A_GATEWAY
  ,S.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
  ,S.NAME AS A_NAME
  ,S.NOTE AS A_NOTE
  ,S.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES
  ,S.PHONE AS A_PHONE
  ,S.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
  ,S.REFERRING_SITE AS A_REFERRING_SITE    
  ,S.SOURCE AS A_SOURCE
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.SOURCE_URL AS A_SOURCE_URL
  ,S.TOKEN AS A_TOKEN
  ,S.UPDATED_AT AS A_UPDATED_AT  
  --BOOLEAN
  ,S.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
  ,S.TAXES_INCLUDED AS B_TAXES_INCLUDED
  --METRIC
  ,S.SUBTOTAL_PRICE::decimal(15,2) AS M_SUBTOTAL_PRICE
  ,S.TOTAL_DISCOUNTS::decimal(15,2) AS M_TOTAL_DISCOUNTS
  ,S.TOTAL_DUTIES::decimal(15,2) AS M_TOTAL_DUTIES
  ,S.TOTAL_LINE_ITEMS_PRICE::decimal(15,2) AS M_TOTAL_LINE_ITEMS_PRICE
  ,S.TOTAL_PRICE::decimal(15,2) AS M_TOTAL_PRICE
  ,S.TOTAL_TAX::decimal(15,2) AS M_TOTAL_TAX
  ,S.TOTAL_WEIGHT::decimal(15,2) AS M_TOTAL_WEIGHT
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'dd79289c-7366-4ac0-b082-da7378a56679' AS MD_INTGR_ID
  FROM
      source S
      left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
      left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-07 13:44:27.690182 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:44:29.365477 (Thread-1): SQL status: SUCCESS 1 in 1.68 seconds
2022-03-07 13:44:29.369342 (Thread-1): finished collecting timing info
2022-03-07 13:44:29.369933 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: Close
2022-03-07 13:44:29.835361 (Thread-1): 10:44:29 | 6 of 8 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.... [SUCCESS 1 in 2.17s]
2022-03-07 13:44:29.836289 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:44:29.839111 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:44:29.840570 (Thread-1): 10:44:29 | 7 of 8 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_F_STG....... [RUN]
2022-03-07 13:44:29.842544 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:44:29.843377 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:44:29.851689 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG"
2022-03-07 13:44:29.852898 (Thread-1): finished collecting timing info
2022-03-07 13:44:29.855744 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG"
2022-03-07 13:44:29.861083 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:44:29.861253 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_F_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG
),
abandoned_checkout_item AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
),
rename AS 
(   
  SELECT 
  I.K_ABANDONED_CHECKOUT_ITEM_DLHK
  ,S.K_ABANDONED_CHECKOUT_DLHK
  ,I.K_PRODUCT_VARIATION_DLHK
  ,I.K_DESTINATION_LOCATION_BK AS K_ITEM_DESTINATION_LOCATION_BK
  ,I.K_ORIGIN_LOCATION_BK AS K_ITEM_ORIGIN_LOCATION_BK
  ,S.K_CUSTOMER_DLHK
  ,S.K_LOCATION_DLHK
  ,S.K_USER_DLHK
  ,S.K_SHIPPING_ADDRESS_DLHK
  ,S.K_BILLING_ADDRESS_DLHK  
  ,S.K_ABANDONED_CHECKOUT_BK
  ,S.K_CUSTOMER_BK
  ,S.K_DEVICE_BK
  ,S.K_LOCATION_BK
  ,S.K_SOURCE_BKENTIFIER
  ,S.K_USER_BK
  ,S.A_ABANDONED_CHECKOUT_URL  
  ,S.A_CART_TOKEN
  ,S.A_CLOSED_AT
  ,S.A_COMPLETED_AT
  ,S.A_CREATED_AT
  ,S.A_CURRENCY
  ,S.A_CUSTOMER_LOCALE
  ,S.A_EMAIL
  ,S.A_GATEWAY
  ,S.A_LANDING_SITE_BASE_URL
  ,S.A_NAME
  ,S.A_NOTE
  ,S.A_NOTE_ATTRIBUTES
  ,S.A_PHONE
  ,S.A_PRESENTMENT_CURRENCY
  ,S.A_REFERRING_SITE    
  ,S.A_SOURCE
  ,S.A_SOURCE_NAME
  ,S.A_SOURCE_URL
  ,S.A_TOKEN
  ,S.A_UPDATED_AT    
  ,S.B_BUYER_ACCEPTS_MARKETING
  ,S.B_TAXES_INCLUDED  
  ,I.B_GIFT_CARD
  ,I.B_REQUIRES_SHIPPING
  ,I.B_TAXABLE
  --,S.M_SUBTOTAL_PRICE
  ,S.M_TOTAL_DISCOUNTS
  --,S.M_TOTAL_DUTIES
  --,S.M_TOTAL_LINE_ITEMS_PRICE
  --,S.M_TOTAL_PRICE
  --,S.M_TOTAL_TAX
  
  ,ROUND(DIV0((O.M_TOTAL_DUTIES * I.PRICE),S.M_TOTAL_LINE_ITEMS_PRICE),4)::decimal(15,4) as M_ALLOCATED_DUTIES
  ,ROUND(DIV0((O.M_TOTAL_TAX * I.PRICE),S.M_TOTAL_LINE_ITEMS_PRICE),4)::decimal(15,4) as M_ALLOCATED_TAXES
  ,ROUND(DIV0((O.M_TOTAL_DISCOUNTS * I.PRICE),S.M_TOTAL_LINE_ITEMS_PRICE),4)::decimal(15,4) as M_ALLOCATED_DISCOUNTS
  
  ,I.COMPARE_AT_PRICE::decimal(15,2)  AS M_COMPARE_AT_PRICE
  ,I.GRAMS::decimal(15,2)  AS M_GRAMS
  ,I.LINE_PRICE::decimal(15,2)  AS M_LINE_PRICE
  ,I.PRICE::decimal(15,2)  AS M_PRICE
  ,I.QUANTITY::decimal(15,2)  AS M_QUANTITY
  ,I.VARIANT_PRICE::decimal(15,2)  AS M_VARIANT_PRICE
  ,(I.PRICE + M_ALLOCATED_DUTIES - M_ALLOCATED_TAXES - M_ALLOCATED_DISCOUNTS)::decimal(15,4) AS M_TOTAL_PRICE

  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'dd79289c-7366-4ac0-b082-da7378a56679' AS MD_INTGR_ID
  FROM
      source S
      left join abandoned_checkout_item I ON I.K_ABANDONED_CHECKOUT_BK = S.K_ABANDONED_CHECKOUT_BK
)


SELECT * FROM rename
  );
2022-03-07 13:44:29.861414 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:44:31.842034 (Thread-1): Snowflake query id: 01a2c478-0601-418f-000b-358300f4f3d2
2022-03-07 13:44:31.842237 (Thread-1): Snowflake error: 000904 (42000): SQL compilation error: error line 68 at position 15
invalid identifier 'O.M_TOTAL_DUTIES'
2022-03-07 13:44:31.842413 (Thread-1): finished collecting timing info
2022-03-07 13:44:31.842548 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG: Close
2022-03-07 13:44:32.309813 (Thread-1): Database Error in model V_ABANDONED_CHECKOUT_F_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql)
  000904 (42000): SQL compilation error: error line 68 at position 15
  invalid identifier 'O.M_TOTAL_DUTIES'
  compiled SQL at target/run/snowflake_aicd/models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 68 at position 15
invalid identifier 'O.M_TOTAL_DUTIES'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_ABANDONED_CHECKOUT_F_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql)
  000904 (42000): SQL compilation error: error line 68 at position 15
  invalid identifier 'O.M_TOTAL_DUTIES'
  compiled SQL at target/run/snowflake_aicd/models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql
2022-03-07 13:44:32.340057 (Thread-1): 10:44:32 | 7 of 8 ERROR creating view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_F_STG [ERROR in 2.50s]
2022-03-07 13:44:32.340414 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:44:32.341479 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-07 13:44:32.341835 (Thread-1): 10:44:32 | 8 of 8 SKIP relation DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F.............. [SKIP]
2022-03-07 13:44:32.341994 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-07 13:44:32.343226 (MainThread): Acquiring new snowflake connection "master".
2022-03-07 13:44:32.343845 (MainThread): 10:44:32 | 
2022-03-07 13:44:32.344092 (MainThread): 10:44:32 | Finished running 5 view models, 3 table models in 23.23s.
2022-03-07 13:44:32.344303 (MainThread): Connection 'master' was properly closed.
2022-03-07 13:44:32.344471 (MainThread): Connection 'model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG' was properly closed.
2022-03-07 13:44:32.352022 (MainThread): 
2022-03-07 13:44:32.352184 (MainThread): Completed with 1 error and 0 warnings:
2022-03-07 13:44:32.352309 (MainThread): 
2022-03-07 13:44:32.352425 (MainThread): Database Error in model V_ABANDONED_CHECKOUT_F_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql)
2022-03-07 13:44:32.352537 (MainThread):   000904 (42000): SQL compilation error: error line 68 at position 15
2022-03-07 13:44:32.352828 (MainThread):   invalid identifier 'O.M_TOTAL_DUTIES'
2022-03-07 13:44:32.352965 (MainThread):   compiled SQL at target/run/snowflake_aicd/models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql
2022-03-07 13:44:32.353111 (MainThread): 
Done. PASS=6 WARN=0 ERROR=1 SKIP=1 TOTAL=8
2022-03-07 13:44:32.353290 (MainThread): Flushing usage events
2022-03-07 13:45:03.828877 (MainThread): Running with dbt=0.21.1
2022-03-07 13:45:04.360808 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=['+W_ABANDONED_CHECKOUT_F'], selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-07 13:45:04.362077 (MainThread): Tracking: do not track
2022-03-07 13:45:04.372519 (MainThread): Partial parsing not enabled
2022-03-07 13:45:04.391484 (MainThread): Parsing macros/common.sql
2022-03-07 13:45:04.394593 (MainThread): Parsing macros/catalog.sql
2022-03-07 13:45:04.396312 (MainThread): Parsing macros/adapters.sql
2022-03-07 13:45:04.427355 (MainThread): Parsing macros/materializations/merge.sql
2022-03-07 13:45:04.430622 (MainThread): Parsing macros/materializations/seed.sql
2022-03-07 13:45:04.434484 (MainThread): Parsing macros/materializations/view.sql
2022-03-07 13:45:04.435590 (MainThread): Parsing macros/materializations/table.sql
2022-03-07 13:45:04.438259 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-07 13:45:04.445382 (MainThread): Parsing macros/core.sql
2022-03-07 13:45:04.448382 (MainThread): Parsing macros/materializations/test.sql
2022-03-07 13:45:04.453580 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-07 13:45:04.461261 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-07 13:45:04.462657 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-07 13:45:04.476230 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-07 13:45:04.503915 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-07 13:45:04.522164 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-07 13:45:04.523457 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-07 13:45:04.531917 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-07 13:45:04.548425 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-07 13:45:04.560278 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-07 13:45:04.567333 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-07 13:45:04.573513 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-07 13:45:04.576504 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-07 13:45:04.577606 (MainThread): Parsing macros/etc/query.sql
2022-03-07 13:45:04.578300 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-07 13:45:04.579446 (MainThread): Parsing macros/etc/datetime.sql
2022-03-07 13:45:04.586457 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-07 13:45:04.587814 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-07 13:45:04.589605 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-07 13:45:04.591090 (MainThread): Parsing macros/adapters/common.sql
2022-03-07 13:45:04.636760 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-07 13:45:04.638054 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-07 13:45:04.638933 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-07 13:45:04.639894 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-07 13:45:04.784966 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:45:04.793851 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.797319 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-07 13:45:04.799889 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.800608 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-07 13:45:04.803195 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.804110 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:45:04.807095 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.807881 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:45:04.812324 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.813047 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:45:04.816360 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.817079 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-07 13:45:04.819865 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.820567 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-07 13:45:04.822909 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.823620 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-07 13:45:04.826229 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.826944 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-07 13:45:04.829492 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.830239 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:45:04.832694 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.833413 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-07 13:45:04.837089 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.837806 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-07 13:45:04.840772 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.841493 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-07 13:45:04.845911 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.846615 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-07 13:45:04.851917 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.852614 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-07 13:45:04.855275 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.855977 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-07 13:45:04.859065 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.859767 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-07 13:45:04.863766 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.864489 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-07 13:45:04.900615 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.901427 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-07 13:45:04.903672 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.904378 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-07 13:45:04.906548 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.907241 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-07 13:45:04.909530 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.910399 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-07 13:45:04.912970 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.913800 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:45:04.916381 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.917115 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-07 13:45:04.919319 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.920208 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:45:04.922976 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.923738 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-07 13:45:04.925971 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.926690 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-07 13:45:04.928869 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.948881 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.950098 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.951386 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.952521 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.953629 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.954738 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.956160 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.957329 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:45:04.992233 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-07 13:45:04.992818 (MainThread): Found 28 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 24 sources, 0 exposures
2022-03-07 13:45:04.993355 (MainThread): context manager reversed is deprecated and to be removed in 3.0.Use G.reverse(copy=False) if G.is_directed() else G instead.
2022-03-07 13:45:04.994687 (MainThread): 
2022-03-07 13:45:04.994925 (MainThread): Acquiring new snowflake connection "master".
2022-03-07 13:45:04.995770 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-07 13:45:05.005160 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-07 13:45:05.005286 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-07 13:45:05.005376 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-07 13:45:06.846562 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 1.84 seconds
2022-03-07 13:45:06.859812 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-07 13:45:07.327986 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-07 13:45:07.340692 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-07 13:45:07.340995 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-07 13:45:07.341163 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-07 13:45:09.358279 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 28 in 2.02 seconds
2022-03-07 13:45:09.400564 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-07 13:45:09.875504 (MainThread): 10:45:09 | Concurrency: 1 threads (target='dev')
2022-03-07 13:45:09.876522 (MainThread): 10:45:09 | 
2022-03-07 13:45:09.883068 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:45:09.884279 (Thread-1): 10:45:09 | 1 of 8 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG [RUN]
2022-03-07 13:45:09.891721 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:45:09.892057 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:45:09.896154 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"
2022-03-07 13:45:09.896716 (Thread-1): finished collecting timing info
2022-03-07 13:45:09.924132 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"
2022-03-07 13:45:09.926637 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:45:09.926770 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT_LINE_ITEM"
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_ABANDONED_CHECKOUT_ITEM_DLHK
  ,MD5(S.CHECKOUT_ID) AS K_ABANDONED_CHECKOUT_DLHK
  
  ,MD5(CONCAT(S.PRODUCT_ID,'-',COALESCE(S.VARIANT_ID,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_ABANDONED_CHECKOUT_ITEM_BK
  ,S.CHECKOUT_ID AS K_ABANDONED_CHECKOUT_BK
  ,S.DESTINATION_LOCATION_ID AS K_DESTINATION_LOCATION_BK    
  ,S.ORIGIN_LOCATION_ID AS K_ORIGIN_LOCATION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  ,S.VARIANT_ID AS K_VARIANT_BK
  --ATTRIBUTES
  ,S.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,S.KEY AS A_KEY
  ,S.PRESENTMENT_TITLE AS A_PRESENTMENT_TITLE
  ,S.PRESENTMENT_VARIANT_TITLE AS A_PRESENTMENT_VARIANT_TITLE
  ,S.SKU AS A_SKU
  ,S.TITLE AS A_TITLE
  ,S.VARIANT_TITLE AS A_VARIANT_TITLE
  ,S.VENDOR AS A_VENDOR
  --BOOLEAN
  ,S.GIFT_CARD AS B_GIFT_CARD
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TAXABLE AS B_TAXABLE
  --METRICS
  ,S.COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,S.GRAMS AS M_GRAMS
  ,S.LINE_PRICE AS M_LINE_PRICE
  ,S.PRICE AS M_PRICE
  ,S.QUANTITY AS M_QUANTITY
  ,S.VARIANT_PRICE AS M_VARIANT_PRICE
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'48db2339-c1d1-4d06-bec0-2b2ac82d48ae' AS MD_INTGR_ID
  FROM
      source S
)


SELECT * FROM rename
  );
2022-03-07 13:45:09.926883 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:45:11.845316 (Thread-1): SQL status: SUCCESS 1 in 1.92 seconds
2022-03-07 13:45:11.867509 (Thread-1): finished collecting timing info
2022-03-07 13:45:11.867976 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG: Close
2022-03-07 13:45:12.341501 (Thread-1): 10:45:12 | 1 of 8 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG [SUCCESS 1 in 2.46s]
2022-03-07 13:45:12.342041 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:45:12.342766 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:45:12.345055 (Thread-1): 10:45:12 | 2 of 8 START view model DBT_SHOPIFY.V_CUSTOMER_STG................... [RUN]
2022-03-07 13:45:12.346233 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:45:12.346737 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:45:12.356052 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-07 13:45:12.356714 (Thread-1): finished collecting timing info
2022-03-07 13:45:12.358285 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-07 13:45:12.360412 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:45:12.360531 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER"
),
rename AS 
(   
SELECT 
    --KEYS
    MD5(ID) AS K_CUSTOMER_DLHK    
    --BUSINESS KEYS
    ,ID AS K_CUSTOMER_BK
    ,LAST_ORDER_ID AS K_LAST_ORDER_BK
    ,MULTIPASS_IDENTIFIER AS K_MULTIPASS_BKENTIFIER
    --ATTRIBUTES
    ,ACCEPTS_MARKETING_UPDATED_AT AS A_ACCEPTS_MARKETING_UPDATED_AT_DTS
    ,CREATED_AT AS A_CREATED_AT_DTS
    ,CURRENCY AS A_CURRENCY
    ,EMAIL AS A_EMAIL
    ,
    (COALESCE(FIRST_NAME,'') || ' ' || COALESCE(LAST_NAME,''))
 AS A_FULL_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,LAST_ORDER_NAME AS A_LAST_ORDER_NAME
    ,MARKETING_OPT_IN_LEVEL AS A_MARKETING_OPT_IN_LEVEL
    ,NOTE AS A_NOTE
    ,PHONE AS A_PHONE
    ,SMS_MARKETING_CONSENT AS A_SMS_MARKETING_CONSENT
    ,STATE AS A_STATE
    ,TAGS AS A_TAGS
    ,TAX_EXEMPTIONS AS A_TAX_EXEMPTIONS
    ,TOTAL_SPENT AS A_TOTAL_SPENT
    ,UPDATED_AT AS A_UPDATED_AT
    --BOOLEAN
    ,ACCEPTS_MARKETING AS B_ACCEPTS_MARKETING
    ,TAX_EXEMPT AS B_TAX_EXEMPT
    ,VERIFIED_EMAIL AS B_VERIFIED_EMAIL
    --METRICS
    ,ORDERS_COUNT AS M_ORDERS_COUNT
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'48db2339-c1d1-4d06-bec0-2b2ac82d48ae' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-07 13:45:12.360637 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:45:14.168314 (Thread-1): SQL status: SUCCESS 1 in 1.81 seconds
2022-03-07 13:45:14.177187 (Thread-1): finished collecting timing info
2022-03-07 13:45:14.178455 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-07 13:45:14.646632 (Thread-1): 10:45:14 | 2 of 8 OK created view model DBT_SHOPIFY.V_CUSTOMER_STG.............. [SUCCESS 1 in 2.30s]
2022-03-07 13:45:14.647455 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:45:14.648113 (Thread-1): Began running node model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:45:14.649318 (Thread-1): 10:45:14 | 3 of 8 START view model DBT_SHOPIFY.V_LOCATION_STG................... [RUN]
2022-03-07 13:45:14.650594 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:45:14.651175 (Thread-1): Compiling model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:45:14.661313 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-07 13:45:14.662255 (Thread-1): finished collecting timing info
2022-03-07 13:45:14.664924 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-07 13:45:14.667347 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:45:14.667536 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '48db2339-c1d1-4d06-bec0-2b2ac82d48ae' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-07 13:45:14.667736 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:45:16.840073 (Thread-1): SQL status: SUCCESS 1 in 2.17 seconds
2022-03-07 13:45:16.843284 (Thread-1): finished collecting timing info
2022-03-07 13:45:16.843509 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-07 13:45:17.308283 (Thread-1): 10:45:17 | 3 of 8 OK created view model DBT_SHOPIFY.V_LOCATION_STG.............. [SUCCESS 1 in 2.66s]
2022-03-07 13:45:17.308533 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:45:17.308704 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:45:17.309737 (Thread-1): 10:45:17 | 4 of 8 START table model DBT_SHOPIFY.W_CUSTOMERS_D................... [RUN]
2022-03-07 13:45:17.310925 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:45:17.311296 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:45:17.315317 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-07 13:45:17.315842 (Thread-1): finished collecting timing info
2022-03-07 13:45:17.330736 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-07 13:45:17.331554 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:45:17.331653 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG AS C
      );
2022-03-07 13:45:17.331747 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:45:22.058400 (Thread-1): SQL status: SUCCESS 1 in 4.73 seconds
2022-03-07 13:45:22.064707 (Thread-1): finished collecting timing info
2022-03-07 13:45:22.064991 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-07 13:45:22.526115 (Thread-1): 10:45:22 | 4 of 8 OK created table model DBT_SHOPIFY.W_CUSTOMERS_D.............. [SUCCESS 1 in 5.22s]
2022-03-07 13:45:22.526815 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:45:22.527071 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:45:22.527375 (Thread-1): 10:45:22 | 5 of 8 START table model DBT_SHOPIFY.W_LOCATION_D.................... [RUN]
2022-03-07 13:45:22.527769 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:45:22.528154 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:45:22.532060 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-07 13:45:22.532727 (Thread-1): finished collecting timing info
2022-03-07 13:45:22.534868 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-07 13:45:22.535710 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:45:22.535871 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-07 13:45:22.536020 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:45:24.735301 (Thread-1): SQL status: SUCCESS 1 in 2.20 seconds
2022-03-07 13:45:24.738192 (Thread-1): finished collecting timing info
2022-03-07 13:45:24.738538 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-07 13:45:25.184102 (Thread-1): 10:45:25 | 5 of 8 OK created table model DBT_SHOPIFY.W_LOCATION_D............... [SUCCESS 1 in 2.66s]
2022-03-07 13:45:25.184534 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:45:25.185110 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:45:25.185650 (Thread-1): 10:45:25 | 6 of 8 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG......... [RUN]
2022-03-07 13:45:25.186075 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:45:25.186279 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:45:25.192372 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-07 13:45:25.193079 (Thread-1): finished collecting timing info
2022-03-07 13:45:25.195627 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-07 13:45:25.204677 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:45:25.204967 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT"
),
customer AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 

  MD5(S.ID) AS K_ABANDONED_CHECKOUT_DLHK
  ,C.K_CUSTOMER_DLHK
  ,L.K_LOCATION_DLHK
  ,MD5(S.USER_ID) AS K_USER_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK  
  ,S.ID AS K_ABANDONED_CHECKOUT_BK
  ,S.CUSTOMER_ID AS K_CUSTOMER_BK
  ,S.DEVICE_ID AS K_DEVICE_BK
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.SOURCE_IDENTIFIER AS K_SOURCE_BKENTIFIER
  ,S.USER_ID AS K_USER_BK
  ,S.ABANDONED_CHECKOUT_URL AS A_ABANDONED_CHECKOUT_URL  
  ,S.CART_TOKEN AS A_CART_TOKEN
  ,S.CLOSED_AT AS A_CLOSED_AT
  ,S.COMPLETED_AT AS A_COMPLETED_AT
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
  ,S.EMAIL AS A_EMAIL
  ,S.GATEWAY AS A_GATEWAY
  ,S.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
  ,S.NAME AS A_NAME
  ,S.NOTE AS A_NOTE
  ,S.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES
  ,S.PHONE AS A_PHONE
  ,S.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
  ,S.REFERRING_SITE AS A_REFERRING_SITE    
  ,S.SOURCE AS A_SOURCE
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.SOURCE_URL AS A_SOURCE_URL
  ,S.TOKEN AS A_TOKEN
  ,S.UPDATED_AT AS A_UPDATED_AT  
  --BOOLEAN
  ,S.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
  ,S.TAXES_INCLUDED AS B_TAXES_INCLUDED
  --METRIC
  ,S.SUBTOTAL_PRICE::decimal(15,2) AS M_SUBTOTAL_PRICE
  ,S.TOTAL_DISCOUNTS::decimal(15,2) AS M_TOTAL_DISCOUNTS
  ,S.TOTAL_DUTIES::decimal(15,2) AS M_TOTAL_DUTIES
  ,S.TOTAL_LINE_ITEMS_PRICE::decimal(15,2) AS M_TOTAL_LINE_ITEMS_PRICE
  ,S.TOTAL_PRICE::decimal(15,2) AS M_TOTAL_PRICE
  ,S.TOTAL_TAX::decimal(15,2) AS M_TOTAL_TAX
  ,S.TOTAL_WEIGHT::decimal(15,2) AS M_TOTAL_WEIGHT
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'48db2339-c1d1-4d06-bec0-2b2ac82d48ae' AS MD_INTGR_ID
  FROM
      source S
      left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
      left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-07 13:45:25.205180 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:45:27.078801 (Thread-1): SQL status: SUCCESS 1 in 1.87 seconds
2022-03-07 13:45:27.081566 (Thread-1): finished collecting timing info
2022-03-07 13:45:27.081873 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: Close
2022-03-07 13:45:27.539071 (Thread-1): 10:45:27 | 6 of 8 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.... [SUCCESS 1 in 2.35s]
2022-03-07 13:45:27.539814 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:45:27.542795 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:45:27.543845 (Thread-1): 10:45:27 | 7 of 8 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_F_STG....... [RUN]
2022-03-07 13:45:27.546781 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:45:27.548175 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:45:27.556617 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG"
2022-03-07 13:45:27.557436 (Thread-1): finished collecting timing info
2022-03-07 13:45:27.559680 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG"
2022-03-07 13:45:27.565496 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:45:27.565738 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_F_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG
),
abandoned_checkout_item AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
),
rename AS 
(   
  SELECT 
  I.K_ABANDONED_CHECKOUT_ITEM_DLHK
  ,S.K_ABANDONED_CHECKOUT_DLHK
  ,I.K_PRODUCT_VARIATION_DLHK
  ,I.K_DESTINATION_LOCATION_BK AS K_ITEM_DESTINATION_LOCATION_BK
  ,I.K_ORIGIN_LOCATION_BK AS K_ITEM_ORIGIN_LOCATION_BK
  ,S.K_CUSTOMER_DLHK
  ,S.K_LOCATION_DLHK
  ,S.K_USER_DLHK
  ,S.K_SHIPPING_ADDRESS_DLHK
  ,S.K_BILLING_ADDRESS_DLHK  
  ,S.K_ABANDONED_CHECKOUT_BK
  ,S.K_CUSTOMER_BK
  ,S.K_DEVICE_BK
  ,S.K_LOCATION_BK
  ,S.K_SOURCE_BKENTIFIER
  ,S.K_USER_BK
  ,S.A_ABANDONED_CHECKOUT_URL  
  ,S.A_CART_TOKEN
  ,S.A_CLOSED_AT
  ,S.A_COMPLETED_AT
  ,S.A_CREATED_AT
  ,S.A_CURRENCY
  ,S.A_CUSTOMER_LOCALE
  ,S.A_EMAIL
  ,S.A_GATEWAY
  ,S.A_LANDING_SITE_BASE_URL
  ,S.A_NAME
  ,S.A_NOTE
  ,S.A_NOTE_ATTRIBUTES
  ,S.A_PHONE
  ,S.A_PRESENTMENT_CURRENCY
  ,S.A_REFERRING_SITE    
  ,S.A_SOURCE
  ,S.A_SOURCE_NAME
  ,S.A_SOURCE_URL
  ,S.A_TOKEN
  ,S.A_UPDATED_AT    
  ,S.B_BUYER_ACCEPTS_MARKETING
  ,S.B_TAXES_INCLUDED  
  ,I.B_GIFT_CARD
  ,I.B_REQUIRES_SHIPPING
  ,I.B_TAXABLE
  --,S.M_SUBTOTAL_PRICE
  ,S.M_TOTAL_DISCOUNTS
  --,S.M_TOTAL_DUTIES
  --,S.M_TOTAL_LINE_ITEMS_PRICE
  --,S.M_TOTAL_PRICE
  --,S.M_TOTAL_TAX
  
  ,ROUND(DIV0((S.M_TOTAL_DUTIES * I.PRICE),S.M_TOTAL_LINE_ITEMS_PRICE),4)::decimal(15,4) as M_ALLOCATED_DUTIES
  ,ROUND(DIV0((S.M_TOTAL_TAX * I.PRICE),S.M_TOTAL_LINE_ITEMS_PRICE),4)::decimal(15,4) as M_ALLOCATED_TAXES
  ,ROUND(DIV0((S.M_TOTAL_DISCOUNTS * I.PRICE),S.M_TOTAL_LINE_ITEMS_PRICE),4)::decimal(15,4) as M_ALLOCATED_DISCOUNTS
  
  ,I.COMPARE_AT_PRICE::decimal(15,2)  AS M_COMPARE_AT_PRICE
  ,I.GRAMS::decimal(15,2)  AS M_GRAMS
  ,I.LINE_PRICE::decimal(15,2)  AS M_LINE_PRICE
  ,I.PRICE::decimal(15,2)  AS M_PRICE
  ,I.QUANTITY::decimal(15,2)  AS M_QUANTITY
  ,I.VARIANT_PRICE::decimal(15,2)  AS M_VARIANT_PRICE
  ,(I.PRICE + M_ALLOCATED_DUTIES - M_ALLOCATED_TAXES - M_ALLOCATED_DISCOUNTS)::decimal(15,4) AS M_TOTAL_PRICE

  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'48db2339-c1d1-4d06-bec0-2b2ac82d48ae' AS MD_INTGR_ID
  FROM
      source S
      left join abandoned_checkout_item I ON I.K_ABANDONED_CHECKOUT_BK = S.K_ABANDONED_CHECKOUT_BK
)


SELECT * FROM rename
  );
2022-03-07 13:45:27.565911 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:45:29.551378 (Thread-1): Snowflake query id: 01a2c479-0601-4183-000b-358300f4e866
2022-03-07 13:45:29.551612 (Thread-1): Snowflake error: 000904 (42000): SQL compilation error: error line 68 at position 34
invalid identifier 'I.PRICE'
2022-03-07 13:45:29.551814 (Thread-1): finished collecting timing info
2022-03-07 13:45:29.551980 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG: Close
2022-03-07 13:45:30.021579 (Thread-1): Database Error in model V_ABANDONED_CHECKOUT_F_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql)
  000904 (42000): SQL compilation error: error line 68 at position 34
  invalid identifier 'I.PRICE'
  compiled SQL at target/run/snowflake_aicd/models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 68 at position 34
invalid identifier 'I.PRICE'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_ABANDONED_CHECKOUT_F_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql)
  000904 (42000): SQL compilation error: error line 68 at position 34
  invalid identifier 'I.PRICE'
  compiled SQL at target/run/snowflake_aicd/models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql
2022-03-07 13:45:30.037198 (Thread-1): 10:45:30 | 7 of 8 ERROR creating view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_F_STG [ERROR in 2.49s]
2022-03-07 13:45:30.037465 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:45:30.037998 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-07 13:45:30.038169 (Thread-1): 10:45:30 | 8 of 8 SKIP relation DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F.............. [SKIP]
2022-03-07 13:45:30.038373 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-07 13:45:30.039280 (MainThread): Acquiring new snowflake connection "master".
2022-03-07 13:45:30.039801 (MainThread): 10:45:30 | 
2022-03-07 13:45:30.040053 (MainThread): 10:45:30 | Finished running 5 view models, 3 table models in 25.04s.
2022-03-07 13:45:30.040238 (MainThread): Connection 'master' was properly closed.
2022-03-07 13:45:30.040387 (MainThread): Connection 'model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG' was properly closed.
2022-03-07 13:45:30.048155 (MainThread): 
2022-03-07 13:45:30.048382 (MainThread): Completed with 1 error and 0 warnings:
2022-03-07 13:45:30.048518 (MainThread): 
2022-03-07 13:45:30.048642 (MainThread): Database Error in model V_ABANDONED_CHECKOUT_F_STG (models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql)
2022-03-07 13:45:30.048759 (MainThread):   000904 (42000): SQL compilation error: error line 68 at position 34
2022-03-07 13:45:30.048871 (MainThread):   invalid identifier 'I.PRICE'
2022-03-07 13:45:30.048980 (MainThread):   compiled SQL at target/run/snowflake_aicd/models/staging/ABANDONED_CHECKOUT/V_ABANDONED_CHECKOUT_F_STG.sql
2022-03-07 13:45:30.049113 (MainThread): 
Done. PASS=6 WARN=0 ERROR=1 SKIP=1 TOTAL=8
2022-03-07 13:45:30.049294 (MainThread): Flushing usage events
2022-03-07 13:47:11.895283 (MainThread): Running with dbt=0.21.1
2022-03-07 13:47:12.423786 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=['+W_ABANDONED_CHECKOUT_F'], selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-07 13:47:12.425360 (MainThread): Tracking: do not track
2022-03-07 13:47:12.435710 (MainThread): Partial parsing not enabled
2022-03-07 13:47:12.456464 (MainThread): Parsing macros/common.sql
2022-03-07 13:47:12.459669 (MainThread): Parsing macros/catalog.sql
2022-03-07 13:47:12.461375 (MainThread): Parsing macros/adapters.sql
2022-03-07 13:47:12.492852 (MainThread): Parsing macros/materializations/merge.sql
2022-03-07 13:47:12.496216 (MainThread): Parsing macros/materializations/seed.sql
2022-03-07 13:47:12.500055 (MainThread): Parsing macros/materializations/view.sql
2022-03-07 13:47:12.501263 (MainThread): Parsing macros/materializations/table.sql
2022-03-07 13:47:12.503990 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-07 13:47:12.511456 (MainThread): Parsing macros/core.sql
2022-03-07 13:47:12.514355 (MainThread): Parsing macros/materializations/test.sql
2022-03-07 13:47:12.519783 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-07 13:47:12.527952 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-07 13:47:12.529331 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-07 13:47:12.543151 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-07 13:47:12.572022 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-07 13:47:12.591504 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-07 13:47:12.592908 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-07 13:47:12.601444 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-07 13:47:12.618654 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-07 13:47:12.630975 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-07 13:47:12.638008 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-07 13:47:12.644068 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-07 13:47:12.647079 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-07 13:47:12.648207 (MainThread): Parsing macros/etc/query.sql
2022-03-07 13:47:12.648916 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-07 13:47:12.650047 (MainThread): Parsing macros/etc/datetime.sql
2022-03-07 13:47:12.657023 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-07 13:47:12.658613 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-07 13:47:12.660533 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-07 13:47:12.661735 (MainThread): Parsing macros/adapters/common.sql
2022-03-07 13:47:12.708301 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-07 13:47:12.710097 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-07 13:47:12.711139 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-07 13:47:12.712267 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-07 13:47:12.866308 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:47:12.875243 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.878283 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_ADDRESS_STG".
2022-03-07 13:47:12.881076 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.881905 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_TRANSACTIONS_STG".
2022-03-07 13:47:12.884776 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.885923 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:47:12.889006 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.890141 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:47:12.895325 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.896226 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:47:12.900098 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.900890 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_COLLECTION_STG".
2022-03-07 13:47:12.903913 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.904646 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_STG".
2022-03-07 13:47:12.907043 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.907747 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCTS_D_STG".
2022-03-07 13:47:12.911058 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.912018 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PRODUCT_VARIANT_STG".
2022-03-07 13:47:12.914913 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.915727 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:47:12.918142 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.918850 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-07 13:47:12.923455 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.924471 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_INVENTORY_ITEM_STG".
2022-03-07 13:47:12.927626 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.928371 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_LINE_ITEM_STG".
2022-03-07 13:47:12.933867 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.934599 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_HEADER_STG".
2022-03-07 13:47:12.940583 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.941525 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_TAX_LINE_STG".
2022-03-07 13:47:12.944761 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.945483 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDERS_ADJUSTMENT_STG".
2022-03-07 13:47:12.948730 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.949593 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_REFUND_LINE_ITEM_STG".
2022-03-07 13:47:12.954076 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.954864 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-07 13:47:12.996544 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:12.997718 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-07 13:47:13.000393 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.001122 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCTS_D".
2022-03-07 13:47:13.003545 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.004360 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-07 13:47:13.006790 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.007502 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PRODUCT_COLLECTION_F".
2022-03-07 13:47:13.009682 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.010395 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:47:13.013337 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.014301 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_TRANSACTIONS_F".
2022-03-07 13:47:13.016966 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.017723 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:47:13.020100 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.020818 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_INVENTORY_F".
2022-03-07 13:47:13.023114 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.023846 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMER_ADDRESS_D".
2022-03-07 13:47:13.026158 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.047695 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.049168 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.050753 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.052021 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.053574 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.054735 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.056035 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.057162 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-07 13:47:13.095651 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-07 13:47:13.096217 (MainThread): Found 28 models, 8 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 24 sources, 0 exposures
2022-03-07 13:47:13.096726 (MainThread): context manager reversed is deprecated and to be removed in 3.0.Use G.reverse(copy=False) if G.is_directed() else G instead.
2022-03-07 13:47:13.098301 (MainThread): 
2022-03-07 13:47:13.098649 (MainThread): Acquiring new snowflake connection "master".
2022-03-07 13:47:13.099594 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-07 13:47:13.109954 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-07 13:47:13.110154 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-07 13:47:13.110255 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-07 13:47:14.998712 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 42 in 1.89 seconds
2022-03-07 13:47:15.004053 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-07 13:47:15.475572 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-07 13:47:15.484569 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SHOPIFY".
2022-03-07 13:47:15.484885 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SHOPIFY"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SHOPIFY
2022-03-07 13:47:15.485069 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-07 13:47:17.211358 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 28 in 1.73 seconds
2022-03-07 13:47:17.215558 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SHOPIFY: Close
2022-03-07 13:47:17.664394 (MainThread): 10:47:17 | Concurrency: 1 threads (target='dev')
2022-03-07 13:47:17.664770 (MainThread): 10:47:17 | 
2022-03-07 13:47:17.666403 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:47:17.666953 (Thread-1): 10:47:17 | 1 of 8 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG [RUN]
2022-03-07 13:47:17.668691 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:47:17.668903 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:47:17.672857 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"
2022-03-07 13:47:17.673460 (Thread-1): finished collecting timing info
2022-03-07 13:47:17.701684 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"
2022-03-07 13:47:17.704590 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG".
2022-03-07 13:47:17.704813 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT_LINE_ITEM"
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.ID) AS K_ABANDONED_CHECKOUT_ITEM_DLHK
  ,MD5(S.CHECKOUT_ID) AS K_ABANDONED_CHECKOUT_DLHK
  
  ,MD5(CONCAT(S.PRODUCT_ID,'-',COALESCE(S.VARIANT_ID,'0000000000'))) AS K_PRODUCT_VARIATION_DLHK
  --BUSINESS KEYS
  ,S.ID AS K_ABANDONED_CHECKOUT_ITEM_BK
  ,S.CHECKOUT_ID AS K_ABANDONED_CHECKOUT_BK
  ,S.DESTINATION_LOCATION_ID AS K_DESTINATION_LOCATION_BK    
  ,S.ORIGIN_LOCATION_ID AS K_ORIGIN_LOCATION_BK
  ,S.PRODUCT_ID AS K_PRODUCT_BK
  ,S.VARIANT_ID AS K_VARIANT_BK
  --ATTRIBUTES
  ,S.FULFILLMENT_SERVICE AS A_FULFILLMENT_SERVICE
  ,S.KEY AS A_KEY
  ,S.PRESENTMENT_TITLE AS A_PRESENTMENT_TITLE
  ,S.PRESENTMENT_VARIANT_TITLE AS A_PRESENTMENT_VARIANT_TITLE
  ,S.SKU AS A_SKU
  ,S.TITLE AS A_TITLE
  ,S.VARIANT_TITLE AS A_VARIANT_TITLE
  ,S.VENDOR AS A_VENDOR
  --BOOLEAN
  ,S.GIFT_CARD AS B_GIFT_CARD
  ,S.REQUIRES_SHIPPING AS B_REQUIRES_SHIPPING
  ,S.TAXABLE AS B_TAXABLE
  --METRICS
  ,S.COMPARE_AT_PRICE AS M_COMPARE_AT_PRICE
  ,S.GRAMS AS M_GRAMS
  ,S.LINE_PRICE AS M_LINE_PRICE
  ,S.PRICE AS M_PRICE
  ,S.QUANTITY AS M_QUANTITY
  ,S.VARIANT_PRICE AS M_VARIANT_PRICE
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'9a6254a5-a7b6-4785-afcf-f956626fae6f' AS MD_INTGR_ID
  FROM
      source S
)


SELECT * FROM rename
  );
2022-03-07 13:47:17.704928 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:47:19.558379 (Thread-1): SQL status: SUCCESS 1 in 1.85 seconds
2022-03-07 13:47:19.569623 (Thread-1): finished collecting timing info
2022-03-07 13:47:19.570037 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG: Close
2022-03-07 13:47:20.026703 (Thread-1): 10:47:20 | 1 of 8 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG [SUCCESS 1 in 2.36s]
2022-03-07 13:47:20.027098 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
2022-03-07 13:47:20.027428 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:47:20.028197 (Thread-1): 10:47:20 | 2 of 8 START view model DBT_SHOPIFY.V_CUSTOMER_STG................... [RUN]
2022-03-07 13:47:20.028696 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:47:20.028936 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:47:20.033553 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-07 13:47:20.034164 (Thread-1): finished collecting timing info
2022-03-07 13:47:20.036551 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-07 13:47:20.039434 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-07 13:47:20.039549 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."CUSTOMER"
),
rename AS 
(   
SELECT 
    --KEYS
    MD5(ID) AS K_CUSTOMER_DLHK    
    --BUSINESS KEYS
    ,ID AS K_CUSTOMER_BK
    ,LAST_ORDER_ID AS K_LAST_ORDER_BK
    ,MULTIPASS_IDENTIFIER AS K_MULTIPASS_BKENTIFIER
    --ATTRIBUTES
    ,ACCEPTS_MARKETING_UPDATED_AT AS A_ACCEPTS_MARKETING_UPDATED_AT_DTS
    ,CREATED_AT AS A_CREATED_AT_DTS
    ,CURRENCY AS A_CURRENCY
    ,EMAIL AS A_EMAIL
    ,
    (COALESCE(FIRST_NAME,'') || ' ' || COALESCE(LAST_NAME,''))
 AS A_FULL_NAME
    ,FIRST_NAME AS A_FIRST_NAME
    ,LAST_NAME AS A_LAST_NAME
    ,LAST_ORDER_NAME AS A_LAST_ORDER_NAME
    ,MARKETING_OPT_IN_LEVEL AS A_MARKETING_OPT_IN_LEVEL
    ,NOTE AS A_NOTE
    ,PHONE AS A_PHONE
    ,SMS_MARKETING_CONSENT AS A_SMS_MARKETING_CONSENT
    ,STATE AS A_STATE
    ,TAGS AS A_TAGS
    ,TAX_EXEMPTIONS AS A_TAX_EXEMPTIONS
    ,TOTAL_SPENT AS A_TOTAL_SPENT
    ,UPDATED_AT AS A_UPDATED_AT
    --BOOLEAN
    ,ACCEPTS_MARKETING AS B_ACCEPTS_MARKETING
    ,TAX_EXEMPT AS B_TAX_EXEMPT
    ,VERIFIED_EMAIL AS B_VERIFIED_EMAIL
    --METRICS
    ,ORDERS_COUNT AS M_ORDERS_COUNT
    --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'9a6254a5-a7b6-4785-afcf-f956626fae6f' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-07 13:47:20.039650 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:47:21.728212 (Thread-1): SQL status: SUCCESS 1 in 1.69 seconds
2022-03-07 13:47:21.732139 (Thread-1): finished collecting timing info
2022-03-07 13:47:21.732574 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-07 13:47:22.185693 (Thread-1): 10:47:22 | 2 of 8 OK created view model DBT_SHOPIFY.V_CUSTOMER_STG.............. [SUCCESS 1 in 2.16s]
2022-03-07 13:47:22.186014 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-07 13:47:22.186344 (Thread-1): Began running node model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:47:22.186590 (Thread-1): 10:47:22 | 3 of 8 START view model DBT_SHOPIFY.V_LOCATION_STG................... [RUN]
2022-03-07 13:47:22.187011 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:47:22.187406 (Thread-1): Compiling model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:47:22.191041 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-07 13:47:22.191688 (Thread-1): finished collecting timing info
2022-03-07 13:47:22.193895 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_LOCATION_STG"
2022-03-07 13:47:22.196657 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_LOCATION_STG".
2022-03-07 13:47:22.196918 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SHOPIFY."LOCATION"
),

rename as (
  SELECT
  MD5(ID) AS K_LOCATION_DLHK
  ,ID AS K_LOCATION_BK
  ,ADDRESS_1 AS A_ADDRESS_1
  ,ADDRESS_2 AS A_ADDRESS_2
  ,CITY AS A_CITY
  ,COUNTRY AS A_COUNTRY
  ,COUNTRY_CODE AS A_COUNTRY_CODE
  ,COUNTRY_NAME AS A_COUNTRY_NAME
  ,CREATED_AT AS A_CREATED_AT
  ,LOCALIZED_COUNTRY_NAME AS A_LOCALIZED_COUNTRY_NAME
  ,LOCALIZED_PROVINCE_NAME AS A_LOCALIZED_PROVINCE_NAME
  ,NAME AS A_NAME
  ,PHONE AS A_PHONE
  ,PROVINCE AS A_PROVINCE
  ,PROVINCE_CODE AS A_PROVINCE_CODE
  ,UPDATED_AT AS A_UPDATED_AT_DTS
  ,ZIP AS A_ZIP
  --BOOLEAN  
  ,ACTIVE AS B_ACTIVE
  ,LEGACY AS B_LEGACY   
  --metadata (MD)
  ,__DLH_IS_DELETED AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '9a6254a5-a7b6-4785-afcf-f956626fae6f' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-07 13:47:22.197102 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:47:23.999778 (Thread-1): SQL status: SUCCESS 1 in 1.80 seconds
2022-03-07 13:47:24.002987 (Thread-1): finished collecting timing info
2022-03-07 13:47:24.003309 (Thread-1): On model.snowflake_aicd.V_LOCATION_STG: Close
2022-03-07 13:47:24.444685 (Thread-1): 10:47:24 | 3 of 8 OK created view model DBT_SHOPIFY.V_LOCATION_STG.............. [SUCCESS 1 in 2.26s]
2022-03-07 13:47:24.445095 (Thread-1): Finished running node model.snowflake_aicd.V_LOCATION_STG
2022-03-07 13:47:24.445378 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:47:24.445702 (Thread-1): 10:47:24 | 4 of 8 START table model DBT_SHOPIFY.W_CUSTOMERS_D................... [RUN]
2022-03-07 13:47:24.446596 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:47:24.446948 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:47:24.451643 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-07 13:47:24.453310 (Thread-1): finished collecting timing info
2022-03-07 13:47:24.476879 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-07 13:47:24.477910 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-07 13:47:24.478055 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_CUSTOMER_STG AS C
      );
2022-03-07 13:47:24.478195 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:47:27.330766 (Thread-1): SQL status: SUCCESS 1 in 2.85 seconds
2022-03-07 13:47:27.338546 (Thread-1): finished collecting timing info
2022-03-07 13:47:27.338842 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-07 13:47:27.783625 (Thread-1): 10:47:27 | 4 of 8 OK created table model DBT_SHOPIFY.W_CUSTOMERS_D.............. [SUCCESS 1 in 3.34s]
2022-03-07 13:47:27.783871 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-07 13:47:27.784099 (Thread-1): Began running node model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:47:27.784336 (Thread-1): 10:47:27 | 5 of 8 START table model DBT_SHOPIFY.W_LOCATION_D.................... [RUN]
2022-03-07 13:47:27.784593 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:47:27.784725 (Thread-1): Compiling model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:47:27.787867 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-07 13:47:27.788376 (Thread-1): finished collecting timing info
2022-03-07 13:47:27.790195 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_LOCATION_D"
2022-03-07 13:47:27.790906 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_LOCATION_D".
2022-03-07 13:47:27.791007 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_LOCATION_STG AS M
      );
2022-03-07 13:47:27.791108 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:47:30.318020 (Thread-1): SQL status: SUCCESS 1 in 2.53 seconds
2022-03-07 13:47:30.323225 (Thread-1): finished collecting timing info
2022-03-07 13:47:30.323986 (Thread-1): On model.snowflake_aicd.W_LOCATION_D: Close
2022-03-07 13:47:30.779846 (Thread-1): 10:47:30 | 5 of 8 OK created table model DBT_SHOPIFY.W_LOCATION_D............... [SUCCESS 1 in 2.99s]
2022-03-07 13:47:30.780422 (Thread-1): Finished running node model.snowflake_aicd.W_LOCATION_D
2022-03-07 13:47:30.782518 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:47:30.783399 (Thread-1): 10:47:30 | 6 of 8 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG......... [RUN]
2022-03-07 13:47:30.784831 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:47:30.796478 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:47:30.800743 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-07 13:47:30.801402 (Thread-1): finished collecting timing info
2022-03-07 13:47:30.803355 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"
2022-03-07 13:47:30.809221 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG".
2022-03-07 13:47:30.809390 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SHOPIFY."ABANDONED_CHECKOUT"
),
customer AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_CUSTOMERS_D
),
locations AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.W_LOCATION_D
),
rename AS 
(   
  SELECT 

  MD5(S.ID) AS K_ABANDONED_CHECKOUT_DLHK
  ,C.K_CUSTOMER_DLHK
  ,L.K_LOCATION_DLHK
  ,MD5(S.USER_ID) AS K_USER_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.SHIPPING_ADDRESS), 'zip')),'00')))
 AS K_SHIPPING_ADDRESS_DLHK
  ,
    MD5(CONCAT(coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address1')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'address2')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'city')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'country_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'first_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'last_name')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'province_code')),'00'),
              coalesce(to_varchar(get_path(parse_json(S.BILLING_ADDRESS), 'zip')),'00')))
 AS K_BILLING_ADDRESS_DLHK  
  ,S.ID AS K_ABANDONED_CHECKOUT_BK
  ,S.CUSTOMER_ID AS K_CUSTOMER_BK
  ,S.DEVICE_ID AS K_DEVICE_BK
  ,S.LOCATION_ID AS K_LOCATION_BK
  ,S.SOURCE_IDENTIFIER AS K_SOURCE_BKENTIFIER
  ,S.USER_ID AS K_USER_BK
  ,S.ABANDONED_CHECKOUT_URL AS A_ABANDONED_CHECKOUT_URL  
  ,S.CART_TOKEN AS A_CART_TOKEN
  ,S.CLOSED_AT AS A_CLOSED_AT
  ,S.COMPLETED_AT AS A_COMPLETED_AT
  ,S.CREATED_AT AS A_CREATED_AT
  ,S.CURRENCY AS A_CURRENCY
  ,S.CUSTOMER_LOCALE AS A_CUSTOMER_LOCALE
  ,S.EMAIL AS A_EMAIL
  ,S.GATEWAY AS A_GATEWAY
  ,S.LANDING_SITE_BASE_URL AS A_LANDING_SITE_BASE_URL
  ,S.NAME AS A_NAME
  ,S.NOTE AS A_NOTE
  ,S.NOTE_ATTRIBUTES AS A_NOTE_ATTRIBUTES
  ,S.PHONE AS A_PHONE
  ,S.PRESENTMENT_CURRENCY AS A_PRESENTMENT_CURRENCY
  ,S.REFERRING_SITE AS A_REFERRING_SITE    
  ,S.SOURCE AS A_SOURCE
  ,S.SOURCE_NAME AS A_SOURCE_NAME
  ,S.SOURCE_URL AS A_SOURCE_URL
  ,S.TOKEN AS A_TOKEN
  ,S.UPDATED_AT AS A_UPDATED_AT  
  --BOOLEAN
  ,S.BUYER_ACCEPTS_MARKETING AS B_BUYER_ACCEPTS_MARKETING
  ,S.TAXES_INCLUDED AS B_TAXES_INCLUDED
  --METRIC
  ,S.SUBTOTAL_PRICE::decimal(15,2) AS M_SUBTOTAL_PRICE
  ,S.TOTAL_DISCOUNTS::decimal(15,2) AS M_TOTAL_DISCOUNTS
  ,S.TOTAL_DUTIES::decimal(15,2) AS M_TOTAL_DUTIES
  ,S.TOTAL_LINE_ITEMS_PRICE::decimal(15,2) AS M_TOTAL_LINE_ITEMS_PRICE
  ,S.TOTAL_PRICE::decimal(15,2) AS M_TOTAL_PRICE
  ,S.TOTAL_TAX::decimal(15,2) AS M_TOTAL_TAX
  ,S.TOTAL_WEIGHT::decimal(15,2) AS M_TOTAL_WEIGHT
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'9a6254a5-a7b6-4785-afcf-f956626fae6f' AS MD_INTGR_ID
  FROM
      source S
      left join customer C ON C.K_CUSTOMER_BK = S.CUSTOMER_ID
      left join locations L ON L.K_LOCATION_BK = S.LOCATION_ID
)


SELECT * FROM rename
  );
2022-03-07 13:47:30.809549 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:47:32.621358 (Thread-1): SQL status: SUCCESS 1 in 1.81 seconds
2022-03-07 13:47:32.624622 (Thread-1): finished collecting timing info
2022-03-07 13:47:32.625059 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG: Close
2022-03-07 13:47:33.089167 (Thread-1): 10:47:33 | 6 of 8 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG.... [SUCCESS 1 in 2.30s]
2022-03-07 13:47:33.090365 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_STG
2022-03-07 13:47:33.095236 (Thread-1): Began running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:47:33.097528 (Thread-1): 10:47:33 | 7 of 8 START view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_F_STG....... [RUN]
2022-03-07 13:47:33.098254 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:47:33.098739 (Thread-1): Compiling model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:47:33.103499 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG"
2022-03-07 13:47:33.103995 (Thread-1): finished collecting timing info
2022-03-07 13:47:33.105849 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG"
2022-03-07 13:47:33.110941 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG".
2022-03-07 13:47:33.111195 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_F_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_STG
),
abandoned_checkout_item AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_LINE_ITEM_STG
),
rename AS 
(   
  SELECT 
  I.K_ABANDONED_CHECKOUT_ITEM_DLHK
  ,S.K_ABANDONED_CHECKOUT_DLHK
  ,I.K_PRODUCT_VARIATION_DLHK
  ,I.K_DESTINATION_LOCATION_BK AS K_ITEM_DESTINATION_LOCATION_BK
  ,I.K_ORIGIN_LOCATION_BK AS K_ITEM_ORIGIN_LOCATION_BK
  ,S.K_CUSTOMER_DLHK
  ,S.K_LOCATION_DLHK
  ,S.K_USER_DLHK
  ,S.K_SHIPPING_ADDRESS_DLHK
  ,S.K_BILLING_ADDRESS_DLHK  
  ,S.K_ABANDONED_CHECKOUT_BK
  ,S.K_CUSTOMER_BK
  ,S.K_DEVICE_BK
  ,S.K_LOCATION_BK
  ,S.K_SOURCE_BKENTIFIER
  ,S.K_USER_BK
  ,S.A_ABANDONED_CHECKOUT_URL  
  ,S.A_CART_TOKEN
  ,S.A_CLOSED_AT
  ,S.A_COMPLETED_AT
  ,S.A_CREATED_AT
  ,S.A_CURRENCY
  ,S.A_CUSTOMER_LOCALE
  ,S.A_EMAIL
  ,S.A_GATEWAY
  ,S.A_LANDING_SITE_BASE_URL
  ,S.A_NAME
  ,S.A_NOTE
  ,S.A_NOTE_ATTRIBUTES
  ,S.A_PHONE
  ,S.A_PRESENTMENT_CURRENCY
  ,S.A_REFERRING_SITE    
  ,S.A_SOURCE
  ,S.A_SOURCE_NAME
  ,S.A_SOURCE_URL
  ,S.A_TOKEN
  ,S.A_UPDATED_AT    
  ,S.B_BUYER_ACCEPTS_MARKETING
  ,S.B_TAXES_INCLUDED  
  ,I.B_GIFT_CARD
  ,I.B_REQUIRES_SHIPPING
  ,I.B_TAXABLE
  --,S.M_SUBTOTAL_PRICE
  ,S.M_TOTAL_DISCOUNTS
  --,S.M_TOTAL_DUTIES
  --,S.M_TOTAL_LINE_ITEMS_PRICE
  --,S.M_TOTAL_PRICE
  --,S.M_TOTAL_TAX
  
  ,ROUND(DIV0((S.M_TOTAL_DUTIES * I.M_PRICE),S.M_TOTAL_LINE_ITEMS_PRICE),4)::decimal(15,4) as M_ALLOCATED_DUTIES
  ,ROUND(DIV0((S.M_TOTAL_TAX * I.M_PRICE),S.M_TOTAL_LINE_ITEMS_PRICE),4)::decimal(15,4) as M_ALLOCATED_TAXES
  ,ROUND(DIV0((S.M_TOTAL_DISCOUNTS * I.M_PRICE),S.M_TOTAL_LINE_ITEMS_PRICE),4)::decimal(15,4) as M_ALLOCATED_DISCOUNTS
  
  ,I.M_COMPARE_AT_PRICE
  ,I.M_GRAMS
  ,I.M_LINE_PRICE
  ,I.M_PRICE
  ,I.M_QUANTITY
  ,I.M_VARIANT_PRICE
  ,(I.M_PRICE + M_ALLOCATED_DUTIES - M_ALLOCATED_TAXES - M_ALLOCATED_DISCOUNTS)::decimal(15,4) AS M_TOTAL_PRICE
  
  --//metadata (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'9a6254a5-a7b6-4785-afcf-f956626fae6f' AS MD_INTGR_ID
  FROM
      source S
      left join abandoned_checkout_item I ON I.K_ABANDONED_CHECKOUT_BK = S.K_ABANDONED_CHECKOUT_BK
)


SELECT * FROM rename
  );
2022-03-07 13:47:33.111373 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:47:35.080709 (Thread-1): SQL status: SUCCESS 1 in 1.97 seconds
2022-03-07 13:47:35.085435 (Thread-1): finished collecting timing info
2022-03-07 13:47:35.086643 (Thread-1): On model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG: Close
2022-03-07 13:47:35.552187 (Thread-1): 10:47:35 | 7 of 8 OK created view model DBT_SHOPIFY.V_ABANDONED_CHECKOUT_F_STG.. [SUCCESS 1 in 2.45s]
2022-03-07 13:47:35.552898 (Thread-1): Finished running node model.snowflake_aicd.V_ABANDONED_CHECKOUT_F_STG
2022-03-07 13:47:35.554350 (Thread-1): Began running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-07 13:47:35.554823 (Thread-1): 10:47:35 | 8 of 8 START table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F.......... [RUN]
2022-03-07 13:47:35.555323 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-07 13:47:35.555561 (Thread-1): Compiling model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-07 13:47:35.562625 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-07 13:47:35.565502 (Thread-1): finished collecting timing info
2022-03-07 13:47:35.569289 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"
2022-03-07 13:47:35.571101 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F".
2022-03-07 13:47:35.571494 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ABANDONED_CHECKOUT_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SHOPIFY.V_ABANDONED_CHECKOUT_F_STG AS C
      );
2022-03-07 13:47:35.571748 (Thread-1): Opening a new connection, currently in state closed
2022-03-07 13:47:38.702186 (Thread-1): SQL status: SUCCESS 1 in 3.13 seconds
2022-03-07 13:47:38.705596 (Thread-1): finished collecting timing info
2022-03-07 13:47:38.706371 (Thread-1): On model.snowflake_aicd.W_ABANDONED_CHECKOUT_F: Close
2022-03-07 13:47:39.163593 (Thread-1): 10:47:39 | 8 of 8 OK created table model DBT_SHOPIFY.W_ABANDONED_CHECKOUT_F..... [SUCCESS 1 in 3.61s]
2022-03-07 13:47:39.163846 (Thread-1): Finished running node model.snowflake_aicd.W_ABANDONED_CHECKOUT_F
2022-03-07 13:47:39.164822 (MainThread): Acquiring new snowflake connection "master".
2022-03-07 13:47:39.165167 (MainThread): 10:47:39 | 
2022-03-07 13:47:39.165293 (MainThread): 10:47:39 | Finished running 5 view models, 3 table models in 26.07s.
2022-03-07 13:47:39.165395 (MainThread): Connection 'master' was properly closed.
2022-03-07 13:47:39.165478 (MainThread): Connection 'model.snowflake_aicd.W_ABANDONED_CHECKOUT_F' was properly closed.
2022-03-07 13:47:39.170996 (MainThread): 
2022-03-07 13:47:39.171186 (MainThread): Completed successfully
2022-03-07 13:47:39.171321 (MainThread): 
Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
2022-03-07 13:47:39.171487 (MainThread): Flushing usage events
2022-03-10 12:03:24.605796 (MainThread): Running with dbt=0.21.1
2022-03-10 12:03:25.253208 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-10 12:03:25.259988 (MainThread): Tracking: do not track
2022-03-10 12:03:25.271603 (MainThread): Partial parsing not enabled
2022-03-10 12:03:25.288513 (MainThread): Parsing macros/common.sql
2022-03-10 12:03:25.291620 (MainThread): Parsing macros/catalog.sql
2022-03-10 12:03:25.293330 (MainThread): Parsing macros/adapters.sql
2022-03-10 12:03:25.324593 (MainThread): Parsing macros/materializations/merge.sql
2022-03-10 12:03:25.327694 (MainThread): Parsing macros/materializations/seed.sql
2022-03-10 12:03:25.331301 (MainThread): Parsing macros/materializations/view.sql
2022-03-10 12:03:25.332315 (MainThread): Parsing macros/materializations/table.sql
2022-03-10 12:03:25.334694 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-10 12:03:25.341456 (MainThread): Parsing macros/core.sql
2022-03-10 12:03:25.344252 (MainThread): Parsing macros/materializations/test.sql
2022-03-10 12:03:25.349479 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-10 12:03:25.357720 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-10 12:03:25.359084 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-10 12:03:25.373624 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-10 12:03:25.402672 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-10 12:03:25.421326 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-10 12:03:25.422657 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-10 12:03:25.430829 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-10 12:03:25.447575 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-10 12:03:25.459069 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-10 12:03:25.465737 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-10 12:03:25.471677 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-10 12:03:25.474588 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-10 12:03:25.475654 (MainThread): Parsing macros/etc/query.sql
2022-03-10 12:03:25.476323 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-10 12:03:25.477427 (MainThread): Parsing macros/etc/datetime.sql
2022-03-10 12:03:25.484208 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-10 12:03:25.485524 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-10 12:03:25.487355 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-10 12:03:25.488513 (MainThread): Parsing macros/adapters/common.sql
2022-03-10 12:03:25.533875 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-10 12:03:25.535106 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-10 12:03:25.535955 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-10 12:03:25.536937 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-10 12:03:25.679433 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:03:25.687323 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.690184 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:03:25.692536 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.693249 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:03:25.696937 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.697665 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:03:25.700109 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.700799 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:03:25.703375 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.704083 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_ACCESS_HISTORY_STG".
2022-03-10 12:03:25.707112 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.707818 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_ORDERS_F".
2022-03-10 12:03:25.710548 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.711235 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_ABANDONED_CHECKOUT_F".
2022-03-10 12:03:25.713395 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.714098 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_PRODUCTS_D".
2022-03-10 12:03:25.716265 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.716953 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_DATE_D".
2022-03-10 12:03:25.719268 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.719964 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_PRODUCT_COLLECTION_F".
2022-03-10 12:03:25.722191 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.722901 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_LOCATION_D".
2022-03-10 12:03:25.725086 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.725777 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_TRANSACTIONS_F".
2022-03-10 12:03:25.727951 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.728639 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_CUSTOMERS_D".
2022-03-10 12:03:25.730786 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.731478 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_INVENTORY_F".
2022-03-10 12:03:25.733636 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.734321 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_CUSTOMER_ADDRESS_D".
2022-03-10 12:03:25.736596 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.793485 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.794824 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.796008 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.797174 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.798481 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.799595 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.800696 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.801799 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:03:25.814322 (MainThread): Flushing usage events
2022-03-10 12:03:25.814489 (MainThread): Connection 'model.snowflake_aicg.W_CUSTOMER_ADDRESS_D' was properly closed.
2022-03-10 12:03:25.814593 (MainThread): Encountered an error:
2022-03-10 12:03:25.814711 (MainThread): Compilation Error in model V_ACCESS_HISTORY_STG (models/staging/ACCESS_HISTORY/V_ACCESS_HISTORY_STG.sql)
  Model 'model.snowflake_aicg.V_ACCESS_HISTORY_STG' (models/staging/ACCESS_HISTORY/V_ACCESS_HISTORY_STG.sql) depends on a node named 'W_TABLES_D' which was not found
2022-03-10 12:03:25.825737 (MainThread): Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/main.py", line 127, in main
    results, succeeded = handle_and_check(args)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/main.py", line 205, in handle_and_check
    task, res = run_from_args(parsed)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/main.py", line 258, in run_from_args
    results = task.run()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 438, in run
    self._runtime_initialize()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 154, in _runtime_initialize
    super()._runtime_initialize()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 92, in _runtime_initialize
    self.load_manifest()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 79, in load_manifest
    self.manifest = ManifestLoader.get_full_manifest(self.config)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 182, in get_full_manifest
    manifest = loader.load()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 361, in load
    self.process_refs(self.root_project.project_name)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 721, in process_refs
    _process_refs_for_node(self.manifest, current_project, node)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 1032, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 805, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/exceptions.py", line 587, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/exceptions.py", line 447, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model V_ACCESS_HISTORY_STG (models/staging/ACCESS_HISTORY/V_ACCESS_HISTORY_STG.sql)
  Model 'model.snowflake_aicg.V_ACCESS_HISTORY_STG' (models/staging/ACCESS_HISTORY/V_ACCESS_HISTORY_STG.sql) depends on a node named 'W_TABLES_D' which was not found

2022-03-10 12:04:15.095047 (MainThread): Running with dbt=0.21.1
2022-03-10 12:04:15.577923 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-10 12:04:15.579367 (MainThread): Tracking: do not track
2022-03-10 12:04:15.588763 (MainThread): Partial parsing not enabled
2022-03-10 12:04:15.601429 (MainThread): Parsing macros/common.sql
2022-03-10 12:04:15.604692 (MainThread): Parsing macros/catalog.sql
2022-03-10 12:04:15.606546 (MainThread): Parsing macros/adapters.sql
2022-03-10 12:04:15.639307 (MainThread): Parsing macros/materializations/merge.sql
2022-03-10 12:04:15.642499 (MainThread): Parsing macros/materializations/seed.sql
2022-03-10 12:04:15.646132 (MainThread): Parsing macros/materializations/view.sql
2022-03-10 12:04:15.647144 (MainThread): Parsing macros/materializations/table.sql
2022-03-10 12:04:15.649618 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-10 12:04:15.656379 (MainThread): Parsing macros/core.sql
2022-03-10 12:04:15.659226 (MainThread): Parsing macros/materializations/test.sql
2022-03-10 12:04:15.664565 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-10 12:04:15.672365 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-10 12:04:15.673666 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-10 12:04:15.687313 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-10 12:04:15.718134 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-10 12:04:15.738395 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-10 12:04:15.739933 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-10 12:04:15.749018 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-10 12:04:15.767741 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-10 12:04:15.779934 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-10 12:04:15.787251 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-10 12:04:15.793692 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-10 12:04:15.797014 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-10 12:04:15.798245 (MainThread): Parsing macros/etc/query.sql
2022-03-10 12:04:15.798946 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-10 12:04:15.800108 (MainThread): Parsing macros/etc/datetime.sql
2022-03-10 12:04:15.807161 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-10 12:04:15.808516 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-10 12:04:15.810360 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-10 12:04:15.811523 (MainThread): Parsing macros/adapters/common.sql
2022-03-10 12:04:15.859207 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-10 12:04:15.860449 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-10 12:04:15.861278 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-10 12:04:15.862243 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-10 12:04:16.007247 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:04:16.014704 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:16.017738 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:04:16.020824 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:16.021714 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:04:16.026174 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:16.027088 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:04:16.029831 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:16.030561 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:04:16.033460 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:16.034224 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_ACCESS_HISTORY_STG".
2022-03-10 12:04:16.037381 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:16.038212 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_TRANSACTIONS_F".
2022-03-10 12:04:16.040620 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:16.060523 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:16.061762 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:16.062917 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:16.064174 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:16.065340 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:16.066497 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:16.067666 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:16.069532 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:16.121617 (MainThread): Flushing usage events
2022-03-10 12:04:16.145936 (MainThread): Connection 'model.snowflake_aicg.W_TRANSACTIONS_F' was properly closed.
2022-03-10 12:04:16.146184 (MainThread): Encountered an error:
2022-03-10 12:04:16.146353 (MainThread): Compilation Error in model V_ACCESS_HISTORY_STG (models/staging/ACCESS_HISTORY/V_ACCESS_HISTORY_STG.sql)
  Model 'model.snowflake_aicg.V_ACCESS_HISTORY_STG' (models/staging/ACCESS_HISTORY/V_ACCESS_HISTORY_STG.sql) depends on a node named 'W_TABLES_D' which was not found
2022-03-10 12:04:16.165766 (MainThread): Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/main.py", line 127, in main
    results, succeeded = handle_and_check(args)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/main.py", line 205, in handle_and_check
    task, res = run_from_args(parsed)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/main.py", line 258, in run_from_args
    results = task.run()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 438, in run
    self._runtime_initialize()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 154, in _runtime_initialize
    super()._runtime_initialize()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 92, in _runtime_initialize
    self.load_manifest()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 79, in load_manifest
    self.manifest = ManifestLoader.get_full_manifest(self.config)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 182, in get_full_manifest
    manifest = loader.load()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 361, in load
    self.process_refs(self.root_project.project_name)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 721, in process_refs
    _process_refs_for_node(self.manifest, current_project, node)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 1032, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 805, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/exceptions.py", line 587, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/exceptions.py", line 447, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model V_ACCESS_HISTORY_STG (models/staging/ACCESS_HISTORY/V_ACCESS_HISTORY_STG.sql)
  Model 'model.snowflake_aicg.V_ACCESS_HISTORY_STG' (models/staging/ACCESS_HISTORY/V_ACCESS_HISTORY_STG.sql) depends on a node named 'W_TABLES_D' which was not found

2022-03-10 12:04:26.244676 (MainThread): Running with dbt=0.21.1
2022-03-10 12:04:26.757379 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-10 12:04:26.758335 (MainThread): Tracking: do not track
2022-03-10 12:04:26.768385 (MainThread): Partial parsing not enabled
2022-03-10 12:04:26.781707 (MainThread): Parsing macros/common.sql
2022-03-10 12:04:26.784825 (MainThread): Parsing macros/catalog.sql
2022-03-10 12:04:26.786845 (MainThread): Parsing macros/adapters.sql
2022-03-10 12:04:26.820744 (MainThread): Parsing macros/materializations/merge.sql
2022-03-10 12:04:26.823988 (MainThread): Parsing macros/materializations/seed.sql
2022-03-10 12:04:26.827679 (MainThread): Parsing macros/materializations/view.sql
2022-03-10 12:04:26.828665 (MainThread): Parsing macros/materializations/table.sql
2022-03-10 12:04:26.831084 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-10 12:04:26.838254 (MainThread): Parsing macros/core.sql
2022-03-10 12:04:26.841243 (MainThread): Parsing macros/materializations/test.sql
2022-03-10 12:04:26.846946 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-10 12:04:26.854984 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-10 12:04:26.856341 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-10 12:04:26.870561 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-10 12:04:26.903321 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-10 12:04:26.922952 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-10 12:04:26.924301 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-10 12:04:26.932845 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-10 12:04:26.951410 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-10 12:04:26.963448 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-10 12:04:26.970807 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-10 12:04:26.977302 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-10 12:04:26.980202 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-10 12:04:26.981288 (MainThread): Parsing macros/etc/query.sql
2022-03-10 12:04:26.981968 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-10 12:04:26.983102 (MainThread): Parsing macros/etc/datetime.sql
2022-03-10 12:04:26.990134 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-10 12:04:26.991534 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-10 12:04:26.993361 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-10 12:04:26.994508 (MainThread): Parsing macros/adapters/common.sql
2022-03-10 12:04:27.043525 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-10 12:04:27.044856 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-10 12:04:27.045693 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-10 12:04:27.046653 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-10 12:04:27.195912 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:04:27.203344 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:27.207901 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:04:27.210358 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:27.211095 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:04:27.214822 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:27.215543 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:04:27.217985 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:27.218684 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:04:27.221873 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:27.222748 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_ACCESS_HISTORY_STG".
2022-03-10 12:04:27.225984 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:27.226709 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_TABLES_D".
2022-03-10 12:04:27.229103 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:27.249983 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:27.251278 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:27.252451 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:27.253703 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:27.254822 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:27.255937 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:27.257095 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:27.259032 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:04:27.307723 (MainThread): [WARNING]: Test 'test.snowflake_aicg.unique_W_CUSTOMERS_D_K_CUSTOMER_DLHK.190cadd98a' (models/schema.yml) depends on a node named 'W_CUSTOMERS_D' which was not found
2022-03-10 12:04:27.307939 (MainThread): [WARNING]: Test 'test.snowflake_aicg.not_null_W_CUSTOMERS_D_K_CUSTOMER_DLHK.d428ec020e' (models/schema.yml) depends on a node named 'W_CUSTOMERS_D' which was not found
2022-03-10 12:04:27.308052 (MainThread): [WARNING]: Test 'test.snowflake_aicg.unique_W_PRODUCTS_D_K_PRODUCT_DLHK.8597b27fcc' (models/schema.yml) depends on a node named 'W_PRODUCTS_D' which was not found
2022-03-10 12:04:27.308158 (MainThread): [WARNING]: Test 'test.snowflake_aicg.not_null_W_PRODUCTS_D_K_PRODUCT_DLHK.cf0934feba' (models/schema.yml) depends on a node named 'W_PRODUCTS_D' which was not found
2022-03-10 12:04:27.308260 (MainThread): [WARNING]: Test 'test.snowflake_aicg.unique_W_ORDERS_F_K_ORDER_LINE_ITEM_DLHK.203cea5c69' (models/schema.yml) depends on a node named 'W_ORDERS_F' which was not found
2022-03-10 12:04:27.308356 (MainThread): [WARNING]: Test 'test.snowflake_aicg.not_null_W_ORDERS_F_K_ORDER_LINE_ITEM_DLHK.dab1d9030b' (models/schema.yml) depends on a node named 'W_ORDERS_F' which was not found
2022-03-10 12:04:27.308452 (MainThread): [WARNING]: Test 'test.snowflake_aicg.unique_W_LOCATION_D_K_LOCATION_DLHK.ae6d83719f' (models/schema.yml) depends on a node named 'W_LOCATION_D' which was not found
2022-03-10 12:04:27.308542 (MainThread): [WARNING]: Test 'test.snowflake_aicg.not_null_W_LOCATION_D_K_LOCATION_DLHK.b52dd4acc4' (models/schema.yml) depends on a node named 'W_LOCATION_D' which was not found
2022-03-10 12:04:27.328148 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-10 12:04:27.328809 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 18 sources, 0 exposures
2022-03-10 12:04:27.330363 (MainThread): 
2022-03-10 12:04:27.330625 (MainThread): Acquiring new snowflake connection "master".
2022-03-10 12:04:27.331414 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-10 12:04:27.340747 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-10 12:04:27.340921 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-10 12:04:27.341023 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-10 12:04:29.837572 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 43 in 2.50 seconds
2022-03-10 12:04:29.846664 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-10 12:04:30.384506 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "create_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE".
2022-03-10 12:04:30.385392 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "create_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE".
2022-03-10 12:04:30.385889 (ThreadPoolExecutor-0_0): Creating schema "DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE"
2022-03-10 12:04:30.398579 (ThreadPoolExecutor-0_0): Using snowflake connection "create_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE".
2022-03-10 12:04:30.398893 (ThreadPoolExecutor-0_0): On create_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "connection_name": "create_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE"} */
create schema if not exists DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE
2022-03-10 12:04:30.399343 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state closed
2022-03-10 12:04:32.299036 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 1 in 1.90 seconds
2022-03-10 12:04:32.301295 (ThreadPoolExecutor-0_0): On create_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE: Close
2022-03-10 12:04:33.690490 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE".
2022-03-10 12:04:33.713893 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE".
2022-03-10 12:04:33.714458 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE
2022-03-10 12:04:33.714726 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-10 12:04:35.324418 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 0 in 1.61 seconds
2022-03-10 12:04:35.329073 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE: Close
2022-03-10 12:04:35.799533 (MainThread): 09:04:35 | Concurrency: 1 threads (target='dev')
2022-03-10 12:04:35.800468 (MainThread): 09:04:35 | 
2022-03-10 12:04:35.802723 (Thread-1): Began running node model.snowflake_aicg.V_COLUMNS_STG
2022-03-10 12:04:35.803200 (Thread-1): 09:04:35 | 1 of 7 START view model DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG............ [RUN]
2022-03-10 12:04:35.803525 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:04:35.803684 (Thread-1): Compiling model.snowflake_aicg.V_COLUMNS_STG
2022-03-10 12:04:35.807654 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_COLUMNS_STG"
2022-03-10 12:04:35.808555 (Thread-1): finished collecting timing info
2022-03-10 12:04:35.839132 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_COLUMNS_STG"
2022-03-10 12:04:35.845607 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:04:35.845804 (Thread-1): On model.snowflake_aicg.V_COLUMNS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_COLUMNS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG  as (
    
 

WITH source AS (
  SELECT * FROM  SNOWFLAKE.ACCOUNT_USAGE."COLUMNS"
),

rename as (
SELECT
--DLHK
  MD5(S.COLUMN_ID) AS K_COLUMN_DLHK
  ,MD5(S.TABLE_ID) AS K_TABLE_DLHK
  ,MD5(S.TABLE_CATALOG_ID) AS K_DATABASE_DLHK
  ,MD5(CONCAT(COALESCE(S.TABLE_NAME,'A'),COALESCE(S.TABLE_SCHEMA_ID,'A'),COALESCE(S.TABLE_CATALOG_ID,'A'))) AS K_UNIQUE_TABLE_DLHK
--BUSINESS KEYS
  ,S.COLUMN_ID AS K_COLUMN_BK
  ,S.TABLE_ID AS K_TABLE_BK
  ,S.TABLE_CATALOG_ID AS K_DATABASE_BK
  ,S.TABLE_SCHEMA_ID AS K_TABLE_SCHEMA_BK
  --ATTRIBUTES  
  ,S.CHARACTER_SET_CATALOG AS A_CHARACTER_SET_CATALOG
  ,S.CHARACTER_SET_NAME AS A_CHARACTER_SET_NAME
  ,S.CHARACTER_SET_SCHEMA AS A_CHARACTER_SET_SCHEMA
  ,S.COLLATION_CATALOG AS A_COLLATION_CATALOG
  ,S.COLLATION_NAME AS A_COLLATION_NAME
  ,S.COLLATION_SCHEMA AS A_COLLATION_SCHEMA
  ,S.COLUMN_DEFAULT AS A_COLUMN_DEFAULT
  ,S.COLUMN_NAME AS A_COLUMN_NAME
  ,S.COMMENT AS A_COMMENT
  ,S.DATA_TYPE AS A_DATA_TYPE
  ,S.DELETED AS A_DELETED
  ,S.DOMAIN_CATALOG AS A_DOMAIN_CATALOG
  ,S.DOMAIN_NAME AS A_DOMAIN_NAME
  ,S.DOMAIN_SCHEMA AS A_DOMAIN_SCHEMA
  ,S.INTERVAL_PRECISION AS A_INTERVAL_PRECISION
  ,S.INTERVAL_TYPE AS A_INTERVAL_TYPE
  ,S.MAXIMUM_CARDINALITY AS A_MAXIMUM_CARDINALITY
  ,S.SCOPE_CATALOG AS A_SCOPE_CATALOG
  ,S.SCOPE_NAME AS A_SCOPE_NAME
  ,S.SCOPE_SCHEMA AS A_SCOPE_SCHEMA
  ,S.TABLE_CATALOG AS A_TABLE_CATALOG
  ,S.TABLE_NAME AS A_TABLE_NAME
  ,S.TABLE_SCHEMA AS A_TABLE_SCHEMA
  ,S.UDT_CATALOG AS A_UDT_CATALOG
  ,S.UDT_NAME AS A_UDT_NAME
  ,S.UDT_SCHEMA AS A_UDT_SCHEMA
  ,S.DTD_IDENTIFIER AS A_DTD_BKENTIFIER
  ,S.IDENTITY_CYCLE AS A_IDENTITY_CYCLE
  ,S.IDENTITY_GENERATION AS A_IDENTITY_GENERATION
  ,S.IDENTITY_INCREMENT AS A_IDENTITY_INCREMENT
  ,S.IDENTITY_MAXIMUM AS A_IDENTITY_MAXIMUM
  ,S.IDENTITY_MINIMUM AS A_IDENTITY_MINIMUM
  ,S.IDENTITY_START AS A_IDENTITY_START
  --BOOLEAN
  ,IIF(S.IS_IDENTITY='YES',TRUE,FALSE) AS B_IS_BKENTITY
  ,IIF(S.IS_NULLABLE='YES',TRUE,FALSE) AS A_IS_NULLABLE
  ,IIF(S.IS_SELF_REFERENCING='YES',TRUE,FALSE) AS A_IS_SELF_REFERENCING
  --METRICS
  ,S.CHARACTER_MAXIMUM_LENGTH AS M_CHARACTER_MAXIMUM_LENGTH
  ,S.CHARACTER_OCTET_LENGTH AS M_CHARACTER_OCTET_LENGTH
  ,S.DATETIME_PRECISION AS M_DATETIME_PRECISION
  ,S.NUMERIC_PRECISION AS M_NUMERIC_PRECISION
  ,S.NUMERIC_PRECISION_RADIX AS M_NUMERIC_PRECISION_RADIX
  ,S.NUMERIC_SCALE AS M_NUMERIC_SCALE
  ,S.ORDINAL_POSITION AS M_ORDINAL_POSITION
    --metadata (MD)
  ,S.CREATED AS MD_VALID_FROM_DTS
  ,S.DELETED AS MD_VALID_TO_DTS
  ,NOT(IFNULL(S.DELETED,TRUE)) AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '74d34fc7-f1d1-4a02-975b-0ab3ae9ae7a6' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-10 12:04:35.845956 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:04:37.736119 (Thread-1): Snowflake query id: 01a2d4f4-0601-442a-000b-358300f73636
2022-03-10 12:04:37.736637 (Thread-1): Snowflake error: 000904 (42000): SQL compilation error: error line 12 at position 6
invalid identifier 'S.COLUMN_ID'
2022-03-10 12:04:37.736861 (Thread-1): finished collecting timing info
2022-03-10 12:04:37.737007 (Thread-1): On model.snowflake_aicg.V_COLUMNS_STG: Close
2022-03-10 12:04:38.203274 (Thread-1): Database Error in model V_COLUMNS_STG (models/staging/COLUMNS/V_COLUMNS_STG.sql)
  000904 (42000): SQL compilation error: error line 12 at position 6
  invalid identifier 'S.COLUMN_ID'
  compiled SQL at target/run/snowflake_aicg/models/staging/COLUMNS/V_COLUMNS_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 12 at position 6
invalid identifier 'S.COLUMN_ID'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_COLUMNS_STG (models/staging/COLUMNS/V_COLUMNS_STG.sql)
  000904 (42000): SQL compilation error: error line 12 at position 6
  invalid identifier 'S.COLUMN_ID'
  compiled SQL at target/run/snowflake_aicg/models/staging/COLUMNS/V_COLUMNS_STG.sql
2022-03-10 12:04:38.230017 (Thread-1): 09:04:38 | 1 of 7 ERROR creating view model DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG... [ERROR in 2.43s]
2022-03-10 12:04:38.230180 (Thread-1): Finished running node model.snowflake_aicg.V_COLUMNS_STG
2022-03-10 12:04:38.230313 (Thread-1): Began running node model.snowflake_aicg.V_DATABASES_STG
2022-03-10 12:04:38.230465 (Thread-1): 09:04:38 | 2 of 7 START view model DBT_SNOWFLAKE_USAGE.V_DATABASES_STG.......... [RUN]
2022-03-10 12:04:38.230691 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:04:38.230797 (Thread-1): Compiling model.snowflake_aicg.V_DATABASES_STG
2022-03-10 12:04:38.233442 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_DATABASES_STG"
2022-03-10 12:04:38.233862 (Thread-1): finished collecting timing info
2022-03-10 12:04:38.235316 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_DATABASES_STG"
2022-03-10 12:04:38.237081 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:04:38.237191 (Thread-1): On model.snowflake_aicg.V_DATABASES_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_DATABASES_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_DATABASES_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    SNOWFLAKE.ACCOUNT_USAGE."DATABASES"
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.DATABASE_ID) AS K_DATABASE_DLHK
  ,MD5(CONCAT(COALESCE(S.TABLE_NAME,'A'),COALESCE(S.TABLE_SCHEMA_ID,'A'),COALESCE(S.TABLE_CATALOG_ID,'A'),COALESCE(S.TABLE_TYPE,'A'))) AS K_UNIQUE_TABLE_DLHK
  --BUSINESS KEYS  
  ,DATABASE_ID AS K_DATABASE_BK
  --ATTRIBUTES
  ,DATABASE_NAME AS A_DATABASE_NAME
  ,DATABASE_OWNER AS A_DATABASE_OWNER
  ,COMMENT AS A_COMMENT
  ,LAST_ALTERED AS A_LAST_ALTERED_AT_DTS
  ,S.CREATED AS A_CREATED_AT_DTS
  ,S.DELETED AS A_DELETED_AT_DTS
  --BOOLEAN
  ,IIF(IS_TRANSIENT='YES', TRUE, FALSE) AS B_IS_TRANSIENT
  --METRICS
  ,RETENTION_TIME AS M_RETENTION_TIME  
  --//metadata (MD)
  ,NOT(IFNULL(S.DELETED,TRUE)) AS MD_IS_DELETED
  ,CURRENT_TIMESTAMP as MD_ELT_UPDATED_DTS
  ,'74d34fc7-f1d1-4a02-975b-0ab3ae9ae7a6' AS MD_INTGR_ID

  FROM
    source S
)


SELECT * FROM rename
  );
2022-03-10 12:04:38.237293 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:04:40.179684 (Thread-1): Snowflake query id: 01a2d4f4-0601-442a-000b-358300f7363a
2022-03-10 12:04:40.180738 (Thread-1): Snowflake error: 000904 (42000): SQL compilation error: error line 15 at position 23
invalid identifier 'S.TABLE_NAME'
2022-03-10 12:04:40.180888 (Thread-1): finished collecting timing info
2022-03-10 12:04:40.181023 (Thread-1): On model.snowflake_aicg.V_DATABASES_STG: Close
2022-03-10 12:04:40.652056 (Thread-1): Database Error in model V_DATABASES_STG (models/staging/DATABASES/V_DATABASES_STG.sql)
  000904 (42000): SQL compilation error: error line 15 at position 23
  invalid identifier 'S.TABLE_NAME'
  compiled SQL at target/run/snowflake_aicg/models/staging/DATABASES/V_DATABASES_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 15 at position 23
invalid identifier 'S.TABLE_NAME'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_DATABASES_STG (models/staging/DATABASES/V_DATABASES_STG.sql)
  000904 (42000): SQL compilation error: error line 15 at position 23
  invalid identifier 'S.TABLE_NAME'
  compiled SQL at target/run/snowflake_aicg/models/staging/DATABASES/V_DATABASES_STG.sql
2022-03-10 12:04:40.678239 (Thread-1): 09:04:40 | 2 of 7 ERROR creating view model DBT_SNOWFLAKE_USAGE.V_DATABASES_STG. [ERROR in 2.45s]
2022-03-10 12:04:40.678398 (Thread-1): Finished running node model.snowflake_aicg.V_DATABASES_STG
2022-03-10 12:04:40.678527 (Thread-1): Began running node model.snowflake_aicg.V_DATE_STG
2022-03-10 12:04:40.678677 (Thread-1): 09:04:40 | 3 of 7 START view model DBT_SNOWFLAKE_USAGE.V_DATE_STG............... [RUN]
2022-03-10 12:04:40.679125 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:04:40.679297 (Thread-1): Compiling model.snowflake_aicg.V_DATE_STG
2022-03-10 12:04:40.682713 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_DATE_STG"
2022-03-10 12:04:40.683107 (Thread-1): finished collecting timing info
2022-03-10 12:04:40.684420 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_DATE_STG"
2022-03-10 12:04:40.704982 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:04:40.705171 (Thread-1): On model.snowflake_aicg.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-10 12:04:40.705434 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:04:42.817415 (Thread-1): SQL status: SUCCESS 1 in 2.11 seconds
2022-03-10 12:04:42.839174 (Thread-1): finished collecting timing info
2022-03-10 12:04:42.839709 (Thread-1): On model.snowflake_aicg.V_DATE_STG: Close
2022-03-10 12:04:43.289121 (Thread-1): 09:04:43 | 3 of 7 OK created view model DBT_SNOWFLAKE_USAGE.V_DATE_STG.......... [SUCCESS 1 in 2.61s]
2022-03-10 12:04:43.289744 (Thread-1): Finished running node model.snowflake_aicg.V_DATE_STG
2022-03-10 12:04:43.290188 (Thread-1): Began running node model.snowflake_aicg.V_TABLES_STG
2022-03-10 12:04:43.290971 (Thread-1): 09:04:43 | 4 of 7 START view model DBT_SNOWFLAKE_USAGE.V_TABLES_STG............. [RUN]
2022-03-10 12:04:43.293227 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:04:43.293784 (Thread-1): Compiling model.snowflake_aicg.V_TABLES_STG
2022-03-10 12:04:43.303421 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_TABLES_STG"
2022-03-10 12:04:43.304137 (Thread-1): finished collecting timing info
2022-03-10 12:04:43.305432 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_TABLES_STG"
2022-03-10 12:04:43.307817 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:04:43.307913 (Thread-1): On model.snowflake_aicg.V_TABLES_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_TABLES_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_TABLES_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    SNOWFLAKE.ACCOUNT_USAGE."TABLES"
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.TABLE_ID) AS K_TABLE_DLHK
  ,MD5(CONCAT(COALESCE(S.TABLE_NAME,'A'),COALESCE(S.TABLE_SCHEMA_ID,'A'),COALESCE(S.TABLE_CATALOG_ID,'A'))) AS K_UNIQUE_TABLE_DLHK
  --BUSINESS KEYS
  ,S.TABLE_ID AS K_TABLE_BK
  ,S.TABLE_CATALOG_ID AS K_DATABASE_BK
  ,S.TABLE_SCHEMA_ID AS K_TABLE_SCHEMA_BK
  --ATTRIBUTES
  ,S.AUTO_CLUSTERING_ON AS A_AUTO_CLUSTERING_ON
  ,S.CLUSTERING_KEY AS A_CLUSTERING_KEY
  ,S.COMMENT AS A_COMMENT
  ,S.COMMIT_ACTION AS A_COMMIT_ACTION   
  ,S.REFERENCE_GENERATION AS A_REFERENCE_GENERATION
  ,S.SELF_REFERENCING_COLUMN_NAME AS A_SELF_REFERENCING_COLUMN_NAME
  ,S.TABLE_CATALOG AS A_TABLE_CATALOG
  ,S.TABLE_NAME AS A_TABLE_NAME
  ,S.TABLE_OWNER AS A_TABLE_OWNER
  ,S.TABLE_SCHEMA AS A_TABLE_SCHEMA
  ,S.TABLE_TYPE AS A_TABLE_TYPE
  ,S.USER_DEFINED_TYPE_CATALOG AS A_USER_DEFINED_TYPE_CATALOG
  ,S.USER_DEFINED_TYPE_NAME AS A_USER_DEFINED_TYPE_NAME
  ,S.USER_DEFINED_TYPE_SCHEMA AS A_USER_DEFINED_TYPE_SCHEMA   
  --BOOLEAN
  ,IIF(S.IS_INSERTABLE_INTO='YES',TRUE,FALSE) AS B_IS_INSERTABLE_INTO
  ,IIF(S.IS_TRANSIENT='YES',TRUE,FALSE) AS B_IS_TRANSIENT
  ,IIF(S.IS_TYPED='YES',TRUE,FALSE) AS B_IS_TYPED
  --METRICS
  ,S.BYTES AS M_BYTES
  ,S.RETENTION_TIME AS M_RETENTION_TIME
  ,S.ROW_COUNT AS M_ROW_COUNT
  ,S.LAST_ALTERED AS A_LAST_ALTERED_AT_DTS
  --//metadata (MD)
  ,S.CREATED AS MD_VALID_FROM_DTS
  ,S.DELETED AS MD_VALID_TO_DTS
  ,NOT(IFNULL(S.DELETED,TRUE)) AS MD_IS_DELETED
  ,CURRENT_TIMESTAMP as MD_ELT_UPDATED_DTS
  ,'74d34fc7-f1d1-4a02-975b-0ab3ae9ae7a6' AS MD_INTGR_ID

  FROM
    source S
)


SELECT * FROM rename
  );
2022-03-10 12:04:43.308010 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:04:45.019463 (Thread-1): Snowflake query id: 01a2d4f4-0601-4473-000b-358300f71b56
2022-03-10 12:04:45.019653 (Thread-1): Snowflake error: 002140 (42601): SQL compilation error:
Unknown functions IIF, IIF, IIF
2022-03-10 12:04:45.019805 (Thread-1): finished collecting timing info
2022-03-10 12:04:45.019942 (Thread-1): On model.snowflake_aicg.V_TABLES_STG: Close
2022-03-10 12:04:45.526224 (Thread-1): Database Error in model V_TABLES_STG (models/staging/TABLES/V_TABLES_STG.sql)
  002140 (42601): SQL compilation error:
  Unknown functions IIF, IIF, IIF
  compiled SQL at target/run/snowflake_aicg/models/staging/TABLES/V_TABLES_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 002140 (42601): SQL compilation error:
Unknown functions IIF, IIF, IIF

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_TABLES_STG (models/staging/TABLES/V_TABLES_STG.sql)
  002140 (42601): SQL compilation error:
  Unknown functions IIF, IIF, IIF
  compiled SQL at target/run/snowflake_aicg/models/staging/TABLES/V_TABLES_STG.sql
2022-03-10 12:04:45.556932 (Thread-1): 09:04:45 | 4 of 7 ERROR creating view model DBT_SNOWFLAKE_USAGE.V_TABLES_STG.... [ERROR in 2.27s]
2022-03-10 12:04:45.557103 (Thread-1): Finished running node model.snowflake_aicg.V_TABLES_STG
2022-03-10 12:04:45.557373 (Thread-1): Began running node model.snowflake_aicg.V_USERS_STG
2022-03-10 12:04:45.557617 (Thread-1): 09:04:45 | 5 of 7 START view model DBT_SNOWFLAKE_USAGE.V_USERS_STG.............. [RUN]
2022-03-10 12:04:45.558079 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:04:45.558319 (Thread-1): Compiling model.snowflake_aicg.V_USERS_STG
2022-03-10 12:04:45.560610 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_USERS_STG"
2022-03-10 12:04:45.561106 (Thread-1): finished collecting timing info
2022-03-10 12:04:45.562847 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_USERS_STG"
2022-03-10 12:04:45.565113 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:04:45.565254 (Thread-1): On model.snowflake_aicg.V_USERS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_USERS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_USERS_STG  as (
    
 

WITH source AS (
  SELECT * FROM  SNOWFLAKE.ACCOUNT_USAGE."COLUMNS"
),

rename as (
SELECT
--DLHK
  MD5(S.NAME) AS K_USER_DLHK  
  ,S.NAME AS A_USERNAME
  ,S.BYPASS_MFA_UNTIL AS A_BYPASS_MFA_UNTIL
  ,S.COMMENT AS A_COMMENT  
  ,S.DEFAULT_NAMESPACE AS A_DEFAULT_NAMESPACE
  ,S.DEFAULT_ROLE AS A_DEFAULT_ROLE
  ,S.DEFAULT_WAREHOUSE AS A_DEFAULT_WAREHOUSE  
  ,S.DISABLED AS A_DISABLED
  ,S.DISPLAY_NAME AS A_DISPLAY_NAME
  ,S.EMAIL AS A_EMAIL  
  ,S.EXT_AUTHN_DUO AS A_EXT_AUTHN_DUO
  ,S.FIRST_NAME AS A_FIRST_NAME
  ,S.LAST_NAME AS A_LAST_NAME
  ,S.LAST_SUCCESS_LOGIN AS A_LAST_SUCCESS_LOGIN
  ,S.LOCKED_UNTIL_TIME AS A_LOCKED_UNTIL_TIME
  ,S.LOGIN_NAME AS A_LOGIN_NAME
  ,S.NAME AS A_NAME
  ,S.PASSWORD_LAST_SET_TIME AS A_PASSWORD_LAST_SET_TIME
  ,S.EXT_AUTHN_UID AS A_EXT_AUTHN_UID
  ,S.EXPIRES_AT AS A_EXPIRES_AT_DTS
  --BOOLEAN
  ,S.HAS_PASSWORD AS B_HAS_PASSWORD
  ,S.HAS_RSA_PUBLIC_KEY AS B_HAS_RSA_PUBLIC_KEY
  ,S.MUST_CHANGE_PASSWORD AS B_MUST_CHANGE_PASSWORD
  ,iif(S.SNOWFLAKE_LOCK='false',FALSE,TRUE) AS B_SNOWFLAKE_LOCK
  ,iif(S.DISABLED='false',FALSE,TRUE) AS B_DISABLED
    --metadata (MD)
  ,S.CREATED_ON AS MD_VALID_FROM_DTS
  ,S.DELETED_ON AS MD_VALID_TO_DTS
  ,NOT(IFNULL(S.DELETED_ON,TRUE)) AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '74d34fc7-f1d1-4a02-975b-0ab3ae9ae7a6' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-10 12:04:45.565361 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:04:47.298411 (Thread-1): Snowflake query id: 01a2d4f4-0601-442a-000b-358300f7364a
2022-03-10 12:04:47.299498 (Thread-1): Snowflake error: 000904 (42000): SQL compilation error: error line 12 at position 6
invalid identifier 'S.NAME'
2022-03-10 12:04:47.299661 (Thread-1): finished collecting timing info
2022-03-10 12:04:47.299808 (Thread-1): On model.snowflake_aicg.V_USERS_STG: Close
2022-03-10 12:04:47.769888 (Thread-1): Database Error in model V_USERS_STG (models/staging/USERS/V_USERS_STG.sql)
  000904 (42000): SQL compilation error: error line 12 at position 6
  invalid identifier 'S.NAME'
  compiled SQL at target/run/snowflake_aicg/models/staging/USERS/V_USERS_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 12 at position 6
invalid identifier 'S.NAME'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_USERS_STG (models/staging/USERS/V_USERS_STG.sql)
  000904 (42000): SQL compilation error: error line 12 at position 6
  invalid identifier 'S.NAME'
  compiled SQL at target/run/snowflake_aicg/models/staging/USERS/V_USERS_STG.sql
2022-03-10 12:04:47.790173 (Thread-1): 09:04:47 | 5 of 7 ERROR creating view model DBT_SNOWFLAKE_USAGE.V_USERS_STG..... [ERROR in 2.23s]
2022-03-10 12:04:47.790354 (Thread-1): Finished running node model.snowflake_aicg.V_USERS_STG
2022-03-10 12:04:47.790492 (Thread-1): Began running node model.snowflake_aicg.W_TABLES_D
2022-03-10 12:04:47.790624 (Thread-1): 09:04:47 | 6 of 7 SKIP relation DBT_SNOWFLAKE_USAGE.W_TABLES_D.................. [SKIP]
2022-03-10 12:04:47.790749 (Thread-1): Finished running node model.snowflake_aicg.W_TABLES_D
2022-03-10 12:04:47.791191 (Thread-1): Began running node model.snowflake_aicg.V_ACCESS_HISTORY_STG
2022-03-10 12:04:47.791352 (Thread-1): 09:04:47 | 7 of 7 SKIP relation DBT_SNOWFLAKE_USAGE.V_ACCESS_HISTORY_STG........ [SKIP]
2022-03-10 12:04:47.791478 (Thread-1): Finished running node model.snowflake_aicg.V_ACCESS_HISTORY_STG
2022-03-10 12:04:47.792486 (MainThread): Acquiring new snowflake connection "master".
2022-03-10 12:04:47.792791 (MainThread): 09:04:47 | 
2022-03-10 12:04:47.792908 (MainThread): 09:04:47 | Finished running 6 view models, 1 table model in 20.46s.
2022-03-10 12:04:47.793006 (MainThread): Connection 'master' was properly closed.
2022-03-10 12:04:47.793084 (MainThread): Connection 'model.snowflake_aicg.V_USERS_STG' was properly closed.
2022-03-10 12:04:47.798156 (MainThread): 
2022-03-10 12:04:47.798329 (MainThread): Completed with 4 errors and 0 warnings:
2022-03-10 12:04:47.798451 (MainThread): 
2022-03-10 12:04:47.798555 (MainThread): Database Error in model V_COLUMNS_STG (models/staging/COLUMNS/V_COLUMNS_STG.sql)
2022-03-10 12:04:47.798776 (MainThread):   000904 (42000): SQL compilation error: error line 12 at position 6
2022-03-10 12:04:47.798883 (MainThread):   invalid identifier 'S.COLUMN_ID'
2022-03-10 12:04:47.798977 (MainThread):   compiled SQL at target/run/snowflake_aicg/models/staging/COLUMNS/V_COLUMNS_STG.sql
2022-03-10 12:04:47.799076 (MainThread): 
2022-03-10 12:04:47.799175 (MainThread): Database Error in model V_DATABASES_STG (models/staging/DATABASES/V_DATABASES_STG.sql)
2022-03-10 12:04:47.799267 (MainThread):   000904 (42000): SQL compilation error: error line 15 at position 23
2022-03-10 12:04:47.799354 (MainThread):   invalid identifier 'S.TABLE_NAME'
2022-03-10 12:04:47.799441 (MainThread):   compiled SQL at target/run/snowflake_aicg/models/staging/DATABASES/V_DATABASES_STG.sql
2022-03-10 12:04:47.799529 (MainThread): 
2022-03-10 12:04:47.799623 (MainThread): Database Error in model V_TABLES_STG (models/staging/TABLES/V_TABLES_STG.sql)
2022-03-10 12:04:47.799711 (MainThread):   002140 (42601): SQL compilation error:
2022-03-10 12:04:47.799795 (MainThread):   Unknown functions IIF, IIF, IIF
2022-03-10 12:04:47.799880 (MainThread):   compiled SQL at target/run/snowflake_aicg/models/staging/TABLES/V_TABLES_STG.sql
2022-03-10 12:04:47.799969 (MainThread): 
2022-03-10 12:04:47.800058 (MainThread): Database Error in model V_USERS_STG (models/staging/USERS/V_USERS_STG.sql)
2022-03-10 12:04:47.800145 (MainThread):   000904 (42000): SQL compilation error: error line 12 at position 6
2022-03-10 12:04:47.800229 (MainThread):   invalid identifier 'S.NAME'
2022-03-10 12:04:47.800312 (MainThread):   compiled SQL at target/run/snowflake_aicg/models/staging/USERS/V_USERS_STG.sql
2022-03-10 12:04:47.800414 (MainThread): 
Done. PASS=1 WARN=0 ERROR=4 SKIP=2 TOTAL=7
2022-03-10 12:04:47.800557 (MainThread): Flushing usage events
2022-03-10 12:15:11.924821 (MainThread): Running with dbt=0.21.1
2022-03-10 12:15:12.459255 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-10 12:15:12.462266 (MainThread): Tracking: do not track
2022-03-10 12:15:12.472928 (MainThread): Partial parsing not enabled
2022-03-10 12:15:12.487328 (MainThread): Parsing macros/common.sql
2022-03-10 12:15:12.490344 (MainThread): Parsing macros/catalog.sql
2022-03-10 12:15:12.492419 (MainThread): Parsing macros/adapters.sql
2022-03-10 12:15:12.524167 (MainThread): Parsing macros/materializations/merge.sql
2022-03-10 12:15:12.527364 (MainThread): Parsing macros/materializations/seed.sql
2022-03-10 12:15:12.531201 (MainThread): Parsing macros/materializations/view.sql
2022-03-10 12:15:12.532342 (MainThread): Parsing macros/materializations/table.sql
2022-03-10 12:15:12.534874 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-10 12:15:12.541703 (MainThread): Parsing macros/core.sql
2022-03-10 12:15:12.544577 (MainThread): Parsing macros/materializations/test.sql
2022-03-10 12:15:12.549797 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-10 12:15:12.557363 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-10 12:15:12.558592 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-10 12:15:12.572021 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-10 12:15:12.600773 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-10 12:15:12.619365 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-10 12:15:12.620658 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-10 12:15:12.628809 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-10 12:15:12.645655 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-10 12:15:12.657276 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-10 12:15:12.663917 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-10 12:15:12.669829 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-10 12:15:12.672846 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-10 12:15:12.673944 (MainThread): Parsing macros/etc/query.sql
2022-03-10 12:15:12.674616 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-10 12:15:12.675718 (MainThread): Parsing macros/etc/datetime.sql
2022-03-10 12:15:12.682502 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-10 12:15:12.683805 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-10 12:15:12.685594 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-10 12:15:12.686723 (MainThread): Parsing macros/adapters/common.sql
2022-03-10 12:15:12.732133 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-10 12:15:12.733393 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-10 12:15:12.734247 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-10 12:15:12.735216 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-10 12:15:12.879875 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:15:12.887406 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.890187 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:15:12.892534 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.893246 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:15:12.897002 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.897758 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:15:12.900355 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.901074 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:15:12.903628 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.904338 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_ACCESS_HISTORY_STG".
2022-03-10 12:15:12.907347 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.908035 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_USERS_D".
2022-03-10 12:15:12.910193 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.910896 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_COLUMNS_D".
2022-03-10 12:15:12.913042 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.913740 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_DATABASES_D".
2022-03-10 12:15:12.915898 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.916588 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_ACCESS_HISTORY_F".
2022-03-10 12:15:12.918736 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.919420 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_TABLES_D".
2022-03-10 12:15:12.921576 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.976871 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.978150 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.979483 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.980634 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.981744 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.982916 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.984199 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.985298 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:15:12.997661 (MainThread): [WARNING]: Test 'test.snowflake_aicg.unique_W_CUSTOMERS_D_K_CUSTOMER_DLHK.190cadd98a' (models/schema.yml) depends on a node named 'W_CUSTOMERS_D' which was not found
2022-03-10 12:15:12.997819 (MainThread): [WARNING]: Test 'test.snowflake_aicg.not_null_W_CUSTOMERS_D_K_CUSTOMER_DLHK.d428ec020e' (models/schema.yml) depends on a node named 'W_CUSTOMERS_D' which was not found
2022-03-10 12:15:12.997926 (MainThread): [WARNING]: Test 'test.snowflake_aicg.unique_W_PRODUCTS_D_K_PRODUCT_DLHK.8597b27fcc' (models/schema.yml) depends on a node named 'W_PRODUCTS_D' which was not found
2022-03-10 12:15:12.998029 (MainThread): [WARNING]: Test 'test.snowflake_aicg.not_null_W_PRODUCTS_D_K_PRODUCT_DLHK.cf0934feba' (models/schema.yml) depends on a node named 'W_PRODUCTS_D' which was not found
2022-03-10 12:15:12.998127 (MainThread): [WARNING]: Test 'test.snowflake_aicg.unique_W_ORDERS_F_K_ORDER_LINE_ITEM_DLHK.203cea5c69' (models/schema.yml) depends on a node named 'W_ORDERS_F' which was not found
2022-03-10 12:15:12.998225 (MainThread): [WARNING]: Test 'test.snowflake_aicg.not_null_W_ORDERS_F_K_ORDER_LINE_ITEM_DLHK.dab1d9030b' (models/schema.yml) depends on a node named 'W_ORDERS_F' which was not found
2022-03-10 12:15:12.998319 (MainThread): [WARNING]: Test 'test.snowflake_aicg.unique_W_LOCATION_D_K_LOCATION_DLHK.ae6d83719f' (models/schema.yml) depends on a node named 'W_LOCATION_D' which was not found
2022-03-10 12:15:12.998409 (MainThread): [WARNING]: Test 'test.snowflake_aicg.not_null_W_LOCATION_D_K_LOCATION_DLHK.b52dd4acc4' (models/schema.yml) depends on a node named 'W_LOCATION_D' which was not found
2022-03-10 12:15:13.017898 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-10 12:15:13.018547 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 18 sources, 0 exposures
2022-03-10 12:15:13.019869 (MainThread): 
2022-03-10 12:15:13.020146 (MainThread): Acquiring new snowflake connection "master".
2022-03-10 12:15:13.021107 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-10 12:15:13.031399 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-10 12:15:13.031703 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-10 12:15:13.031825 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-10 12:15:14.976974 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 44 in 1.95 seconds
2022-03-10 12:15:14.983716 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-10 12:15:15.469358 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE".
2022-03-10 12:15:15.480686 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE".
2022-03-10 12:15:15.481042 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE
2022-03-10 12:15:15.481227 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-10 12:15:17.271583 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 1 in 1.79 seconds
2022-03-10 12:15:17.280467 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE: Close
2022-03-10 12:15:17.830778 (MainThread): 09:15:17 | Concurrency: 1 threads (target='dev')
2022-03-10 12:15:17.831214 (MainThread): 09:15:17 | 
2022-03-10 12:15:17.833201 (Thread-1): Began running node model.snowflake_aicg.V_COLUMNS_STG
2022-03-10 12:15:17.833736 (Thread-1): 09:15:17 | 1 of 11 START view model DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG........... [RUN]
2022-03-10 12:15:17.834112 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:15:17.834275 (Thread-1): Compiling model.snowflake_aicg.V_COLUMNS_STG
2022-03-10 12:15:17.838230 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_COLUMNS_STG"
2022-03-10 12:15:17.838752 (Thread-1): finished collecting timing info
2022-03-10 12:15:17.871301 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_COLUMNS_STG"
2022-03-10 12:15:17.878440 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:15:17.878642 (Thread-1): On model.snowflake_aicg.V_COLUMNS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_COLUMNS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG  as (
    
 

WITH source AS (
  SELECT * FROM  SNOWFLAKE.ACCOUNT_USAGE."COLUMNS"
),

rename as (
SELECT
--DLHK
  MD5(S.COLUMN_ID) AS K_COLUMN_DLHK
  ,MD5(S.TABLE_ID) AS K_TABLE_DLHK
  ,MD5(S.TABLE_CATALOG_ID) AS K_DATABASE_DLHK
  ,MD5(CONCAT(COALESCE(S.TABLE_NAME,'A'),COALESCE(S.TABLE_SCHEMA_ID,'A'),COALESCE(S.TABLE_CATALOG_ID,'A'))) AS K_UNIQUE_TABLE_DLHK
--BUSINESS KEYS
  ,S.COLUMN_ID AS K_COLUMN_BK
  ,S.TABLE_ID AS K_TABLE_BK
  ,S.TABLE_CATALOG_ID AS K_DATABASE_BK
  ,S.TABLE_SCHEMA_ID AS K_TABLE_SCHEMA_BK
  --ATTRIBUTES  
  ,S.CHARACTER_SET_CATALOG AS A_CHARACTER_SET_CATALOG
  ,S.CHARACTER_SET_NAME AS A_CHARACTER_SET_NAME
  ,S.CHARACTER_SET_SCHEMA AS A_CHARACTER_SET_SCHEMA
  ,S.COLLATION_CATALOG AS A_COLLATION_CATALOG
  ,S.COLLATION_NAME AS A_COLLATION_NAME
  ,S.COLLATION_SCHEMA AS A_COLLATION_SCHEMA
  ,S.COLUMN_DEFAULT AS A_COLUMN_DEFAULT
  ,S.COLUMN_NAME AS A_COLUMN_NAME
  ,S.COMMENT AS A_COMMENT
  ,S.DATA_TYPE AS A_DATA_TYPE
  ,S.DELETED AS A_DELETED
  ,S.DOMAIN_CATALOG AS A_DOMAIN_CATALOG
  ,S.DOMAIN_NAME AS A_DOMAIN_NAME
  ,S.DOMAIN_SCHEMA AS A_DOMAIN_SCHEMA
  ,S.INTERVAL_PRECISION AS A_INTERVAL_PRECISION
  ,S.INTERVAL_TYPE AS A_INTERVAL_TYPE
  ,S.MAXIMUM_CARDINALITY AS A_MAXIMUM_CARDINALITY
  ,S.SCOPE_CATALOG AS A_SCOPE_CATALOG
  ,S.SCOPE_NAME AS A_SCOPE_NAME
  ,S.SCOPE_SCHEMA AS A_SCOPE_SCHEMA
  ,S.TABLE_CATALOG AS A_TABLE_CATALOG
  ,S.TABLE_NAME AS A_TABLE_NAME
  ,S.TABLE_SCHEMA AS A_TABLE_SCHEMA
  ,S.UDT_CATALOG AS A_UDT_CATALOG
  ,S.UDT_NAME AS A_UDT_NAME
  ,S.UDT_SCHEMA AS A_UDT_SCHEMA
  ,S.DTD_IDENTIFIER AS A_DTD_BKENTIFIER
  ,S.IDENTITY_CYCLE AS A_IDENTITY_CYCLE
  ,S.IDENTITY_GENERATION AS A_IDENTITY_GENERATION
  ,S.IDENTITY_INCREMENT AS A_IDENTITY_INCREMENT
  ,S.IDENTITY_MAXIMUM AS A_IDENTITY_MAXIMUM
  ,S.IDENTITY_MINIMUM AS A_IDENTITY_MINIMUM
  ,S.IDENTITY_START AS A_IDENTITY_START
  --BOOLEAN
  ,S.IS_IDENTITY='YES' AS B_IS_BKENTITY
  ,S.IS_NULLABLE='YES' AS A_IS_NULLABLE
  ,S.IS_SELF_REFERENCING='YES' AS A_IS_SELF_REFERENCING
  --METRICS
  ,S.CHARACTER_MAXIMUM_LENGTH AS M_CHARACTER_MAXIMUM_LENGTH
  ,S.CHARACTER_OCTET_LENGTH AS M_CHARACTER_OCTET_LENGTH
  ,S.DATETIME_PRECISION AS M_DATETIME_PRECISION
  ,S.NUMERIC_PRECISION AS M_NUMERIC_PRECISION
  ,S.NUMERIC_PRECISION_RADIX AS M_NUMERIC_PRECISION_RADIX
  ,S.NUMERIC_SCALE AS M_NUMERIC_SCALE
  ,S.ORDINAL_POSITION AS M_ORDINAL_POSITION
    --metadata (MD)
  ,S.CREATED AS MD_VALID_FROM_DTS
  ,S.DELETED AS MD_VALID_TO_DTS
  ,NOT(IFNULL(S.DELETED,TRUE)) AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'b2c83d35-6b86-4637-ae6d-c1623ce684df' AS MD_INTGR_ID
FROM
    source S
)

SELECT * FROM rename
  );
2022-03-10 12:15:17.878813 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:15:19.927856 (Thread-1): Snowflake query id: 01a2d4ff-0601-42b0-000b-358300f728ea
2022-03-10 12:15:19.928271 (Thread-1): Snowflake error: 000904 (42000): SQL compilation error: error line 68 at position 3
invalid identifier 'S.CREATED'
2022-03-10 12:15:19.928500 (Thread-1): finished collecting timing info
2022-03-10 12:15:19.928679 (Thread-1): On model.snowflake_aicg.V_COLUMNS_STG: Close
2022-03-10 12:15:20.390617 (Thread-1): Database Error in model V_COLUMNS_STG (models/staging/COLUMNS/V_COLUMNS_STG.sql)
  000904 (42000): SQL compilation error: error line 68 at position 3
  invalid identifier 'S.CREATED'
  compiled SQL at target/run/snowflake_aicg/models/staging/COLUMNS/V_COLUMNS_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 68 at position 3
invalid identifier 'S.CREATED'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_COLUMNS_STG (models/staging/COLUMNS/V_COLUMNS_STG.sql)
  000904 (42000): SQL compilation error: error line 68 at position 3
  invalid identifier 'S.CREATED'
  compiled SQL at target/run/snowflake_aicg/models/staging/COLUMNS/V_COLUMNS_STG.sql
2022-03-10 12:15:20.414414 (Thread-1): 09:15:20 | 1 of 11 ERROR creating view model DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG.. [ERROR in 2.58s]
2022-03-10 12:15:20.414652 (Thread-1): Finished running node model.snowflake_aicg.V_COLUMNS_STG
2022-03-10 12:15:20.414854 (Thread-1): Began running node model.snowflake_aicg.V_DATABASES_STG
2022-03-10 12:15:20.415094 (Thread-1): 09:15:20 | 2 of 11 START view model DBT_SNOWFLAKE_USAGE.V_DATABASES_STG......... [RUN]
2022-03-10 12:15:20.416132 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:15:20.416389 (Thread-1): Compiling model.snowflake_aicg.V_DATABASES_STG
2022-03-10 12:15:20.419777 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_DATABASES_STG"
2022-03-10 12:15:20.420606 (Thread-1): finished collecting timing info
2022-03-10 12:15:20.423171 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_DATABASES_STG"
2022-03-10 12:15:20.425782 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:15:20.425990 (Thread-1): On model.snowflake_aicg.V_DATABASES_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_DATABASES_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_DATABASES_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    SNOWFLAKE.ACCOUNT_USAGE."DATABASES"
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.DATABASE_ID) AS K_DATABASE_DLHK  
  --BUSINESS KEYS  
  ,DATABASE_ID AS K_DATABASE_BK
  --ATTRIBUTES
  ,DATABASE_NAME AS A_DATABASE_NAME
  ,DATABASE_OWNER AS A_DATABASE_OWNER
  ,COMMENT AS A_COMMENT
  ,LAST_ALTERED AS A_LAST_ALTERED_AT_DTS
  ,S.CREATED AS A_CREATED_AT_DTS
  ,S.DELETED AS A_DELETED_AT_DTS
  --BOOLEAN
  ,IS_TRANSIENT='YES' AS B_IS_TRANSIENT
  --METRICS
  ,RETENTION_TIME AS M_RETENTION_TIME  
  --//metadata (MD)
  ,NOT(IFNULL(S.DELETED,TRUE)) AS MD_IS_DELETED
  ,CURRENT_TIMESTAMP as MD_ELT_UPDATED_DTS
  ,'b2c83d35-6b86-4637-ae6d-c1623ce684df' AS MD_INTGR_ID

  FROM
    source S
)


SELECT * FROM rename
  );
2022-03-10 12:15:20.426140 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:15:22.335686 (Thread-1): Snowflake query id: 01a2d4ff-0601-442a-000b-358300f736d2
2022-03-10 12:15:22.336149 (Thread-1): Snowflake error: 001038 (22023): SQL compilation error:
Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
2022-03-10 12:15:22.336457 (Thread-1): finished collecting timing info
2022-03-10 12:15:22.336734 (Thread-1): On model.snowflake_aicg.V_DATABASES_STG: Close
2022-03-10 12:15:22.880117 (Thread-1): Database Error in model V_DATABASES_STG (models/staging/DATABASES/V_DATABASES_STG.sql)
  001038 (22023): SQL compilation error:
  Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
  compiled SQL at target/run/snowflake_aicg/models/staging/DATABASES/V_DATABASES_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001038 (22023): SQL compilation error:
Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_DATABASES_STG (models/staging/DATABASES/V_DATABASES_STG.sql)
  001038 (22023): SQL compilation error:
  Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
  compiled SQL at target/run/snowflake_aicg/models/staging/DATABASES/V_DATABASES_STG.sql
2022-03-10 12:15:22.902987 (Thread-1): 09:15:22 | 2 of 11 ERROR creating view model DBT_SNOWFLAKE_USAGE.V_DATABASES_STG [ERROR in 2.49s]
2022-03-10 12:15:22.903226 (Thread-1): Finished running node model.snowflake_aicg.V_DATABASES_STG
2022-03-10 12:15:22.903427 (Thread-1): Began running node model.snowflake_aicg.V_DATE_STG
2022-03-10 12:15:22.903964 (Thread-1): 09:15:22 | 3 of 11 START view model DBT_SNOWFLAKE_USAGE.V_DATE_STG.............. [RUN]
2022-03-10 12:15:22.904525 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:15:22.904745 (Thread-1): Compiling model.snowflake_aicg.V_DATE_STG
2022-03-10 12:15:22.910403 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_DATE_STG"
2022-03-10 12:15:22.910953 (Thread-1): finished collecting timing info
2022-03-10 12:15:22.912868 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_DATE_STG"
2022-03-10 12:15:22.938783 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:15:22.939017 (Thread-1): On model.snowflake_aicg.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-10 12:15:22.939231 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:15:24.823558 (Thread-1): SQL status: SUCCESS 1 in 1.88 seconds
2022-03-10 12:15:24.837339 (Thread-1): finished collecting timing info
2022-03-10 12:15:24.837689 (Thread-1): On model.snowflake_aicg.V_DATE_STG: Close
2022-03-10 12:15:25.451551 (Thread-1): 09:15:25 | 3 of 11 OK created view model DBT_SNOWFLAKE_USAGE.V_DATE_STG......... [SUCCESS 1 in 2.55s]
2022-03-10 12:15:25.452536 (Thread-1): Finished running node model.snowflake_aicg.V_DATE_STG
2022-03-10 12:15:25.453013 (Thread-1): Began running node model.snowflake_aicg.V_TABLES_STG
2022-03-10 12:15:25.454043 (Thread-1): 09:15:25 | 4 of 11 START view model DBT_SNOWFLAKE_USAGE.V_TABLES_STG............ [RUN]
2022-03-10 12:15:25.454960 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:15:25.456145 (Thread-1): Compiling model.snowflake_aicg.V_TABLES_STG
2022-03-10 12:15:25.469237 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_TABLES_STG"
2022-03-10 12:15:25.470402 (Thread-1): finished collecting timing info
2022-03-10 12:15:25.473484 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_TABLES_STG"
2022-03-10 12:15:25.479979 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:15:25.480376 (Thread-1): On model.snowflake_aicg.V_TABLES_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_TABLES_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_TABLES_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    SNOWFLAKE.ACCOUNT_USAGE."TABLES"
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.TABLE_ID) AS K_TABLE_DLHK
  ,MD5(CONCAT(COALESCE(S.TABLE_NAME,'A'),COALESCE(S.TABLE_SCHEMA_ID,'A'),COALESCE(S.TABLE_CATALOG_ID,'A'))) AS K_UNIQUE_TABLE_DLHK
  --BUSINESS KEYS
  ,S.TABLE_ID AS K_TABLE_BK
  ,S.TABLE_CATALOG_ID AS K_DATABASE_BK
  ,S.TABLE_SCHEMA_ID AS K_TABLE_SCHEMA_BK
  --ATTRIBUTES
  ,S.AUTO_CLUSTERING_ON AS A_AUTO_CLUSTERING_ON
  ,S.CLUSTERING_KEY AS A_CLUSTERING_KEY
  ,S.COMMENT AS A_COMMENT
  ,S.COMMIT_ACTION AS A_COMMIT_ACTION   
  ,S.REFERENCE_GENERATION AS A_REFERENCE_GENERATION
  ,S.SELF_REFERENCING_COLUMN_NAME AS A_SELF_REFERENCING_COLUMN_NAME
  ,S.TABLE_CATALOG AS A_TABLE_CATALOG
  ,S.TABLE_NAME AS A_TABLE_NAME
  ,S.TABLE_OWNER AS A_TABLE_OWNER
  ,S.TABLE_SCHEMA AS A_TABLE_SCHEMA
  ,S.TABLE_TYPE AS A_TABLE_TYPE
  ,S.USER_DEFINED_TYPE_CATALOG AS A_USER_DEFINED_TYPE_CATALOG
  ,S.USER_DEFINED_TYPE_NAME AS A_USER_DEFINED_TYPE_NAME
  ,S.USER_DEFINED_TYPE_SCHEMA AS A_USER_DEFINED_TYPE_SCHEMA   
  --BOOLEAN
  ,S.IS_INSERTABLE_INTO='YES' AS B_IS_INSERTABLE_INTO
  ,S.IS_TRANSIENT='YES' AS B_IS_TRANSIENT
  ,S.IS_TYPED='YES' AS B_IS_TYPED
  --METRICS
  ,S.BYTES AS M_BYTES
  ,S.RETENTION_TIME AS M_RETENTION_TIME
  ,S.ROW_COUNT AS M_ROW_COUNT
  ,S.LAST_ALTERED AS A_LAST_ALTERED_AT_DTS
  --//metadata (MD)
  ,S.CREATED AS MD_VALID_FROM_DTS
  ,S.DELETED AS MD_VALID_TO_DTS
  ,NOT(IFNULL(S.DELETED,TRUE)) AS MD_IS_DELETED
  ,CURRENT_TIMESTAMP as MD_ELT_UPDATED_DTS
  ,'b2c83d35-6b86-4637-ae6d-c1623ce684df' AS MD_INTGR_ID

  FROM
    source S
)


SELECT * FROM rename
  );
2022-03-10 12:15:25.480642 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:15:27.417910 (Thread-1): Snowflake query id: 01a2d4ff-0601-434f-000b-358300f740ce
2022-03-10 12:15:27.419056 (Thread-1): Snowflake error: 001038 (22023): SQL compilation error:
Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
2022-03-10 12:15:27.419354 (Thread-1): finished collecting timing info
2022-03-10 12:15:27.419533 (Thread-1): On model.snowflake_aicg.V_TABLES_STG: Close
2022-03-10 12:15:27.903762 (Thread-1): Database Error in model V_TABLES_STG (models/staging/TABLES/V_TABLES_STG.sql)
  001038 (22023): SQL compilation error:
  Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
  compiled SQL at target/run/snowflake_aicg/models/staging/TABLES/V_TABLES_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001038 (22023): SQL compilation error:
Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_TABLES_STG (models/staging/TABLES/V_TABLES_STG.sql)
  001038 (22023): SQL compilation error:
  Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
  compiled SQL at target/run/snowflake_aicg/models/staging/TABLES/V_TABLES_STG.sql
2022-03-10 12:15:27.929381 (Thread-1): 09:15:27 | 4 of 11 ERROR creating view model DBT_SNOWFLAKE_USAGE.V_TABLES_STG... [ERROR in 2.47s]
2022-03-10 12:15:27.929568 (Thread-1): Finished running node model.snowflake_aicg.V_TABLES_STG
2022-03-10 12:15:27.929718 (Thread-1): Began running node model.snowflake_aicg.V_USERS_STG
2022-03-10 12:15:27.930073 (Thread-1): 09:15:27 | 5 of 11 START view model DBT_SNOWFLAKE_USAGE.V_USERS_STG............. [RUN]
2022-03-10 12:15:27.930514 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:15:27.930712 (Thread-1): Compiling model.snowflake_aicg.V_USERS_STG
2022-03-10 12:15:27.933749 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_USERS_STG"
2022-03-10 12:15:27.934224 (Thread-1): finished collecting timing info
2022-03-10 12:15:27.936016 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_USERS_STG"
2022-03-10 12:15:27.938930 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:15:27.939128 (Thread-1): On model.snowflake_aicg.V_USERS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_USERS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_USERS_STG  as (
    
 

WITH source AS (
  SELECT * FROM  SNOWFLAKE.ACCOUNT_USAGE."COLUMNS"
),

rename as (
SELECT
--DLHK
  MD5(S.NAME) AS K_USER_DLHK  
  ,S.NAME AS A_USERNAME
  ,S.BYPASS_MFA_UNTIL AS A_BYPASS_MFA_UNTIL
  ,S.COMMENT AS A_COMMENT  
  ,S.DEFAULT_NAMESPACE AS A_DEFAULT_NAMESPACE
  ,S.DEFAULT_ROLE AS A_DEFAULT_ROLE
  ,S.DEFAULT_WAREHOUSE AS A_DEFAULT_WAREHOUSE  
  ,S.DISABLED AS A_DISABLED
  ,S.DISPLAY_NAME AS A_DISPLAY_NAME
  ,S.EMAIL AS A_EMAIL  
  ,S.EXT_AUTHN_DUO AS A_EXT_AUTHN_DUO
  ,S.FIRST_NAME AS A_FIRST_NAME
  ,S.LAST_NAME AS A_LAST_NAME
  ,S.LAST_SUCCESS_LOGIN AS A_LAST_SUCCESS_LOGIN
  ,S.LOCKED_UNTIL_TIME AS A_LOCKED_UNTIL_TIME
  ,S.LOGIN_NAME AS A_LOGIN_NAME
  ,S.NAME AS A_NAME
  ,S.PASSWORD_LAST_SET_TIME AS A_PASSWORD_LAST_SET_TIME
  ,S.EXT_AUTHN_UID AS A_EXT_AUTHN_UID
  ,S.EXPIRES_AT AS A_EXPIRES_AT_DTS
  --BOOLEAN
  ,S.HAS_PASSWORD AS B_HAS_PASSWORD
  ,S.HAS_RSA_PUBLIC_KEY AS B_HAS_RSA_PUBLIC_KEY
  ,S.MUST_CHANGE_PASSWORD AS B_MUST_CHANGE_PASSWORD
  ,S.SNOWFLAKE_LOCK<>'FALSE' OR S.SNOWFLAKE_LOCK IS NULL AS B_SNOWFLAKE_LOCK
  ,S.DISABLED<>'FALSE' OR S.DISABLED IS NULL AS B_DISABLED
    --metadata (MD)
  ,S.CREATED_ON AS MD_VALID_FROM_DTS
  ,S.DELETED_ON AS MD_VALID_TO_DTS
  ,NOT(IFNULL(S.DELETED_ON,TRUE)) AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'b2c83d35-6b86-4637-ae6d-c1623ce684df' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-10 12:15:27.939256 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:15:29.700122 (Thread-1): Snowflake query id: 01a2d4ff-0601-442a-000b-358300f736d6
2022-03-10 12:15:29.700711 (Thread-1): Snowflake error: 000904 (42000): SQL compilation error: error line 12 at position 6
invalid identifier 'S.NAME'
2022-03-10 12:15:29.701058 (Thread-1): finished collecting timing info
2022-03-10 12:15:29.701380 (Thread-1): On model.snowflake_aicg.V_USERS_STG: Close
2022-03-10 12:15:30.225302 (Thread-1): Database Error in model V_USERS_STG (models/staging/USERS/V_USERS_STG.sql)
  000904 (42000): SQL compilation error: error line 12 at position 6
  invalid identifier 'S.NAME'
  compiled SQL at target/run/snowflake_aicg/models/staging/USERS/V_USERS_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 12 at position 6
invalid identifier 'S.NAME'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_USERS_STG (models/staging/USERS/V_USERS_STG.sql)
  000904 (42000): SQL compilation error: error line 12 at position 6
  invalid identifier 'S.NAME'
  compiled SQL at target/run/snowflake_aicg/models/staging/USERS/V_USERS_STG.sql
2022-03-10 12:15:30.253094 (Thread-1): 09:15:30 | 5 of 11 ERROR creating view model DBT_SNOWFLAKE_USAGE.V_USERS_STG.... [ERROR in 2.32s]
2022-03-10 12:15:30.253318 (Thread-1): Finished running node model.snowflake_aicg.V_USERS_STG
2022-03-10 12:15:30.253535 (Thread-1): Began running node model.snowflake_aicg.W_COLUMNS_D
2022-03-10 12:15:30.253696 (Thread-1): 09:15:30 | 6 of 11 SKIP relation DBT_SNOWFLAKE_USAGE.W_COLUMNS_D................ [SKIP]
2022-03-10 12:15:30.253960 (Thread-1): Finished running node model.snowflake_aicg.W_COLUMNS_D
2022-03-10 12:15:30.254193 (Thread-1): Began running node model.snowflake_aicg.W_DATABASES_D
2022-03-10 12:15:30.254331 (Thread-1): 09:15:30 | 7 of 11 SKIP relation DBT_SNOWFLAKE_USAGE.W_DATABASES_D.............. [SKIP]
2022-03-10 12:15:30.254505 (Thread-1): Finished running node model.snowflake_aicg.W_DATABASES_D
2022-03-10 12:15:30.254662 (Thread-1): Began running node model.snowflake_aicg.W_TABLES_D
2022-03-10 12:15:30.254892 (Thread-1): 09:15:30 | 8 of 11 SKIP relation DBT_SNOWFLAKE_USAGE.W_TABLES_D................. [SKIP]
2022-03-10 12:15:30.255070 (Thread-1): Finished running node model.snowflake_aicg.W_TABLES_D
2022-03-10 12:15:30.255226 (Thread-1): Began running node model.snowflake_aicg.W_USERS_D
2022-03-10 12:15:30.255358 (Thread-1): 09:15:30 | 9 of 11 SKIP relation DBT_SNOWFLAKE_USAGE.W_USERS_D.................. [SKIP]
2022-03-10 12:15:30.255530 (Thread-1): Finished running node model.snowflake_aicg.W_USERS_D
2022-03-10 12:15:30.255721 (Thread-1): Began running node model.snowflake_aicg.V_ACCESS_HISTORY_STG
2022-03-10 12:15:30.255904 (Thread-1): 09:15:30 | 10 of 11 SKIP relation DBT_SNOWFLAKE_USAGE.V_ACCESS_HISTORY_STG...... [SKIP]
2022-03-10 12:15:30.256033 (Thread-1): Finished running node model.snowflake_aicg.V_ACCESS_HISTORY_STG
2022-03-10 12:15:30.256350 (Thread-1): Began running node model.snowflake_aicg.W_ACCESS_HISTORY_F
2022-03-10 12:15:30.256617 (Thread-1): 09:15:30 | 11 of 11 SKIP relation DBT_SNOWFLAKE_USAGE.W_ACCESS_HISTORY_F........ [SKIP]
2022-03-10 12:15:30.256788 (Thread-1): Finished running node model.snowflake_aicg.W_ACCESS_HISTORY_F
2022-03-10 12:15:30.257484 (MainThread): Acquiring new snowflake connection "master".
2022-03-10 12:15:30.257765 (MainThread): 09:15:30 | 
2022-03-10 12:15:30.257883 (MainThread): 09:15:30 | Finished running 6 view models, 5 table models in 17.24s.
2022-03-10 12:15:30.257988 (MainThread): Connection 'master' was properly closed.
2022-03-10 12:15:30.258074 (MainThread): Connection 'model.snowflake_aicg.V_USERS_STG' was properly closed.
2022-03-10 12:15:30.263192 (MainThread): 
2022-03-10 12:15:30.263373 (MainThread): Completed with 4 errors and 0 warnings:
2022-03-10 12:15:30.263506 (MainThread): 
2022-03-10 12:15:30.263615 (MainThread): Database Error in model V_COLUMNS_STG (models/staging/COLUMNS/V_COLUMNS_STG.sql)
2022-03-10 12:15:30.263718 (MainThread):   000904 (42000): SQL compilation error: error line 68 at position 3
2022-03-10 12:15:30.263814 (MainThread):   invalid identifier 'S.CREATED'
2022-03-10 12:15:30.263909 (MainThread):   compiled SQL at target/run/snowflake_aicg/models/staging/COLUMNS/V_COLUMNS_STG.sql
2022-03-10 12:15:30.264008 (MainThread): 
2022-03-10 12:15:30.264111 (MainThread): Database Error in model V_DATABASES_STG (models/staging/DATABASES/V_DATABASES_STG.sql)
2022-03-10 12:15:30.264206 (MainThread):   001038 (22023): SQL compilation error:
2022-03-10 12:15:30.264298 (MainThread):   Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
2022-03-10 12:15:30.264390 (MainThread):   compiled SQL at target/run/snowflake_aicg/models/staging/DATABASES/V_DATABASES_STG.sql
2022-03-10 12:15:30.264485 (MainThread): 
2022-03-10 12:15:30.264584 (MainThread): Database Error in model V_TABLES_STG (models/staging/TABLES/V_TABLES_STG.sql)
2022-03-10 12:15:30.264681 (MainThread):   001038 (22023): SQL compilation error:
2022-03-10 12:15:30.264772 (MainThread):   Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
2022-03-10 12:15:30.264866 (MainThread):   compiled SQL at target/run/snowflake_aicg/models/staging/TABLES/V_TABLES_STG.sql
2022-03-10 12:15:30.264959 (MainThread): 
2022-03-10 12:15:30.265056 (MainThread): Database Error in model V_USERS_STG (models/staging/USERS/V_USERS_STG.sql)
2022-03-10 12:15:30.265146 (MainThread):   000904 (42000): SQL compilation error: error line 12 at position 6
2022-03-10 12:15:30.265233 (MainThread):   invalid identifier 'S.NAME'
2022-03-10 12:15:30.265319 (MainThread):   compiled SQL at target/run/snowflake_aicg/models/staging/USERS/V_USERS_STG.sql
2022-03-10 12:15:30.265427 (MainThread): 
Done. PASS=1 WARN=0 ERROR=4 SKIP=6 TOTAL=11
2022-03-10 12:15:30.265579 (MainThread): Flushing usage events
2022-03-10 12:20:44.217062 (MainThread): Running with dbt=0.21.1
2022-03-10 12:20:44.750932 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-10 12:20:44.752418 (MainThread): Tracking: do not track
2022-03-10 12:20:44.762540 (MainThread): Partial parsing not enabled
2022-03-10 12:20:44.778689 (MainThread): Parsing macros/common.sql
2022-03-10 12:20:44.781640 (MainThread): Parsing macros/catalog.sql
2022-03-10 12:20:44.783418 (MainThread): Parsing macros/adapters.sql
2022-03-10 12:20:44.815567 (MainThread): Parsing macros/materializations/merge.sql
2022-03-10 12:20:44.818727 (MainThread): Parsing macros/materializations/seed.sql
2022-03-10 12:20:44.822323 (MainThread): Parsing macros/materializations/view.sql
2022-03-10 12:20:44.823322 (MainThread): Parsing macros/materializations/table.sql
2022-03-10 12:20:44.825718 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-10 12:20:44.832437 (MainThread): Parsing macros/core.sql
2022-03-10 12:20:44.835272 (MainThread): Parsing macros/materializations/test.sql
2022-03-10 12:20:44.840530 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-10 12:20:44.848177 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-10 12:20:44.849450 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-10 12:20:44.862979 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-10 12:20:44.892637 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-10 12:20:44.912510 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-10 12:20:44.914035 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-10 12:20:44.922331 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-10 12:20:44.939718 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-10 12:20:44.951350 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-10 12:20:44.958048 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-10 12:20:44.964294 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-10 12:20:44.967359 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-10 12:20:44.968519 (MainThread): Parsing macros/etc/query.sql
2022-03-10 12:20:44.969224 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-10 12:20:44.970355 (MainThread): Parsing macros/etc/datetime.sql
2022-03-10 12:20:44.977691 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-10 12:20:44.979154 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-10 12:20:44.980991 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-10 12:20:44.982170 (MainThread): Parsing macros/adapters/common.sql
2022-03-10 12:20:45.028809 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-10 12:20:45.030123 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-10 12:20:45.030964 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-10 12:20:45.031934 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-10 12:20:45.175224 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:20:45.183465 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.186460 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:20:45.189027 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.189757 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:20:45.193508 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.194237 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:20:45.196739 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.197452 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:20:45.200039 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.203123 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_ACCESS_HISTORY_STG".
2022-03-10 12:20:45.206229 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.206951 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_USERS_D".
2022-03-10 12:20:45.209147 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.209882 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_COLUMNS_D".
2022-03-10 12:20:45.212083 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.212816 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_DATABASES_D".
2022-03-10 12:20:45.215015 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.215713 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_ACCESS_HISTORY_F".
2022-03-10 12:20:45.217949 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.218668 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_TABLES_D".
2022-03-10 12:20:45.220872 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.278678 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.280034 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.281311 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.282427 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.283561 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.284735 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.286020 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.287478 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:20:45.301084 (MainThread): Flushing usage events
2022-03-10 12:20:45.301332 (MainThread): Connection 'model.snowflake_aicg.W_TABLES_D' was properly closed.
2022-03-10 12:20:45.301461 (MainThread): Encountered an error:
2022-03-10 12:20:45.301586 (MainThread): Compilation Error in model V_USERS_STG (models/staging/USERS/V_USERS_STG.sql)
  Model 'model.snowflake_aicg.V_USERS_STG' (models/staging/USERS/V_USERS_STG.sql) depends on a source named 'ACCOUNT_USAGE.USERS' which was not found
2022-03-10 12:20:45.311767 (MainThread): Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/main.py", line 127, in main
    results, succeeded = handle_and_check(args)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/main.py", line 205, in handle_and_check
    task, res = run_from_args(parsed)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/main.py", line 258, in run_from_args
    results = task.run()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 438, in run
    self._runtime_initialize()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 154, in _runtime_initialize
    super()._runtime_initialize()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 92, in _runtime_initialize
    self.load_manifest()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/runnable.py", line 79, in load_manifest
    self.manifest = ManifestLoader.get_full_manifest(self.config)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 182, in get_full_manifest
    manifest = loader.load()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 360, in load
    self.process_sources(self.root_project.project_name)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 783, in process_sources
    _process_sources_for_node(self.manifest, current_project, node)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 1088, in _process_sources_for_node
    invalid_source_fail_unless_test(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/parser/manifest.py", line 828, in invalid_source_fail_unless_test
    source_target_not_found(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/exceptions.py", line 618, in source_target_not_found
    raise_compiler_error(msg, model)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/exceptions.py", line 447, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model V_USERS_STG (models/staging/USERS/V_USERS_STG.sql)
  Model 'model.snowflake_aicg.V_USERS_STG' (models/staging/USERS/V_USERS_STG.sql) depends on a source named 'ACCOUNT_USAGE.USERS' which was not found

2022-03-10 12:21:03.148269 (MainThread): Running with dbt=0.21.1
2022-03-10 12:21:03.698432 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-10 12:21:03.699742 (MainThread): Tracking: do not track
2022-03-10 12:21:03.710188 (MainThread): Partial parsing not enabled
2022-03-10 12:21:03.725434 (MainThread): Parsing macros/common.sql
2022-03-10 12:21:03.728714 (MainThread): Parsing macros/catalog.sql
2022-03-10 12:21:03.730598 (MainThread): Parsing macros/adapters.sql
2022-03-10 12:21:03.763940 (MainThread): Parsing macros/materializations/merge.sql
2022-03-10 12:21:03.767077 (MainThread): Parsing macros/materializations/seed.sql
2022-03-10 12:21:03.770781 (MainThread): Parsing macros/materializations/view.sql
2022-03-10 12:21:03.771800 (MainThread): Parsing macros/materializations/table.sql
2022-03-10 12:21:03.774345 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-10 12:21:03.781656 (MainThread): Parsing macros/core.sql
2022-03-10 12:21:03.785096 (MainThread): Parsing macros/materializations/test.sql
2022-03-10 12:21:03.790652 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-10 12:21:03.798586 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-10 12:21:03.799927 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-10 12:21:03.814092 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-10 12:21:03.845226 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-10 12:21:03.864577 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-10 12:21:03.865902 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-10 12:21:03.874361 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-10 12:21:03.891815 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-10 12:21:03.904566 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-10 12:21:03.912531 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-10 12:21:03.919137 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-10 12:21:03.922291 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-10 12:21:03.923696 (MainThread): Parsing macros/etc/query.sql
2022-03-10 12:21:03.924496 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-10 12:21:03.925681 (MainThread): Parsing macros/etc/datetime.sql
2022-03-10 12:21:03.932994 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-10 12:21:03.934507 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-10 12:21:03.936406 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-10 12:21:03.937619 (MainThread): Parsing macros/adapters/common.sql
2022-03-10 12:21:03.986136 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-10 12:21:03.987541 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-10 12:21:03.988419 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-10 12:21:03.989389 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-10 12:21:04.134040 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:21:04.141563 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.144389 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:21:04.146756 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.147463 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:21:04.151135 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.151858 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:21:04.154279 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.154968 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:21:04.157485 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.158178 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_ACCESS_HISTORY_STG".
2022-03-10 12:21:04.161676 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.162489 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_USERS_D".
2022-03-10 12:21:04.164837 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.165539 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_COLUMNS_D".
2022-03-10 12:21:04.167726 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.168414 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_DATABASES_D".
2022-03-10 12:21:04.171084 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.171997 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_ACCESS_HISTORY_F".
2022-03-10 12:21:04.174645 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.175392 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_TABLES_D".
2022-03-10 12:21:04.177673 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.233491 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.234848 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.236117 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.237209 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.238333 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.239742 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.241323 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.242523 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:21:04.255753 (MainThread): [WARNING]: Test 'test.snowflake_aicg.unique_W_CUSTOMERS_D_K_CUSTOMER_DLHK.190cadd98a' (models/schema.yml) depends on a node named 'W_CUSTOMERS_D' which was not found
2022-03-10 12:21:04.255938 (MainThread): [WARNING]: Test 'test.snowflake_aicg.not_null_W_CUSTOMERS_D_K_CUSTOMER_DLHK.d428ec020e' (models/schema.yml) depends on a node named 'W_CUSTOMERS_D' which was not found
2022-03-10 12:21:04.256048 (MainThread): [WARNING]: Test 'test.snowflake_aicg.unique_W_PRODUCTS_D_K_PRODUCT_DLHK.8597b27fcc' (models/schema.yml) depends on a node named 'W_PRODUCTS_D' which was not found
2022-03-10 12:21:04.256156 (MainThread): [WARNING]: Test 'test.snowflake_aicg.not_null_W_PRODUCTS_D_K_PRODUCT_DLHK.cf0934feba' (models/schema.yml) depends on a node named 'W_PRODUCTS_D' which was not found
2022-03-10 12:21:04.256253 (MainThread): [WARNING]: Test 'test.snowflake_aicg.unique_W_ORDERS_F_K_ORDER_LINE_ITEM_DLHK.203cea5c69' (models/schema.yml) depends on a node named 'W_ORDERS_F' which was not found
2022-03-10 12:21:04.256353 (MainThread): [WARNING]: Test 'test.snowflake_aicg.not_null_W_ORDERS_F_K_ORDER_LINE_ITEM_DLHK.dab1d9030b' (models/schema.yml) depends on a node named 'W_ORDERS_F' which was not found
2022-03-10 12:21:04.256448 (MainThread): [WARNING]: Test 'test.snowflake_aicg.unique_W_LOCATION_D_K_LOCATION_DLHK.ae6d83719f' (models/schema.yml) depends on a node named 'W_LOCATION_D' which was not found
2022-03-10 12:21:04.256539 (MainThread): [WARNING]: Test 'test.snowflake_aicg.not_null_W_LOCATION_D_K_LOCATION_DLHK.b52dd4acc4' (models/schema.yml) depends on a node named 'W_LOCATION_D' which was not found
2022-03-10 12:21:04.275828 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-10 12:21:04.276300 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 19 sources, 0 exposures
2022-03-10 12:21:04.277689 (MainThread): 
2022-03-10 12:21:04.278024 (MainThread): Acquiring new snowflake connection "master".
2022-03-10 12:21:04.279033 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-10 12:21:04.288955 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-10 12:21:04.289137 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-10 12:21:04.289246 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-10 12:21:06.381627 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 44 in 2.09 seconds
2022-03-10 12:21:06.391200 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-10 12:21:06.872344 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE".
2022-03-10 12:21:06.888128 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE".
2022-03-10 12:21:06.888289 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE
2022-03-10 12:21:06.888396 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-10 12:21:08.482640 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 1 in 1.59 seconds
2022-03-10 12:21:08.487134 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE: Close
2022-03-10 12:21:09.015203 (MainThread): 09:21:09 | Concurrency: 1 threads (target='dev')
2022-03-10 12:21:09.016128 (MainThread): 09:21:09 | 
2022-03-10 12:21:09.023588 (Thread-1): Began running node model.snowflake_aicg.V_COLUMNS_STG
2022-03-10 12:21:09.028878 (Thread-1): 09:21:09 | 1 of 11 START view model DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG........... [RUN]
2022-03-10 12:21:09.030081 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:21:09.030639 (Thread-1): Compiling model.snowflake_aicg.V_COLUMNS_STG
2022-03-10 12:21:09.035414 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_COLUMNS_STG"
2022-03-10 12:21:09.036052 (Thread-1): finished collecting timing info
2022-03-10 12:21:09.052833 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_COLUMNS_STG"
2022-03-10 12:21:09.056887 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:21:09.057053 (Thread-1): On model.snowflake_aicg.V_COLUMNS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_COLUMNS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG  as (
    
 

WITH source AS (
  SELECT * FROM  SNOWFLAKE.ACCOUNT_USAGE."COLUMNS"
),

rename as (
SELECT
--DLHK
  MD5(S.COLUMN_ID) AS K_COLUMN_DLHK
  ,MD5(S.TABLE_ID) AS K_TABLE_DLHK
  ,MD5(S.TABLE_CATALOG_ID) AS K_DATABASE_DLHK
  ,MD5(CONCAT(COALESCE(S.TABLE_NAME,'A'),COALESCE(S.TABLE_SCHEMA_ID,'A'),COALESCE(S.TABLE_CATALOG_ID,'A'))) AS K_UNIQUE_TABLE_DLHK
--BUSINESS KEYS
  ,S.COLUMN_ID AS K_COLUMN_BK
  ,S.TABLE_ID AS K_TABLE_BK
  ,S.TABLE_CATALOG_ID AS K_DATABASE_BK
  ,S.TABLE_SCHEMA_ID AS K_TABLE_SCHEMA_BK
  --ATTRIBUTES  
  ,S.CHARACTER_SET_CATALOG AS A_CHARACTER_SET_CATALOG
  ,S.CHARACTER_SET_NAME AS A_CHARACTER_SET_NAME
  ,S.CHARACTER_SET_SCHEMA AS A_CHARACTER_SET_SCHEMA
  ,S.COLLATION_CATALOG AS A_COLLATION_CATALOG
  ,S.COLLATION_NAME AS A_COLLATION_NAME
  ,S.COLLATION_SCHEMA AS A_COLLATION_SCHEMA
  ,S.COLUMN_DEFAULT AS A_COLUMN_DEFAULT
  ,S.COLUMN_NAME AS A_COLUMN_NAME
  ,S.COMMENT AS A_COMMENT
  ,S.DATA_TYPE AS A_DATA_TYPE
  ,S.DELETED AS A_DELETED
  ,S.DOMAIN_CATALOG AS A_DOMAIN_CATALOG
  ,S.DOMAIN_NAME AS A_DOMAIN_NAME
  ,S.DOMAIN_SCHEMA AS A_DOMAIN_SCHEMA
  ,S.INTERVAL_PRECISION AS A_INTERVAL_PRECISION
  ,S.INTERVAL_TYPE AS A_INTERVAL_TYPE
  ,S.MAXIMUM_CARDINALITY AS A_MAXIMUM_CARDINALITY
  ,S.SCOPE_CATALOG AS A_SCOPE_CATALOG
  ,S.SCOPE_NAME AS A_SCOPE_NAME
  ,S.SCOPE_SCHEMA AS A_SCOPE_SCHEMA
  ,S.TABLE_CATALOG AS A_TABLE_CATALOG
  ,S.TABLE_NAME AS A_TABLE_NAME
  ,S.TABLE_SCHEMA AS A_TABLE_SCHEMA
  ,S.UDT_CATALOG AS A_UDT_CATALOG
  ,S.UDT_NAME AS A_UDT_NAME
  ,S.UDT_SCHEMA AS A_UDT_SCHEMA
  ,S.DTD_IDENTIFIER AS A_DTD_BKENTIFIER
  ,S.IDENTITY_CYCLE AS A_IDENTITY_CYCLE
  ,S.IDENTITY_GENERATION AS A_IDENTITY_GENERATION
  ,S.IDENTITY_INCREMENT AS A_IDENTITY_INCREMENT
  ,S.IDENTITY_MAXIMUM AS A_IDENTITY_MAXIMUM
  ,S.IDENTITY_MINIMUM AS A_IDENTITY_MINIMUM
  ,S.IDENTITY_START AS A_IDENTITY_START
  --BOOLEAN
  ,S.IS_IDENTITY='YES' AS B_IS_BKENTITY
  ,S.IS_NULLABLE='YES' AS A_IS_NULLABLE
  ,S.IS_SELF_REFERENCING='YES' AS A_IS_SELF_REFERENCING
  --METRICS
  ,S.CHARACTER_MAXIMUM_LENGTH AS M_CHARACTER_MAXIMUM_LENGTH
  ,S.CHARACTER_OCTET_LENGTH AS M_CHARACTER_OCTET_LENGTH
  ,S.DATETIME_PRECISION AS M_DATETIME_PRECISION
  ,S.NUMERIC_PRECISION AS M_NUMERIC_PRECISION
  ,S.NUMERIC_PRECISION_RADIX AS M_NUMERIC_PRECISION_RADIX
  ,S.NUMERIC_SCALE AS M_NUMERIC_SCALE
  ,S.ORDINAL_POSITION AS M_ORDINAL_POSITION
    --metadata (MD)
  ,S.CREATED_AT AS MD_VALID_FROM_DTS
  ,S.DELETED_AT AS MD_VALID_TO_DTS
  ,NOT(IFNULL(S.DELETED,TRUE)) AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'c74df86e-ed90-45cf-880e-192b2e2c5181' AS MD_INTGR_ID
FROM
    source S
)

SELECT * FROM rename
  );
2022-03-10 12:21:09.057165 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:21:11.104003 (Thread-1): Snowflake query id: 01a2d505-0601-434f-000b-358300f7410e
2022-03-10 12:21:11.104338 (Thread-1): Snowflake error: 000904 (42000): SQL compilation error: error line 68 at position 3
invalid identifier 'S.CREATED_AT'
2022-03-10 12:21:11.104605 (Thread-1): finished collecting timing info
2022-03-10 12:21:11.104762 (Thread-1): On model.snowflake_aicg.V_COLUMNS_STG: Close
2022-03-10 12:21:11.565537 (Thread-1): Database Error in model V_COLUMNS_STG (models/staging/COLUMNS/V_COLUMNS_STG.sql)
  000904 (42000): SQL compilation error: error line 68 at position 3
  invalid identifier 'S.CREATED_AT'
  compiled SQL at target/run/snowflake_aicg/models/staging/COLUMNS/V_COLUMNS_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 68 at position 3
invalid identifier 'S.CREATED_AT'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_COLUMNS_STG (models/staging/COLUMNS/V_COLUMNS_STG.sql)
  000904 (42000): SQL compilation error: error line 68 at position 3
  invalid identifier 'S.CREATED_AT'
  compiled SQL at target/run/snowflake_aicg/models/staging/COLUMNS/V_COLUMNS_STG.sql
2022-03-10 12:21:11.589156 (Thread-1): 09:21:11 | 1 of 11 ERROR creating view model DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG.. [ERROR in 2.56s]
2022-03-10 12:21:11.589522 (Thread-1): Finished running node model.snowflake_aicg.V_COLUMNS_STG
2022-03-10 12:21:11.589875 (Thread-1): Began running node model.snowflake_aicg.V_DATABASES_STG
2022-03-10 12:21:11.590148 (Thread-1): 09:21:11 | 2 of 11 START view model DBT_SNOWFLAKE_USAGE.V_DATABASES_STG......... [RUN]
2022-03-10 12:21:11.590916 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:21:11.591047 (Thread-1): Compiling model.snowflake_aicg.V_DATABASES_STG
2022-03-10 12:21:11.593962 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_DATABASES_STG"
2022-03-10 12:21:11.594715 (Thread-1): finished collecting timing info
2022-03-10 12:21:11.595945 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_DATABASES_STG"
2022-03-10 12:21:11.597458 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:21:11.597685 (Thread-1): On model.snowflake_aicg.V_DATABASES_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_DATABASES_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_DATABASES_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    SNOWFLAKE.ACCOUNT_USAGE."DATABASES"
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.DATABASE_ID) AS K_DATABASE_DLHK  
  --BUSINESS KEYS  
  ,DATABASE_ID AS K_DATABASE_BK
  --ATTRIBUTES
  ,DATABASE_NAME AS A_DATABASE_NAME
  ,DATABASE_OWNER AS A_DATABASE_OWNER
  ,COMMENT AS A_COMMENT
  ,LAST_ALTERED AS A_LAST_ALTERED_AT_DTS
  ,S.CREATED AS A_CREATED_AT_DTS
  ,S.DELETED AS A_DELETED_AT_DTS
  --BOOLEAN
  ,IS_TRANSIENT::STRING='YES' AS B_IS_TRANSIENT
  --METRICS
  ,RETENTION_TIME AS M_RETENTION_TIME  
  --//metadata (MD)
  ,NOT(IFNULL(S.DELETED,TRUE)) AS MD_IS_DELETED
  ,CURRENT_TIMESTAMP as MD_ELT_UPDATED_DTS
  ,'c74df86e-ed90-45cf-880e-192b2e2c5181' AS MD_INTGR_ID

  FROM
    source S
)


SELECT * FROM rename
  );
2022-03-10 12:21:11.597799 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:21:13.249805 (Thread-1): Snowflake query id: 01a2d505-0601-442a-000b-358300f7370a
2022-03-10 12:21:13.250052 (Thread-1): Snowflake error: 001038 (22023): SQL compilation error:
Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
2022-03-10 12:21:13.250205 (Thread-1): finished collecting timing info
2022-03-10 12:21:13.250354 (Thread-1): On model.snowflake_aicg.V_DATABASES_STG: Close
2022-03-10 12:21:13.688425 (Thread-1): Database Error in model V_DATABASES_STG (models/staging/DATABASES/V_DATABASES_STG.sql)
  001038 (22023): SQL compilation error:
  Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
  compiled SQL at target/run/snowflake_aicg/models/staging/DATABASES/V_DATABASES_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001038 (22023): SQL compilation error:
Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_DATABASES_STG (models/staging/DATABASES/V_DATABASES_STG.sql)
  001038 (22023): SQL compilation error:
  Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
  compiled SQL at target/run/snowflake_aicg/models/staging/DATABASES/V_DATABASES_STG.sql
2022-03-10 12:21:13.714389 (Thread-1): 09:21:13 | 2 of 11 ERROR creating view model DBT_SNOWFLAKE_USAGE.V_DATABASES_STG [ERROR in 2.12s]
2022-03-10 12:21:13.714555 (Thread-1): Finished running node model.snowflake_aicg.V_DATABASES_STG
2022-03-10 12:21:13.714688 (Thread-1): Began running node model.snowflake_aicg.V_DATE_STG
2022-03-10 12:21:13.714883 (Thread-1): 09:21:13 | 3 of 11 START view model DBT_SNOWFLAKE_USAGE.V_DATE_STG.............. [RUN]
2022-03-10 12:21:13.715156 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:21:13.715274 (Thread-1): Compiling model.snowflake_aicg.V_DATE_STG
2022-03-10 12:21:13.719122 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_DATE_STG"
2022-03-10 12:21:13.719764 (Thread-1): finished collecting timing info
2022-03-10 12:21:13.721279 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_DATE_STG"
2022-03-10 12:21:13.741906 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:21:13.742063 (Thread-1): On model.snowflake_aicg.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-10 12:21:13.742235 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:21:15.866106 (Thread-1): SQL status: SUCCESS 1 in 2.12 seconds
2022-03-10 12:21:15.884268 (Thread-1): finished collecting timing info
2022-03-10 12:21:15.884460 (Thread-1): On model.snowflake_aicg.V_DATE_STG: Close
2022-03-10 12:21:16.357241 (Thread-1): 09:21:16 | 3 of 11 OK created view model DBT_SNOWFLAKE_USAGE.V_DATE_STG......... [SUCCESS 1 in 2.64s]
2022-03-10 12:21:16.357781 (Thread-1): Finished running node model.snowflake_aicg.V_DATE_STG
2022-03-10 12:21:16.360431 (Thread-1): Began running node model.snowflake_aicg.V_TABLES_STG
2022-03-10 12:21:16.361287 (Thread-1): 09:21:16 | 4 of 11 START view model DBT_SNOWFLAKE_USAGE.V_TABLES_STG............ [RUN]
2022-03-10 12:21:16.367015 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:21:16.367518 (Thread-1): Compiling model.snowflake_aicg.V_TABLES_STG
2022-03-10 12:21:16.374500 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_TABLES_STG"
2022-03-10 12:21:16.374873 (Thread-1): finished collecting timing info
2022-03-10 12:21:16.376026 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_TABLES_STG"
2022-03-10 12:21:16.378326 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:21:16.378422 (Thread-1): On model.snowflake_aicg.V_TABLES_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_TABLES_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_TABLES_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    SNOWFLAKE.ACCOUNT_USAGE."TABLES"
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.TABLE_ID) AS K_TABLE_DLHK
  ,MD5(CONCAT(COALESCE(S.TABLE_NAME,'A'),COALESCE(S.TABLE_SCHEMA_ID,'A'),COALESCE(S.TABLE_CATALOG_ID,'A'))) AS K_UNIQUE_TABLE_DLHK
  --BUSINESS KEYS
  ,S.TABLE_ID AS K_TABLE_BK
  ,S.TABLE_CATALOG_ID AS K_DATABASE_BK
  ,S.TABLE_SCHEMA_ID AS K_TABLE_SCHEMA_BK
  --ATTRIBUTES
  ,S.AUTO_CLUSTERING_ON AS A_AUTO_CLUSTERING_ON
  ,S.CLUSTERING_KEY AS A_CLUSTERING_KEY
  ,S.COMMENT AS A_COMMENT
  ,S.COMMIT_ACTION AS A_COMMIT_ACTION   
  ,S.REFERENCE_GENERATION AS A_REFERENCE_GENERATION
  ,S.SELF_REFERENCING_COLUMN_NAME AS A_SELF_REFERENCING_COLUMN_NAME
  ,S.TABLE_CATALOG AS A_TABLE_CATALOG
  ,S.TABLE_NAME AS A_TABLE_NAME
  ,S.TABLE_OWNER AS A_TABLE_OWNER
  ,S.TABLE_SCHEMA AS A_TABLE_SCHEMA
  ,S.TABLE_TYPE AS A_TABLE_TYPE
  ,S.USER_DEFINED_TYPE_CATALOG AS A_USER_DEFINED_TYPE_CATALOG
  ,S.USER_DEFINED_TYPE_NAME AS A_USER_DEFINED_TYPE_NAME
  ,S.USER_DEFINED_TYPE_SCHEMA AS A_USER_DEFINED_TYPE_SCHEMA   
  --BOOLEAN
  ,S.IS_INSERTABLE_INTO='YES' AS B_IS_INSERTABLE_INTO
  ,S.IS_TRANSIENT='YES' AS B_IS_TRANSIENT
  ,S.IS_TYPED='YES' AS B_IS_TYPED
  --METRICS
  ,S.BYTES AS M_BYTES
  ,S.RETENTION_TIME AS M_RETENTION_TIME
  ,S.ROW_COUNT AS M_ROW_COUNT
  ,S.LAST_ALTERED AS A_LAST_ALTERED_AT_DTS
  --//metadata (MD)  
  ,S.DELETED AS MD_VALID_TO_DTS
  ,NOT(IFNULL(S.DELETED,TRUE)) AS MD_IS_DELETED
  ,CURRENT_TIMESTAMP as MD_ELT_UPDATED_DTS
  ,'c74df86e-ed90-45cf-880e-192b2e2c5181' AS MD_INTGR_ID

  FROM
    source S
)


SELECT * FROM rename
  );
2022-03-10 12:21:16.378521 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:21:18.548944 (Thread-1): Snowflake query id: 01a2d505-0601-434f-000b-358300f74116
2022-03-10 12:21:18.549364 (Thread-1): Snowflake error: 001038 (22023): SQL compilation error:
Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
2022-03-10 12:21:18.549527 (Thread-1): finished collecting timing info
2022-03-10 12:21:18.549666 (Thread-1): On model.snowflake_aicg.V_TABLES_STG: Close
2022-03-10 12:21:19.036781 (Thread-1): Database Error in model V_TABLES_STG (models/staging/TABLES/V_TABLES_STG.sql)
  001038 (22023): SQL compilation error:
  Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
  compiled SQL at target/run/snowflake_aicg/models/staging/TABLES/V_TABLES_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001038 (22023): SQL compilation error:
Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_TABLES_STG (models/staging/TABLES/V_TABLES_STG.sql)
  001038 (22023): SQL compilation error:
  Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
  compiled SQL at target/run/snowflake_aicg/models/staging/TABLES/V_TABLES_STG.sql
2022-03-10 12:21:19.069242 (Thread-1): 09:21:19 | 4 of 11 ERROR creating view model DBT_SNOWFLAKE_USAGE.V_TABLES_STG... [ERROR in 2.70s]
2022-03-10 12:21:19.069419 (Thread-1): Finished running node model.snowflake_aicg.V_TABLES_STG
2022-03-10 12:21:19.069858 (Thread-1): Began running node model.snowflake_aicg.V_USERS_STG
2022-03-10 12:21:19.070299 (Thread-1): 09:21:19 | 5 of 11 START view model DBT_SNOWFLAKE_USAGE.V_USERS_STG............. [RUN]
2022-03-10 12:21:19.070733 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:21:19.070838 (Thread-1): Compiling model.snowflake_aicg.V_USERS_STG
2022-03-10 12:21:19.073128 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_USERS_STG"
2022-03-10 12:21:19.073676 (Thread-1): finished collecting timing info
2022-03-10 12:21:19.075279 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_USERS_STG"
2022-03-10 12:21:19.077522 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:21:19.077646 (Thread-1): On model.snowflake_aicg.V_USERS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_USERS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_USERS_STG  as (
    
 

WITH source AS (
  SELECT * FROM  SNOWFLAKE.ACCOUNT_USAGE."USERS"
),

rename as (
SELECT
--DLHK
  MD5(S.NAME) AS K_USER_DLHK  
  ,S.NAME AS A_USERNAME
  ,S.BYPASS_MFA_UNTIL AS A_BYPASS_MFA_UNTIL
  ,S.COMMENT AS A_COMMENT  
  ,S.DEFAULT_NAMESPACE AS A_DEFAULT_NAMESPACE
  ,S.DEFAULT_ROLE AS A_DEFAULT_ROLE
  ,S.DEFAULT_WAREHOUSE AS A_DEFAULT_WAREHOUSE  
  ,S.DISABLED AS A_DISABLED
  ,S.DISPLAY_NAME AS A_DISPLAY_NAME
  ,S.EMAIL AS A_EMAIL  
  ,S.EXT_AUTHN_DUO AS A_EXT_AUTHN_DUO
  ,S.FIRST_NAME AS A_FIRST_NAME
  ,S.LAST_NAME AS A_LAST_NAME
  ,S.LAST_SUCCESS_LOGIN AS A_LAST_SUCCESS_LOGIN
  ,S.LOCKED_UNTIL_TIME AS A_LOCKED_UNTIL_TIME
  ,S.LOGIN_NAME AS A_LOGIN_NAME
  ,S.NAME AS A_NAME
  ,S.PASSWORD_LAST_SET_TIME AS A_PASSWORD_LAST_SET_TIME
  ,S.EXT_AUTHN_UID AS A_EXT_AUTHN_UID
  ,S.EXPIRES_AT AS A_EXPIRES_AT_DTS
  --BOOLEAN
  ,S.HAS_PASSWORD AS B_HAS_PASSWORD
  ,S.HAS_RSA_PUBLIC_KEY AS B_HAS_RSA_PUBLIC_KEY
  ,S.MUST_CHANGE_PASSWORD AS B_MUST_CHANGE_PASSWORD
  ,S.SNOWFLAKE_LOCK<>'FALSE' OR S.SNOWFLAKE_LOCK IS NULL AS B_SNOWFLAKE_LOCK
  ,S.DISABLED<>'FALSE' OR S.DISABLED IS NULL AS B_DISABLED
    --metadata (MD)
  ,S.CREATED_ON AS MD_VALID_FROM_DTS
  ,S.DELETED_ON AS MD_VALID_TO_DTS
  ,NOT(IFNULL(S.DELETED_ON,TRUE)) AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , 'c74df86e-ed90-45cf-880e-192b2e2c5181' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-10 12:21:19.077747 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:21:20.722474 (Thread-1): Snowflake query id: 01a2d505-0601-42b0-000b-358300f72926
2022-03-10 12:21:20.722661 (Thread-1): Snowflake error: 000904 (42000): SQL compilation error: error line 12 at position 6
invalid identifier 'S.NAME'
2022-03-10 12:21:20.722803 (Thread-1): finished collecting timing info
2022-03-10 12:21:20.722935 (Thread-1): On model.snowflake_aicg.V_USERS_STG: Close
2022-03-10 12:21:21.187289 (Thread-1): Database Error in model V_USERS_STG (models/staging/USERS/V_USERS_STG.sql)
  000904 (42000): SQL compilation error: error line 12 at position 6
  invalid identifier 'S.NAME'
  compiled SQL at target/run/snowflake_aicg/models/staging/USERS/V_USERS_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 12 at position 6
invalid identifier 'S.NAME'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_USERS_STG (models/staging/USERS/V_USERS_STG.sql)
  000904 (42000): SQL compilation error: error line 12 at position 6
  invalid identifier 'S.NAME'
  compiled SQL at target/run/snowflake_aicg/models/staging/USERS/V_USERS_STG.sql
2022-03-10 12:21:21.211833 (Thread-1): 09:21:21 | 5 of 11 ERROR creating view model DBT_SNOWFLAKE_USAGE.V_USERS_STG.... [ERROR in 2.14s]
2022-03-10 12:21:21.211991 (Thread-1): Finished running node model.snowflake_aicg.V_USERS_STG
2022-03-10 12:21:21.212121 (Thread-1): Began running node model.snowflake_aicg.W_COLUMNS_D
2022-03-10 12:21:21.212245 (Thread-1): 09:21:21 | 6 of 11 SKIP relation DBT_SNOWFLAKE_USAGE.W_COLUMNS_D................ [SKIP]
2022-03-10 12:21:21.212352 (Thread-1): Finished running node model.snowflake_aicg.W_COLUMNS_D
2022-03-10 12:21:21.212456 (Thread-1): Began running node model.snowflake_aicg.W_DATABASES_D
2022-03-10 12:21:21.212559 (Thread-1): 09:21:21 | 7 of 11 SKIP relation DBT_SNOWFLAKE_USAGE.W_DATABASES_D.............. [SKIP]
2022-03-10 12:21:21.212657 (Thread-1): Finished running node model.snowflake_aicg.W_DATABASES_D
2022-03-10 12:21:21.212969 (Thread-1): Began running node model.snowflake_aicg.W_TABLES_D
2022-03-10 12:21:21.213273 (Thread-1): 09:21:21 | 8 of 11 SKIP relation DBT_SNOWFLAKE_USAGE.W_TABLES_D................. [SKIP]
2022-03-10 12:21:21.213453 (Thread-1): Finished running node model.snowflake_aicg.W_TABLES_D
2022-03-10 12:21:21.213599 (Thread-1): Began running node model.snowflake_aicg.W_USERS_D
2022-03-10 12:21:21.213710 (Thread-1): 09:21:21 | 9 of 11 SKIP relation DBT_SNOWFLAKE_USAGE.W_USERS_D.................. [SKIP]
2022-03-10 12:21:21.213972 (Thread-1): Finished running node model.snowflake_aicg.W_USERS_D
2022-03-10 12:21:21.214425 (Thread-1): Began running node model.snowflake_aicg.V_ACCESS_HISTORY_STG
2022-03-10 12:21:21.214724 (Thread-1): 09:21:21 | 10 of 11 SKIP relation DBT_SNOWFLAKE_USAGE.V_ACCESS_HISTORY_STG...... [SKIP]
2022-03-10 12:21:21.214984 (Thread-1): Finished running node model.snowflake_aicg.V_ACCESS_HISTORY_STG
2022-03-10 12:21:21.215529 (Thread-1): Began running node model.snowflake_aicg.W_ACCESS_HISTORY_F
2022-03-10 12:21:21.215968 (Thread-1): 09:21:21 | 11 of 11 SKIP relation DBT_SNOWFLAKE_USAGE.W_ACCESS_HISTORY_F........ [SKIP]
2022-03-10 12:21:21.216239 (Thread-1): Finished running node model.snowflake_aicg.W_ACCESS_HISTORY_F
2022-03-10 12:21:21.216928 (MainThread): Acquiring new snowflake connection "master".
2022-03-10 12:21:21.217169 (MainThread): 09:21:21 | 
2022-03-10 12:21:21.217274 (MainThread): 09:21:21 | Finished running 6 view models, 5 table models in 16.94s.
2022-03-10 12:21:21.217370 (MainThread): Connection 'master' was properly closed.
2022-03-10 12:21:21.217449 (MainThread): Connection 'model.snowflake_aicg.V_USERS_STG' was properly closed.
2022-03-10 12:21:21.221948 (MainThread): 
2022-03-10 12:21:21.222105 (MainThread): Completed with 4 errors and 0 warnings:
2022-03-10 12:21:21.222224 (MainThread): 
2022-03-10 12:21:21.222351 (MainThread): Database Error in model V_COLUMNS_STG (models/staging/COLUMNS/V_COLUMNS_STG.sql)
2022-03-10 12:21:21.222453 (MainThread):   000904 (42000): SQL compilation error: error line 68 at position 3
2022-03-10 12:21:21.222546 (MainThread):   invalid identifier 'S.CREATED_AT'
2022-03-10 12:21:21.222697 (MainThread):   compiled SQL at target/run/snowflake_aicg/models/staging/COLUMNS/V_COLUMNS_STG.sql
2022-03-10 12:21:21.222804 (MainThread): 
2022-03-10 12:21:21.222906 (MainThread): Database Error in model V_DATABASES_STG (models/staging/DATABASES/V_DATABASES_STG.sql)
2022-03-10 12:21:21.223007 (MainThread):   001038 (22023): SQL compilation error:
2022-03-10 12:21:21.223097 (MainThread):   Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
2022-03-10 12:21:21.223187 (MainThread):   compiled SQL at target/run/snowflake_aicg/models/staging/DATABASES/V_DATABASES_STG.sql
2022-03-10 12:21:21.223279 (MainThread): 
2022-03-10 12:21:21.223384 (MainThread): Database Error in model V_TABLES_STG (models/staging/TABLES/V_TABLES_STG.sql)
2022-03-10 12:21:21.223478 (MainThread):   001038 (22023): SQL compilation error:
2022-03-10 12:21:21.223567 (MainThread):   Can not convert parameter 'TRUE' of type [BOOLEAN] into expected type [TIMESTAMP_LTZ(6)]
2022-03-10 12:21:21.223653 (MainThread):   compiled SQL at target/run/snowflake_aicg/models/staging/TABLES/V_TABLES_STG.sql
2022-03-10 12:21:21.223743 (MainThread): 
2022-03-10 12:21:21.223839 (MainThread): Database Error in model V_USERS_STG (models/staging/USERS/V_USERS_STG.sql)
2022-03-10 12:21:21.223930 (MainThread):   000904 (42000): SQL compilation error: error line 12 at position 6
2022-03-10 12:21:21.224017 (MainThread):   invalid identifier 'S.NAME'
2022-03-10 12:21:21.224142 (MainThread):   compiled SQL at target/run/snowflake_aicg/models/staging/USERS/V_USERS_STG.sql
2022-03-10 12:21:21.224276 (MainThread): 
Done. PASS=1 WARN=0 ERROR=4 SKIP=6 TOTAL=11
2022-03-10 12:21:21.224433 (MainThread): Flushing usage events
2022-03-10 12:32:33.290606 (MainThread): Running with dbt=0.21.1
2022-03-10 12:32:33.829648 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-10 12:32:33.832149 (MainThread): Tracking: do not track
2022-03-10 12:32:33.843357 (MainThread): Partial parsing not enabled
2022-03-10 12:32:33.858595 (MainThread): Parsing macros/common.sql
2022-03-10 12:32:33.861824 (MainThread): Parsing macros/catalog.sql
2022-03-10 12:32:33.863629 (MainThread): Parsing macros/adapters.sql
2022-03-10 12:32:33.896943 (MainThread): Parsing macros/materializations/merge.sql
2022-03-10 12:32:33.900124 (MainThread): Parsing macros/materializations/seed.sql
2022-03-10 12:32:33.903893 (MainThread): Parsing macros/materializations/view.sql
2022-03-10 12:32:33.904929 (MainThread): Parsing macros/materializations/table.sql
2022-03-10 12:32:33.907729 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-10 12:32:33.915321 (MainThread): Parsing macros/core.sql
2022-03-10 12:32:33.918823 (MainThread): Parsing macros/materializations/test.sql
2022-03-10 12:32:33.924433 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-10 12:32:33.932750 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-10 12:32:33.934041 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-10 12:32:33.948573 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-10 12:32:33.981109 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-10 12:32:34.002311 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-10 12:32:34.003760 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-10 12:32:34.012851 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-10 12:32:34.030938 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-10 12:32:34.043141 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-10 12:32:34.050506 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-10 12:32:34.057339 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-10 12:32:34.060503 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-10 12:32:34.061660 (MainThread): Parsing macros/etc/query.sql
2022-03-10 12:32:34.062358 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-10 12:32:34.063505 (MainThread): Parsing macros/etc/datetime.sql
2022-03-10 12:32:34.070953 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-10 12:32:34.072328 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-10 12:32:34.074351 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-10 12:32:34.075787 (MainThread): Parsing macros/adapters/common.sql
2022-03-10 12:32:34.125009 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-10 12:32:34.126522 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-10 12:32:34.127394 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-10 12:32:34.128386 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-10 12:32:34.280218 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:32:34.288564 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:32:34.291430 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:32:34.293840 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:32:34.294550 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:32:34.299281 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:32:34.300045 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:32:34.302718 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:32:34.303461 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:32:34.306509 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:32:34.307222 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_ACCESS_HISTORY_STG".
2022-03-10 12:32:34.310402 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:32:34.311113 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_USERS_D".
2022-03-10 12:32:34.313331 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:32:34.314026 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_COLUMNS_D".
2022-03-10 12:32:34.316770 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:32:34.317508 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_DATABASES_D".
2022-03-10 12:32:34.319772 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:32:34.320493 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_ACCESS_HISTORY_F".
2022-03-10 12:32:34.322705 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:32:34.323395 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_TABLES_D".
2022-03-10 12:32:34.326110 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:32:34.383483 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:32:34.384732 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:32:34.415627 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-10 12:32:34.416131 (MainThread): Found 11 models, 2 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 19 sources, 0 exposures
2022-03-10 12:32:34.417488 (MainThread): 
2022-03-10 12:32:34.417708 (MainThread): Acquiring new snowflake connection "master".
2022-03-10 12:32:34.418619 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-10 12:32:34.428996 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-10 12:32:34.429196 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-10 12:32:34.429313 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-10 12:32:36.531628 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 44 in 2.10 seconds
2022-03-10 12:32:36.550349 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-10 12:32:37.067669 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE".
2022-03-10 12:32:37.080469 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE".
2022-03-10 12:32:37.080647 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE
2022-03-10 12:32:37.080755 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-10 12:32:39.004457 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 2 in 1.92 seconds
2022-03-10 12:32:39.007736 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE: Close
2022-03-10 12:32:39.495216 (MainThread): 09:32:39 | Concurrency: 1 threads (target='dev')
2022-03-10 12:32:39.495957 (MainThread): 09:32:39 | 
2022-03-10 12:32:39.509710 (Thread-1): Began running node model.snowflake_aicg.V_COLUMNS_STG
2022-03-10 12:32:39.510033 (Thread-1): 09:32:39 | 1 of 11 START view model DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG........... [RUN]
2022-03-10 12:32:39.510319 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:32:39.510435 (Thread-1): Compiling model.snowflake_aicg.V_COLUMNS_STG
2022-03-10 12:32:39.513331 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_COLUMNS_STG"
2022-03-10 12:32:39.515060 (Thread-1): finished collecting timing info
2022-03-10 12:32:39.532373 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_COLUMNS_STG"
2022-03-10 12:32:39.536108 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:32:39.536211 (Thread-1): On model.snowflake_aicg.V_COLUMNS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_COLUMNS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG  as (
    
 

WITH source AS (
  SELECT * FROM  SNOWFLAKE.ACCOUNT_USAGE."COLUMNS"
),

rename as (
SELECT
--DLHK
  MD5(S.COLUMN_ID) AS K_COLUMN_DLHK
  ,MD5(S.TABLE_ID) AS K_TABLE_DLHK
  ,MD5(S.TABLE_CATALOG_ID) AS K_DATABASE_DLHK
  ,MD5(CONCAT(COALESCE(S.TABLE_NAME,'A'),COALESCE(S.TABLE_SCHEMA_ID,0),COALESCE(S.TABLE_CATALOG_ID,0))) AS K_UNIQUE_TABLE_DLHK
--BUSINESS KEYS
  ,S.COLUMN_ID AS K_COLUMN_BK
  ,S.TABLE_ID AS K_TABLE_BK
  ,S.TABLE_CATALOG_ID AS K_DATABASE_BK
  ,S.TABLE_SCHEMA_ID AS K_TABLE_SCHEMA_BK
  --ATTRIBUTES  
  ,S.CHARACTER_SET_CATALOG AS A_CHARACTER_SET_CATALOG
  ,S.CHARACTER_SET_NAME AS A_CHARACTER_SET_NAME
  ,S.CHARACTER_SET_SCHEMA AS A_CHARACTER_SET_SCHEMA
  ,S.COLLATION_CATALOG AS A_COLLATION_CATALOG
  ,S.COLLATION_NAME AS A_COLLATION_NAME
  ,S.COLLATION_SCHEMA AS A_COLLATION_SCHEMA
  ,S.COLUMN_DEFAULT AS A_COLUMN_DEFAULT
  ,S.COLUMN_NAME AS A_COLUMN_NAME
  ,S.COMMENT AS A_COMMENT
  ,S.DATA_TYPE AS A_DATA_TYPE
  ,S.DELETED AS A_DELETED
  ,S.DOMAIN_CATALOG AS A_DOMAIN_CATALOG
  ,S.DOMAIN_NAME AS A_DOMAIN_NAME
  ,S.DOMAIN_SCHEMA AS A_DOMAIN_SCHEMA
  ,S.INTERVAL_PRECISION AS A_INTERVAL_PRECISION
  ,S.INTERVAL_TYPE AS A_INTERVAL_TYPE
  ,S.MAXIMUM_CARDINALITY AS A_MAXIMUM_CARDINALITY
  ,S.SCOPE_CATALOG AS A_SCOPE_CATALOG
  ,S.SCOPE_NAME AS A_SCOPE_NAME
  ,S.SCOPE_SCHEMA AS A_SCOPE_SCHEMA
  ,S.TABLE_CATALOG AS A_TABLE_CATALOG
  ,S.TABLE_NAME AS A_TABLE_NAME
  ,S.TABLE_SCHEMA AS A_TABLE_SCHEMA
  ,S.UDT_CATALOG AS A_UDT_CATALOG
  ,S.UDT_NAME AS A_UDT_NAME
  ,S.UDT_SCHEMA AS A_UDT_SCHEMA
  ,S.DTD_IDENTIFIER AS A_DTD_BKENTIFIER
  ,S.IDENTITY_CYCLE AS A_IDENTITY_CYCLE
  ,S.IDENTITY_GENERATION AS A_IDENTITY_GENERATION
  ,S.IDENTITY_INCREMENT AS A_IDENTITY_INCREMENT
  ,S.IDENTITY_MAXIMUM AS A_IDENTITY_MAXIMUM
  ,S.IDENTITY_MINIMUM AS A_IDENTITY_MINIMUM
  ,S.IDENTITY_START AS A_IDENTITY_START
  --BOOLEAN
  ,S.IS_IDENTITY='YES' AS B_IS_BKENTITY
  ,S.IS_NULLABLE='YES' AS A_IS_NULLABLE
  ,S.IS_SELF_REFERENCING='YES' AS A_IS_SELF_REFERENCING
  --METRICS
  ,S.CHARACTER_MAXIMUM_LENGTH AS M_CHARACTER_MAXIMUM_LENGTH
  ,S.CHARACTER_OCTET_LENGTH AS M_CHARACTER_OCTET_LENGTH
  ,S.DATETIME_PRECISION AS M_DATETIME_PRECISION
  ,S.NUMERIC_PRECISION AS M_NUMERIC_PRECISION
  ,S.NUMERIC_PRECISION_RADIX AS M_NUMERIC_PRECISION_RADIX
  ,S.NUMERIC_SCALE AS M_NUMERIC_SCALE
  ,S.ORDINAL_POSITION AS M_ORDINAL_POSITION
    --metadata (MD)  
  ,S.DELETED AS MD_VALID_TO_DTS
  ,S.DELETED IS NOT NULL AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '53699826-2599-4e98-8e7d-80aef6cf9b59' AS MD_INTGR_ID
FROM
    source S
)

SELECT * FROM rename
  );
2022-03-10 12:32:39.536312 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:32:41.416483 (Thread-1): SQL status: SUCCESS 1 in 1.88 seconds
2022-03-10 12:32:41.426496 (Thread-1): finished collecting timing info
2022-03-10 12:32:41.427112 (Thread-1): On model.snowflake_aicg.V_COLUMNS_STG: Close
2022-03-10 12:32:41.904345 (Thread-1): 09:32:41 | 1 of 11 OK created view model DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG...... [SUCCESS 1 in 2.39s]
2022-03-10 12:32:41.905343 (Thread-1): Finished running node model.snowflake_aicg.V_COLUMNS_STG
2022-03-10 12:32:41.907508 (Thread-1): Began running node model.snowflake_aicg.V_DATABASES_STG
2022-03-10 12:32:41.909150 (Thread-1): 09:32:41 | 2 of 11 START view model DBT_SNOWFLAKE_USAGE.V_DATABASES_STG......... [RUN]
2022-03-10 12:32:41.910620 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:32:41.911167 (Thread-1): Compiling model.snowflake_aicg.V_DATABASES_STG
2022-03-10 12:32:41.915018 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_DATABASES_STG"
2022-03-10 12:32:41.915422 (Thread-1): finished collecting timing info
2022-03-10 12:32:41.916643 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_DATABASES_STG"
2022-03-10 12:32:41.917936 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:32:41.918043 (Thread-1): On model.snowflake_aicg.V_DATABASES_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_DATABASES_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_DATABASES_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    SNOWFLAKE.ACCOUNT_USAGE."DATABASES"
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.DATABASE_ID) AS K_DATABASE_DLHK  
  --BUSINESS KEYS  
  ,DATABASE_ID AS K_DATABASE_BK
  --ATTRIBUTES
  ,DATABASE_NAME AS A_DATABASE_NAME
  ,DATABASE_OWNER AS A_DATABASE_OWNER
  ,COMMENT AS A_COMMENT
  ,LAST_ALTERED AS A_LAST_ALTERED_AT_DTS
  ,S.CREATED AS A_CREATED_AT_DTS
  ,S.DELETED AS A_DELETED_AT_DTS
  --BOOLEAN
  ,NOT(IS_TRANSIENT='NO') AS B_IS_TRANSIENT
  --METRICS
  ,RETENTION_TIME AS M_RETENTION_TIME  
  --//metadata (MD)
  ,S.DELETED IS NOT NULL AS MD_IS_DELETED
  ,CURRENT_TIMESTAMP as MD_ELT_UPDATED_DTS
  ,'53699826-2599-4e98-8e7d-80aef6cf9b59' AS MD_INTGR_ID

  FROM
    source S
)


SELECT * FROM rename
  );
2022-03-10 12:32:41.918140 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:32:43.930065 (Thread-1): SQL status: SUCCESS 1 in 2.01 seconds
2022-03-10 12:32:43.933862 (Thread-1): finished collecting timing info
2022-03-10 12:32:43.935313 (Thread-1): On model.snowflake_aicg.V_DATABASES_STG: Close
2022-03-10 12:32:44.409184 (Thread-1): 09:32:44 | 2 of 11 OK created view model DBT_SNOWFLAKE_USAGE.V_DATABASES_STG.... [SUCCESS 1 in 2.50s]
2022-03-10 12:32:44.409710 (Thread-1): Finished running node model.snowflake_aicg.V_DATABASES_STG
2022-03-10 12:32:44.410275 (Thread-1): Began running node model.snowflake_aicg.V_DATE_STG
2022-03-10 12:32:44.410802 (Thread-1): 09:32:44 | 3 of 11 START view model DBT_SNOWFLAKE_USAGE.V_DATE_STG.............. [RUN]
2022-03-10 12:32:44.415621 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:32:44.416084 (Thread-1): Compiling model.snowflake_aicg.V_DATE_STG
2022-03-10 12:32:44.424794 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_DATE_STG"
2022-03-10 12:32:44.425421 (Thread-1): finished collecting timing info
2022-03-10 12:32:44.426864 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_DATE_STG"
2022-03-10 12:32:44.448321 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:32:44.448507 (Thread-1): On model.snowflake_aicg.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-10 12:32:44.448684 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:32:46.319852 (Thread-1): SQL status: SUCCESS 1 in 1.87 seconds
2022-03-10 12:32:46.323342 (Thread-1): finished collecting timing info
2022-03-10 12:32:46.323523 (Thread-1): On model.snowflake_aicg.V_DATE_STG: Close
2022-03-10 12:32:46.796295 (Thread-1): 09:32:46 | 3 of 11 OK created view model DBT_SNOWFLAKE_USAGE.V_DATE_STG......... [SUCCESS 1 in 2.38s]
2022-03-10 12:32:46.796781 (Thread-1): Finished running node model.snowflake_aicg.V_DATE_STG
2022-03-10 12:32:46.797181 (Thread-1): Began running node model.snowflake_aicg.V_TABLES_STG
2022-03-10 12:32:46.797723 (Thread-1): 09:32:46 | 4 of 11 START view model DBT_SNOWFLAKE_USAGE.V_TABLES_STG............ [RUN]
2022-03-10 12:32:46.799863 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:32:46.800442 (Thread-1): Compiling model.snowflake_aicg.V_TABLES_STG
2022-03-10 12:32:46.811271 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_TABLES_STG"
2022-03-10 12:32:46.811664 (Thread-1): finished collecting timing info
2022-03-10 12:32:46.813118 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_TABLES_STG"
2022-03-10 12:32:46.815564 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:32:46.815672 (Thread-1): On model.snowflake_aicg.V_TABLES_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_TABLES_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_TABLES_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    SNOWFLAKE.ACCOUNT_USAGE."TABLES"
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.TABLE_ID) AS K_TABLE_DLHK
  ,MD5(CONCAT(COALESCE(S.TABLE_NAME,'A'),COALESCE(S.TABLE_SCHEMA_ID,0),COALESCE(S.TABLE_CATALOG_ID,0))) AS K_UNIQUE_TABLE_DLHK
  --BUSINESS KEYS
  ,S.TABLE_ID AS K_TABLE_BK
  ,S.TABLE_CATALOG_ID AS K_DATABASE_BK
  ,S.TABLE_SCHEMA_ID AS K_TABLE_SCHEMA_BK
  --ATTRIBUTES
  ,S.AUTO_CLUSTERING_ON AS A_AUTO_CLUSTERING_ON
  ,S.CLUSTERING_KEY AS A_CLUSTERING_KEY
  ,S.COMMENT AS A_COMMENT
  ,S.COMMIT_ACTION AS A_COMMIT_ACTION   
  ,S.REFERENCE_GENERATION AS A_REFERENCE_GENERATION
  ,S.SELF_REFERENCING_COLUMN_NAME AS A_SELF_REFERENCING_COLUMN_NAME
  ,S.TABLE_CATALOG AS A_TABLE_CATALOG
  ,S.TABLE_NAME AS A_TABLE_NAME
  ,S.TABLE_OWNER AS A_TABLE_OWNER
  ,S.TABLE_SCHEMA AS A_TABLE_SCHEMA
  ,S.TABLE_TYPE AS A_TABLE_TYPE
  ,S.USER_DEFINED_TYPE_CATALOG AS A_USER_DEFINED_TYPE_CATALOG
  ,S.USER_DEFINED_TYPE_NAME AS A_USER_DEFINED_TYPE_NAME
  ,S.USER_DEFINED_TYPE_SCHEMA AS A_USER_DEFINED_TYPE_SCHEMA   
  --BOOLEAN
  ,S.IS_INSERTABLE_INTO='YES' AS B_IS_INSERTABLE_INTO
  ,S.IS_TRANSIENT='YES' AS B_IS_TRANSIENT
  ,S.IS_TYPED='YES' AS B_IS_TYPED
  --METRICS
  ,S.BYTES AS M_BYTES
  ,S.RETENTION_TIME AS M_RETENTION_TIME
  ,S.ROW_COUNT AS M_ROW_COUNT
  ,S.LAST_ALTERED AS A_LAST_ALTERED_AT_DTS
  --//metadata (MD)  
  ,S.DELETED AS MD_VALID_TO_DTS
  ,S.DELETED IS NOT NULL AS MD_IS_DELETED
  ,CURRENT_TIMESTAMP as MD_ELT_UPDATED_DTS
  ,'53699826-2599-4e98-8e7d-80aef6cf9b59' AS MD_INTGR_ID

  FROM
    source S
)


SELECT * FROM rename
  );
2022-03-10 12:32:46.815779 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:32:48.711330 (Thread-1): SQL status: SUCCESS 1 in 1.90 seconds
2022-03-10 12:32:48.715415 (Thread-1): finished collecting timing info
2022-03-10 12:32:48.715889 (Thread-1): On model.snowflake_aicg.V_TABLES_STG: Close
2022-03-10 12:32:49.198223 (Thread-1): 09:32:49 | 4 of 11 OK created view model DBT_SNOWFLAKE_USAGE.V_TABLES_STG....... [SUCCESS 1 in 2.40s]
2022-03-10 12:32:49.199368 (Thread-1): Finished running node model.snowflake_aicg.V_TABLES_STG
2022-03-10 12:32:49.200120 (Thread-1): Began running node model.snowflake_aicg.V_USERS_STG
2022-03-10 12:32:49.201261 (Thread-1): 09:32:49 | 5 of 11 START view model DBT_SNOWFLAKE_USAGE.V_USERS_STG............. [RUN]
2022-03-10 12:32:49.205732 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:32:49.206732 (Thread-1): Compiling model.snowflake_aicg.V_USERS_STG
2022-03-10 12:32:49.213343 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_USERS_STG"
2022-03-10 12:32:49.213831 (Thread-1): finished collecting timing info
2022-03-10 12:32:49.215208 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_USERS_STG"
2022-03-10 12:32:49.217369 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:32:49.217481 (Thread-1): On model.snowflake_aicg.V_USERS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_USERS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_USERS_STG  as (
    
 

WITH source AS (
  SELECT * FROM  SNOWFLAKE.ACCOUNT_USAGE."USERS"
),

rename as (
SELECT
--DLHK
  MD5(S.NAME) AS K_USER_DLHK  
  ,S.NAME AS A_USERNAME
  ,S.BYPASS_MFA_UNTIL AS A_BYPASS_MFA_UNTIL
  ,S.COMMENT AS A_COMMENT  
  ,S.DEFAULT_NAMESPACE AS A_DEFAULT_NAMESPACE
  ,S.DEFAULT_ROLE AS A_DEFAULT_ROLE
  ,S.DEFAULT_WAREHOUSE AS A_DEFAULT_WAREHOUSE  
  ,S.DISABLED AS A_DISABLED
  ,S.DISPLAY_NAME AS A_DISPLAY_NAME
  ,S.EMAIL AS A_EMAIL  
  ,S.EXT_AUTHN_DUO AS A_EXT_AUTHN_DUO
  ,S.FIRST_NAME AS A_FIRST_NAME
  ,S.LAST_NAME AS A_LAST_NAME
  ,S.LAST_SUCCESS_LOGIN AS A_LAST_SUCCESS_LOGIN
  ,S.LOCKED_UNTIL_TIME AS A_LOCKED_UNTIL_TIME
  ,S.LOGIN_NAME AS A_LOGIN_NAME  
  ,S.PASSWORD_LAST_SET_TIME AS A_PASSWORD_LAST_SET_TIME
  ,S.EXT_AUTHN_UID AS A_EXT_AUTHN_UID
  ,S.EXPIRES_AT AS A_EXPIRES_AT_DTS
  --BOOLEAN
  ,S.HAS_PASSWORD AS B_HAS_PASSWORD
  ,S.HAS_RSA_PUBLIC_KEY AS B_HAS_RSA_PUBLIC_KEY
  ,S.MUST_CHANGE_PASSWORD AS B_MUST_CHANGE_PASSWORD
  ,S.SNOWFLAKE_LOCK<>'FALSE' OR S.SNOWFLAKE_LOCK IS NULL AS B_SNOWFLAKE_LOCK
  ,S.DISABLED<>'FALSE' OR S.DISABLED IS NULL AS B_DISABLED
    --metadata (MD)
  ,S.CREATED_ON AS MD_VALID_FROM_DTS
  ,S.DELETED_ON AS MD_VALID_TO_DTS
  ,S.DELETED_ON IS NOT NULL  AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '53699826-2599-4e98-8e7d-80aef6cf9b59' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-10 12:32:49.217583 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:32:51.082704 (Thread-1): Snowflake query id: 01a2d510-0601-4473-000b-358300f71cb2
2022-03-10 12:32:51.082897 (Thread-1): Snowflake error: 000904 (42000): SQL compilation error: error line 12 at position 6
invalid identifier 'S.NAME'
2022-03-10 12:32:51.083062 (Thread-1): finished collecting timing info
2022-03-10 12:32:51.083203 (Thread-1): On model.snowflake_aicg.V_USERS_STG: Close
2022-03-10 12:32:51.608033 (Thread-1): Database Error in model V_USERS_STG (models/staging/USERS/V_USERS_STG.sql)
  000904 (42000): SQL compilation error: error line 12 at position 6
  invalid identifier 'S.NAME'
  compiled SQL at target/run/snowflake_aicg/models/staging/USERS/V_USERS_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): SQL compilation error: error line 12 at position 6
invalid identifier 'S.NAME'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_USERS_STG (models/staging/USERS/V_USERS_STG.sql)
  000904 (42000): SQL compilation error: error line 12 at position 6
  invalid identifier 'S.NAME'
  compiled SQL at target/run/snowflake_aicg/models/staging/USERS/V_USERS_STG.sql
2022-03-10 12:32:51.630010 (Thread-1): 09:32:51 | 5 of 11 ERROR creating view model DBT_SNOWFLAKE_USAGE.V_USERS_STG.... [ERROR in 2.43s]
2022-03-10 12:32:51.630174 (Thread-1): Finished running node model.snowflake_aicg.V_USERS_STG
2022-03-10 12:32:51.630308 (Thread-1): Began running node model.snowflake_aicg.W_COLUMNS_D
2022-03-10 12:32:51.630468 (Thread-1): 09:32:51 | 6 of 11 START table model DBT_SNOWFLAKE_USAGE.W_COLUMNS_D............ [RUN]
2022-03-10 12:32:51.630705 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.W_COLUMNS_D".
2022-03-10 12:32:51.630815 (Thread-1): Compiling model.snowflake_aicg.W_COLUMNS_D
2022-03-10 12:32:51.632905 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.W_COLUMNS_D"
2022-03-10 12:32:51.633479 (Thread-1): finished collecting timing info
2022-03-10 12:32:51.647982 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.W_COLUMNS_D"
2022-03-10 12:32:51.648755 (Thread-1): Using snowflake connection "model.snowflake_aicg.W_COLUMNS_D".
2022-03-10 12:32:51.648861 (Thread-1): On model.snowflake_aicg.W_COLUMNS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.W_COLUMNS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.W_COLUMNS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG AS C
      );
2022-03-10 12:32:51.648959 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:33:16.703081 (Thread-1): SQL status: SUCCESS 1 in 25.05 seconds
2022-03-10 12:33:16.717771 (Thread-1): finished collecting timing info
2022-03-10 12:33:16.718039 (Thread-1): On model.snowflake_aicg.W_COLUMNS_D: Close
2022-03-10 12:33:17.165656 (Thread-1): 09:33:17 | 6 of 11 OK created table model DBT_SNOWFLAKE_USAGE.W_COLUMNS_D....... [SUCCESS 1 in 25.53s]
2022-03-10 12:33:17.166312 (Thread-1): Finished running node model.snowflake_aicg.W_COLUMNS_D
2022-03-10 12:33:17.166945 (Thread-1): Began running node model.snowflake_aicg.W_DATABASES_D
2022-03-10 12:33:17.167622 (Thread-1): 09:33:17 | 7 of 11 START table model DBT_SNOWFLAKE_USAGE.W_DATABASES_D.......... [RUN]
2022-03-10 12:33:17.168361 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.W_DATABASES_D".
2022-03-10 12:33:17.169192 (Thread-1): Compiling model.snowflake_aicg.W_DATABASES_D
2022-03-10 12:33:17.182110 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.W_DATABASES_D"
2022-03-10 12:33:17.183476 (Thread-1): finished collecting timing info
2022-03-10 12:33:17.190079 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.W_DATABASES_D"
2022-03-10 12:33:17.192110 (Thread-1): Using snowflake connection "model.snowflake_aicg.W_DATABASES_D".
2022-03-10 12:33:17.192263 (Thread-1): On model.snowflake_aicg.W_DATABASES_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.W_DATABASES_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.W_DATABASES_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_DATABASES_STG AS C
      );
2022-03-10 12:33:17.192368 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:33:25.735836 (Thread-1): SQL status: SUCCESS 1 in 8.54 seconds
2022-03-10 12:33:25.740678 (Thread-1): finished collecting timing info
2022-03-10 12:33:25.741186 (Thread-1): On model.snowflake_aicg.W_DATABASES_D: Close
2022-03-10 12:33:26.242017 (Thread-1): 09:33:26 | 7 of 11 OK created table model DBT_SNOWFLAKE_USAGE.W_DATABASES_D..... [SUCCESS 1 in 9.07s]
2022-03-10 12:33:26.243712 (Thread-1): Finished running node model.snowflake_aicg.W_DATABASES_D
2022-03-10 12:33:26.244190 (Thread-1): Began running node model.snowflake_aicg.W_TABLES_D
2022-03-10 12:33:26.245540 (Thread-1): 09:33:26 | 8 of 11 START table model DBT_SNOWFLAKE_USAGE.W_TABLES_D............. [RUN]
2022-03-10 12:33:26.246745 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.W_TABLES_D".
2022-03-10 12:33:26.247269 (Thread-1): Compiling model.snowflake_aicg.W_TABLES_D
2022-03-10 12:33:26.257229 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.W_TABLES_D"
2022-03-10 12:33:26.258116 (Thread-1): finished collecting timing info
2022-03-10 12:33:26.259394 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.W_TABLES_D"
2022-03-10 12:33:26.260070 (Thread-1): Using snowflake connection "model.snowflake_aicg.W_TABLES_D".
2022-03-10 12:33:26.260243 (Thread-1): On model.snowflake_aicg.W_TABLES_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.W_TABLES_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.W_TABLES_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_TABLES_STG AS C
      );
2022-03-10 12:33:26.260350 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:33:43.371062 (Thread-1): SQL status: SUCCESS 1 in 17.11 seconds
2022-03-10 12:33:43.376572 (Thread-1): finished collecting timing info
2022-03-10 12:33:43.377355 (Thread-1): On model.snowflake_aicg.W_TABLES_D: Close
2022-03-10 12:33:43.829119 (Thread-1): 09:33:43 | 8 of 11 OK created table model DBT_SNOWFLAKE_USAGE.W_TABLES_D........ [SUCCESS 1 in 17.58s]
2022-03-10 12:33:43.829810 (Thread-1): Finished running node model.snowflake_aicg.W_TABLES_D
2022-03-10 12:33:43.830544 (Thread-1): Began running node model.snowflake_aicg.W_USERS_D
2022-03-10 12:33:43.833764 (Thread-1): 09:33:43 | 9 of 11 SKIP relation DBT_SNOWFLAKE_USAGE.W_USERS_D.................. [SKIP]
2022-03-10 12:33:43.834374 (Thread-1): Finished running node model.snowflake_aicg.W_USERS_D
2022-03-10 12:33:43.836943 (Thread-1): Began running node model.snowflake_aicg.V_ACCESS_HISTORY_STG
2022-03-10 12:33:43.837811 (Thread-1): 09:33:43 | 10 of 11 START view model DBT_SNOWFLAKE_USAGE.V_ACCESS_HISTORY_STG... [RUN]
2022-03-10 12:33:43.838640 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_ACCESS_HISTORY_STG".
2022-03-10 12:33:43.838969 (Thread-1): Compiling model.snowflake_aicg.V_ACCESS_HISTORY_STG
2022-03-10 12:33:43.856442 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_ACCESS_HISTORY_STG"
2022-03-10 12:33:43.861516 (Thread-1): finished collecting timing info
2022-03-10 12:33:43.864836 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_ACCESS_HISTORY_STG"
2022-03-10 12:33:43.866851 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_ACCESS_HISTORY_STG".
2022-03-10 12:33:43.866982 (Thread-1): On model.snowflake_aicg.V_ACCESS_HISTORY_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_ACCESS_HISTORY_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_ACCESS_HISTORY_STG  as (
    
 

WITH source AS (
  SELECT * FROM  SNOWFLAKE.ACCOUNT_USAGE."ACCESS_HISTORY"
),
tables AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.W_TABLES_D
),

rename as (
   SELECT 
      S.query_id AS K_QUERY_BK
     ,MD5(S.user_name) AS K_USER_DLHK
     ,tables.K_UNIQUE_TABLE_DLHK
     ,tables.K_TABLE_DLHK
     ,base.value:objectId::string AS K_TABLE_BK
     ,S.user_name A_USERNAME
     ,S.query_start_time AS A_START_TIME_DTS
     ,split(base.value:objectName, '.')[0]::string AS A_DATABASE_NAME
     ,split(base.value:objectName, '.')[1]::string AS A_SCHEMA_NAME
     ,split(base.value:objectName, '.')[2]::string AS A_TABLE_NAME   
FROM source S
     ,lateral flatten (base_objects_accessed) base
LEFT JOIN tables on tables.K_TABLE_BK = base.value:objectId::string 
)

SELECT * FROM rename
  );
2022-03-10 12:33:43.867111 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:33:45.690180 (Thread-1): Snowflake query id: 01a2d511-0601-4473-000b-358300f71cbe
2022-03-10 12:33:45.690370 (Thread-1): Snowflake error: 001072 (42601): SQL compilation error:
Lateral View cannot be on the left side of join
2022-03-10 12:33:45.690525 (Thread-1): finished collecting timing info
2022-03-10 12:33:45.690666 (Thread-1): On model.snowflake_aicg.V_ACCESS_HISTORY_STG: Close
2022-03-10 12:33:46.169079 (Thread-1): Database Error in model V_ACCESS_HISTORY_STG (models/staging/ACCESS_HISTORY/V_ACCESS_HISTORY_STG.sql)
  001072 (42601): SQL compilation error:
  Lateral View cannot be on the left side of join
  compiled SQL at target/run/snowflake_aicg/models/staging/ACCESS_HISTORY/V_ACCESS_HISTORY_STG.sql
Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 183, in exception_handler
    yield
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/cursor.py", line 721, in execute
    Error.errorhandler_wrapper(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 258, in errorhandler_wrapper
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/snowflake/connector/errors.py", line 188, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 001072 (42601): SQL compilation error:
Lateral View cannot be on the left side of join

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 348, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 291, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/base.py", line 393, in run
    return self.execute(compiled_node, manifest)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/task/run.py", line 249, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 27, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 55, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 333, in __call__
    return self.call_macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/clients/jinja.py", line 260, in call_macro
    return macro(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/base/impl.py", line 226, in execute
    return self.connections.execute(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 131, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 354, in add_query
    connection, cursor = super().add_query(
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.8/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/Users/guilhermealcantara/Library/Python/3.8/lib/python/site-packages/dbt/adapters/snowflake/connections.py", line 200, in exception_handler
    raise DatabaseException(msg)
dbt.exceptions.DatabaseException: Database Error in model V_ACCESS_HISTORY_STG (models/staging/ACCESS_HISTORY/V_ACCESS_HISTORY_STG.sql)
  001072 (42601): SQL compilation error:
  Lateral View cannot be on the left side of join
  compiled SQL at target/run/snowflake_aicg/models/staging/ACCESS_HISTORY/V_ACCESS_HISTORY_STG.sql
2022-03-10 12:33:46.200042 (Thread-1): 09:33:46 | 10 of 11 ERROR creating view model DBT_SNOWFLAKE_USAGE.V_ACCESS_HISTORY_STG [ERROR in 2.36s]
2022-03-10 12:33:46.200205 (Thread-1): Finished running node model.snowflake_aicg.V_ACCESS_HISTORY_STG
2022-03-10 12:33:46.200643 (Thread-1): Began running node model.snowflake_aicg.W_ACCESS_HISTORY_F
2022-03-10 12:33:46.200771 (Thread-1): 09:33:46 | 11 of 11 SKIP relation DBT_SNOWFLAKE_USAGE.W_ACCESS_HISTORY_F........ [SKIP]
2022-03-10 12:33:46.200877 (Thread-1): Finished running node model.snowflake_aicg.W_ACCESS_HISTORY_F
2022-03-10 12:33:46.201554 (MainThread): Acquiring new snowflake connection "master".
2022-03-10 12:33:46.201796 (MainThread): 09:33:46 | 
2022-03-10 12:33:46.201903 (MainThread): 09:33:46 | Finished running 6 view models, 5 table models in 71.78s.
2022-03-10 12:33:46.201994 (MainThread): Connection 'master' was properly closed.
2022-03-10 12:33:46.202076 (MainThread): Connection 'model.snowflake_aicg.V_ACCESS_HISTORY_STG' was properly closed.
2022-03-10 12:33:46.211777 (MainThread): 
2022-03-10 12:33:46.211929 (MainThread): Completed with 2 errors and 0 warnings:
2022-03-10 12:33:46.212035 (MainThread): 
2022-03-10 12:33:46.212133 (MainThread): Database Error in model V_USERS_STG (models/staging/USERS/V_USERS_STG.sql)
2022-03-10 12:33:46.212224 (MainThread):   000904 (42000): SQL compilation error: error line 12 at position 6
2022-03-10 12:33:46.212309 (MainThread):   invalid identifier 'S.NAME'
2022-03-10 12:33:46.212394 (MainThread):   compiled SQL at target/run/snowflake_aicg/models/staging/USERS/V_USERS_STG.sql
2022-03-10 12:33:46.212482 (MainThread): 
2022-03-10 12:33:46.212572 (MainThread): Database Error in model V_ACCESS_HISTORY_STG (models/staging/ACCESS_HISTORY/V_ACCESS_HISTORY_STG.sql)
2022-03-10 12:33:46.212658 (MainThread):   001072 (42601): SQL compilation error:
2022-03-10 12:33:46.212741 (MainThread):   Lateral View cannot be on the left side of join
2022-03-10 12:33:46.212822 (MainThread):   compiled SQL at target/run/snowflake_aicg/models/staging/ACCESS_HISTORY/V_ACCESS_HISTORY_STG.sql
2022-03-10 12:33:46.212923 (MainThread): 
Done. PASS=7 WARN=0 ERROR=2 SKIP=2 TOTAL=11
2022-03-10 12:33:46.213076 (MainThread): Flushing usage events
2022-03-10 12:35:09.074055 (MainThread): Running with dbt=0.21.1
2022-03-10 12:35:09.923526 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-10 12:35:09.926019 (MainThread): Tracking: do not track
2022-03-10 12:35:09.944688 (MainThread): Partial parsing not enabled
2022-03-10 12:35:09.966324 (MainThread): Parsing macros/common.sql
2022-03-10 12:35:09.970398 (MainThread): Parsing macros/catalog.sql
2022-03-10 12:35:09.972672 (MainThread): Parsing macros/adapters.sql
2022-03-10 12:35:10.006951 (MainThread): Parsing macros/materializations/merge.sql
2022-03-10 12:35:10.011536 (MainThread): Parsing macros/materializations/seed.sql
2022-03-10 12:35:10.016264 (MainThread): Parsing macros/materializations/view.sql
2022-03-10 12:35:10.017422 (MainThread): Parsing macros/materializations/table.sql
2022-03-10 12:35:10.019981 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-10 12:35:10.027491 (MainThread): Parsing macros/core.sql
2022-03-10 12:35:10.031247 (MainThread): Parsing macros/materializations/test.sql
2022-03-10 12:35:10.038352 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-10 12:35:10.048628 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-10 12:35:10.050594 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-10 12:35:10.065634 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-10 12:35:10.109014 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-10 12:35:10.132459 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-10 12:35:10.134180 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-10 12:35:10.144330 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-10 12:35:10.167546 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-10 12:35:10.181662 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-10 12:35:10.190812 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-10 12:35:10.198264 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-10 12:35:10.202277 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-10 12:35:10.203774 (MainThread): Parsing macros/etc/query.sql
2022-03-10 12:35:10.204751 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-10 12:35:10.206050 (MainThread): Parsing macros/etc/datetime.sql
2022-03-10 12:35:10.213135 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-10 12:35:10.214863 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-10 12:35:10.216791 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-10 12:35:10.217993 (MainThread): Parsing macros/adapters/common.sql
2022-03-10 12:35:10.268321 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-10 12:35:10.269740 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-10 12:35:10.270643 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-10 12:35:10.271885 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-10 12:35:10.427976 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:35:10.436004 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:35:10.439362 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:35:10.441922 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:35:10.442675 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:35:10.446748 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:35:10.447898 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:35:10.450802 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:35:10.451622 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:35:10.454446 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:35:10.455254 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.V_ACCESS_HISTORY_STG".
2022-03-10 12:35:10.460411 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:35:10.461279 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_USERS_D".
2022-03-10 12:35:10.464512 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:35:10.465391 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_COLUMNS_D".
2022-03-10 12:35:10.467991 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:35:10.468814 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_DATABASES_D".
2022-03-10 12:35:10.471835 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:35:10.472775 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_ACCESS_HISTORY_F".
2022-03-10 12:35:10.475339 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:35:10.476137 (MainThread): Acquiring new snowflake connection "model.snowflake_aicg.W_TABLES_D".
2022-03-10 12:35:10.478827 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:35:10.543322 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:35:10.544786 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-10 12:35:10.578233 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-10 12:35:10.578780 (MainThread): Found 11 models, 2 tests, 0 snapshots, 0 analyses, 176 macros, 0 operations, 0 seed files, 19 sources, 0 exposures
2022-03-10 12:35:10.580554 (MainThread): 
2022-03-10 12:35:10.580907 (MainThread): Acquiring new snowflake connection "master".
2022-03-10 12:35:10.581974 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-10 12:35:10.591945 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-10 12:35:10.592098 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-10 12:35:10.592243 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-10 12:35:12.546626 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 44 in 1.95 seconds
2022-03-10 12:35:12.567528 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-10 12:35:13.208340 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE".
2022-03-10 12:35:13.219694 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE".
2022-03-10 12:35:13.219875 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE
2022-03-10 12:35:13.219980 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-10 12:35:14.953428 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 7 in 1.73 seconds
2022-03-10 12:35:14.957553 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SNOWFLAKE_USAGE: Close
2022-03-10 12:35:15.430625 (MainThread): 09:35:15 | Concurrency: 1 threads (target='dev')
2022-03-10 12:35:15.432313 (MainThread): 09:35:15 | 
2022-03-10 12:35:15.438014 (Thread-1): Began running node model.snowflake_aicg.V_COLUMNS_STG
2022-03-10 12:35:15.439038 (Thread-1): 09:35:15 | 1 of 11 START view model DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG........... [RUN]
2022-03-10 12:35:15.440219 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:35:15.440759 (Thread-1): Compiling model.snowflake_aicg.V_COLUMNS_STG
2022-03-10 12:35:15.449114 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_COLUMNS_STG"
2022-03-10 12:35:15.450394 (Thread-1): finished collecting timing info
2022-03-10 12:35:15.469082 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_COLUMNS_STG"
2022-03-10 12:35:15.472934 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_COLUMNS_STG".
2022-03-10 12:35:15.473066 (Thread-1): On model.snowflake_aicg.V_COLUMNS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_COLUMNS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG  as (
    
 

WITH source AS (
  SELECT * FROM  SNOWFLAKE.ACCOUNT_USAGE."COLUMNS"
),

rename as (
SELECT
--DLHK
  MD5(S.COLUMN_ID) AS K_COLUMN_DLHK
  ,MD5(S.TABLE_ID) AS K_TABLE_DLHK
  ,MD5(S.TABLE_CATALOG_ID) AS K_DATABASE_DLHK
  ,MD5(CONCAT(COALESCE(S.TABLE_NAME,'A'),COALESCE(S.TABLE_SCHEMA_ID,0),COALESCE(S.TABLE_CATALOG_ID,0))) AS K_UNIQUE_TABLE_DLHK
--BUSINESS KEYS
  ,S.COLUMN_ID AS K_COLUMN_BK
  ,S.TABLE_ID AS K_TABLE_BK
  ,S.TABLE_CATALOG_ID AS K_DATABASE_BK
  ,S.TABLE_SCHEMA_ID AS K_TABLE_SCHEMA_BK
  --ATTRIBUTES  
  ,S.CHARACTER_SET_CATALOG AS A_CHARACTER_SET_CATALOG
  ,S.CHARACTER_SET_NAME AS A_CHARACTER_SET_NAME
  ,S.CHARACTER_SET_SCHEMA AS A_CHARACTER_SET_SCHEMA
  ,S.COLLATION_CATALOG AS A_COLLATION_CATALOG
  ,S.COLLATION_NAME AS A_COLLATION_NAME
  ,S.COLLATION_SCHEMA AS A_COLLATION_SCHEMA
  ,S.COLUMN_DEFAULT AS A_COLUMN_DEFAULT
  ,S.COLUMN_NAME AS A_COLUMN_NAME
  ,S.COMMENT AS A_COMMENT
  ,S.DATA_TYPE AS A_DATA_TYPE
  ,S.DELETED AS A_DELETED
  ,S.DOMAIN_CATALOG AS A_DOMAIN_CATALOG
  ,S.DOMAIN_NAME AS A_DOMAIN_NAME
  ,S.DOMAIN_SCHEMA AS A_DOMAIN_SCHEMA
  ,S.INTERVAL_PRECISION AS A_INTERVAL_PRECISION
  ,S.INTERVAL_TYPE AS A_INTERVAL_TYPE
  ,S.MAXIMUM_CARDINALITY AS A_MAXIMUM_CARDINALITY
  ,S.SCOPE_CATALOG AS A_SCOPE_CATALOG
  ,S.SCOPE_NAME AS A_SCOPE_NAME
  ,S.SCOPE_SCHEMA AS A_SCOPE_SCHEMA
  ,S.TABLE_CATALOG AS A_TABLE_CATALOG
  ,S.TABLE_NAME AS A_TABLE_NAME
  ,S.TABLE_SCHEMA AS A_TABLE_SCHEMA
  ,S.UDT_CATALOG AS A_UDT_CATALOG
  ,S.UDT_NAME AS A_UDT_NAME
  ,S.UDT_SCHEMA AS A_UDT_SCHEMA
  ,S.DTD_IDENTIFIER AS A_DTD_BKENTIFIER
  ,S.IDENTITY_CYCLE AS A_IDENTITY_CYCLE
  ,S.IDENTITY_GENERATION AS A_IDENTITY_GENERATION
  ,S.IDENTITY_INCREMENT AS A_IDENTITY_INCREMENT
  ,S.IDENTITY_MAXIMUM AS A_IDENTITY_MAXIMUM
  ,S.IDENTITY_MINIMUM AS A_IDENTITY_MINIMUM
  ,S.IDENTITY_START AS A_IDENTITY_START
  --BOOLEAN
  ,S.IS_IDENTITY='YES' AS B_IS_BKENTITY
  ,S.IS_NULLABLE='YES' AS A_IS_NULLABLE
  ,S.IS_SELF_REFERENCING='YES' AS A_IS_SELF_REFERENCING
  --METRICS
  ,S.CHARACTER_MAXIMUM_LENGTH AS M_CHARACTER_MAXIMUM_LENGTH
  ,S.CHARACTER_OCTET_LENGTH AS M_CHARACTER_OCTET_LENGTH
  ,S.DATETIME_PRECISION AS M_DATETIME_PRECISION
  ,S.NUMERIC_PRECISION AS M_NUMERIC_PRECISION
  ,S.NUMERIC_PRECISION_RADIX AS M_NUMERIC_PRECISION_RADIX
  ,S.NUMERIC_SCALE AS M_NUMERIC_SCALE
  ,S.ORDINAL_POSITION AS M_ORDINAL_POSITION
    --metadata (MD)  
  ,S.DELETED AS MD_VALID_TO_DTS
  ,S.DELETED IS NOT NULL AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '5d46a0f0-b3d3-4524-9663-160a0476382b' AS MD_INTGR_ID
FROM
    source S
)

SELECT * FROM rename
  );
2022-03-10 12:35:15.473179 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:35:17.519149 (Thread-1): SQL status: SUCCESS 1 in 2.05 seconds
2022-03-10 12:35:17.545569 (Thread-1): finished collecting timing info
2022-03-10 12:35:17.546225 (Thread-1): On model.snowflake_aicg.V_COLUMNS_STG: Close
2022-03-10 12:35:18.023170 (Thread-1): 09:35:18 | 1 of 11 OK created view model DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG...... [SUCCESS 1 in 2.58s]
2022-03-10 12:35:18.023681 (Thread-1): Finished running node model.snowflake_aicg.V_COLUMNS_STG
2022-03-10 12:35:18.025571 (Thread-1): Began running node model.snowflake_aicg.V_DATABASES_STG
2022-03-10 12:35:18.026311 (Thread-1): 09:35:18 | 2 of 11 START view model DBT_SNOWFLAKE_USAGE.V_DATABASES_STG......... [RUN]
2022-03-10 12:35:18.027214 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:35:18.027703 (Thread-1): Compiling model.snowflake_aicg.V_DATABASES_STG
2022-03-10 12:35:18.040284 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_DATABASES_STG"
2022-03-10 12:35:18.042654 (Thread-1): finished collecting timing info
2022-03-10 12:35:18.044272 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_DATABASES_STG"
2022-03-10 12:35:18.045912 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_DATABASES_STG".
2022-03-10 12:35:18.046077 (Thread-1): On model.snowflake_aicg.V_DATABASES_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_DATABASES_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_DATABASES_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    SNOWFLAKE.ACCOUNT_USAGE."DATABASES"
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.DATABASE_ID) AS K_DATABASE_DLHK  
  --BUSINESS KEYS  
  ,DATABASE_ID AS K_DATABASE_BK
  --ATTRIBUTES
  ,DATABASE_NAME AS A_DATABASE_NAME
  ,DATABASE_OWNER AS A_DATABASE_OWNER
  ,COMMENT AS A_COMMENT
  ,LAST_ALTERED AS A_LAST_ALTERED_AT_DTS
  ,S.CREATED AS A_CREATED_AT_DTS
  ,S.DELETED AS A_DELETED_AT_DTS
  --BOOLEAN
  ,NOT(IS_TRANSIENT='NO') AS B_IS_TRANSIENT
  --METRICS
  ,RETENTION_TIME AS M_RETENTION_TIME  
  --//metadata (MD)
  ,S.DELETED IS NOT NULL AS MD_IS_DELETED
  ,CURRENT_TIMESTAMP as MD_ELT_UPDATED_DTS
  ,'5d46a0f0-b3d3-4524-9663-160a0476382b' AS MD_INTGR_ID

  FROM
    source S
)


SELECT * FROM rename
  );
2022-03-10 12:35:18.046189 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:35:19.881770 (Thread-1): SQL status: SUCCESS 1 in 1.84 seconds
2022-03-10 12:35:19.895386 (Thread-1): finished collecting timing info
2022-03-10 12:35:19.896145 (Thread-1): On model.snowflake_aicg.V_DATABASES_STG: Close
2022-03-10 12:35:20.369848 (Thread-1): 09:35:20 | 2 of 11 OK created view model DBT_SNOWFLAKE_USAGE.V_DATABASES_STG.... [SUCCESS 1 in 2.33s]
2022-03-10 12:35:20.370524 (Thread-1): Finished running node model.snowflake_aicg.V_DATABASES_STG
2022-03-10 12:35:20.370772 (Thread-1): Began running node model.snowflake_aicg.V_DATE_STG
2022-03-10 12:35:20.373021 (Thread-1): 09:35:20 | 3 of 11 START view model DBT_SNOWFLAKE_USAGE.V_DATE_STG.............. [RUN]
2022-03-10 12:35:20.384026 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:35:20.388452 (Thread-1): Compiling model.snowflake_aicg.V_DATE_STG
2022-03-10 12:35:20.411944 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_DATE_STG"
2022-03-10 12:35:20.412575 (Thread-1): finished collecting timing info
2022-03-10 12:35:20.416812 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_DATE_STG"
2022-03-10 12:35:20.445652 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_DATE_STG".
2022-03-10 12:35:20.445949 (Thread-1): On model.snowflake_aicg.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-10 12:35:20.446278 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:35:22.671693 (Thread-1): SQL status: SUCCESS 1 in 2.23 seconds
2022-03-10 12:35:22.673137 (Thread-1): finished collecting timing info
2022-03-10 12:35:22.673474 (Thread-1): On model.snowflake_aicg.V_DATE_STG: Close
2022-03-10 12:35:23.124750 (Thread-1): 09:35:23 | 3 of 11 OK created view model DBT_SNOWFLAKE_USAGE.V_DATE_STG......... [SUCCESS 1 in 2.75s]
2022-03-10 12:35:23.124954 (Thread-1): Finished running node model.snowflake_aicg.V_DATE_STG
2022-03-10 12:35:23.125099 (Thread-1): Began running node model.snowflake_aicg.V_TABLES_STG
2022-03-10 12:35:23.125254 (Thread-1): 09:35:23 | 4 of 11 START view model DBT_SNOWFLAKE_USAGE.V_TABLES_STG............ [RUN]
2022-03-10 12:35:23.125454 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:35:23.125588 (Thread-1): Compiling model.snowflake_aicg.V_TABLES_STG
2022-03-10 12:35:23.129725 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_TABLES_STG"
2022-03-10 12:35:23.130567 (Thread-1): finished collecting timing info
2022-03-10 12:35:23.133312 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_TABLES_STG"
2022-03-10 12:35:23.136066 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_TABLES_STG".
2022-03-10 12:35:23.136191 (Thread-1): On model.snowflake_aicg.V_TABLES_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_TABLES_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_TABLES_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    SNOWFLAKE.ACCOUNT_USAGE."TABLES"
),
rename AS 
(   
  SELECT 
  --DLHK
  MD5(S.TABLE_ID) AS K_TABLE_DLHK
  ,MD5(CONCAT(COALESCE(S.TABLE_NAME,'A'),COALESCE(S.TABLE_SCHEMA_ID,0),COALESCE(S.TABLE_CATALOG_ID,0))) AS K_UNIQUE_TABLE_DLHK
  --BUSINESS KEYS
  ,S.TABLE_ID AS K_TABLE_BK
  ,S.TABLE_CATALOG_ID AS K_DATABASE_BK
  ,S.TABLE_SCHEMA_ID AS K_TABLE_SCHEMA_BK
  --ATTRIBUTES
  ,S.AUTO_CLUSTERING_ON AS A_AUTO_CLUSTERING_ON
  ,S.CLUSTERING_KEY AS A_CLUSTERING_KEY
  ,S.COMMENT AS A_COMMENT
  ,S.COMMIT_ACTION AS A_COMMIT_ACTION   
  ,S.REFERENCE_GENERATION AS A_REFERENCE_GENERATION
  ,S.SELF_REFERENCING_COLUMN_NAME AS A_SELF_REFERENCING_COLUMN_NAME
  ,S.TABLE_CATALOG AS A_TABLE_CATALOG
  ,S.TABLE_NAME AS A_TABLE_NAME
  ,S.TABLE_OWNER AS A_TABLE_OWNER
  ,S.TABLE_SCHEMA AS A_TABLE_SCHEMA
  ,S.TABLE_TYPE AS A_TABLE_TYPE
  ,S.USER_DEFINED_TYPE_CATALOG AS A_USER_DEFINED_TYPE_CATALOG
  ,S.USER_DEFINED_TYPE_NAME AS A_USER_DEFINED_TYPE_NAME
  ,S.USER_DEFINED_TYPE_SCHEMA AS A_USER_DEFINED_TYPE_SCHEMA   
  --BOOLEAN
  ,S.IS_INSERTABLE_INTO='YES' AS B_IS_INSERTABLE_INTO
  ,S.IS_TRANSIENT='YES' AS B_IS_TRANSIENT
  ,S.IS_TYPED='YES' AS B_IS_TYPED
  --METRICS
  ,S.BYTES AS M_BYTES
  ,S.RETENTION_TIME AS M_RETENTION_TIME
  ,S.ROW_COUNT AS M_ROW_COUNT
  ,S.LAST_ALTERED AS A_LAST_ALTERED_AT_DTS
  --//metadata (MD)  
  ,S.DELETED AS MD_VALID_TO_DTS
  ,S.DELETED IS NOT NULL AS MD_IS_DELETED
  ,CURRENT_TIMESTAMP as MD_ELT_UPDATED_DTS
  ,'5d46a0f0-b3d3-4524-9663-160a0476382b' AS MD_INTGR_ID

  FROM
    source S
)


SELECT * FROM rename
  );
2022-03-10 12:35:23.136294 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:35:24.907538 (Thread-1): SQL status: SUCCESS 1 in 1.77 seconds
2022-03-10 12:35:24.933084 (Thread-1): finished collecting timing info
2022-03-10 12:35:24.933310 (Thread-1): On model.snowflake_aicg.V_TABLES_STG: Close
2022-03-10 12:35:25.425923 (Thread-1): 09:35:25 | 4 of 11 OK created view model DBT_SNOWFLAKE_USAGE.V_TABLES_STG....... [SUCCESS 1 in 2.30s]
2022-03-10 12:35:25.426285 (Thread-1): Finished running node model.snowflake_aicg.V_TABLES_STG
2022-03-10 12:35:25.426531 (Thread-1): Began running node model.snowflake_aicg.V_USERS_STG
2022-03-10 12:35:25.426816 (Thread-1): 09:35:25 | 5 of 11 START view model DBT_SNOWFLAKE_USAGE.V_USERS_STG............. [RUN]
2022-03-10 12:35:25.427161 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:35:25.427299 (Thread-1): Compiling model.snowflake_aicg.V_USERS_STG
2022-03-10 12:35:25.430281 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_USERS_STG"
2022-03-10 12:35:25.430693 (Thread-1): finished collecting timing info
2022-03-10 12:35:25.431971 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_USERS_STG"
2022-03-10 12:35:25.434679 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_USERS_STG".
2022-03-10 12:35:25.434824 (Thread-1): On model.snowflake_aicg.V_USERS_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_USERS_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_USERS_STG  as (
    
 

WITH source AS (
  SELECT * FROM  SNOWFLAKE.ACCOUNT_USAGE."USERS"
),

rename as (
SELECT
--DLHK
  MD5(S.NAME) AS K_USER_DLHK  
  ,S.NAME AS A_USERNAME
  ,S.BYPASS_MFA_UNTIL AS A_BYPASS_MFA_UNTIL
  ,S.COMMENT AS A_COMMENT  
  ,S.DEFAULT_NAMESPACE AS A_DEFAULT_NAMESPACE
  ,S.DEFAULT_ROLE AS A_DEFAULT_ROLE
  ,S.DEFAULT_WAREHOUSE AS A_DEFAULT_WAREHOUSE  
  ,S.DISABLED AS A_DISABLED
  ,S.DISPLAY_NAME AS A_DISPLAY_NAME
  ,S.EMAIL AS A_EMAIL  
  ,S.EXT_AUTHN_DUO AS A_EXT_AUTHN_DUO
  ,S.FIRST_NAME AS A_FIRST_NAME
  ,S.LAST_NAME AS A_LAST_NAME
  ,S.LAST_SUCCESS_LOGIN AS A_LAST_SUCCESS_LOGIN
  ,S.LOCKED_UNTIL_TIME AS A_LOCKED_UNTIL_TIME
  ,S.LOGIN_NAME AS A_LOGIN_NAME  
  ,S.PASSWORD_LAST_SET_TIME AS A_PASSWORD_LAST_SET_TIME
  ,S.EXT_AUTHN_UID AS A_EXT_AUTHN_UID
  ,S.EXPIRES_AT AS A_EXPIRES_AT_DTS
  --BOOLEAN
  ,S.HAS_PASSWORD AS B_HAS_PASSWORD
  ,S.HAS_RSA_PUBLIC_KEY AS B_HAS_RSA_PUBLIC_KEY
  ,S.MUST_CHANGE_PASSWORD AS B_MUST_CHANGE_PASSWORD
  ,S.SNOWFLAKE_LOCK<>'FALSE' OR S.SNOWFLAKE_LOCK IS NULL AS B_SNOWFLAKE_LOCK
  ,S.DISABLED<>'FALSE' OR S.DISABLED IS NULL AS B_DISABLED
    --metadata (MD)
  ,S.CREATED_ON AS MD_VALID_FROM_DTS
  ,S.DELETED_ON AS MD_VALID_TO_DTS
  ,S.DELETED_ON IS NOT NULL  AS MD_IS_DELETED
  , CURRENT_TIMESTAMP AS MD_ELT_UPDATED_DTS        
  , '5d46a0f0-b3d3-4524-9663-160a0476382b' AS MD_INTGR_ID
FROM
    source S
)

SELECT * FROM rename
  );
2022-03-10 12:35:25.434933 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:35:27.223377 (Thread-1): SQL status: SUCCESS 1 in 1.79 seconds
2022-03-10 12:35:27.230678 (Thread-1): finished collecting timing info
2022-03-10 12:35:27.231013 (Thread-1): On model.snowflake_aicg.V_USERS_STG: Close
2022-03-10 12:35:27.677296 (Thread-1): 09:35:27 | 5 of 11 OK created view model DBT_SNOWFLAKE_USAGE.V_USERS_STG........ [SUCCESS 1 in 2.25s]
2022-03-10 12:35:27.677641 (Thread-1): Finished running node model.snowflake_aicg.V_USERS_STG
2022-03-10 12:35:27.677830 (Thread-1): Began running node model.snowflake_aicg.W_COLUMNS_D
2022-03-10 12:35:27.678423 (Thread-1): 09:35:27 | 6 of 11 START table model DBT_SNOWFLAKE_USAGE.W_COLUMNS_D............ [RUN]
2022-03-10 12:35:27.678919 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.W_COLUMNS_D".
2022-03-10 12:35:27.679303 (Thread-1): Compiling model.snowflake_aicg.W_COLUMNS_D
2022-03-10 12:35:27.682843 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.W_COLUMNS_D"
2022-03-10 12:35:27.683255 (Thread-1): finished collecting timing info
2022-03-10 12:35:27.705796 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.W_COLUMNS_D"
2022-03-10 12:35:27.706594 (Thread-1): Using snowflake connection "model.snowflake_aicg.W_COLUMNS_D".
2022-03-10 12:35:27.706780 (Thread-1): On model.snowflake_aicg.W_COLUMNS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.W_COLUMNS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.W_COLUMNS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_COLUMNS_STG AS C
      );
2022-03-10 12:35:27.707016 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:35:49.679318 (Thread-1): SQL status: SUCCESS 1 in 21.97 seconds
2022-03-10 12:35:49.695008 (Thread-1): finished collecting timing info
2022-03-10 12:35:49.695373 (Thread-1): On model.snowflake_aicg.W_COLUMNS_D: Close
2022-03-10 12:35:50.176882 (Thread-1): 09:35:50 | 6 of 11 OK created table model DBT_SNOWFLAKE_USAGE.W_COLUMNS_D....... [SUCCESS 1 in 22.50s]
2022-03-10 12:35:50.177933 (Thread-1): Finished running node model.snowflake_aicg.W_COLUMNS_D
2022-03-10 12:35:50.179756 (Thread-1): Began running node model.snowflake_aicg.W_DATABASES_D
2022-03-10 12:35:50.181075 (Thread-1): 09:35:50 | 7 of 11 START table model DBT_SNOWFLAKE_USAGE.W_DATABASES_D.......... [RUN]
2022-03-10 12:35:50.182293 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.W_DATABASES_D".
2022-03-10 12:35:50.183110 (Thread-1): Compiling model.snowflake_aicg.W_DATABASES_D
2022-03-10 12:35:50.195260 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.W_DATABASES_D"
2022-03-10 12:35:50.197810 (Thread-1): finished collecting timing info
2022-03-10 12:35:50.199802 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.W_DATABASES_D"
2022-03-10 12:35:50.200814 (Thread-1): Using snowflake connection "model.snowflake_aicg.W_DATABASES_D".
2022-03-10 12:35:50.201109 (Thread-1): On model.snowflake_aicg.W_DATABASES_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.W_DATABASES_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.W_DATABASES_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_DATABASES_STG AS C
      );
2022-03-10 12:35:50.201271 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:35:57.805008 (Thread-1): SQL status: SUCCESS 1 in 7.60 seconds
2022-03-10 12:35:57.809342 (Thread-1): finished collecting timing info
2022-03-10 12:35:57.809871 (Thread-1): On model.snowflake_aicg.W_DATABASES_D: Close
2022-03-10 12:35:58.290252 (Thread-1): 09:35:58 | 7 of 11 OK created table model DBT_SNOWFLAKE_USAGE.W_DATABASES_D..... [SUCCESS 1 in 8.11s]
2022-03-10 12:35:58.290859 (Thread-1): Finished running node model.snowflake_aicg.W_DATABASES_D
2022-03-10 12:35:58.291371 (Thread-1): Began running node model.snowflake_aicg.W_TABLES_D
2022-03-10 12:35:58.292210 (Thread-1): 09:35:58 | 8 of 11 START table model DBT_SNOWFLAKE_USAGE.W_TABLES_D............. [RUN]
2022-03-10 12:35:58.293080 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.W_TABLES_D".
2022-03-10 12:35:58.293612 (Thread-1): Compiling model.snowflake_aicg.W_TABLES_D
2022-03-10 12:35:58.308671 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.W_TABLES_D"
2022-03-10 12:35:58.309108 (Thread-1): finished collecting timing info
2022-03-10 12:35:58.310395 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.W_TABLES_D"
2022-03-10 12:35:58.311043 (Thread-1): Using snowflake connection "model.snowflake_aicg.W_TABLES_D".
2022-03-10 12:35:58.311161 (Thread-1): On model.snowflake_aicg.W_TABLES_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.W_TABLES_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.W_TABLES_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_TABLES_STG AS C
      );
2022-03-10 12:35:58.311263 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:36:13.224366 (Thread-1): SQL status: SUCCESS 1 in 14.91 seconds
2022-03-10 12:36:13.236952 (Thread-1): finished collecting timing info
2022-03-10 12:36:13.237901 (Thread-1): On model.snowflake_aicg.W_TABLES_D: Close
2022-03-10 12:36:13.788246 (Thread-1): 09:36:13 | 8 of 11 OK created table model DBT_SNOWFLAKE_USAGE.W_TABLES_D........ [SUCCESS 1 in 15.49s]
2022-03-10 12:36:13.788486 (Thread-1): Finished running node model.snowflake_aicg.W_TABLES_D
2022-03-10 12:36:13.790231 (Thread-1): Began running node model.snowflake_aicg.W_USERS_D
2022-03-10 12:36:13.790501 (Thread-1): 09:36:13 | 9 of 11 START table model DBT_SNOWFLAKE_USAGE.W_USERS_D.............. [RUN]
2022-03-10 12:36:13.792189 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.W_USERS_D".
2022-03-10 12:36:13.793313 (Thread-1): Compiling model.snowflake_aicg.W_USERS_D
2022-03-10 12:36:13.798701 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.W_USERS_D"
2022-03-10 12:36:13.801306 (Thread-1): finished collecting timing info
2022-03-10 12:36:13.808163 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.W_USERS_D"
2022-03-10 12:36:13.808965 (Thread-1): Using snowflake connection "model.snowflake_aicg.W_USERS_D".
2022-03-10 12:36:13.809068 (Thread-1): On model.snowflake_aicg.W_USERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.W_USERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.W_USERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_USERS_STG AS C
      );
2022-03-10 12:36:13.809167 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:36:17.113687 (Thread-1): SQL status: SUCCESS 1 in 3.30 seconds
2022-03-10 12:36:17.117717 (Thread-1): finished collecting timing info
2022-03-10 12:36:17.118269 (Thread-1): On model.snowflake_aicg.W_USERS_D: Close
2022-03-10 12:36:17.639810 (Thread-1): 09:36:17 | 9 of 11 OK created table model DBT_SNOWFLAKE_USAGE.W_USERS_D......... [SUCCESS 1 in 3.85s]
2022-03-10 12:36:17.640356 (Thread-1): Finished running node model.snowflake_aicg.W_USERS_D
2022-03-10 12:36:17.640892 (Thread-1): Began running node model.snowflake_aicg.V_ACCESS_HISTORY_STG
2022-03-10 12:36:17.641596 (Thread-1): 09:36:17 | 10 of 11 START view model DBT_SNOWFLAKE_USAGE.V_ACCESS_HISTORY_STG... [RUN]
2022-03-10 12:36:17.642387 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.V_ACCESS_HISTORY_STG".
2022-03-10 12:36:17.642880 (Thread-1): Compiling model.snowflake_aicg.V_ACCESS_HISTORY_STG
2022-03-10 12:36:17.661067 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.V_ACCESS_HISTORY_STG"
2022-03-10 12:36:17.662684 (Thread-1): finished collecting timing info
2022-03-10 12:36:17.664101 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.V_ACCESS_HISTORY_STG"
2022-03-10 12:36:17.665693 (Thread-1): Using snowflake connection "model.snowflake_aicg.V_ACCESS_HISTORY_STG".
2022-03-10 12:36:17.665846 (Thread-1): On model.snowflake_aicg.V_ACCESS_HISTORY_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.V_ACCESS_HISTORY_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_ACCESS_HISTORY_STG  as (
    
 

WITH source AS (
  SELECT * FROM  SNOWFLAKE.ACCOUNT_USAGE."ACCESS_HISTORY"
),
tables AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.W_TABLES_D
),

rename as (
   SELECT 
      S.query_id AS K_QUERY_BK
     ,MD5(S.user_name) AS K_USER_DLHK
     ,tables.K_UNIQUE_TABLE_DLHK
     ,tables.K_TABLE_DLHK
     ,base.value:objectId::string AS K_TABLE_BK
     ,S.user_name A_USERNAME
     ,S.query_start_time AS A_START_TIME_DTS
     ,split(base.value:objectName, '.')[0]::string AS A_DATABASE_NAME
     ,split(base.value:objectName, '.')[1]::string AS A_SCHEMA_NAME
     ,split(base.value:objectName, '.')[2]::string AS A_TABLE_NAME   
FROM source S
     ,lateral flatten (base_objects_accessed) base
     ,tables 
WHERE tables.K_TABLE_BK = base.value:objectId::string 
)

SELECT * FROM rename
  );
2022-03-10 12:36:17.665951 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:36:19.555770 (Thread-1): SQL status: SUCCESS 1 in 1.89 seconds
2022-03-10 12:36:19.560932 (Thread-1): finished collecting timing info
2022-03-10 12:36:19.561478 (Thread-1): On model.snowflake_aicg.V_ACCESS_HISTORY_STG: Close
2022-03-10 12:36:20.016596 (Thread-1): 09:36:20 | 10 of 11 OK created view model DBT_SNOWFLAKE_USAGE.V_ACCESS_HISTORY_STG [SUCCESS 1 in 2.37s]
2022-03-10 12:36:20.021286 (Thread-1): Finished running node model.snowflake_aicg.V_ACCESS_HISTORY_STG
2022-03-10 12:36:20.025438 (Thread-1): Began running node model.snowflake_aicg.W_ACCESS_HISTORY_F
2022-03-10 12:36:20.026284 (Thread-1): 09:36:20 | 11 of 11 START table model DBT_SNOWFLAKE_USAGE.W_ACCESS_HISTORY_F.... [RUN]
2022-03-10 12:36:20.027266 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicg.W_ACCESS_HISTORY_F".
2022-03-10 12:36:20.029272 (Thread-1): Compiling model.snowflake_aicg.W_ACCESS_HISTORY_F
2022-03-10 12:36:20.040733 (Thread-1): Writing injected SQL for node "model.snowflake_aicg.W_ACCESS_HISTORY_F"
2022-03-10 12:36:20.041169 (Thread-1): finished collecting timing info
2022-03-10 12:36:20.042446 (Thread-1): Writing runtime SQL for node "model.snowflake_aicg.W_ACCESS_HISTORY_F"
2022-03-10 12:36:20.043094 (Thread-1): Using snowflake connection "model.snowflake_aicg.W_ACCESS_HISTORY_F".
2022-03-10 12:36:20.043209 (Thread-1): On model.snowflake_aicg.W_ACCESS_HISTORY_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicg", "target_name": "dev", "node_id": "model.snowflake_aicg.W_ACCESS_HISTORY_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.W_ACCESS_HISTORY_F  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SNOWFLAKE_USAGE.V_ACCESS_HISTORY_STG AS C
      );
2022-03-10 12:36:20.043310 (Thread-1): Opening a new connection, currently in state closed
2022-03-10 12:36:43.115650 (Thread-1): SQL status: SUCCESS 1 in 23.07 seconds
2022-03-10 12:36:43.136477 (Thread-1): finished collecting timing info
2022-03-10 12:36:43.137079 (Thread-1): On model.snowflake_aicg.W_ACCESS_HISTORY_F: Close
2022-03-10 12:36:43.600893 (Thread-1): 09:36:43 | 11 of 11 OK created table model DBT_SNOWFLAKE_USAGE.W_ACCESS_HISTORY_F [SUCCESS 1 in 23.57s]
2022-03-10 12:36:43.602176 (Thread-1): Finished running node model.snowflake_aicg.W_ACCESS_HISTORY_F
2022-03-10 12:36:43.608068 (MainThread): Acquiring new snowflake connection "master".
2022-03-10 12:36:43.610165 (MainThread): 09:36:43 | 
2022-03-10 12:36:43.610723 (MainThread): 09:36:43 | Finished running 6 view models, 5 table models in 93.03s.
2022-03-10 12:36:43.611140 (MainThread): Connection 'master' was properly closed.
2022-03-10 12:36:43.611481 (MainThread): Connection 'model.snowflake_aicg.W_ACCESS_HISTORY_F' was properly closed.
2022-03-10 12:36:43.635492 (MainThread): 
2022-03-10 12:36:43.635721 (MainThread): Completed successfully
2022-03-10 12:36:43.635859 (MainThread): 
Done. PASS=11 WARN=0 ERROR=0 SKIP=0 TOTAL=11
2022-03-10 12:36:43.636202 (MainThread): Flushing usage events
