2022-03-02 12:31:34.479798 (MainThread): Running with dbt=0.21.1
2022-03-02 12:31:35.130693 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='/Users/guilhermealcantara/.dbt', project_dir=None, record_timing_info=None, rpc_method='run', select=None, selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, use_experimental_parser=False, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-03-02 12:31:35.131791 (MainThread): Tracking: do not track
2022-03-02 12:31:35.142721 (MainThread): Partial parsing not enabled
2022-03-02 12:31:35.159984 (MainThread): Parsing macros/common.sql
2022-03-02 12:31:35.160788 (MainThread): Parsing macros/catalog.sql
2022-03-02 12:31:35.162551 (MainThread): Parsing macros/adapters.sql
2022-03-02 12:31:35.195010 (MainThread): Parsing macros/materializations/merge.sql
2022-03-02 12:31:35.198147 (MainThread): Parsing macros/materializations/seed.sql
2022-03-02 12:31:35.201913 (MainThread): Parsing macros/materializations/view.sql
2022-03-02 12:31:35.203045 (MainThread): Parsing macros/materializations/table.sql
2022-03-02 12:31:35.205662 (MainThread): Parsing macros/materializations/incremental.sql
2022-03-02 12:31:35.213302 (MainThread): Parsing macros/core.sql
2022-03-02 12:31:35.216597 (MainThread): Parsing macros/materializations/test.sql
2022-03-02 12:31:35.222731 (MainThread): Parsing macros/materializations/helpers.sql
2022-03-02 12:31:35.231309 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-03-02 12:31:35.233107 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-03-02 12:31:35.247358 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-03-02 12:31:35.277640 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-03-02 12:31:35.301174 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-03-02 12:31:35.302799 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-03-02 12:31:35.312681 (MainThread): Parsing macros/materializations/incremental/on_schema_change.sql
2022-03-02 12:31:35.331476 (MainThread): Parsing macros/materializations/common/merge.sql
2022-03-02 12:31:35.344394 (MainThread): Parsing macros/materializations/table/table.sql
2022-03-02 12:31:35.351859 (MainThread): Parsing macros/materializations/view/view.sql
2022-03-02 12:31:35.358484 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-03-02 12:31:35.361823 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-03-02 12:31:35.362988 (MainThread): Parsing macros/etc/query.sql
2022-03-02 12:31:35.363703 (MainThread): Parsing macros/etc/is_incremental.sql
2022-03-02 12:31:35.365068 (MainThread): Parsing macros/etc/datetime.sql
2022-03-02 12:31:35.372708 (MainThread): Parsing macros/etc/where_subquery.sql
2022-03-02 12:31:35.374118 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-03-02 12:31:35.376302 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-03-02 12:31:35.377504 (MainThread): Parsing macros/adapters/common.sql
2022-03-02 12:31:35.469359 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-03-02 12:31:35.480768 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-03-02 12:31:35.483869 (MainThread): Parsing macros/schema_tests/unique.sql
2022-03-02 12:31:35.485430 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-03-02 12:31:35.668863 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-02 12:31:35.678158 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.681149 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_MERCHANT_LOCATION_STG".
2022-03-02 12:31:35.683755 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.684512 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_PAYMENT_STG".
2022-03-02 12:31:35.687066 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.687795 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CATALOG_ITEM_MODIFIER_STG".
2022-03-02 12:31:35.690189 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.690917 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CATALOG_TAX_STG".
2022-03-02 12:31:35.693365 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.694079 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CATALOG_CATEGORY_STG".
2022-03-02 12:31:35.696929 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.697637 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CATALOG_DISCOUNT_STG".
2022-03-02 12:31:35.699984 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.700687 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CATALOG_ITEM_VARIATION_STG".
2022-03-02 12:31:35.702960 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.703661 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-02 12:31:35.707501 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.708240 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_STG".
2022-03-02 12:31:35.711471 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.712192 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_HEADER_STG".
2022-03-02 12:31:35.714617 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.715334 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_MODIFIER_STG".
2022-03-02 12:31:35.718468 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.719189 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.V_CURRENCY_STG".
2022-03-02 12:31:35.721342 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.722067 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-02 12:31:35.725806 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.726532 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-02 12:31:35.728947 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.729752 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_MERCHANT_LOCATION_D".
2022-03-02 12:31:35.732025 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.732748 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_PAYMENTS_F".
2022-03-02 12:31:35.735103 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.735823 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-02 12:31:35.738730 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.739478 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CURRENCY_D".
2022-03-02 12:31:35.776642 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.777481 (MainThread): Acquiring new snowflake connection "model.snowflake_aicd.W_CATALOG_ITEM_D".
2022-03-02 12:31:35.780143 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.787311 (MainThread): Acquiring new snowflake connection "snapshot.snowflake_aicd.w_customers_snapshot_d".
2022-03-02 12:31:35.811037 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.812213 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.813343 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.814613 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.815722 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.816835 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.817945 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.819237 (MainThread): 'soft_unicode' has been renamed to 'soft_str'. The old name will be removed in MarkupSafe 2.1.
2022-03-02 12:31:35.849531 (MainThread): write_gpickle is deprecated and will be removed in 3.0.Use ``pickle.dump(G, path, protocol)``
2022-03-02 12:31:35.850436 (MainThread): Found 20 models, 8 tests, 1 snapshot, 0 analyses, 173 macros, 0 operations, 0 seed files, 13 sources, 0 exposures
2022-03-02 12:31:35.852378 (MainThread): 
2022-03-02 12:31:35.852620 (MainThread): Acquiring new snowflake connection "master".
2022-03-02 12:31:35.853847 (ThreadPoolExecutor-0_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-02 12:31:35.863391 (ThreadPoolExecutor-0_0): Using snowflake connection "list_DEVELOPER_SANDBOX".
2022-03-02 12:31:35.863534 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX"} */

    show terse schemas in database DEVELOPER_SANDBOX
    limit 10000
2022-03-02 12:31:35.863631 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-03-02 12:31:37.927421 (ThreadPoolExecutor-0_0): SQL status: SUCCESS 41 in 2.06 seconds
2022-03-02 12:31:37.930241 (ThreadPoolExecutor-0_0): On list_DEVELOPER_SANDBOX: Close
2022-03-02 12:31:38.441398 (ThreadPoolExecutor-1_0): Acquiring new snowflake connection "list_DEVELOPER_SANDBOX_DBT_SQUARE".
2022-03-02 12:31:38.446328 (ThreadPoolExecutor-1_0): Using snowflake connection "list_DEVELOPER_SANDBOX_DBT_SQUARE".
2022-03-02 12:31:38.446509 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SQUARE: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "connection_name": "list_DEVELOPER_SANDBOX_DBT_SQUARE"} */

    show terse objects in DEVELOPER_SANDBOX.DBT_SQUARE
2022-03-02 12:31:38.446610 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-03-02 12:31:40.248139 (ThreadPoolExecutor-1_0): SQL status: SUCCESS 25 in 1.80 seconds
2022-03-02 12:31:40.250885 (ThreadPoolExecutor-1_0): On list_DEVELOPER_SANDBOX_DBT_SQUARE: Close
2022-03-02 12:31:40.742643 (MainThread): 09:31:40 | Concurrency: 1 threads (target='dev')
2022-03-02 12:31:40.743026 (MainThread): 09:31:40 | 
2022-03-02 12:31:40.744961 (Thread-1): Began running node model.snowflake_aicd.V_CATALOG_CATEGORY_STG
2022-03-02 12:31:40.745893 (Thread-1): 09:31:40 | 1 of 20 START view model DBT_SQUARE.V_CATALOG_CATEGORY_STG........... [RUN]
2022-03-02 12:31:40.746327 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CATALOG_CATEGORY_STG".
2022-03-02 12:31:40.746557 (Thread-1): Compiling model.snowflake_aicd.V_CATALOG_CATEGORY_STG
2022-03-02 12:31:40.751739 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CATALOG_CATEGORY_STG"
2022-03-02 12:31:40.752848 (Thread-1): finished collecting timing info
2022-03-02 12:31:40.781067 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CATALOG_CATEGORY_STG"
2022-03-02 12:31:40.782648 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CATALOG_CATEGORY_STG".
2022-03-02 12:31:40.782782 (Thread-1): On model.snowflake_aicd.V_CATALOG_CATEGORY_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CATALOG_CATEGORY_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SQUARE.V_CATALOG_CATEGORY_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SQUARE_ALT13."CATALOG_CATEGORY"
),

rename as (


SELECT
       --MD5 KEYS
        MD5( ID ) AS K_POS_CATALOG_CATEGORY_DLHK        
        --BUSINESS KEYS
        ,ID AS K_POS_CATALOG_CATEGORY_BK        
        --DESCRIPTION
        ,NAME AS A_POS_PRODUCT_CATEGORY        
        --metadata (MD)
        , CURRENT_TIMESTAMP AS MD_LOAD_DTS        
        , 'f023f503-a01b-4501-91a5-424921ffc4ca' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-02 12:31:40.782906 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:31:42.402093 (Thread-1): SQL status: SUCCESS 1 in 1.62 seconds
2022-03-02 12:31:42.414776 (Thread-1): finished collecting timing info
2022-03-02 12:31:42.415170 (Thread-1): On model.snowflake_aicd.V_CATALOG_CATEGORY_STG: Close
2022-03-02 12:31:42.861794 (Thread-1): 09:31:42 | 1 of 20 OK created view model DBT_SQUARE.V_CATALOG_CATEGORY_STG...... [SUCCESS 1 in 2.12s]
2022-03-02 12:31:42.862077 (Thread-1): Finished running node model.snowflake_aicd.V_CATALOG_CATEGORY_STG
2022-03-02 12:31:42.862246 (Thread-1): Began running node model.snowflake_aicd.V_CATALOG_DISCOUNT_STG
2022-03-02 12:31:42.862433 (Thread-1): 09:31:42 | 2 of 20 START view model DBT_SQUARE.V_CATALOG_DISCOUNT_STG........... [RUN]
2022-03-02 12:31:42.862923 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CATALOG_DISCOUNT_STG".
2022-03-02 12:31:42.863078 (Thread-1): Compiling model.snowflake_aicd.V_CATALOG_DISCOUNT_STG
2022-03-02 12:31:42.866605 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CATALOG_DISCOUNT_STG"
2022-03-02 12:31:42.867124 (Thread-1): finished collecting timing info
2022-03-02 12:31:42.869110 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CATALOG_DISCOUNT_STG"
2022-03-02 12:31:42.870568 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CATALOG_DISCOUNT_STG".
2022-03-02 12:31:42.870688 (Thread-1): On model.snowflake_aicd.V_CATALOG_DISCOUNT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CATALOG_DISCOUNT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SQUARE.V_CATALOG_DISCOUNT_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SQUARE_ALT13."CATALOG_DISCOUNT"
),

rename as (
SELECT DISTINCT
    --MD5 KEYS    
    MD5( TRIM(ID) ) AS K_POS_CATALOG_OBJECT_DLHK
    --BUSINESS KEYS
    ,ID AS K_POS_CATALOG_OBJECT_BK
    --ATTRIBUTES
    ,NAME AS A_POS_PRODUCT_NAME
    ,COALESCE(NAME, 'N/A') AS A_POS_PRODUCT_SUB_NAME
    ,'TAX' AS A_POS_CATEGORY_NAME
    ,'CATALOG TAX' AS A_POS_USAGE
    ,0.00::decimal(15,2) AS M_POS_ITEM_BASE_COST_AMT
    ,0.00::decimal(15,2) AS M_POS_ITEM_BASE_PRICE_AMT
    ,0.00::decimal(15,2) AS M_POS_PRICE_AMT
    ,'USD' AS POS_PRICE_CCY
    --METADATA (MD)
    ,CURRENT_TIMESTAMP AS MD_LOAD_DTS        
    ,'f023f503-a01b-4501-91a5-424921ffc4ca' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-02 12:31:42.870809 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:31:44.763088 (Thread-1): SQL status: SUCCESS 1 in 1.89 seconds
2022-03-02 12:31:44.768482 (Thread-1): finished collecting timing info
2022-03-02 12:31:44.769335 (Thread-1): On model.snowflake_aicd.V_CATALOG_DISCOUNT_STG: Close
2022-03-02 12:31:45.215448 (Thread-1): 09:31:45 | 2 of 20 OK created view model DBT_SQUARE.V_CATALOG_DISCOUNT_STG...... [SUCCESS 1 in 2.35s]
2022-03-02 12:31:45.216111 (Thread-1): Finished running node model.snowflake_aicd.V_CATALOG_DISCOUNT_STG
2022-03-02 12:31:45.216639 (Thread-1): Began running node model.snowflake_aicd.V_CATALOG_TAX_STG
2022-03-02 12:31:45.226942 (Thread-1): 09:31:45 | 3 of 20 START view model DBT_SQUARE.V_CATALOG_TAX_STG................ [RUN]
2022-03-02 12:31:45.227448 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CATALOG_TAX_STG".
2022-03-02 12:31:45.227621 (Thread-1): Compiling model.snowflake_aicd.V_CATALOG_TAX_STG
2022-03-02 12:31:45.230341 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CATALOG_TAX_STG"
2022-03-02 12:31:45.230805 (Thread-1): finished collecting timing info
2022-03-02 12:31:45.232356 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CATALOG_TAX_STG"
2022-03-02 12:31:45.234270 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CATALOG_TAX_STG".
2022-03-02 12:31:45.234460 (Thread-1): On model.snowflake_aicd.V_CATALOG_TAX_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CATALOG_TAX_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SQUARE.V_CATALOG_TAX_STG  as (
    
 

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SQUARE_ALT13."CATALOG_TAX"
),

rename as (


SELECT DISTINCT
    --MD5 KEYS    
    MD5( TRIM(ID) ) AS K_POS_CATALOG_OBJECT_DLHK
    --BUSINESS KEYS
    ,ID AS K_POS_CATALOG_OBJECT_BK
    --ATTRIBUTES
    ,NAME AS A_POS_PRODUCT_NAME
    ,COALESCE(NAME, 'N/A') AS A_POS_PRODUCT_SUB_NAME
    ,INCLUSION_TYPE AS A_POS_TAX_INCLUSION_TYPE
    ,PERCENTAGE AS A_POS_TAX_PERCENTAGE
    ,'TAX' AS A_POS_CATEGORY_NAME
    ,'CATALOG TAX' AS A_POS_USAGE
    ,0.00::decimal(15,2) AS M_POS_ITEM_BASE_COST_AMT
    ,0.00::decimal(15,2) AS M_POS_ITEM_BASE_PRICE_AMT
    ,0.00::decimal(15,2) AS M_POS_PRICE_AMT
    ,'USD' AS POS_PRICE_CCY
    --BOOLEAN
    ,ENABLED AS B_IS_ENABLED
    --METADATA (MD)
    ,CURRENT_TIMESTAMP AS MD_LOAD_DTS        
    ,'f023f503-a01b-4501-91a5-424921ffc4ca' AS MD_INTGR_ID
FROM
    source
)

SELECT * FROM rename
  );
2022-03-02 12:31:45.234570 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:31:47.440194 (Thread-1): SQL status: SUCCESS 1 in 2.21 seconds
2022-03-02 12:31:47.443103 (Thread-1): finished collecting timing info
2022-03-02 12:31:47.443544 (Thread-1): On model.snowflake_aicd.V_CATALOG_TAX_STG: Close
2022-03-02 12:31:47.911958 (Thread-1): 09:31:47 | 3 of 20 OK created view model DBT_SQUARE.V_CATALOG_TAX_STG........... [SUCCESS 1 in 2.68s]
2022-03-02 12:31:47.912238 (Thread-1): Finished running node model.snowflake_aicd.V_CATALOG_TAX_STG
2022-03-02 12:31:47.912468 (Thread-1): Began running node model.snowflake_aicd.V_CURRENCY_STG
2022-03-02 12:31:47.912667 (Thread-1): 09:31:47 | 4 of 20 START view model DBT_SQUARE.V_CURRENCY_STG................... [RUN]
2022-03-02 12:31:47.913122 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CURRENCY_STG".
2022-03-02 12:31:47.913305 (Thread-1): Compiling model.snowflake_aicd.V_CURRENCY_STG
2022-03-02 12:31:47.915800 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CURRENCY_STG"
2022-03-02 12:31:47.916221 (Thread-1): finished collecting timing info
2022-03-02 12:31:47.917540 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CURRENCY_STG"
2022-03-02 12:31:47.918541 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CURRENCY_STG".
2022-03-02 12:31:47.918633 (Thread-1): On model.snowflake_aicd.V_CURRENCY_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CURRENCY_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SQUARE.V_CURRENCY_STG  as (
    

with rename as (

SELECT
    'USD' as K_CURRENCY_BK
    , MD5('USD') AS K_CURRENCY_DLHK
    , 'USD' AS K_CURRENCY_CODE
    , 'USD' AS A_CURRENCY_NAME
    , 'United States Dollars' as A_CURRENCY_NAME_FULL
    ,'' AS MD_HASH_COL
    , 'f023f503-a01b-4501-91a5-424921ffc4ca' AS MD_INTGR_ID

UNION

SELECT
    'EUR' as K_CURRENCY_BK
    , MD5('EUR') AS K_CURRENCY_DLHK
    , 'EUR' AS K_CURRENCY_CODE
    , 'EUR' AS A_CURRENCY_NAME
    , 'Euros' as A_CURRENCY_NAME_FULL
    ,'' AS MD_HASH_COL
    , 'f023f503-a01b-4501-91a5-424921ffc4ca' AS MD_INTGR_ID

)

select * from rename
  );
2022-03-02 12:31:47.918735 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:31:49.634975 (Thread-1): SQL status: SUCCESS 1 in 1.72 seconds
2022-03-02 12:31:49.637703 (Thread-1): finished collecting timing info
2022-03-02 12:31:49.637924 (Thread-1): On model.snowflake_aicd.V_CURRENCY_STG: Close
2022-03-02 12:31:50.116713 (Thread-1): 09:31:50 | 4 of 20 OK created view model DBT_SQUARE.V_CURRENCY_STG.............. [SUCCESS 1 in 2.20s]
2022-03-02 12:31:50.117321 (Thread-1): Finished running node model.snowflake_aicd.V_CURRENCY_STG
2022-03-02 12:31:50.117633 (Thread-1): Began running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-02 12:31:50.117845 (Thread-1): 09:31:50 | 5 of 20 START view model DBT_SQUARE.V_CUSTOMER_STG................... [RUN]
2022-03-02 12:31:50.118092 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-02 12:31:50.118201 (Thread-1): Compiling model.snowflake_aicd.V_CUSTOMER_STG
2022-03-02 12:31:50.121128 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-02 12:31:50.122459 (Thread-1): finished collecting timing info
2022-03-02 12:31:50.124228 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CUSTOMER_STG"
2022-03-02 12:31:50.127363 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CUSTOMER_STG".
2022-03-02 12:31:50.127548 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CUSTOMER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SQUARE.V_CUSTOMER_STG  as (
    

WITH source AS (
  SELECT 
  * 
  FROM  	
    DEVELOPER_SANDBOX.DEMO_SQUARE_ALT13."CUSTOMER"
),
rename AS 
(   
SELECT 
    --MD5 KEYS
     MD5( TRIM(COALESCE(ID, '00000000000000000000000000000000')) ) AS K_POS_CUSTOMER_DLHK
    --BUSINESS KEYS
    ,ID AS K_POS_CUSTOMER_BK
    --ATTRIBUTES
    ,GIVEN_NAME AS A_POS_GIVEN_NAME
    ,FAMILY_NAME AS A_POS_FAMILY_NAME
    ,
    (COALESCE(GIVEN_NAME,'') || ' ' || COALESCE(FAMILY_NAME,''))
 AS A_POS_FULL_NAME
    ,EMAIL_ADDRESS AS A_POS_EMAIL
    ,ADDRESS_ADDRESS_LINE_1 AS A_POS_ADDR_LINE_1
    ,ADDRESS_ADDRESS_LINE_2 AS A_POS_ADDR_LINE_2
    ,ADDRESS_ADDRESS_LINE_3 AS A_POS_ADDR_LINE_3
    ,ADDRESS_LOCALITY AS A_POS_ADDR_LOCAL
    ,ADDRESS_SUBLOCALITY AS A_POS_ADDR_SUBLOCAL
    ,ADDRESS_POSTAL_CODE AS A_POS_ADDR_POSTAL_CODE
    ,ADDRESS_COUNTRY AS A_POS_ADDR_COUNTRY
    ,PHONE_NUMBER AS A_POS_PHONE_NUM
    ,CASE 
      WHEN LEFT(BIRTHDAY,4) = '0000' THEN NULL 
      ELSE BIRTHDAY::DATE
     END AS A_POS_BIRTHDAY
    ,REFERENCE_ID AS A_POS_REFERENCE_ID  
    , CASE WHEN EMAIL_ADDRESS IS NOT NULL THEN 'POSLOYAL' ELSE 'ANONYMOUS' END
    AS A_POS_GB_CONSUMER_TYPE
    ,UPDATED_AT AS A_POS_UPDATED_AT_DTS
        --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'f023f503-a01b-4501-91a5-424921ffc4ca' AS MD_INTGR_ID
  FROM
      source    
)


SELECT * FROM rename
  );
2022-03-02 12:31:50.127666 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:31:51.804656 (Thread-1): SQL status: SUCCESS 1 in 1.68 seconds
2022-03-02 12:31:51.807589 (Thread-1): finished collecting timing info
2022-03-02 12:31:51.807823 (Thread-1): On model.snowflake_aicd.V_CUSTOMER_STG: Close
2022-03-02 12:31:52.269293 (Thread-1): 09:31:52 | 5 of 20 OK created view model DBT_SQUARE.V_CUSTOMER_STG.............. [SUCCESS 1 in 2.15s]
2022-03-02 12:31:52.269493 (Thread-1): Finished running node model.snowflake_aicd.V_CUSTOMER_STG
2022-03-02 12:31:52.269750 (Thread-1): Began running node model.snowflake_aicd.V_DATE_STG
2022-03-02 12:31:52.270010 (Thread-1): 09:31:52 | 6 of 20 START view model DBT_SQUARE.V_DATE_STG....................... [RUN]
2022-03-02 12:31:52.270500 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-02 12:31:52.270688 (Thread-1): Compiling model.snowflake_aicd.V_DATE_STG
2022-03-02 12:31:52.274673 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-02 12:31:52.275263 (Thread-1): finished collecting timing info
2022-03-02 12:31:52.277157 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_DATE_STG"
2022-03-02 12:31:52.298744 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_DATE_STG".
2022-03-02 12:31:52.298942 (Thread-1): On model.snowflake_aicd.V_DATE_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_DATE_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SQUARE.V_DATE_STG  as (
    

SELECT 
     to_date('2015-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') as DD, /*<<Modify date for preferred table start date*/
      seq1() as Sl,row_number() over (order by Sl) as row_numbers,
      dateadd(day,row_numbers,DD) as V_DATE,
      case when date_part(dd, V_DATE) < 10 and date_part(mm, V_DATE) > 9 then
        date_part(year, V_DATE)||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) < 10 and  date_part(mm, V_DATE) < 10 then 
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||'0'||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) < 10 then
         date_part(year, V_DATE)||'0'||date_part(mm, V_DATE)||date_part(dd, V_DATE)
         when date_part(dd, V_DATE) > 9 and  date_part(mm, V_DATE) > 9 then
         date_part(year, V_DATE)||date_part(mm, V_DATE)||date_part(dd, V_DATE) end as DATE_KEY,
      V_DATE as DATE_COLUMN,
      dayname(dateadd(day,row_numbers,DD)) as DAY_NAME_1,
      case 
        when dayname(dateadd(day,row_numbers,DD)) = 'Mon' then 'Monday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Tue' then 'Tuesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Wed' then 'Wednesday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Thu' then 'Thursday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Fri' then 'Friday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sat' then 'Saturday'
        when dayname(dateadd(day,row_numbers,DD)) = 'Sun' then 'Sunday' end ||', '||
      case when monthname(dateadd(day,row_numbers,DD)) ='Jan' then 'January'
           when monthname(dateadd(day,row_numbers,DD)) ='Feb' then 'February'
           when monthname(dateadd(day,row_numbers,DD)) ='Mar' then 'March'
           when monthname(dateadd(day,row_numbers,DD)) ='Apr' then 'April'
           when monthname(dateadd(day,row_numbers,DD)) ='May' then 'May'
           when monthname(dateadd(day,row_numbers,DD)) ='Jun' then 'June'
           when monthname(dateadd(day,row_numbers,DD)) ='Jul' then 'July'
           when monthname(dateadd(day,row_numbers,DD)) ='Aug' then 'August'
           when monthname(dateadd(day,row_numbers,DD)) ='Sep' then 'September'
           when monthname(dateadd(day,row_numbers,DD)) ='Oct' then 'October'
           when monthname(dateadd(day,row_numbers,DD)) ='Nov' then 'November'
           when monthname(dateadd(day,row_numbers,DD)) ='Dec' then 'December' end
           ||' '|| to_varchar(dateadd(day,row_numbers,DD), ' dd, yyyy') as FULL_DATE_DESC,
      dateadd(day,row_numbers,DD) as V_DATE_1,
      dayofweek(V_DATE_1)+1 as DAY_NUM_IN_WEEK,
      Date_part(dd,V_DATE_1) as DAY_NUM_IN_MONTH,
      dayofyear(V_DATE_1) as DAY_NUM_IN_YEAR,
      case 
        when dayname(V_DATE_1) = 'Mon' then 'Monday'
        when dayname(V_DATE_1) = 'Tue' then 'Tuesday'
        when dayname(V_DATE_1) = 'Wed' then 'Wednesday'
        when dayname(V_DATE_1) = 'Thu' then 'Thursday'
        when dayname(V_DATE_1) = 'Fri' then 'Friday'
        when dayname(V_DATE_1) = 'Sat' then 'Saturday'
        when dayname(V_DATE_1) = 'Sun' then 'Sunday' end as DAY_NAME,
      dayname(dateadd(day,row_numbers,DD)) as DAY_ABBREV,
      case  
        when dayname(V_DATE_1) = 'Sun' and dayname(V_DATE_1) = 'Sat' then 
                 'Not-Weekday'
        else 'Weekday' end as WEEKDAY_IND,
       case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0704' or
        DATE_KEY = date_part(year, V_DATE)||'1225' or DATE_KEY = date_part(year, V_DATE)||'1226') then  
        'Holiday' 
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Wed' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Thu' 
        and dateadd(day,-3,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and dateadd(day,-4,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-5,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-6,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Mon' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='May' and dayname(last_day(V_DATE_1)) = 'Tue' 
        and dateadd(day,-1 ,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
        and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and (dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  or 
           dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and ( dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and ( dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,20,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and ( dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and ( dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and (dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and (dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 or 
           dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 ) then
         'Holiday'    
        else
        'Not-Holiday' end as US_HOLIDAY_IND,
      /*Modify the following for Company Specific Holidays*/
      case 
        when (DATE_KEY = date_part(year, V_DATE)||'0101' or DATE_KEY = date_part(year, V_DATE)||'0219'
        or DATE_KEY = date_part(year, V_DATE)||'0528' or DATE_KEY = date_part(year, V_DATE)||'0704' 
        or DATE_KEY = date_part(year, V_DATE)||'1225' )then 
        'Holiday'               
                when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Fri' 
        and last_day(V_DATE_1) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sat' 
        and dateadd(day,-1,last_day(V_DATE_1)) = V_DATE_1  then
        'Holiday'
        when monthname(V_DATE_1) ='Mar' and dayname(last_day(V_DATE_1)) = 'Sun' 
        and dateadd(day,-2,last_day(V_DATE_1)) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue'
                and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu'
                and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and date_part(year, V_DATE_1)||'-04-01' = V_DATE_1 then
        'Holiday'
                when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-04-01'= V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Apr' and dayname(date_part(year, V_DATE_1)||'-04-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-04-01')) = V_DATE_1  then
        'Holiday'   
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Wed' 
        and dateadd(day,5,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Thu' 
        and dateadd(day,4,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Fri' 
        and dateadd(day,3,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sat' 
        and dateadd(day,2,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Sun' 
        and dateadd(day,1,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Mon' 
                and date_part(year, V_DATE_1)||'-09-01' = V_DATE_1 then
        'Holiday' 
        when monthname(V_DATE_1) ='Sep' and dayname(date_part(year, V_DATE_1)||'-09-01') = 'Tue' 
        and dateadd(day,6 ,(date_part(year, V_DATE_1)||'-09-01')) = V_DATE_1  then
        'Holiday' 
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Wed' 
        and dateadd(day,23,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Thu' 
        and dateadd(day,22,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Fri' 
        and dateadd(day,21,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sat' 
        and dateadd(day,27,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Sun' 
        and dateadd(day,26,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Mon' 
        and dateadd(day,25,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1 then
        'Holiday'
        when monthname(V_DATE_1) ='Nov' and dayname(date_part(year, V_DATE_1)||'-11-01') = 'Tue' 
        and dateadd(day,24,(date_part(year, V_DATE_1)||'-11-01')) = V_DATE_1  then
         'Holiday'     
        else
        'Not-Holiday' end as COMPANY_HOLIDAY_IND,
      case                                           
        when last_day(V_DATE_1) = V_DATE_1 then 
        'Month-end'
        else 'Not-Month-end' end as MONTH_END_IND,
          
      case when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||'0'||
            date_part(dd,date_trunc('week',V_DATE_1))  
         when date_part(mm,date_trunc('week',V_DATE_1)) < 10 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||'0'||
            date_part(mm,date_trunc('week',V_DATE_1))||date_part(dd,date_trunc('week',V_DATE_1))    
         when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) < 10 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||date_part(mm,date_trunc('week',V_DATE_1))||
            '0'||date_part(dd,date_trunc('week',V_DATE_1))    
        when date_part(mm,date_trunc('week',V_DATE_1)) > 9 and date_part(dd,date_trunc('week',V_DATE_1)) > 9 then
            date_part(yyyy,date_trunc('week',V_DATE_1))||
            date_part(mm,date_trunc('week',V_DATE_1))||
            date_part(dd,date_trunc('week',V_DATE_1)) end as WEEK_BEGIN_DATE_NKEY,
      date_trunc('week',V_DATE_1) as WEEK_BEGIN_DATE,

      case when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) < 10 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week')) 
         when  date_part(mm,last_day(V_DATE_1,'week')) < 10 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||'0'||
            date_part(mm,last_day(V_DATE_1,'week'))||date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) < 10  then
            date_part(yyyy,last_day(V_DATE_1,'week'))||date_part(mm,last_day(V_DATE_1,'week'))||'0'||
            date_part(dd,last_day(V_DATE_1,'week'))   
         when  date_part(mm,last_day(V_DATE_1,'week')) > 9 and date_part(dd,last_day(V_DATE_1,'week')) > 9 then
            date_part(yyyy,last_day(V_DATE_1,'week'))||
            date_part(mm,last_day(V_DATE_1,'week'))||
            date_part(dd,last_day(V_DATE_1,'week')) end as WEEK_END_DATE_NKEY,
      last_day(V_DATE_1,'week') as WEEK_END_DATE,
      week(V_DATE_1) as WEEK_NUM_IN_YEAR,
      case when monthname(V_DATE_1) ='Jan' then 'January'
           when monthname(V_DATE_1) ='Feb' then 'February'
           when monthname(V_DATE_1) ='Mar' then 'March'
           when monthname(V_DATE_1) ='Apr' then 'April'
           when monthname(V_DATE_1) ='May' then 'May'
           when monthname(V_DATE_1) ='Jun' then 'June'
           when monthname(V_DATE_1) ='Jul' then 'July'
           when monthname(V_DATE_1) ='Aug' then 'August'
           when monthname(V_DATE_1) ='Sep' then 'September'
           when monthname(V_DATE_1) ='Oct' then 'October'
           when monthname(V_DATE_1) ='Nov' then 'November'
           when monthname(V_DATE_1) ='Dec' then 'December' end as MONTH_NAME,
      monthname(V_DATE_1) as MONTH_ABBREV,
      month(V_DATE_1) as MONTH_NUM_IN_YEAR,
      case when month(V_DATE_1) < 10 then 
      year(V_DATE_1)||'-0'||month(V_DATE_1)   
      else year(V_DATE_1)||'-'||month(V_DATE_1) end as YEARMONTH,
      quarter(V_DATE_1) as CURRENT_QUARTER,
      year(V_DATE_1)||'-0'||quarter(V_DATE_1) as YEARQUARTER,
      year(V_DATE_1) as CURRENT_YEAR,
      /*Modify the following based on company fiscal year - assumes Jan 01*/
            to_date(year(V_DATE_1)||'-01-01','YYYY-MM-DD') as FISCAL_CUR_YEAR,
            to_date(year(V_DATE_1) -1||'-01-01','YYYY-MM-DD') as FISCAL_PREV_YEAR,
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
      datediff('week', FISCAL_PREV_YEAR,V_DATE_1)
      else 
      datediff('week', FISCAL_CUR_YEAR,V_DATE_1)  end as FISCAL_WEEK_NUM  ,
      decode(datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ,-2,10,-1,11,0,12,
                   datediff('MONTH',FISCAL_CUR_YEAR, V_DATE_1)+1 ) as FISCAL_MONTH_NUM,
      concat( year(FISCAL_CUR_YEAR) 
           ,case when to_number(FISCAL_MONTH_NUM) = 10 or 
              to_number(FISCAL_MONTH_NUM) = 11 or 
                            to_number(FISCAL_MONTH_NUM) = 12  then
              '-'||FISCAL_MONTH_NUM
          else  concat('-0',FISCAL_MONTH_NUM) end ) as FISCAL_YEARMONTH,
      case when quarter(V_DATE_1) = 4 then 4
         when quarter(V_DATE_1) = 3 then 3
         when quarter(V_DATE_1) = 2 then 2
         when quarter(V_DATE_1) = 1 then 1 end as FISCAL_QUARTER,
      
      case when   V_DATE_1 < FISCAL_CUR_YEAR then
          year(FISCAL_CUR_YEAR)
          else year(FISCAL_CUR_YEAR)+1 end
          ||'-0'||case when quarter(V_DATE_1) = 4 then 4
           when quarter(V_DATE_1) = 3 then 3
           when quarter(V_DATE_1) = 2 then 2
           when quarter(V_DATE_1) = 1 then 1 end as FISCAL_YEARQUARTER,
      case when quarter(V_DATE_1) = 4  then 2 when quarter(V_DATE_1) = 3 then 2
        when quarter(V_DATE_1) = 1  then 1 when quarter(V_DATE_1) = 2 then 1
      end as FISCAL_HALFYEAR,
      year(FISCAL_CUR_YEAR) as FISCAL_YEAR,
      to_timestamp_ntz(V_DATE) as SQL_TIMESTAMP,
      'Y' as CURRENT_ROW_IND,
      to_date(current_timestamp) as EFFECTIVE_DATE,
      to_date('9999-12-31') as EXPIRA_DATE
      from table(generator(rowcount => 8401)) /*<< Set to generate 20 years. Modify rowcount to increase or decrease size*/
  );
2022-03-02 12:31:52.299139 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:31:54.408398 (Thread-1): SQL status: SUCCESS 1 in 2.11 seconds
2022-03-02 12:31:54.414161 (Thread-1): finished collecting timing info
2022-03-02 12:31:54.414864 (Thread-1): On model.snowflake_aicd.V_DATE_STG: Close
2022-03-02 12:31:54.884188 (Thread-1): 09:31:54 | 6 of 20 OK created view model DBT_SQUARE.V_DATE_STG.................. [SUCCESS 1 in 2.61s]
2022-03-02 12:31:54.884680 (Thread-1): Finished running node model.snowflake_aicd.V_DATE_STG
2022-03-02 12:31:54.885234 (Thread-1): Began running node model.snowflake_aicd.V_MERCHANT_LOCATION_STG
2022-03-02 12:31:54.885951 (Thread-1): 09:31:54 | 7 of 20 START view model DBT_SQUARE.V_MERCHANT_LOCATION_STG.......... [RUN]
2022-03-02 12:31:54.886714 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_MERCHANT_LOCATION_STG".
2022-03-02 12:31:54.886985 (Thread-1): Compiling model.snowflake_aicd.V_MERCHANT_LOCATION_STG
2022-03-02 12:31:54.898281 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_MERCHANT_LOCATION_STG"
2022-03-02 12:31:54.898947 (Thread-1): finished collecting timing info
2022-03-02 12:31:54.900469 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_MERCHANT_LOCATION_STG"
2022-03-02 12:31:54.902372 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_MERCHANT_LOCATION_STG".
2022-03-02 12:31:54.902607 (Thread-1): On model.snowflake_aicd.V_MERCHANT_LOCATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_MERCHANT_LOCATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SQUARE.V_MERCHANT_LOCATION_STG  as (
    


with rename as (

  SELECT 
    --MD5 KEYS
    MD5( TRIM(CAST(ID AS VARCHAR)) ) AS K_MERCH_LOC_DLHK
    ,MD5( TRIM(CAST(MERCHANT_ID AS VARCHAR)) ) AS A_MERCHANT_ID_DLHK
    --BUSINES KEYS
    ,ID AS A_MERCH_LOC_ID_BK
    ,MERCHANT_ID AS A_MERCHANT_ID_BK
    --ATTRIBUTE
    ,NAME AS A_MERCH_LOC_NAME   
  
    ,ADDRESS_ADDRESS_LINE_1 || ';' 
    || COALESCE(ADDRESS_ADDRESS_LINE_2, '') || ';' 
    || COALESCE(ADDRESS_ADDRESS_LINE_3, '') 
    || ADDRESS_LOCALITY || ',' || ADDRESS_ADMINISTRATIVE_DISTRICT_LEVEL_1 || ' '
    || ADDRESS_POSTAL_CODE || ' ' || ADDRESS_COUNTRY
    AS A_MERCH_LOC_ADDR_FULL
    
    ,ADDRESS_LOCALITY AS A_MERCH_LOC_LOCALITY
    ,COUNTRY AS A_MERCH_LOC_COUNTRY
    ,ADDRESS_POSTAL_CODE AS A_MERCH_LOC_POSTAL_CODE
    ,BUSINESS_NAME AS A_MERCH_LOC_BIZ_NAME
    ,TYPE AS A_MERCH_LOC_TYPE
    ,STATUS AS A_MERCH_LOC_STATUS
    ,CREATED_AT AS A_MERCH_LOC_CREATED_DTS

        --//metadata (MD)
    ,CURRENT_TIMESTAMP as MD_LOAD_DTS
    ,'f023f503-a01b-4501-91a5-424921ffc4ca' AS MD_INTGR_ID

  FROM 
    DEVELOPER_SANDBOX.DEMO_SQUARE_ALT13."LOCATION" A    

)

SELECT * FROM rename


UNION

SELECT 
  MD5('00000000000000000000000000000000'), MD5('00000000000000000000000000000000')
  , NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL
  , NULL, 'f023f503-a01b-4501-91a5-424921ffc4ca'
--, TRUE, 1, NULL, NULL
-- , NULL, NULL, MSRC.K_MERCHANT_SOURCE_DLHK
-- FROM
--     merchant_source MSRC WHERE MSRC._id = 1
  );
2022-03-02 12:31:54.902792 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:31:56.827145 (Thread-1): SQL status: SUCCESS 1 in 1.92 seconds
2022-03-02 12:31:56.841013 (Thread-1): finished collecting timing info
2022-03-02 12:31:56.841675 (Thread-1): On model.snowflake_aicd.V_MERCHANT_LOCATION_STG: Close
2022-03-02 12:31:57.302402 (Thread-1): 09:31:57 | 7 of 20 OK created view model DBT_SQUARE.V_MERCHANT_LOCATION_STG..... [SUCCESS 1 in 2.42s]
2022-03-02 12:31:57.302894 (Thread-1): Finished running node model.snowflake_aicd.V_MERCHANT_LOCATION_STG
2022-03-02 12:31:57.303254 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_HEADER_STG
2022-03-02 12:31:57.303830 (Thread-1): 09:31:57 | 8 of 20 START view model DBT_SQUARE.V_ORDER_HEADER_STG............... [RUN]
2022-03-02 12:31:57.304535 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_HEADER_STG".
2022-03-02 12:31:57.305176 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_HEADER_STG
2022-03-02 12:31:57.322170 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_HEADER_STG"
2022-03-02 12:31:57.322760 (Thread-1): finished collecting timing info
2022-03-02 12:31:57.324569 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_HEADER_STG"
2022-03-02 12:31:57.326977 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_HEADER_STG".
2022-03-02 12:31:57.327079 (Thread-1): On model.snowflake_aicd.V_ORDER_HEADER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_HEADER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_HEADER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SQUARE_ALT13."ORDER" AS A
),
rename AS 
(
SELECT 
--MD5 KEYS
  MD5( TRIM(ID) ) AS K_POS_ORDER_DLHK
  ,MD5( TRIM(COALESCE(LOCATION_ID,'00000000000000000000000000000000') )) AS K_POS_LOCATION_DLHK
  ,MD5( TRIM(COALESCE(REFERENCE_ID,'00000000000000000000000000000000' ) )) AS K_POS_REFERENCE_DLHK
  ,MD5( TRIM(COALESCE(CUSTOMER_ID,'00000000000000000000000000000000') )) AS K_POS_CUSTOMER_DLHK  
  ,MD5( TRIM(COALESCE(TOTAL_MONEY_CURRENCY,'00000000000000000000000000000000') )) AS K_CURRENCY_DLHK  
--BUSINESS KEYS
  ,ID AS K_POS_ORDER_BK
  ,LOCATION_ID AS K_POS_LOCATION_BK
  ,CUSTOMER_ID AS K_POS_CUSTOMER_BK
  ,REFERENCE_ID AS K_POS_REFERENCE_BK
--TIMESTAMP FIELDS
  ,CREATED_AT AS A_ORDER_CREATED_DTS
  ,UPDATED_AT AS A_ORDER_UPDATED_DTS
  ,CLOSED_AT AS A_ORDER_CLOSED_DTS  
  
--ATTRIBUTES AND METRICS
  ,STATE AS A_ORDER_STATE
  ,ORDER_SOURCE_NAME AS A_ORDER_SOURCE    
  ,ROUND(NVL(NET_AMOUNT_TIP_MONEY_AMOUNT - RETURN_AMOUNT_TIP_MONEY_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_NET_TIP_MONEY_AMT  
  ,TOTAL_SERVICE_CHARGE_AMOUNT AS M_TOTAL_SERVICE_CHARGE_AMT  
  ,ROUND(NVL(RETURN_AMOUNT_TOTAL_MONEY_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_RETURN_TOTAL_AMT
  ,ROUND(NVL(NET_AMOUNT_TOTAL_MONEY_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_NET_TOTAL_AMT
  ,ROUND(NVL(TOTAL_MONEY_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_TOTAL_AMT
  ,ROUND(NVL(TOTAL_TAX_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_TAX_TOTAL_AMT
  ,ROUND(NVL(TOTAL_DISCOUNT_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_DISCOUNT_TOTAL_AMT
  
  --METADATA (MD)
  ,CURRENT_TIMESTAMP as MD_LOAD_DTS
  ,'f023f503-a01b-4501-91a5-424921ffc4ca' AS MD_INTGR_ID
FROM source
)

SELECT * FROM rename
  );
2022-03-02 12:31:57.327183 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:31:59.309733 (Thread-1): SQL status: SUCCESS 1 in 1.98 seconds
2022-03-02 12:31:59.317738 (Thread-1): finished collecting timing info
2022-03-02 12:31:59.318364 (Thread-1): On model.snowflake_aicd.V_ORDER_HEADER_STG: Close
2022-03-02 12:31:59.791837 (Thread-1): 09:31:59 | 8 of 20 OK created view model DBT_SQUARE.V_ORDER_HEADER_STG.......... [SUCCESS 1 in 2.49s]
2022-03-02 12:31:59.801481 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_HEADER_STG
2022-03-02 12:31:59.801822 (Thread-1): Began running node model.snowflake_aicd.V_PAYMENT_STG
2022-03-02 12:31:59.802031 (Thread-1): 09:31:59 | 9 of 20 START view model DBT_SQUARE.V_PAYMENT_STG.................... [RUN]
2022-03-02 12:31:59.802510 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_PAYMENT_STG".
2022-03-02 12:31:59.802652 (Thread-1): Compiling model.snowflake_aicd.V_PAYMENT_STG
2022-03-02 12:31:59.805309 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_PAYMENT_STG"
2022-03-02 12:31:59.805917 (Thread-1): finished collecting timing info
2022-03-02 12:31:59.807588 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_PAYMENT_STG"
2022-03-02 12:31:59.810442 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_PAYMENT_STG".
2022-03-02 12:31:59.810541 (Thread-1): On model.snowflake_aicd.V_PAYMENT_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_PAYMENT_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SQUARE.V_PAYMENT_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SQUARE_ALT13."PAYMENT"
),

rename AS 
(
 SELECT
        --MD5 KEYS
        MD5( ID ) AS K_POS_PAYMENT_DLHK 
        ,MD5( TRIM(COALESCE(LOCATION_ID, '00000000000000000000000000000000'))  ) AS K_POS_MERCH_LOC_DLHK
        ,MD5( TRIM(COALESCE(ORDER_ID, '00000000000000000000000000000000'))  ) AS K_POS_ORDER_DLHK
        ,MD5( TRIM(COALESCE(CUSTOMER_ID, '00000000000000000000000000000000')) ) AS K_POS_CUSTOMER_DLHK 
        ,MD5( TRIM(COALESCE(TOTAL_MONEY_CURRENCY, '00000000000000000000000000000000')) ) AS K_CURRENCY_DLHK
        ,MD5 (TRIM(COALESCE(EMPLOYEE_ID,'00000000000000000000000000000000'))) AS K_EMPLOYEE_DLHK
        ,MD5(TO_VARCHAR(CREATED_AT::date, 'YYYYMMDD')) AS K_DATE_DLHK -- need to rereference this to a RawDV DLHVID identifier that has 32 charts in the date_d dimension        
        ,TO_VARCHAR(CREATED_AT::date, 'YYYYMMDD')::int AS K_DATE_ID
        --BUSINESS KEYS
        ,ID AS K_POS_PAYMENT_BK
        ,LOCATION_ID AS K_POS_PAYMENT_LOCATION_BK
        ,ORDER_ID AS K_POS_PAYMENT_ORDER_BK
        ,CUSTOMER_ID AS K_POS_PAYMENT_CUSTOMER_BK
        ,EMPLOYEE_ID AS K_EMPLOYEE_BK
        --METRICS
        ,ROUND(NVL(AMOUNT_MONEY_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_PAYMENT_MONEY_AMT
        ,ROUND(NVL(APP_FEE_MONEY_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_PAYMENT_APP_FEE_AMT
        ,ROUND(NVL(REFUNDED_MONEY_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_PAYMENT_REFUND_MONEY_AMT
        ,ROUND(NVL(TIP_MONEY_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_PAYMENT_TIP_AMT
        ,ROUND(NVL(TOTAL_MONEY_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_PAYMENT_TOTAL_AMT  --will match the Order table TOTAL_MONEY_AMOUNT metric
        --DESCRIPTION AND DATE FIELDS
        ,TOTAL_MONEY_CURRENCY AS A_POS_PAYMENT_CURRENCY
        ,RECEIPT_NUMBER AS A_POS_PAYMENT_RECEIPT_NUMBER
        ,RECEIPT_URL AS A_POS_PAYMENT_RECEIPT_URL
        ,SOURCE_TYPE AS A_POS_PAYMENT_SOURCE_TYPE
        ,STATUS AS A_POS_PAYMENT_STATUS
        ,CREATED_AT AS A_POS_PAYMENT_CREATED_DTS
        ,UPDATED_AT AS A_POS_PAYMENT_UPDATED_DTS   
        --METADATA
        , CURRENT_TIMESTAMP AS MD_LOAD_DTS
        , MD5(CONCAT(
                IFNULL(NULLIF(TRIM(CAST(ID AS VARCHAR)), ''), '^^'), '||',
                IFNULL(NULLIF(TRIM(CAST(CUSTOMER_ID AS VARCHAR)), ''), '^^') )) AS MD_HASH_COL
        , 'f023f503-a01b-4501-91a5-424921ffc4ca' AS MD_INTGR_ID
FROM source 
)

SELECT * FROM rename
  );
2022-03-02 12:31:59.810645 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:32:01.557693 (Thread-1): SQL status: SUCCESS 1 in 1.75 seconds
2022-03-02 12:32:01.560733 (Thread-1): finished collecting timing info
2022-03-02 12:32:01.561142 (Thread-1): On model.snowflake_aicd.V_PAYMENT_STG: Close
2022-03-02 12:32:02.032092 (Thread-1): 09:32:02 | 9 of 20 OK created view model DBT_SQUARE.V_PAYMENT_STG............... [SUCCESS 1 in 2.23s]
2022-03-02 12:32:02.032584 (Thread-1): Finished running node model.snowflake_aicd.V_PAYMENT_STG
2022-03-02 12:32:02.034025 (Thread-1): Began running node model.snowflake_aicd.W_CURRENCY_D
2022-03-02 12:32:02.034626 (Thread-1): 09:32:02 | 10 of 20 START table model DBT_SQUARE.W_CURRENCY_D................... [RUN]
2022-03-02 12:32:02.037530 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CURRENCY_D".
2022-03-02 12:32:02.038000 (Thread-1): Compiling model.snowflake_aicd.W_CURRENCY_D
2022-03-02 12:32:02.047286 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CURRENCY_D"
2022-03-02 12:32:02.047978 (Thread-1): finished collecting timing info
2022-03-02 12:32:02.061755 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CURRENCY_D"
2022-03-02 12:32:02.062517 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CURRENCY_D".
2022-03-02 12:32:02.062616 (Thread-1): On model.snowflake_aicd.W_CURRENCY_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CURRENCY_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SQUARE.W_CURRENCY_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SQUARE.V_CURRENCY_STG AS C
      );
2022-03-02 12:32:02.062711 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:32:05.022143 (Thread-1): SQL status: SUCCESS 1 in 2.96 seconds
2022-03-02 12:32:05.027247 (Thread-1): finished collecting timing info
2022-03-02 12:32:05.027467 (Thread-1): On model.snowflake_aicd.W_CURRENCY_D: Close
2022-03-02 12:32:05.605821 (Thread-1): 09:32:05 | 10 of 20 OK created table model DBT_SQUARE.W_CURRENCY_D.............. [SUCCESS 1 in 3.57s]
2022-03-02 12:32:05.606410 (Thread-1): Finished running node model.snowflake_aicd.W_CURRENCY_D
2022-03-02 12:32:05.606657 (Thread-1): Began running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-02 12:32:05.606985 (Thread-1): 09:32:05 | 11 of 20 START table model DBT_SQUARE.W_CUSTOMERS_D.................. [RUN]
2022-03-02 12:32:05.607283 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-02 12:32:05.607405 (Thread-1): Compiling model.snowflake_aicd.W_CUSTOMERS_D
2022-03-02 12:32:05.609931 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-02 12:32:05.610316 (Thread-1): finished collecting timing info
2022-03-02 12:32:05.611703 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CUSTOMERS_D"
2022-03-02 12:32:05.612305 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CUSTOMERS_D".
2022-03-02 12:32:05.612410 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CUSTOMERS_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SQUARE.W_CUSTOMERS_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SQUARE.V_CUSTOMER_STG AS C
      );
2022-03-02 12:32:05.612508 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:32:09.174294 (Thread-1): SQL status: SUCCESS 1 in 3.56 seconds
2022-03-02 12:32:09.175361 (Thread-1): finished collecting timing info
2022-03-02 12:32:09.175503 (Thread-1): On model.snowflake_aicd.W_CUSTOMERS_D: Close
2022-03-02 12:32:09.660187 (Thread-1): 09:32:09 | 11 of 20 OK created table model DBT_SQUARE.W_CUSTOMERS_D............. [SUCCESS 1 in 4.05s]
2022-03-02 12:32:09.660396 (Thread-1): Finished running node model.snowflake_aicd.W_CUSTOMERS_D
2022-03-02 12:32:09.660528 (Thread-1): Began running node model.snowflake_aicd.W_DATE_D
2022-03-02 12:32:09.660679 (Thread-1): 09:32:09 | 12 of 20 START table model DBT_SQUARE.W_DATE_D....................... [RUN]
2022-03-02 12:32:09.660872 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-02 12:32:09.660973 (Thread-1): Compiling model.snowflake_aicd.W_DATE_D
2022-03-02 12:32:09.663667 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-02 12:32:09.664064 (Thread-1): finished collecting timing info
2022-03-02 12:32:09.665343 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_DATE_D"
2022-03-02 12:32:09.668087 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_DATE_D".
2022-03-02 12:32:09.668179 (Thread-1): On model.snowflake_aicd.W_DATE_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_DATE_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SQUARE.W_DATE_D  as
      (

SELECT 
	CAST(DATE_KEY AS NUMBER(9)) AS K_DATE_INTEGER_BK
	,CAST(DATE_COLUMN AS DATE) AS K_DATE_BK
	,CAST(FULL_DATE_DESC AS VARCHAR(64)) AS A_FULL_DATE_DESC
	,CAST(DAY_NUM_IN_WEEK AS NUMBER(1)) AS A_DAY_NUM_IN_WEEK
	,CAST(DAY_NUM_IN_MONTH AS NUMBER(2)) AS A_DAY_NUM_IN_MONTH
	,CAST(DAY_NUM_IN_YEAR AS NUMBER(3)) AS A_DAY_NUM_IN_YEAR
	,CAST(DAY_NAME AS VARCHAR(10)) AS A_DAY_NAME
	,CAST(DAY_ABBREV AS VARCHAR(3)) AS A_DAY_ABBREV
	,CAST(WEEKDAY_IND AS VARCHAR(64)) AS A_WEEKDAY_IND
	,CAST(US_HOLIDAY_IND AS VARCHAR(64)) AS A_US_HOLIDAY_IND
	,CAST(COMPANY_HOLIDAY_IND AS VARCHAR(64)) AS A_COMPANY_HOLIDAY_IND
	,CAST(MONTH_END_IND AS VARCHAR(64)) AS A_MONTH_END_IND
	,CAST(WEEK_BEGIN_DATE_NKEY AS NUMBER(9)) AS A_WEEK_BEGIN_DATE_NKEY
	,CAST(WEEK_BEGIN_DATE AS DATE) AS A_WEEK_BEGIN_DATE
	,CAST(WEEK_END_DATE_NKEY AS NUMBER(9)) AS A_WEEK_END_DATE_NKEY
	,CAST(WEEK_END_DATE AS DATE) AS A_WEEK_END_DATE
	,CAST(WEEK_NUM_IN_YEAR AS NUMBER(9)) AS A_WEEK_NUM_IN_YEAR
	,CAST(MONTH_NAME AS VARCHAR(10)) AS A_MONTH_NAME
	,CAST(MONTH_ABBREV AS VARCHAR(3)) AS A_MONTH_ABBREV
	,CAST(MONTH_NUM_IN_YEAR AS NUMBER(2)) AS A_MONTH_NUM_IN_YEAR
	,CAST(YEARMONTH AS VARCHAR(10)) AS A_YEARMONTH
	,CAST(CURRENT_QUARTER AS NUMBER(1)) AS A_QUARTER
	,CAST(YEARQUARTER AS VARCHAR(10)) AS A_YEARQUARTER
	,CAST(CURRENT_YEAR AS NUMBER(5)) AS A_YEAR
	,CAST(FISCAL_WEEK_NUM AS NUMBER(2)) AS A_FISCAL_WEEK_NUM
	,CAST(FISCAL_MONTH_NUM AS NUMBER(2)) AS A_FISCAL_MONTH_NUM
	,CAST(FISCAL_YEARMONTH AS VARCHAR(10)) AS A_FISCAL_YEARMONTH
	,CAST(FISCAL_QUARTER AS NUMBER(1)) AS A_FISCAL_QUARTER
	,CAST(FISCAL_YEARQUARTER AS VARCHAR(10)) AS A_FISCAL_YEARQUARTER
	,CAST(FISCAL_HALFYEAR AS NUMBER(1)) AS A_FISCAL_HALFYEAR
	,CAST(FISCAL_YEAR AS NUMBER(5)) AS A_FISCAL_YEAR
	,CAST(SQL_TIMESTAMP AS TIMESTAMP_NTZ) AS A_SQL_TIMESTAMP_DTS
	,CAST(CURRENT_ROW_IND AS CHAR(1)) AS A_CURRENT_ROW_IND
	,CAST(EFFECTIVE_DATE AS DATE) AS A_EFFECTIVE_DATE
	,CAST(EXPIRA_DATE AS DATE) AS A_EXPIRATION_DATE
FROM
DEVELOPER_SANDBOX.DBT_SQUARE.V_DATE_STG
      );
2022-03-02 12:32:09.668281 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:32:13.930104 (Thread-1): SQL status: SUCCESS 1 in 4.26 seconds
2022-03-02 12:32:13.938225 (Thread-1): finished collecting timing info
2022-03-02 12:32:13.938867 (Thread-1): On model.snowflake_aicd.W_DATE_D: Close
2022-03-02 12:32:14.463593 (Thread-1): 09:32:14 | 12 of 20 OK created table model DBT_SQUARE.W_DATE_D.................. [SUCCESS 1 in 4.80s]
2022-03-02 12:32:14.464451 (Thread-1): Finished running node model.snowflake_aicd.W_DATE_D
2022-03-02 12:32:14.465637 (Thread-1): Began running node model.snowflake_aicd.W_MERCHANT_LOCATION_D
2022-03-02 12:32:14.474998 (Thread-1): 09:32:14 | 13 of 20 START table model DBT_SQUARE.W_MERCHANT_LOCATION_D.......... [RUN]
2022-03-02 12:32:14.477396 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_MERCHANT_LOCATION_D".
2022-03-02 12:32:14.477881 (Thread-1): Compiling model.snowflake_aicd.W_MERCHANT_LOCATION_D
2022-03-02 12:32:14.481657 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_MERCHANT_LOCATION_D"
2022-03-02 12:32:14.482024 (Thread-1): finished collecting timing info
2022-03-02 12:32:14.483405 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_MERCHANT_LOCATION_D"
2022-03-02 12:32:14.484001 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_MERCHANT_LOCATION_D".
2022-03-02 12:32:14.484098 (Thread-1): On model.snowflake_aicd.W_MERCHANT_LOCATION_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_MERCHANT_LOCATION_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SQUARE.W_MERCHANT_LOCATION_D  as
      (


SELECT
  *
FROM
  DEVELOPER_SANDBOX.DBT_SQUARE.V_MERCHANT_LOCATION_STG AS M
      );
2022-03-02 12:32:14.484199 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:32:17.717025 (Thread-1): SQL status: SUCCESS 1 in 3.23 seconds
2022-03-02 12:32:17.723365 (Thread-1): finished collecting timing info
2022-03-02 12:32:17.725332 (Thread-1): On model.snowflake_aicd.W_MERCHANT_LOCATION_D: Close
2022-03-02 12:32:18.189571 (Thread-1): 09:32:18 | 13 of 20 OK created table model DBT_SQUARE.W_MERCHANT_LOCATION_D..... [SUCCESS 1 in 3.71s]
2022-03-02 12:32:18.190048 (Thread-1): Finished running node model.snowflake_aicd.W_MERCHANT_LOCATION_D
2022-03-02 12:32:18.190299 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_STG
2022-03-02 12:32:18.190575 (Thread-1): 09:32:18 | 14 of 20 START view model DBT_SQUARE.V_ORDER_LINE_ITEM_STG........... [RUN]
2022-03-02 12:32:18.191147 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_STG".
2022-03-02 12:32:18.191424 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_STG
2022-03-02 12:32:18.198059 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_STG"
2022-03-02 12:32:18.198797 (Thread-1): finished collecting timing info
2022-03-02 12:32:18.202416 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_STG"
2022-03-02 12:32:18.214235 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_STG".
2022-03-02 12:32:18.214523 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_LINE_ITEM_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SQUARE_ALT13."ORDER_LINE_ITEM"
),
source_item_variation AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SQUARE_ALT13."CATALOG_ITEM_VARIATION"
),
source_order AS (
SELECT DISTINCT K_POS_ORDER_DLHK,K_POS_LOCATION_BK  FROM  DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_HEADER_STG
),
source_category AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DBT_SQUARE.V_CATALOG_CATEGORY_STG
),
source_item AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SQUARE_ALT13."CATALOG_ITEM"
),
rename AS 
(
SELECT
 MD5 (S.UID) AS K_POS_ORDER_LINE_DLHK
  ,MD5 (TRIM(S.ORDER_ID)) AS K_POS_ORDER_DLHK
  ,MD5( TRIM(COALESCE(S.CATALOG_OBJECT_ID, '00000000000000000000000000000000'))  ) AS K_POS_CATALOG_OBJECT_DLHK
  ,MD5( TRIM(COALESCE(SIT.ID,  '00000000000000000000000000000000'))) AS K_POS_CATALOG_OBJECT_ITEM_DLHK
  ,MD5( TRIM(COALESCE(TOTAL_CURRENCY, '00000000000000000000000000000000')) ) AS K_CURRENCY_DLHK
--BUSINESS KEYS
  ,S.UID AS K_POS_ORDER_LINE_BK
  ,S.ORDER_ID AS K_POS_ORDER_BK  
  ,S.CATALOG_OBJECT_ID AS K_POS_CATALOG_OBJECT_BK
  ,SIT.ID AS K_POS_CATALOG_OBJECT_ITEM_BK
  ,O.K_POS_LOCATION_BK
--OTHER FIELDS
  ,COALESCE(SIT.NAME,SI.NAME,S.NAME,'None') AS A_POS_PRODUCT_NAME
  ,SI.NAME AS A_POS_PRODUCT_VARIATION_NAME
  ,COALESCE(CAT.A_POS_PRODUCT_CATEGORY, 'No Category') AS A_POS_CATEGORY_NAME
  ,S.NAME AS A_POS_ORDER_LINE_NAME
  ,S.QUANTITY AS M_POS_ORDER_LINE_QUANTITY
  ,S.NOTE AS A_POS_ORDER_LINE_NOTE  
  ,S.VARIATION_NAME AS A_POS_ORDER_LINE_VARIATION_NAME
  ,SI.PRICE_MONEY_CURRENCY AS A_POS_VARIATION_PRICE_MONEY_CURRENCY
--METRIC
  ,ROUND(NVL(SI.PRICE_MONEY_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_POS_ITEM_VARIATION_PRICE_MONEY_AMOUNT
  ,ROUND(NVL(S.BASE_PRICE_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_ORDER_LINE_BASE_PRICE_AMT
  ,ROUND(NVL(S.GROSS_SALES_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_ORDER_LINE_GROSS_SALES_AMT
  ,ROUND(NVL(S.TOTAL_TAX_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_ORDER_LINE_TOTAL_TAX_AMT
  ,ROUND(NVL(S.TOTAL_DISCOUNT_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_ORDER_LINE_TOTAL_DISCOUNT_AMT
  ,ROUND(NVL(S.TOTAL_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_ORDER_LINE_TOTAL_AMT
  ,ROUND(NVL(S.GROSS_SALES_AMOUNT, 000)/100, 2) - ROUND(NVL(TOTAL_DISCOUNT_AMOUNT, 000)/100, 2) AS M_POS_ITEM_NET_AMT
FROM source S
LEFT JOIN source_order O ON O.K_POS_ORDER_DLHK = MD5(TRIM(S.ORDER_ID))
LEFT JOIN source_item_variation AS SI ON SI.ID = S.CATALOG_OBJECT_ID
LEFT JOIN source_item AS SIT ON SIT.ID = SI.ITEM_ID
LEFT JOIN source_category AS CAT ON CAT.K_POS_CATALOG_CATEGORY_BK = SIT.CATEGORY_ID
)

SELECT 
 MD5(CONCAT(K_POS_CATALOG_OBJECT_DLHK,K_POS_LOCATION_BK,A_POS_PRODUCT_NAME,COALESCE(A_POS_ORDER_LINE_VARIATION_NAME,'NA'),K_POS_CATALOG_OBJECT_ITEM_DLHK)) AS K_POS_CATALOG_OBJECT_HASH_DLHK,
* FROM rename
  );
2022-03-02 12:32:18.214804 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:32:20.375209 (Thread-1): SQL status: SUCCESS 1 in 2.16 seconds
2022-03-02 12:32:20.380193 (Thread-1): finished collecting timing info
2022-03-02 12:32:20.380702 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_STG: Close
2022-03-02 12:32:20.848459 (Thread-1): 09:32:20 | 14 of 20 OK created view model DBT_SQUARE.V_ORDER_LINE_ITEM_STG...... [SUCCESS 1 in 2.66s]
2022-03-02 12:32:20.849237 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_STG
2022-03-02 12:32:20.849961 (Thread-1): Began running node model.snowflake_aicd.W_PAYMENTS_F
2022-03-02 12:32:20.850703 (Thread-1): 09:32:20 | 15 of 20 START table model DBT_SQUARE.W_PAYMENTS_F................... [RUN]
2022-03-02 12:32:20.851667 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_PAYMENTS_F".
2022-03-02 12:32:20.852459 (Thread-1): Compiling model.snowflake_aicd.W_PAYMENTS_F
2022-03-02 12:32:20.861612 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_PAYMENTS_F"
2022-03-02 12:32:20.862161 (Thread-1): finished collecting timing info
2022-03-02 12:32:20.863926 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_PAYMENTS_F"
2022-03-02 12:32:20.865338 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_PAYMENTS_F".
2022-03-02 12:32:20.865448 (Thread-1): On model.snowflake_aicd.W_PAYMENTS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_PAYMENTS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SQUARE.W_PAYMENTS_F  as
      (

SELECT
    K_POS_PAYMENT_DLHK 
    ,K_POS_MERCH_LOC_DLHK
    ,K_POS_ORDER_DLHK
    ,K_POS_CUSTOMER_DLHK 
    ,K_CURRENCY_DLHK
    ,K_EMPLOYEE_DLHK
    ,K_DATE_ID
    ,K_POS_PAYMENT_BK
    ,K_POS_PAYMENT_LOCATION_BK
    ,K_POS_PAYMENT_ORDER_BK
    ,K_POS_PAYMENT_CUSTOMER_BK
    ,K_EMPLOYEE_BK
    ,M_PAYMENT_MONEY_AMT
    ,M_PAYMENT_APP_FEE_AMT
    ,M_PAYMENT_REFUND_MONEY_AMT
    ,M_PAYMENT_TIP_AMT
    ,A_POS_PAYMENT_CURRENCY
    ,A_POS_PAYMENT_RECEIPT_NUMBER
    ,A_POS_PAYMENT_RECEIPT_URL
    ,A_POS_PAYMENT_SOURCE_TYPE
    ,A_POS_PAYMENT_STATUS
    ,A_POS_PAYMENT_CREATED_DTS
    ,A_POS_PAYMENT_UPDATED_DTS   
    ,MD_LOAD_DTS
    ,MD_HASH_COL
    ,MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SQUARE.V_PAYMENT_STG AS P
      );
2022-03-02 12:32:20.865552 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:32:26.332597 (Thread-1): SQL status: SUCCESS 1 in 5.47 seconds
2022-03-02 12:32:26.340524 (Thread-1): finished collecting timing info
2022-03-02 12:32:26.341201 (Thread-1): On model.snowflake_aicd.W_PAYMENTS_F: Close
2022-03-02 12:32:26.925741 (Thread-1): 09:32:26 | 15 of 20 OK created table model DBT_SQUARE.W_PAYMENTS_F.............. [SUCCESS 1 in 6.07s]
2022-03-02 12:32:26.926323 (Thread-1): Finished running node model.snowflake_aicd.W_PAYMENTS_F
2022-03-02 12:32:26.926902 (Thread-1): Began running node model.snowflake_aicd.V_CATALOG_ITEM_VARIATION_STG
2022-03-02 12:32:26.933299 (Thread-1): 09:32:26 | 16 of 20 START view model DBT_SQUARE.V_CATALOG_ITEM_VARIATION_STG.... [RUN]
2022-03-02 12:32:26.934220 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CATALOG_ITEM_VARIATION_STG".
2022-03-02 12:32:26.934692 (Thread-1): Compiling model.snowflake_aicd.V_CATALOG_ITEM_VARIATION_STG
2022-03-02 12:32:26.942735 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CATALOG_ITEM_VARIATION_STG"
2022-03-02 12:32:26.943162 (Thread-1): finished collecting timing info
2022-03-02 12:32:26.944585 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CATALOG_ITEM_VARIATION_STG"
2022-03-02 12:32:26.946351 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CATALOG_ITEM_VARIATION_STG".
2022-03-02 12:32:26.946455 (Thread-1): On model.snowflake_aicd.V_CATALOG_ITEM_VARIATION_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CATALOG_ITEM_VARIATION_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SQUARE.V_CATALOG_ITEM_VARIATION_STG  as (
    

WITH 
source AS (
SELECT * FROM  DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_LINE_ITEM_STG
), renamed AS (
 SELECT  DISTINCT
 --MD5 KEYS        
        K_POS_CATALOG_OBJECT_HASH_DLHK
        ,K_POS_CATALOG_OBJECT_DLHK AS K_POS_CATALOG_OBJECT_VARIATION_DLHK    
            
        ,K_POS_CATALOG_OBJECT_ITEM_DLHK AS K_POS_CATALOG_OBJECT_DLHK
        --BUSINESS KEYS
        ,K_POS_CATALOG_OBJECT_BK AS K_POS_CATALOG_OBJECT_VARIATION_BK   
        ,COALESCE(K_POS_LOCATION_BK,'N/A') AS K_POS_LOCATION_BK
        ,K_POS_CATALOG_OBJECT_ITEM_BK AS K_POS_CATALOG_OBJECT_BK
        --DESCRIPTION
        ,A_POS_PRODUCT_NAME AS A_POS_PRODUCT_NAME
        ,COALESCE(A_POS_ORDER_LINE_VARIATION_NAME, 'N/A') AS A_POS_PRODUCT_SUB_NAME
        ,A_POS_CATEGORY_NAME AS A_POS_CATEGORY_NAME
        , 'ORDER LINE ITEM VARIATION' AS A_POS_USAGE
        ,A_POS_VARIATION_PRICE_MONEY_CURRENCY AS A_POS_VARIATION_PRICE_MONEY_CURRENCY
        --METRIC
        ,M_POS_ITEM_VARIATION_PRICE_MONEY_AMOUNT AS M_POS_PRICE_MONEY_AMOUNT
        --metadata (MD)
        , CURRENT_TIMESTAMP AS MD_LOAD_DTS        
        , 'f023f503-a01b-4501-91a5-424921ffc4ca' AS MD_INTGR_ID
FROM source
)

SELECT
*
FROM
renamed
  );
2022-03-02 12:32:26.946559 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:32:28.936846 (Thread-1): SQL status: SUCCESS 1 in 1.99 seconds
2022-03-02 12:32:28.950669 (Thread-1): finished collecting timing info
2022-03-02 12:32:28.951500 (Thread-1): On model.snowflake_aicd.V_CATALOG_ITEM_VARIATION_STG: Close
2022-03-02 12:32:29.426612 (Thread-1): 09:32:29 | 16 of 20 OK created view model DBT_SQUARE.V_CATALOG_ITEM_VARIATION_STG [SUCCESS 1 in 2.49s]
2022-03-02 12:32:29.427295 (Thread-1): Finished running node model.snowflake_aicd.V_CATALOG_ITEM_VARIATION_STG
2022-03-02 12:32:29.428130 (Thread-1): Began running node model.snowflake_aicd.V_ORDER_LINE_ITEM_MODIFIER_STG
2022-03-02 12:32:29.430437 (Thread-1): 09:32:29 | 17 of 20 START view model DBT_SQUARE.V_ORDER_LINE_ITEM_MODIFIER_STG.. [RUN]
2022-03-02 12:32:29.431479 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_MODIFIER_STG".
2022-03-02 12:32:29.437510 (Thread-1): Compiling model.snowflake_aicd.V_ORDER_LINE_ITEM_MODIFIER_STG
2022-03-02 12:32:29.443278 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_MODIFIER_STG"
2022-03-02 12:32:29.443681 (Thread-1): finished collecting timing info
2022-03-02 12:32:29.445076 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_ORDER_LINE_ITEM_MODIFIER_STG"
2022-03-02 12:32:29.449422 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_ORDER_LINE_ITEM_MODIFIER_STG".
2022-03-02 12:32:29.449600 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_MODIFIER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_ORDER_LINE_ITEM_MODIFIER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_LINE_ITEM_MODIFIER_STG  as (
    

WITH source AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SQUARE_ALT13."ORDER_LINE_ITEM_MODIFIER"
),
source_order AS (
SELECT DISTINCT K_POS_ORDER_DLHK,K_POS_LOCATION_BK  FROM  DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_HEADER_STG
),
source_order_line_item AS (
SELECT DISTINCT A_POS_CATEGORY_NAME,K_POS_ORDER_DLHK,K_POS_CATALOG_OBJECT_DLHK,K_POS_CATALOG_OBJECT_BK, K_POS_ORDER_LINE_BK,A_POS_ORDER_LINE_NAME,A_POS_ORDER_LINE_VARIATION_NAME,K_POS_ORDER_BK FROM  DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_LINE_ITEM_STG
),
source_catalog_modifier AS (
  SELECT * FROM  DEVELOPER_SANDBOX.DEMO_SQUARE_ALT13."CATALOG_MODIFIER"
),

source_catalog_modifier AS (
  SELECT NULL AS ID, NULL AS NAME, NULL AS PRICE_MONEY_AMOUNT, NULL AS PRICE_MONEY_CURRENCY WHERE FALSE
),

rename AS 
(
 SELECT
      --MD5 KEYS
        MD5( UID ) AS K_POS_ORDER_ITEM_MODIFIER_DLHK 
        ,MD5( TRIM(COALESCE(ORDER_ID, '00000000000000000000000000000000'))  ) AS K_POS_ORDER_DLHK
        ,MD5( TRIM(COALESCE(ORDER_LINE_ITEM_ID, '00000000000000000000000000000000'))  ) AS K_POS_ORDER_LINE_ITEM_DLHK
        ,MD5( TRIM(COALESCE(CATALOG_OBJECT_ID, '00000000000000000000000000000000')) ) AS K_POS_CATALOG_OBJECT_DLHK
        ,OLI.K_POS_CATALOG_OBJECT_DLHK AS K_POS_CATALOG_OBJECT_ITEM_DLHK
        ,MD5(CONCAT(MD5(TRIM(COALESCE(CATALOG_OBJECT_ID, '00000000000000000000000000000000'))) ,'-',COALESCE(O.K_POS_LOCATION_BK,'00000000000000000000000000000000'),'-',COALESCE(CM.NAME, S.NAME,'None'),'-',OLI.K_POS_CATALOG_OBJECT_DLHK)) AS K_POS_CATALOG_OBJECT_DLHK_2 
        ,CONCAT(MD5(TRIM(COALESCE(CATALOG_OBJECT_ID, '00000000000000000000000000000000'))) ,'-',COALESCE(O.K_POS_LOCATION_BK,'00000000000000000000000000000000'),'-',COALESCE(CM.NAME, S.NAME,'None'),'-',OLI.K_POS_CATALOG_OBJECT_DLHK) AS K_POS_CATALOG_OBJECT_DLHK_3
     
        ,MD5( TRIM(COALESCE(TOTAL_PRICE_CURRENCY, '00000000000000000000000000000000')) ) AS K_CURRENCY_DLHK 
        --BUSINESS KEYS
        ,UID AS K_POS_ORDER_ITEM_MODIFIER_BK        
        ,ORDER_ID AS K_POS_ORDER_BK
        ,ORDER_LINE_ITEM_ID AS K_POS_ORDER_LINE_ITEM_BK
        ,CATALOG_OBJECT_ID AS K_POS_CATALOG_OBJECT_BK
        ,OLI.K_POS_CATALOG_OBJECT_BK AS K_POS_CATALOG_OBJECT_ITEM_BK
        ,O.K_POS_LOCATION_BK
        
        --ATTRIBUTES
        ,S.NAME AS A_POS_ORDER_LINE_MODIFIER_NAME
        ,COALESCE(CM.NAME, S.NAME) AS A_POS_PRODUCT_NAME
        ,CM.NAME AS A_POS_MODIFIER_NAME
        ,OLI.A_POS_CATEGORY_NAME
        ,CM.PRICE_MONEY_CURRENCY AS A_POS_CATALOG_MODIFIER_PRICE_MONEY_CURRENCY
        
        --METRICS
        ,CM.PRICE_MONEY_AMOUNT AS M_CATALOG_MODIFIER_PRICE_MONEY_AMOUNT 
        ,ROUND(NVL(BASE_PRICE_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_BASE_PRICE_AMT
        ,ROUND(NVL(TOTAL_PRICE_AMOUNT, 000)/100, 2)::decimal(15,2) AS M_TOTAL_PRICE_AMOUNT         
        --METADATA
        , CURRENT_TIMESTAMP AS MD_LOAD_DTS
        , 'f023f503-a01b-4501-91a5-424921ffc4ca' AS MD_INTGR_ID
FROM source S
LEFT JOIN source_catalog_modifier AS CM ON CM.ID = S.CATALOG_OBJECT_ID
LEFT JOIN source_order O ON O.K_POS_ORDER_DLHK =MD5( TRIM(COALESCE( S.ORDER_ID, '00000000000000000000000000000000'))  )
LEFT JOIN source_order_line_item as OLI ON  S.ORDER_LINE_ITEM_ID = OLI.K_POS_ORDER_LINE_BK AND S.ORDER_ID = OLI.K_POS_ORDER_BK 
)

SELECT 
 MD5(CONCAT(K_POS_CATALOG_OBJECT_DLHK,K_POS_LOCATION_BK,A_POS_PRODUCT_NAME,COALESCE(A_POS_MODIFIER_NAME,'NA'),K_POS_CATALOG_OBJECT_ITEM_DLHK)) AS K_POS_CATALOG_OBJECT_HASH_DLHK,
*
 FROM rename
  );
2022-03-02 12:32:29.449724 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:32:31.572106 (Thread-1): SQL status: SUCCESS 1 in 2.12 seconds
2022-03-02 12:32:31.575362 (Thread-1): finished collecting timing info
2022-03-02 12:32:31.575612 (Thread-1): On model.snowflake_aicd.V_ORDER_LINE_ITEM_MODIFIER_STG: Close
2022-03-02 12:32:32.032280 (Thread-1): 09:32:32 | 17 of 20 OK created view model DBT_SQUARE.V_ORDER_LINE_ITEM_MODIFIER_STG [SUCCESS 1 in 2.60s]
2022-03-02 12:32:32.032824 (Thread-1): Finished running node model.snowflake_aicd.V_ORDER_LINE_ITEM_MODIFIER_STG
2022-03-02 12:32:32.033670 (Thread-1): Began running node model.snowflake_aicd.V_CATALOG_ITEM_MODIFIER_STG
2022-03-02 12:32:32.033944 (Thread-1): 09:32:32 | 18 of 20 START view model DBT_SQUARE.V_CATALOG_ITEM_MODIFIER_STG..... [RUN]
2022-03-02 12:32:32.034224 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.V_CATALOG_ITEM_MODIFIER_STG".
2022-03-02 12:32:32.034330 (Thread-1): Compiling model.snowflake_aicd.V_CATALOG_ITEM_MODIFIER_STG
2022-03-02 12:32:32.036768 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.V_CATALOG_ITEM_MODIFIER_STG"
2022-03-02 12:32:32.037352 (Thread-1): finished collecting timing info
2022-03-02 12:32:32.038679 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.V_CATALOG_ITEM_MODIFIER_STG"
2022-03-02 12:32:32.040652 (Thread-1): Using snowflake connection "model.snowflake_aicd.V_CATALOG_ITEM_MODIFIER_STG".
2022-03-02 12:32:32.040773 (Thread-1): On model.snowflake_aicd.V_CATALOG_ITEM_MODIFIER_STG: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.V_CATALOG_ITEM_MODIFIER_STG"} */

  create or replace  view DEVELOPER_SANDBOX.DBT_SQUARE.V_CATALOG_ITEM_MODIFIER_STG  as (
    

WITH 
source AS (
SELECT * FROM  DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_LINE_ITEM_MODIFIER_STG
), renamed AS (
SELECT DISTINCT
       --MD5 KEYS
       K_POS_CATALOG_OBJECT_HASH_DLHK
        ,K_POS_CATALOG_OBJECT_DLHK AS K_POS_CATALOG_MODIFIER_DLHK
        ,K_POS_CATALOG_OBJECT_ITEM_DLHK AS K_POS_CATALOG_OBJECT_DLHK         
        --BUSINESS KEYS        
        ,K_POS_CATALOG_OBJECT_BK AS K_POS_CATALOG_MODIFIER_BK
        ,K_POS_CATALOG_OBJECT_ITEM_BK AS K_POS_CATALOG_OBJECT_BK
        ,COALESCE(K_POS_LOCATION_BK,'N/A') AS K_POS_LOCATION_BK 
        --ATTRIBUTES
        ,A_POS_PRODUCT_NAME AS A_POS_PRODUCT_NAME
        ,NULL AS A_POS_PRODUCT_SUB_NAME        
        ,COALESCE(A_POS_CATEGORY_NAME,'No Category') AS A_POS_CATEGORY_NAME 
        ,'ORDER LINE ITEM MODIFIER' AS A_POS_USAGE       
        --METRICS
        ,M_CATALOG_MODIFIER_PRICE_MONEY_AMOUNT AS M_PRICE_MONEY_AMOUNT
              
        --DESCRIPTION
        ,A_POS_CATALOG_MODIFIER_PRICE_MONEY_CURRENCY AS A_POS_PRICE_MONEY_CURRENCY  
        ,A_POS_MODIFIER_NAME AS A_POS_CATALOG_MODIFIER_NAME
        --metadata (MD)
        ,CURRENT_TIMESTAMP AS MD_LOAD_DTS        
        ,'f023f503-a01b-4501-91a5-424921ffc4ca' AS MD_INTGR_ID
FROM
   source
)

SELECT 
*
FROM renamed
  );
2022-03-02 12:32:32.040880 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:32:34.346780 (Thread-1): SQL status: SUCCESS 1 in 2.31 seconds
2022-03-02 12:32:34.352183 (Thread-1): finished collecting timing info
2022-03-02 12:32:34.352944 (Thread-1): On model.snowflake_aicd.V_CATALOG_ITEM_MODIFIER_STG: Close
2022-03-02 12:32:34.922080 (Thread-1): 09:32:34 | 18 of 20 OK created view model DBT_SQUARE.V_CATALOG_ITEM_MODIFIER_STG [SUCCESS 1 in 2.89s]
2022-03-02 12:32:34.922750 (Thread-1): Finished running node model.snowflake_aicd.V_CATALOG_ITEM_MODIFIER_STG
2022-03-02 12:32:34.923291 (Thread-1): Began running node model.snowflake_aicd.W_ORDERS_F
2022-03-02 12:32:34.924299 (Thread-1): 09:32:34 | 19 of 20 START table model DBT_SQUARE.W_ORDERS_F..................... [RUN]
2022-03-02 12:32:34.925388 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-02 12:32:34.925888 (Thread-1): Compiling model.snowflake_aicd.W_ORDERS_F
2022-03-02 12:32:34.936598 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-02 12:32:34.937219 (Thread-1): finished collecting timing info
2022-03-02 12:32:34.938788 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_ORDERS_F"
2022-03-02 12:32:34.944096 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_ORDERS_F".
2022-03-02 12:32:34.944201 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_ORDERS_F"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SQUARE.W_ORDERS_F  as
      (

WITH source_item_allocated as (
  select 
        MAX(OLI.M_ORDER_LINE_BASE_PRICE_AMT)/COUNT(1) AS M_POS_ITEM_BASE_PRICE_AMT
        ,MAX(OLI.M_ORDER_LINE_GROSS_SALES_AMT)/COUNT(DISTINCT COALESCE(OLIM.K_POS_ORDER_ITEM_MODIFIER_DLHK,OLI.K_POS_ORDER_LINE_DLHK)) AS M_ORDER_LINE_GROSS_SALES_AMT
        ,K_POS_ORDER_LINE_BK
        ,OLI.K_POS_ORDER_BK
        FROM 
        DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_LINE_ITEM_STG OLI
        LEFT JOIN DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_LINE_ITEM_MODIFIER_STG OLIM ON OLIM.K_POS_ORDER_LINE_ITEM_BK = OLI.K_POS_ORDER_LINE_BK AND OLIM.K_POS_ORDER_BK = OLI.K_POS_ORDER_BK
        GROUP BY K_POS_ORDER_LINE_BK, OLI.K_POS_ORDER_BK
),
source_order_allocated as (
  select MAX(O.M_NET_TIP_MONEY_AMT)/COUNT(1) AS M_NET_TIP_MONEY_AMT
        ,MAX(O.M_TOTAL_SERVICE_CHARGE_AMT)/COUNT(1) AS M_TOTAL_SERVICE_CHARGE_AMT        
        ,O.K_POS_ORDER_DLHK  
        FROM 

        DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_HEADER_STG O
        LEFT JOIN DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_LINE_ITEM_STG OLI ON OLI.K_POS_ORDER_DLHK = O.K_POS_ORDER_DLHK AND OLI.K_POS_ORDER_BK = O.K_POS_ORDER_BK
        LEFT JOIN DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_LINE_ITEM_MODIFIER_STG OLIM ON OLIM.K_POS_ORDER_LINE_ITEM_BK = OLI.K_POS_ORDER_LINE_BK AND OLIM.K_POS_ORDER_BK = OLI.K_POS_ORDER_BK
        GROUP BY O.K_POS_ORDER_DLHK
),
final as (
SELECT
  O.K_POS_ORDER_DLHK
  ,O.K_POS_LOCATION_DLHK
  ,O.K_POS_REFERENCE_DLHK
  ,O.K_POS_CUSTOMER_DLHK
  ,O.K_POS_ORDER_BK
  ,O.K_POS_LOCATION_BK
  ,O.K_POS_CUSTOMER_BK
  ,O.K_POS_REFERENCE_BK
  ,O.A_ORDER_CREATED_DTS
  ,O.A_ORDER_UPDATED_DTS
  ,O.A_ORDER_CLOSED_DTS
  ,O.A_ORDER_STATE
  ,O.A_ORDER_SOURCE
  ,OLI.K_POS_ORDER_LINE_DLHK
  ,COALESCE(OLIM.K_POS_CATALOG_OBJECT_HASH_DLHK,OLI.K_POS_CATALOG_OBJECT_HASH_DLHK) AS K_POS_CATALOG_OBJECT_DLHK
  ,OLI.K_CURRENCY_DLHK
  ,OLI.K_POS_ORDER_LINE_BK
  ,OLI.A_POS_ORDER_LINE_NAME
  ,OLI.M_POS_ORDER_LINE_QUANTITY
  ,OLI.A_POS_ORDER_LINE_NOTE  
  ,OLI.A_POS_ORDER_LINE_VARIATION_NAME
  --,COALESCE(SIA.M_POS_ITEM_BASE_PRICE_AMT,0) + COALESCE(OLIM.M_BASE_PRICE_AMT,OLI.M_ORDER_LINE_BASE_PRICE_AMT) AS M_ALLOCATED_BASE_PRICE_AMT 
  ,ROUND(DIV0((OLI.M_ORDER_LINE_GROSS_SALES_AMT * SIA.M_ORDER_LINE_GROSS_SALES_AMT), OLI.M_ORDER_LINE_GROSS_SALES_AMT),4)::decimal(15,4) AS M_ALLOCATED_ORDER_LINE_GROSS_SALES_AMT  
  ,ROUND(DIV0((OLI.M_ORDER_LINE_TOTAL_TAX_AMT * M_ALLOCATED_ORDER_LINE_GROSS_SALES_AMT), OLI.M_ORDER_LINE_GROSS_SALES_AMT),4)::decimal(15,4) AS M_ALLOCATED_ORDER_LINE_TOTAL_TAX_AMT  
  ,ROUND(DIV0((OLI.M_ORDER_LINE_TOTAL_DISCOUNT_AMT * M_ALLOCATED_ORDER_LINE_GROSS_SALES_AMT), OLI.M_ORDER_LINE_GROSS_SALES_AMT),4)::decimal(15,4) AS M_ALLOCATED_ORDER_LINE_TOTAL_DISCOUNT_AMT  
  ,ROUND(DIV0((OLI.M_POS_ITEM_NET_AMT * M_ALLOCATED_ORDER_LINE_GROSS_SALES_AMT), OLI.M_ORDER_LINE_GROSS_SALES_AMT),4)::decimal(15,4) AS M_ALLOCATED_POS_ITEM_NET_AMT  
  ,M_ALLOCATED_POS_ITEM_NET_AMT + M_ALLOCATED_ORDER_LINE_TOTAL_TAX_AMT AS M_ALLOCATED_POS_TOTAL_AMT
  ,ROUND(DIV0((O.M_NET_TIP_MONEY_AMT * M_ALLOCATED_ORDER_LINE_GROSS_SALES_AMT),O.M_TOTAL_AMT - O.M_TAX_TOTAL_AMT + O.M_DISCOUNT_TOTAL_AMT - O.M_NET_TIP_MONEY_AMT),4)::decimal(15,4) as M_ALLOCATED_NET_TIP_MONEY_AMT
  ,ROUND(DIV0((O.M_TOTAL_SERVICE_CHARGE_AMT * M_ALLOCATED_ORDER_LINE_GROSS_SALES_AMT),O.M_TOTAL_AMT - O.M_TAX_TOTAL_AMT + O.M_DISCOUNT_TOTAL_AMT - O.M_NET_TIP_MONEY_AMT),4)::decimal(15,4) as M_ALLOCATED_TOTAL_SERVICE_CHARGE_AMT
  ,NVL(OLIM.M_BASE_PRICE_AMT,000)::decimal(15,4) AS M_POS_ITEM_MOD_PRICE_AMT
  ,NVL(OLIM.M_TOTAL_PRICE_AMOUNT,000)::decimal(15,4) AS M_POS_ITEM_MOD_TOTAL_AMT  
  ,O.MD_LOAD_DTS
  ,O.MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_HEADER_STG AS O 
  INNER JOIN DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_LINE_ITEM_STG OLI ON OLI.K_POS_ORDER_DLHK = O.K_POS_ORDER_DLHK
  LEFT JOIN DEVELOPER_SANDBOX.DBT_SQUARE.V_ORDER_LINE_ITEM_MODIFIER_STG OLIM ON OLIM.K_POS_ORDER_LINE_ITEM_BK = OLI.K_POS_ORDER_LINE_BK AND OLIM.K_POS_ORDER_BK = OLI.K_POS_ORDER_BK
  LEFT JOIN source_item_allocated SIA ON SIA.K_POS_ORDER_LINE_BK = OLI.K_POS_ORDER_LINE_BK AND SIA.K_POS_ORDER_BK = OLI.K_POS_ORDER_BK
  LEFT JOIN source_order_allocated SOA ON SOA.K_POS_ORDER_DLHK = O.K_POS_ORDER_DLHK  
)

SELECT * FROM final
      );
2022-03-02 12:32:34.944314 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:32:51.306255 (Thread-1): SQL status: SUCCESS 1 in 16.36 seconds
2022-03-02 12:32:51.314732 (Thread-1): finished collecting timing info
2022-03-02 12:32:51.315406 (Thread-1): On model.snowflake_aicd.W_ORDERS_F: Close
2022-03-02 12:32:51.772234 (Thread-1): 09:32:51 | 19 of 20 OK created table model DBT_SQUARE.W_ORDERS_F................ [SUCCESS 1 in 16.85s]
2022-03-02 12:32:51.772816 (Thread-1): Finished running node model.snowflake_aicd.W_ORDERS_F
2022-03-02 12:32:51.773326 (Thread-1): Began running node model.snowflake_aicd.W_CATALOG_ITEM_D
2022-03-02 12:32:51.774146 (Thread-1): 09:32:51 | 20 of 20 START table model DBT_SQUARE.W_CATALOG_ITEM_D............... [RUN]
2022-03-02 12:32:51.775520 (Thread-1): Acquiring new snowflake connection "model.snowflake_aicd.W_CATALOG_ITEM_D".
2022-03-02 12:32:51.776362 (Thread-1): Compiling model.snowflake_aicd.W_CATALOG_ITEM_D
2022-03-02 12:32:51.786070 (Thread-1): Writing injected SQL for node "model.snowflake_aicd.W_CATALOG_ITEM_D"
2022-03-02 12:32:51.786562 (Thread-1): finished collecting timing info
2022-03-02 12:32:51.788149 (Thread-1): Writing runtime SQL for node "model.snowflake_aicd.W_CATALOG_ITEM_D"
2022-03-02 12:32:51.790093 (Thread-1): Using snowflake connection "model.snowflake_aicd.W_CATALOG_ITEM_D".
2022-03-02 12:32:51.790223 (Thread-1): On model.snowflake_aicd.W_CATALOG_ITEM_D: /* {"app": "dbt", "dbt_version": "0.21.1", "profile_name": "snowflake_aicd", "target_name": "dev", "node_id": "model.snowflake_aicd.W_CATALOG_ITEM_D"} */


      create or replace  table DEVELOPER_SANDBOX.DBT_SQUARE.W_CATALOG_ITEM_D  as
      (


SELECT
  --MD5 KEYS
  K_POS_CATALOG_OBJECT_HASH_DLHK
  ,K_POS_CATALOG_OBJECT_VARIATION_DLHK AS K_POS_CATALOG_OBJECT_DLHK
  ,K_POS_CATALOG_OBJECT_DLHK AS K_POS_CATALOG_OBJECT_ITEM_DLHK
  --BUSINESS KEYS
  ,K_POS_CATALOG_OBJECT_VARIATION_BK AS K_POS_CATALOG_OBJECT_BK
  ,K_POS_LOCATION_BK
  ,K_POS_CATALOG_OBJECT_BK AS K_POS_CATALOG_OBJECT_ITEM_BK
  --ATTRIBUTUES
  
  ,A_POS_PRODUCT_SUB_NAME AS A_POS_CATALOG_OBJECT_NAME
  ,A_POS_PRODUCT_NAME
 
  ,A_POS_CATEGORY_NAME
  ,A_POS_USAGE
  ,A_POS_VARIATION_PRICE_MONEY_CURRENCY AS A_POS_PRICE_MONEY_CURRENY
  --,A_POS_VARIATION_PRICING_TYPE AS A_POS_PRICING_TYPE
  --METRICS
  ,M_POS_PRICE_MONEY_AMOUNT
  --METADATA
  ,MD_LOAD_DTS
  ,MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SQUARE.V_CATALOG_ITEM_VARIATION_STG AS CIV

UNION ALL

SELECT
    --MD5 KEYS
    K_POS_CATALOG_OBJECT_HASH_DLHK
    ,K_POS_CATALOG_MODIFIER_DLHK
    ,K_POS_CATALOG_OBJECT_DLHK
    --BUSINESS KEYS
    ,K_POS_CATALOG_MODIFIER_BK
    ,K_POS_LOCATION_BK
    ,K_POS_CATALOG_OBJECT_BK
     --ATTRIBUTES  
    ,A_POS_CATALOG_MODIFIER_NAME
    ,A_POS_PRODUCT_NAME

    ,A_POS_CATEGORY_NAME
    ,A_POS_USAGE
    ,A_POS_PRICE_MONEY_CURRENCY
    --,NULL AS A_POS_PRICING_TYPE
    --METRICS
    ,M_PRICE_MONEY_AMOUNT
    --METADATA (MD)
    ,MD_LOAD_DTS
    ,MD_INTGR_ID
FROM
  DEVELOPER_SANDBOX.DBT_SQUARE.V_CATALOG_ITEM_MODIFIER_STG AS CIM
      );
2022-03-02 12:32:51.790333 (Thread-1): Opening a new connection, currently in state closed
2022-03-02 12:32:57.011011 (Thread-1): SQL status: SUCCESS 1 in 5.22 seconds
2022-03-02 12:32:57.020703 (Thread-1): finished collecting timing info
2022-03-02 12:32:57.021316 (Thread-1): On model.snowflake_aicd.W_CATALOG_ITEM_D: Close
2022-03-02 12:32:57.495623 (Thread-1): 09:32:57 | 20 of 20 OK created table model DBT_SQUARE.W_CATALOG_ITEM_D.......... [SUCCESS 1 in 5.72s]
2022-03-02 12:32:57.496733 (Thread-1): Finished running node model.snowflake_aicd.W_CATALOG_ITEM_D
2022-03-02 12:32:57.507075 (MainThread): Acquiring new snowflake connection "master".
2022-03-02 12:32:57.514089 (MainThread): 09:32:57 | 
2022-03-02 12:32:57.514381 (MainThread): 09:32:57 | Finished running 13 view models, 7 table models in 81.66s.
2022-03-02 12:32:57.514533 (MainThread): Connection 'master' was properly closed.
2022-03-02 12:32:57.514627 (MainThread): Connection 'model.snowflake_aicd.W_CATALOG_ITEM_D' was properly closed.
2022-03-02 12:32:57.520983 (MainThread): 
2022-03-02 12:32:57.521169 (MainThread): Completed successfully
2022-03-02 12:32:57.521302 (MainThread): 
Done. PASS=20 WARN=0 ERROR=0 SKIP=0 TOTAL=20
2022-03-02 12:32:57.521515 (MainThread): Flushing usage events
